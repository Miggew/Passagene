import{r as u,s as f,j as e,B as ze,h as Re,U as He,f as na}from"./index-6OJhfjKP.js";import{a as ca,e as la,c as da,b as ma}from"./dataEnrichment-CmjlCNan.js";import{C as F,d as y,a as je,b as ve,c as Te}from"./card-D-gf0lmS.js";import{T as De,a as Oe,b as ie,c as g,d as Ie,e as p}from"./table-B_Z-CztY.js";import{S as U,a as Q,b as J,c as K,d as E}from"./select-B7v4ZPbC.js";import{I as ne}from"./input-_UHZ9n1P.js";import{B as Ee}from"./badge-ChTtRB_d.js";import{T as xa,a as ua,b as Ge,c as Pe}from"./tabs-DFK_xrkO.js";import{P as ha}from"./PageHeader-P7sO2uqv.js";import{u as ga}from"./use-toast-DasFaehQ.js";import{D as be}from"./DatePickerBR-CEQaSWUC.js";import{g as pa,u as fa,a as _a,c as ja,D as W,C as va,T as Ea,R as ba,v as Na}from"./useLotesTE-stbPxAew.js";import{B as Sa}from"./baby-CmAmI4OU.js";import{C as wa,F as Aa}from"./filter-cmdSYwTm.js";import{S as Fa}from"./save-CusHMB-Y.js";import{T as ya}from"./triangle-alert-pkIeF1ja.js";import{S as Ma}from"./search-DHWddfjN.js";import"./index-CtR1jODk.js";import"./check-CgmfRmMI.js";import"./index-ea8B15na.js";import"./chevron-right-BdMx8zjt.js";import"./popover-CUxnE3Xp.js";import"./dateUtils-eJ5e6apA.js";function Ya(){const{toast:G}=ga(),ce=pa(),[S,Ve]=u.useState(""),[n,Y]=u.useState(null),[w,D]=u.useState([]),[Xe,Ne]=u.useState(!1),[Se,we]=u.useState(!1),[B,P]=u.useState({}),[b,le]=u.useState({veterinario_responsavel:"",tecnico_responsavel:""}),[Le,Ae]=u.useState([]),[ke,Fe]=u.useState(!1),[de,$e]=u.useState("todos"),[ee,Be]=u.useState("todos"),[q,qe]=u.useState(""),[me,Ze]=u.useState(""),[xe,Ue]=u.useState(""),[Qe,Je]=u.useState([]),{fazendas:ue,loadFazendas:he}=fa({statusReceptoraFiltro:["PRENHE","PRENHE_RETOQUE"]}),Ke=u.useCallback((a,s)=>({...a,veterinario_sexagem:s==null?void 0:s.veterinario_responsavel,tecnico_sexagem:s==null?void 0:s.tecnico_responsavel}),[]),{lotesTE:ge,loading:pe,loadLotesTE:ye}=_a({statusReceptoraFiltro:["PRENHE","PRENHE_RETOQUE"],transformLote:Ke});u.useEffect(()=>{he(),We()},[he]),u.useEffect(()=>{var a;if(S){const s=(a=ue.find(i=>i.id===S))==null?void 0:a.nome;ye(S,s)}else Y(null),D([]),P({})},[S]),u.useEffect(()=>{n?((n.veterinario_sexagem||n.tecnico_sexagem)&&le({veterinario_responsavel:n.veterinario_sexagem||b.veterinario_responsavel,tecnico_responsavel:n.tecnico_sexagem||b.tecnico_responsavel}),Ye(n)):(D([]),P({}))},[n]);const We=async()=>{const{data:a}=await f.from("fazendas").select("id, nome").order("nome");Je(a||[])},Me=async()=>{try{Fe(!0);let a=f.from("diagnosticos_gestacao").select("*").eq("tipo_diagnostico","SEXAGEM").order("data_diagnostico",{ascending:!1}).limit(500);me&&(a=a.gte("data_diagnostico",me)),xe&&(a=a.lte("data_diagnostico",xe)),ee&&ee!=="todos"&&(a=a.eq("sexagem",ee));const{data:s,error:i}=await a;if(i)throw console.error("Erro ao buscar diagnósticos:",i),new Error(i.message||"Erro ao buscar diagnósticos");if(!s||s.length===0){Ae([]);return}const t=[...new Set(s.map(o=>o.receptora_id).filter(Boolean))],{data:m,error:h}=await f.from("receptoras").select("id, identificacao, nome").in("id",t);if(h)throw console.error("Erro ao buscar receptoras:",h),new Error(h.message||"Erro ao buscar receptoras");const A=new Map((m||[]).map(o=>[o.id,o])),{data:H,error:M}=await f.from("vw_receptoras_fazenda_atual").select("receptora_id, fazenda_id_atual, fazenda_nome_atual").in("receptora_id",t);M&&console.error("Erro ao buscar view receptoras:",M);const l=new Map((H||[]).map(o=>[o.receptora_id,o.fazenda_nome_atual])),d=s.map(o=>{const x=A.get(o.receptora_id);return{id:o.id,receptora_id:o.receptora_id,receptora_brinco:(x==null?void 0:x.identificacao)||"-",receptora_nome:x==null?void 0:x.nome,fazenda_nome:l.get(o.receptora_id)||"-",data_te:o.data_te,data_diagnostico:o.data_diagnostico,resultado:o.resultado,sexagem:o.sexagem,numero_gestacoes:o.numero_gestacoes,observacoes:o.observacoes,veterinario_responsavel:o.veterinario_responsavel,tecnico_responsavel:o.tecnico_responsavel}});Ae(d)}catch(a){console.error("Erro no loadHistorico:",a);const s=a instanceof Error?a.message:typeof a=="object"&&a!==null&&"message"in a?String(a.message):"Erro desconhecido";G({title:"Erro ao carregar histórico",description:s,variant:"destructive"})}finally{Fe(!1)}},Ye=async a=>{try{Ne(!0);const{data:s}=await f.from("vw_receptoras_fazenda_atual").select("receptora_id").eq("fazenda_id_atual",a.fazenda_id),i=(s==null?void 0:s.map(r=>r.receptora_id))||[],{data:t}=await f.from("receptoras").select("id, identificacao, nome, status_reprodutivo").in("id",i).in("status_reprodutivo",["PRENHE","PRENHE_RETOQUE"]),m=(t==null?void 0:t.map(r=>r.id))||[];if(m.length===0){D([]);return}const[h,A,H]=await Promise.all([f.from("transferencias_embrioes").select("id, receptora_id, embriao_id, data_te").in("receptora_id",m).eq("data_te",a.data_te).eq("status_te","REALIZADA"),f.from("diagnosticos_gestacao").select("*").in("receptora_id",m).eq("tipo_diagnostico","DG").eq("data_te",a.data_te).order("data_diagnostico",{ascending:!1}),f.from("diagnosticos_gestacao").select("*").in("receptora_id",m).eq("tipo_diagnostico","SEXAGEM").eq("data_te",a.data_te).order("data_diagnostico",{ascending:!1})]),M=h.data,l=A.data,d=H.data;if(!M||M.length===0){D([]);return}const o=M.map(r=>r.embriao_id).filter(Boolean);let x=new Map;if(o.length>0){const{data:r}=await f.from("embrioes").select("id, identificacao, classificacao, lote_fiv_id, lote_fiv_acasalamento_id").in("id",o);r&&(x=new Map(r.map(c=>[c.id,c])))}const X=Array.from(x.values()),C=ca(X),fe=la(X),[z,se]=await Promise.all([da(C),ma(fe)]),{doadorasMap:L,tourosMap:te}=se,k=new Map;l==null||l.forEach(r=>{k.has(r.receptora_id)||k.set(r.receptora_id,r)});const _=new Map;d==null||d.forEach(r=>{_.has(r.receptora_id)||_.set(r.receptora_id,r)});const I=new Map;M.forEach(r=>{const c=`${r.receptora_id}-${r.data_te}`;I.has(c)||I.set(c,[]),I.get(c).push(r)});const j=[];I.forEach(r=>{const c=r[0],v=t==null?void 0:t.find(oe=>oe.id===c.receptora_id);if(!v)return;const $=[];let R=null,re=null;if(r.forEach(oe=>{const N=x.get(oe.embriao_id);if(!N)return;const _e=z.get(N.lote_fiv_id);if(!_e)return;R||(R=_e.data_abertura,re=ja(_e.data_abertura));const oa=N.lote_fiv_acasalamento_id?L.get(N.lote_fiv_acasalamento_id):void 0,ia=N.lote_fiv_acasalamento_id?te.get(N.lote_fiv_acasalamento_id):void 0;$.push({te_id:oe.id,embriao_id:N.id,embriao_identificacao:N.identificacao,embriao_classificacao:N.classificacao,lote_fiv_id:N.lote_fiv_id,lote_fiv_acasalamento_id:N.lote_fiv_acasalamento_id,doadora_registro:oa,touro_nome:ia})}),$.length===0||!R||re===null)return;const Z=k.get(c.receptora_id);!Z||Z.resultado==="VAZIA"||j.push({receptora_id:c.receptora_id,brinco:v.identificacao,nome:v.nome,data_te:c.data_te,embrioes:$,data_abertura_lote:R,dias_gestacao:re,numero_gestacoes:Z.numero_gestacoes||1,diagnostico_existente:_.get(c.receptora_id)?{id:_.get(c.receptora_id).id,data_diagnostico:_.get(c.receptora_id).data_diagnostico,resultado:_.get(c.receptora_id).resultado,numero_gestacoes:_.get(c.receptora_id).numero_gestacoes,observacoes:_.get(c.receptora_id).observacoes}:void 0})}),j.sort((r,c)=>r.brinco.localeCompare(c.brinco)),D(j);const T={};j.forEach(r=>{if(r.diagnostico_existente){const c=_.get(r.receptora_id);let v=new Array(r.numero_gestacoes).fill("").map(()=>""),$=r.diagnostico_existente.observacoes||"";if(c!=null&&c.observacoes){const R=c.observacoes.match(/SEXAGENS:([^|]+)/);if(R){for(v=R[1].split(",").map(Z=>Z.trim());v.length<r.numero_gestacoes;)v.push("");v=v.slice(0,r.numero_gestacoes),$=c.observacoes.replace(/SEXAGENS:[^|]+\|?/,"").trim()}}v.every(R=>!R)&&(c!=null&&c.sexagem)&&(v[0]=c.sexagem),T[r.receptora_id]={data_sexagem:r.diagnostico_existente.data_diagnostico,sexagens:v,observacoes:$}}else T[r.receptora_id]={data_sexagem:ce,sexagens:new Array(r.numero_gestacoes).fill("").map(()=>""),observacoes:""}}),P(T)}catch(s){G({title:"Erro ao carregar receptoras",description:s instanceof Error?s.message:"Erro desconhecido",variant:"destructive"}),D([])}finally{Ne(!1)}},ea=(a,s,i)=>{P(t=>{const m=t[a]||{data_sexagem:ce,sexagens:[],observacoes:""},h=[...m.sexagens];return h[s]=i,{...t,[a]:{...m,sexagens:h}}})},Ce=(a,s,i)=>{P(t=>({...t,[a]:{...t[a],[s]:i}}))},aa=a=>{const s=a.filter(h=>h&&h!=="VAZIA");if(s.length===0)return"VAZIA";const i=s.includes("FEMEA"),t=s.includes("MACHO"),m=s.includes("SEM_SEXO");return i&&!t&&!m?"PRENHE_FEMEA":t&&!i&&!m?"PRENHE_MACHO":i&&t?"PRENHE_2_SEXOS":"PRENHE_SEM_SEXO"},sa=async()=>{var s;if(!n)return;if(!Na(b)){G({title:"Erro de validação",description:"Veterinário responsável é obrigatório",variant:"destructive"});return}const a=w.filter(i=>{const t=B[i.receptora_id];return!t||!t.data_sexagem||!t.sexagens||t.sexagens.every(m=>!m)});if(a.length>0){G({title:"Erro de validação",description:`Há ${a.length} receptora(s) sem sexagem definida`,variant:"destructive"});return}try{we(!0);const i=[],t=[],m=[];w.forEach(l=>{var k,_,I;const d=B[l.receptora_id];if(!d||!d.data_sexagem)return;const o=d.sexagens.filter(j=>j&&j!=="VAZIA"),x=aa(d.sexagens),X=x==="VAZIA"?"VAZIA":"PRENHE";let C=null;if(X==="PRENHE"){const j=o.every(r=>r==="FEMEA")&&o.length>0,T=o.every(r=>r==="MACHO")&&o.length>0;j?C="FEMEA":T?C="MACHO":C=o.find(r=>r==="FEMEA"||r==="MACHO")||null}(C==="PRENHE"||C==="SEM_SEXO")&&(C=o.find(T=>T==="FEMEA"||T==="MACHO")||null);const fe=X==="VAZIA"?0:o.length;let z=((k=d.observacoes)==null?void 0:k.trim())||"";const se=d.sexagens.filter(j=>j),L=se.length>0?se.join(","):"";L&&(z.includes("SEXAGENS:")?z=z.replace(/SEXAGENS:[^|]+/,`SEXAGENS:${L}`):z=z?`SEXAGENS:${L}|${z}`:`SEXAGENS:${L}`);const te={receptora_id:l.receptora_id,data_te:l.data_te,tipo_diagnostico:"SEXAGEM",data_diagnostico:d.data_sexagem,resultado:X,sexagem:C,numero_gestacoes:fe,observacoes:z||void 0,veterinario_responsavel:((_=b.veterinario_responsavel)==null?void 0:_.trim())||void 0,tecnico_responsavel:((I=b.tecnico_responsavel)==null?void 0:I.trim())||void 0};l.diagnostico_existente?t.push({id:l.diagnostico_existente.id,...te}):i.push(te),m.push({receptora_id:l.receptora_id,status:x})});const h=[];i.length>0&&h.push(f.from("diagnosticos_gestacao").insert(i).then(({error:l})=>{if(l)throw new Error(`Erro ao inserir sexagens: ${l.message}`)})),t.forEach(l=>{const{id:d,...o}=l;h.push(f.from("diagnosticos_gestacao").update(o).eq("id",d).then(({error:x})=>{if(x)throw new Error(`Erro ao atualizar sexagem: ${x.message}`)}))}),await Promise.all(h);const A=new Map;m.forEach(({receptora_id:l,status:d})=>{A.has(d)||A.set(d,[]),A.get(d).push(l)});for(const[l,d]of A.entries()){const o={status_reprodutivo:l};l==="VAZIA"&&(o.data_provavel_parto=null);const{error:x}=await f.from("receptoras").update(o).in("id",d);if(x)throw console.error("Erro ao atualizar status:",x,"Status:",l,"IDs:",d),new Error(`Erro ao atualizar status das receptoras: ${x.message}`);console.log(`Status atualizado para ${l}:`,d)}const H=w.every(l=>{const d=B[l.receptora_id];return d&&d.data_sexagem&&d.sexagens&&d.sexagens.some(o=>o)});G({title:"Lote salvo com sucesso",description:H?`${w.length} sexagem(ns) registrada(s). Lote fechado.`:`${w.length} sexagem(ns) registrada(s)`}),H?(Y(null),D([]),P({})):Y({...n,veterinario_sexagem:b.veterinario_responsavel.trim(),tecnico_sexagem:b.tecnico_responsavel.trim(),status:"ABERTO"});const M=(s=ue.find(l=>l.id===S))==null?void 0:s.nome;he(),S&&ye(S,M)}catch(i){G({title:"Erro ao salvar lote",description:i instanceof Error?i.message:"Erro desconhecido",variant:"destructive"})}finally{we(!1)}},ta=w.every(a=>{const s=B[a.receptora_id];return s&&s.data_sexagem&&s.sexagens&&s.sexagens.some(i=>i)}),ae=a=>{if(!a)return"-";const[s,i,t]=a.split("-");return`${t}/${i}/${s}`},O=Le.filter(a=>{var t;const s=!q||a.receptora_brinco.toLowerCase().includes(q.toLowerCase())||((t=a.receptora_nome)==null?void 0:t.toLowerCase().includes(q.toLowerCase()))||a.fazenda_nome.toLowerCase().includes(q.toLowerCase()),i=de==="todos"||a.fazenda_nome===de;return s&&i}),V={total:O.length,femeas:O.filter(a=>a.sexagem==="FEMEA").length,machos:O.filter(a=>a.sexagem==="MACHO").length,semSexo:O.filter(a=>!a.sexagem||a.sexagem==="SEM_SEXO").length},ra=V.total>0?Math.round(V.femeas/V.total*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ha,{title:"Sexagem Fetal",description:"Registrar sexagem fetal por lote de receptoras prenhes"}),e.jsxs(xa,{defaultValue:"nova-sessao",className:"w-full",children:[e.jsxs(ua,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(Ge,{value:"nova-sessao",className:"gap-2",children:[e.jsx(Sa,{className:"h-4 w-4"}),"Nova Sessão"]}),e.jsxs(Ge,{value:"historico",className:"gap-2",onClick:()=>Me(),children:[e.jsx(wa,{className:"h-4 w-4"}),"Histórico"]})]}),e.jsxs(Pe,{value:"nova-sessao",className:"mt-4",children:[e.jsx(F,{className:"mb-4",children:e.jsxs(y,{className:"pt-4 pb-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-[180px] max-w-[220px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Veterinário"}),e.jsx(ne,{placeholder:"Nome do veterinário",value:b.veterinario_responsavel,onChange:a=>le(s=>({...s,veterinario_responsavel:a.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px] max-w-[220px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Técnico"}),e.jsx(ne,{placeholder:"Nome do técnico",value:b.tecnico_responsavel,onChange:a=>le(s=>({...s,tecnico_responsavel:a.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px] max-w-[220px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Fazenda"}),e.jsxs(U,{value:S,onValueChange:Ve,disabled:!b.veterinario_responsavel,children:[e.jsx(Q,{className:"h-9",children:e.jsx(J,{placeholder:"Selecione a fazenda"})}),e.jsx(K,{children:ue.map(a=>e.jsx(E,{value:a.id,children:a.nome},a.id))})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px] max-w-[280px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Lote TE"}),e.jsxs(U,{value:(n==null?void 0:n.id)||"",onValueChange:a=>{const s=ge.find(i=>i.id===a);Y(s||null)},disabled:!S||pe,children:[e.jsx(Q,{className:"h-9",children:e.jsx(J,{placeholder:pe?"Carregando...":"Selecione o lote"})}),e.jsx(K,{children:ge.map(a=>{const s=a.dias_gestacao!==void 0&&a.dias_gestacao<W.SEXAGEM;return e.jsx(E,{value:a.id,children:e.jsxs("span",{className:s?"text-amber-600":"",children:[ae(a.data_te)," • ",a.dias_gestacao??"?","d • ",a.quantidade_receptoras," rec.",s&&" ⚠️"]})},a.id)})})]})]}),e.jsxs(ze,{onClick:sa,disabled:!n||!ta||Se||(n==null?void 0:n.status)==="FECHADO"||(n==null?void 0:n.dias_gestacao)!==void 0&&n.dias_gestacao<W.SEXAGEM,className:"h-9 bg-primary hover:bg-primary-dark",children:[e.jsx(Fa,{className:"h-4 w-4 mr-2"}),Se?"Salvando...":"Salvar"]})]}),b.veterinario_responsavel?S?ge.length===0&&!pe?e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"Nenhum lote de receptoras prenhes pendente nesta fazenda"}):n&&n.dias_gestacao!==void 0&&n.dias_gestacao<W.SEXAGEM?e.jsxs("div",{className:"flex items-center gap-2 mt-2 p-2 bg-amber-50 border border-amber-200 rounded-md",children:[e.jsx(ya,{className:"h-4 w-4 text-amber-600 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"Atenção:"})," Este lote está com ",n.dias_gestacao," dias de gestação. A Sexagem só pode ser realizada a partir de ",e.jsxs("strong",{children:[W.SEXAGEM," dias"]}),". Faltam ",e.jsxs("strong",{children:[W.SEXAGEM-n.dias_gestacao," dias"]}),"."]})]}):null:e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Selecione uma fazenda para ver os lotes disponíveis"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Preencha o veterinário para selecionar a fazenda"})]})}),Xe?e.jsx(F,{children:e.jsx(y,{className:"py-8",children:e.jsx(Re,{})})}):n&&w.length>0?e.jsxs(F,{children:[e.jsx(je,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base",children:"Receptoras do Lote"}),e.jsxs(Te,{children:[w.length," receptora(s) • TE em ",ae(n.data_te)]})]}),n.status==="FECHADO"&&e.jsx(Ee,{variant:"secondary",children:"Lote Fechado"})]})})}),e.jsx(y,{className:"pt-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(De,{children:[e.jsx(Oe,{children:e.jsxs(ie,{children:[e.jsx(g,{children:"Receptora"}),e.jsx(g,{children:"Dias Gest."}),e.jsx(g,{children:"Embrião"}),e.jsx(g,{children:"Doadora × Touro"}),e.jsx(g,{children:"Nº Gest."}),e.jsx(g,{children:"Data Sexagem"}),e.jsx(g,{children:"Sexagem(ns)"}),e.jsx(g,{children:"Obs."})]})}),e.jsx(Ie,{children:w.map(a=>{const s=B[a.receptora_id]||{data_sexagem:ce,sexagens:new Array(a.numero_gestacoes).fill("").map(()=>""),observacoes:""},i=n.status==="FECHADO";return e.jsxs(ie,{children:[e.jsx(p,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.brinco,a.nome&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["(",a.nome,")"]})]})}),e.jsx(p,{children:e.jsxs(Ee,{variant:"outline",className:"font-mono",children:[a.dias_gestacao,"d"]})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-0.5",children:a.embrioes.map((t,m)=>e.jsxs("div",{className:"text-sm",children:[t.embriao_identificacao||`#${m+1}`,t.embriao_classificacao&&e.jsxs("span",{className:"text-muted-foreground text-xs ml-1",children:["(",t.embriao_classificacao,")"]})]},t.te_id))})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-0.5 text-sm",children:a.embrioes.map(t=>e.jsxs("div",{children:[t.doadora_registro||"-",t.touro_nome&&` × ${t.touro_nome}`]},t.te_id))})}),e.jsx(p,{className:"text-center font-medium",children:a.numero_gestacoes}),e.jsx(p,{children:e.jsx(be,{value:s.data_sexagem,onChange:t=>Ce(a.receptora_id,"data_sexagem",t||""),className:"w-32",disabled:i})}),e.jsx(p,{children:e.jsx("div",{className:"flex gap-1",children:Array.from({length:a.numero_gestacoes},(t,m)=>{const h=s.sexagens[m]||"",A=a.numero_gestacoes>1?`G${m+1}`:"--";return e.jsxs(U,{value:h,onValueChange:H=>ea(a.receptora_id,m,H),disabled:i,children:[e.jsx(Q,{className:"w-24 h-9",children:e.jsx(J,{placeholder:A})}),e.jsxs(K,{children:[e.jsx(E,{value:"FEMEA",children:"Fêmea"}),e.jsx(E,{value:"MACHO",children:"Macho"}),e.jsx(E,{value:"SEM_SEXO",children:"Sem sexo"}),e.jsx(E,{value:"VAZIA",children:"Vazia"})]})]},m)})})}),e.jsx(p,{children:e.jsx(ne,{value:s.observacoes,onChange:t=>Ce(a.receptora_id,"observacoes",t.target.value),placeholder:"Obs.",className:"w-32 h-9",disabled:i})})]},a.receptora_id)})})]})})})]}):n&&w.length===0?e.jsx(F,{children:e.jsx(y,{className:"py-8 text-center text-muted-foreground",children:"Nenhuma receptora prenhe encontrada neste lote"})}):null]}),e.jsxs(Pe,{value:"historico",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(F,{className:"bg-card",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total de Sexagens"}),e.jsx("p",{className:"text-2xl font-bold",children:V.total})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(va,{className:"h-6 w-6 text-primary"})})]})})}),e.jsx(F,{className:"bg-card",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Fêmeas"}),e.jsx("p",{className:"text-2xl font-bold text-pink-600",children:V.femeas})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-pink-500/10 flex items-center justify-center",children:e.jsx(He,{className:"h-6 w-6 text-pink-600"})})]})})}),e.jsx(F,{className:"bg-card",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Machos"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:V.machos})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-blue-500/10 flex items-center justify-center",children:e.jsx(He,{className:"h-6 w-6 text-blue-600"})})]})})}),e.jsx(F,{className:"bg-card",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"% Fêmeas"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[ra,"%"]})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ea,{className:"h-6 w-6 text-primary"})})]})})})]}),e.jsxs(F,{children:[e.jsx(je,{className:"pb-4",children:e.jsxs(ve,{className:"text-lg flex items-center gap-2",children:[e.jsx(Aa,{className:"h-5 w-5"}),"Filtros"]})}),e.jsxs(y,{children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ma,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ne,{placeholder:"Brinco, nome, fazenda...",value:q,onChange:a=>qe(a.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fazenda"}),e.jsxs(U,{value:de,onValueChange:$e,children:[e.jsx(Q,{children:e.jsx(J,{placeholder:"Todas as fazendas"})}),e.jsxs(K,{children:[e.jsx(E,{value:"todos",children:"Todas as fazendas"}),Qe.map(a=>e.jsx(E,{value:a.nome,children:a.nome},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Sexagem"}),e.jsxs(U,{value:ee,onValueChange:Be,children:[e.jsx(Q,{children:e.jsx(J,{placeholder:"Todos"})}),e.jsxs(K,{children:[e.jsx(E,{value:"todos",children:"Todos"}),e.jsx(E,{value:"FEMEA",children:"Fêmea"}),e.jsx(E,{value:"MACHO",children:"Macho"}),e.jsx(E,{value:"SEM_SEXO",children:"Sem sexo"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Data Início"}),e.jsx(be,{value:me,onChange:a=>Ze(a||"")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Data Fim"}),e.jsx(be,{value:xe,onChange:a=>Ue(a||"")})]})]}),e.jsxs(ze,{onClick:Me,className:"mt-4 bg-primary hover:bg-primary-dark",children:[e.jsx(ba,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]})]}),e.jsxs(F,{children:[e.jsxs(je,{children:[e.jsx(ve,{className:"text-lg",children:"Histórico de Sexagens"}),e.jsxs(Te,{children:[O.length," registro(s) encontrado(s)"]})]}),e.jsx(y,{children:ke?e.jsx(Re,{}):O.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'Nenhuma sexagem encontrada. Clique em "Atualizar" para carregar os dados.'}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(De,{children:[e.jsx(Oe,{children:e.jsxs(ie,{children:[e.jsx(g,{children:"Receptora"}),e.jsx(g,{children:"Fazenda"}),e.jsx(g,{children:"Data TE"}),e.jsx(g,{children:"Data Sexagem"}),e.jsx(g,{children:"Sexagem"}),e.jsx(g,{children:"Nº Gest."}),e.jsx(g,{children:"Veterinário"}),e.jsx(g,{children:"Técnico"}),e.jsx(g,{children:"Observações"})]})}),e.jsx(Ie,{children:O.map(a=>{var s;return e.jsxs(ie,{children:[e.jsxs(p,{className:"font-medium",children:[a.receptora_brinco,a.receptora_nome&&e.jsxs("span",{className:"text-muted-foreground text-sm ml-2",children:["(",a.receptora_nome,")"]})]}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"h-4 w-4 text-muted-foreground"}),a.fazenda_nome]})}),e.jsx(p,{children:ae(a.data_te)}),e.jsx(p,{children:ae(a.data_diagnostico)}),e.jsx(p,{children:e.jsx(Ee,{variant:"outline",className:a.sexagem==="FEMEA"?"bg-pink-500/10 text-pink-600 border-pink-500/30":a.sexagem==="MACHO"?"bg-blue-500/10 text-blue-600 border-blue-500/30":"bg-gray-500/10 text-gray-600 border-gray-500/30",children:a.sexagem==="FEMEA"?"Fêmea":a.sexagem==="MACHO"?"Macho":a.sexagem==="SEM_SEXO"?"Sem sexo":"-"})}),e.jsx(p,{className:"text-center",children:a.numero_gestacoes||"-"}),e.jsx(p,{children:a.veterinario_responsavel||"-"}),e.jsx(p,{children:a.tecnico_responsavel||"-"}),e.jsx(p,{className:"max-w-[200px] truncate",children:((s=a.observacoes)==null?void 0:s.replace(/SEXAGENS:[^|]+\|?/,"").trim())||"-"})]},a.id)})})]})})})]})]})]})]})}export{Ya as default};
