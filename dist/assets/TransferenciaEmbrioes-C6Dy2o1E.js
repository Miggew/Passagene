import{c as Sa,r as o,j as e,B as ye,s as l,a as za,i as Ra,l as Ia}from"./index-BPMeM9-O.js";import{C as ua,d as ha}from"./card-8azKTSNJ.js";import{S as Je,a as Xe,b as Ye,c as ea,d as aa}from"./select-La4nrp5K.js";import{I as ta}from"./input-tqcTRdPv.js";import{L as xa}from"./label-fluRYl3j.js";import{T as ka}from"./textarea-B1aXpqcj.js";import{P as Da}from"./PageHeader-DQ4rM2jO.js";import{u as oa}from"./use-toast-BGNwDi9e.js";import{b as Ta}from"./dataEnrichment-CnFMnwmv.js";import{v as Oa}from"./receptoraStatus-CrpDZcn1.js";import{D as Pa,b as La,c as Ma,d as Fa,e as qa,f as Ba}from"./dialog-CLDnxY7R.js";import{T as Va,a as Ga,b as va,c as ke,d as $a,e as De}from"./table-l_s8S0JA.js";import{f as ra}from"./dateUtils-eJ5e6apA.js";import{F as Ha}from"./file-text-CtxiCcm9.js";import{B as $e}from"./badge-CeJDYfYs.js";import{C as Za,Q as Ua}from"./QualidadeSemaforo-C5SWzaSF.js";import{C as Qa,D as ga}from"./DatePickerBR-CHtWVvxh.js";import{C as Ka}from"./chevron-right-BkIAhNYS.js";import{T as Wa}from"./trash-2-D4PEDwvS.js";import{T as Ja}from"./triangle-alert-h0K6D8II.js";import{S as Xa}from"./switch-CZPJOLE5.js";import{U as Ya}from"./user-BTDnQyTa.js";import{M as et}from"./map-pin-B27L4YNJ.js";import{E as at}from"./eye-CZithoXn.js";import{S as tt}from"./save-CVRLcPrA.js";import{P as ba}from"./package-CNNpa4CW.js";import"./index-C5PY5DOm.js";import"./check-Bdb-Yd05.js";import"./x-BxiwAMrM.js";import"./popover-D1vF_0kq.js";import"./pt-BR-CyDikW87.js";import"./calendar-CuUQg-xw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=Sa("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),ot=768;function ia({data:i,columns:t,renderCell:_,rowKey:F="id",emptyMessage:L="Nenhum item encontrado",className:b="",selectionType:V="radio",selectedId:N="",selectedIds:z=[],onSelect:I,onSelectMultiple:f,isRowDisabled:u,radioName:C="selection",pageSize:x=0,currentPage:_e,onPageChange:W,headerContent:Ne,footerContent:K}){const[de,Y]=o.useState(!1),[fe,ue]=o.useState(1),E=_e??fe,je=W??ue;o.useEffect(()=>{const n=()=>Y(window.innerWidth<ot);return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const le=(n,m,q)=>{if(_){const O=_(n,m,q);if(O!==void 0)return O}const B=n[m.key];return B==null?"—":String(B)},pe=x>0?Math.max(1,Math.ceil(i.length/x)):1,H=x>0?i.slice((E-1)*x,E*x):i,me=n=>{const m=String(n[F]);if(!(u!=null&&u(n)))if(V==="radio")I==null||I(m);else{const q=z.includes(m)?z.filter(B=>B!==m):[...z,m];f==null||f(q)}},Z=n=>{const m=String(n[F]);return V==="radio"?N===m:z.includes(m)},D=()=>e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted text-[10px] font-semibold text-muted-foreground uppercase tracking-wide",children:[e.jsx("th",{className:"w-8 px-2 py-2"}),t.map(n=>e.jsx("th",{className:`px-2 py-2 font-semibold ${n.align==="center"?"text-center":n.align==="right"?"text-right":"text-left"}`,style:n.width?{width:n.width}:void 0,children:n.label},String(n.key)))]})}),e.jsx("tbody",{children:H.map((n,m)=>{const q=String(n[F]),B=(u==null?void 0:u(n))??!1,O=Z(n);return e.jsxs("tr",{className:`border-t border-border transition-colors ${O?"bg-primary/10":B?"opacity-50 cursor-not-allowed":"hover:bg-muted/50 cursor-pointer"}`,onClick:()=>me(n),children:[e.jsx("td",{className:"px-2 py-2",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("input",{type:V,name:V==="radio"?C:void 0,checked:O,onChange:()=>me(n),disabled:B,className:"w-4 h-4 accent-primary"})})}),t.map(h=>e.jsx("td",{className:`px-2 py-2 ${h.align==="center"?"text-center":h.align==="right"?"text-right":""}`,children:e.jsx("div",{className:`${h.align==="center"?"flex justify-center":h.align==="right"?"flex justify-end":""}`,children:le(n,h,m)})},String(h.key)))]},q)})})]})}),T=()=>e.jsx("div",{className:"space-y-2",children:H.map((n,m)=>{const q=String(n[F]),B=(u==null?void 0:u(n))??!1,O=Z(n),h=t[0];return e.jsx("div",{className:`p-3 rounded-lg border transition-colors ${O?"border-primary bg-primary/5":B?"border-border opacity-50":"border-border hover:border-primary/50"} ${B?"cursor-not-allowed":"cursor-pointer"}`,onClick:()=>me(n),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:V,name:V==="radio"?C:void 0,checked:O,onChange:()=>me(n),disabled:B,className:"w-4 h-4 accent-primary mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-foreground",children:le(n,h,m)}),e.jsx("div",{className:"mt-1 space-y-1",children:t.slice(1).filter(A=>!A.excludeFromCard).map(A=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:[A.label,":"]}),e.jsx("span",{className:"text-foreground",children:le(n,A,m)})]},String(A.key)))})]})]})},q)})}),M=()=>x<=0||pe<=1?null:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ye,{type:"button",variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>je(Math.max(1,E-1)),disabled:E===1,children:[e.jsx(Qa,{className:"w-3 h-3 mr-1"}),"Anterior"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[E," / ",pe]}),e.jsxs(ye,{type:"button",variant:"outline",size:"sm",className:"h-6 text-xs px-2",onClick:()=>je(Math.min(pe,E+1)),disabled:E>=pe,children:["Próxima",e.jsx(Ka,{className:"w-3 h-3 ml-1"})]})]});return e.jsxs("div",{className:`flex flex-col h-full ${b}`,children:[Ne,i.length===0?e.jsx("div",{className:"flex-1 flex items-center justify-center py-6 text-sm text-muted-foreground",children:L}):e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:de?T():D()}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{children:K??`${i.length} item(s)`}),M()]})]})}const it=!0;function st({dataPasso2:i,incluirCioLivre:t,filtroClienteId:_,filtroRaca:F,formData:L}){const{toast:b}=oa(),[V,N]=o.useState([]),[z,I]=o.useState([]),[f,u]=o.useState([]),[C,x]=o.useState([]),[_e,W]=o.useState([]),[Ne,K]=o.useState([]),[de,Y]=o.useState(!0),[fe,ue]=o.useState(!1),[E,je]=o.useState([]),[le,pe]=o.useState([]),[H,me]=o.useState({}),[Z,D]=o.useState({}),T=o.useCallback(async a=>{var g,w;if(!a.fazenda_id||!((((g=a.transferenciasIdsSessao)==null?void 0:g.length)||0)>0||(((w=a.transferenciasSessao)==null?void 0:w.length)||0)>0))return;let v=null;if(a.pacote_id){const j=a.pacote_id.substring(0,36);/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(j)&&(v=j)}const y={pacote_id:v,data_passo2:a.data_passo2||null,data_te:a.data_te||null,veterinario_responsavel:a.veterinario_responsavel||null,tecnico_responsavel:a.tecnico_responsavel||null,origem_embriao:a.origem_embriao||null,filtro_cliente_id:a.filtro_cliente_id||null,filtro_raca:a.filtro_raca||null,incluir_cio_livre:!!a.incluir_cio_livre,transferencias_ids:a.transferenciasIdsSessao||[],protocolo_receptora_ids:a.transferenciasSessao||[],updated_at:new Date().toISOString()};try{const{data:j}=await l.from("transferencias_sessoes").select("id").eq("fazenda_id",a.fazenda_id).eq("status","ABERTA").maybeSingle();j?await l.from("transferencias_sessoes").update(y).eq("id",j.id):await l.from("transferencias_sessoes").insert({...y,fazenda_id:a.fazenda_id,status:"ABERTA"})}catch{}},[]),M=o.useCallback(async a=>{a&&await l.from("transferencias_sessoes").update({status:"ENCERRADA",updated_at:new Date().toISOString()}).eq("fazenda_id",a).eq("status","ABERTA")},[]),n=o.useCallback(a=>{const d=Array.isArray(a==null?void 0:a.transferencias_ids)?a.transferencias_ids:[],v=Array.isArray(a==null?void 0:a.protocolo_receptora_ids)?a.protocolo_receptora_ids:[],y=(a==null?void 0:a.origem_embriao)==="CONGELADO"?"CONGELADO":"PACOTE",g=(a==null?void 0:a.data_te)||new Date().toISOString().split("T")[0];return{transferenciasIds:d,protocoloReceptoraIds:v,filtros:{origem_embriao:y,filtro_cliente_id:(a==null?void 0:a.filtro_cliente_id)||"",filtro_raca:(a==null?void 0:a.filtro_raca)||"",data_passo2:(a==null?void 0:a.data_passo2)||new Date().toISOString().split("T")[0],incluir_cio_livre:!!(a!=null&&a.incluir_cio_livre)},camposPacote:{data_te:g,veterinario_responsavel:(a==null?void 0:a.veterinario_responsavel)||"",tecnico_responsavel:(a==null?void 0:a.tecnico_responsavel)||""},formData:{fazenda_id:(a==null?void 0:a.fazenda_id)||"",pacote_id:(a==null?void 0:a.pacote_id)||"",protocolo_id:(a==null?void 0:a.protocolo_id)||"",data_te:g,veterinario_responsavel:(a==null?void 0:a.veterinario_responsavel)||"",tecnico_responsavel:(a==null?void 0:a.tecnico_responsavel)||""}}},[]),m=o.useCallback(a=>{pe(a.transferenciasIds),je(a.protocoloReceptoraIds)},[]),q=o.useCallback(async()=>{try{const{data:a}=await l.from("transferencias_sessoes").select("*").eq("status","ABERTA").order("updated_at",{ascending:!1}).limit(1);if(a&&a.length>0){const d=a[0],v=Array.isArray(d==null?void 0:d.transferencias_ids)?d.transferencias_ids:[];let y=Array.isArray(d==null?void 0:d.protocolo_receptora_ids)?d.protocolo_receptora_ids:[];if(y.length===0&&v.length>0){const{data:j}=await l.from("transferencias_embrioes").select("protocolo_receptora_id").in("id",v);j&&(y=[...new Set(j.map(G=>G.protocolo_receptora_id).filter(G=>!!G))])}let g=!1;if(y.length>0){const{data:j}=await l.from("protocolo_receptoras").select("id, status").in("id",y);j&&(g=j.some(G=>G.status!=="UTILIZADA"))}if(!g)return await l.from("transferencias_sessoes").update({status:"ENCERRADA",updated_at:new Date().toISOString()}).eq("id",d.id),null;const w=n(d);return m({transferenciasIds:w.transferenciasIds,protocoloReceptoraIds:w.protocoloReceptoraIds}),w}return null}catch{return null}},[n,m]),B=o.useCallback(async()=>{try{const{data:a,error:d}=await l.from("clientes").select("id, nome").order("nome",{ascending:!0});if(d)throw d;I(a||[])}catch{I([])}},[]),O=o.useCallback(async()=>{try{let a=l.from("protocolos_sincronizacao").select("id");i&&(a=a.eq("passo2_data",i));const{data:d,error:v}=await a;if(v)throw v;const y=[...new Set((d||[]).map(he=>he.id).filter(Boolean))];if(y.length===0){N([]),Y(!1);return}const{data:g,error:w}=await l.from("v_protocolo_receptoras_status").select("receptora_id").eq("fase_ciclo","SINCRONIZADA").in("protocolo_id",y);if(w)throw w;const j=[...new Set((g||[]).map(he=>he.receptora_id).filter(Boolean))];if(j.length===0){N([]),Y(!1);return}const{data:G,error:J}=await l.from("vw_receptoras_fazenda_atual").select("fazenda_id_atual").in("receptora_id",j);if(J)throw J;const ne=[...new Set((G||[]).map(he=>he.fazenda_id_atual).filter(Boolean))];if(ne.length===0){N([]),Y(!1);return}const{data:we,error:Se}=await l.from("fazendas").select("id, nome").in("id",ne).order("nome",{ascending:!0});if(Se)throw Se;N(we||[]),Y(!1)}catch(a){b({title:"Erro ao carregar fazendas",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"}),Y(!1)}},[i,b]),h=o.useCallback(async()=>{var a;try{const[d,v]=await Promise.all([l.from("transferencias_embrioes").select("embriao_id"),l.from("embrioes").select("*").eq("status_atual","FRESCO").order("created_at",{ascending:!1})]),y=((a=d.data)==null?void 0:a.map(s=>s.embriao_id))||[];if(v.error)throw v.error;const g=[...v.data||[]].filter(s=>!y.includes(s.id)&&s.status_atual!=="TRANSFERIDO").sort((s,U)=>{const c=new Date(s.created_at||0).getTime();return new Date(U.created_at||0).getTime()-c});if(!g||g.length===0){u([]);return}const w=g.map(s=>s.id),j=[...new Set(g.filter(s=>s.lote_fiv_id).map(s=>s.lote_fiv_id))];let G=new Map,J=new Map,ne=new Map,we=new Map;const[Se,he,Pe]=await Promise.all([w.length>0?l.from("v_embrioes_disponiveis_te").select("embriao_id, d7_pronto, d8_limite").in("embriao_id",w):Promise.resolve({data:null,error:null}),l.from("fazendas").select("id, nome"),j.length>0?l.from("lotes_fiv").select("id, pacote_aspiracao_id").in("id",j):Promise.resolve({data:null,error:null})]),Le=new Map((Se.data||[]).map(s=>[s.embriao_id,{d7_pronto:s.d7_pronto,d8_limite:s.d8_limite}]));he.data&&(we=new Map(he.data.map(s=>[s.id,s.nome])));const Ce=Pe.data;if(Ce&&Ce.length>0){Ce.forEach(U=>{U.pacote_aspiracao_id&&J.set(U.id,U.pacote_aspiracao_id)});const s=[...new Set(Ce.map(U=>U.pacote_aspiracao_id).filter(Boolean))];if(s.length>0){const[U,c]=await Promise.all([l.from("pacotes_aspiracao").select("*").in("id",s),l.from("pacotes_aspiracao_fazendas_destino").select("pacote_aspiracao_id, fazenda_destino_id").in("pacote_aspiracao_id",s)]),R=c.data;R&&R.forEach(P=>{const ce=ne.get(P.pacote_aspiracao_id)||[];ce.includes(P.fazenda_destino_id)||ce.push(P.fazenda_destino_id),ne.set(P.pacote_aspiracao_id,ce)});const k=U.data;k&&k.forEach(P=>{if(P.fazenda_destino_id){const ce=ne.get(P.id)||[];ce.includes(P.fazenda_destino_id)||ce.push(P.fazenda_destino_id),ne.set(P.id,ce)}G.set(P.id,{id:P.id,data_aspiracao:P.data_aspiracao,fazenda_nome:we.get(P.fazenda_id),quantidade_doadoras:0,horario_inicio:P.horario_inicio,veterinario_responsavel:P.veterinario_responsavel,total_oocitos:P.total_oocitos})})}}const ze=g.map(s=>s.lote_fiv_acasalamento_id).filter(s=>!!s);let ge=new Map,xe=new Map;if(ze.length>0){const{data:s}=await l.from("lote_fiv_acasalamentos").select("id, aspiracao_doadora_id, dose_semen_id").in("id",ze);if(s){ge=new Map(s.map($=>[$.id,$]));const U=[...new Set(s.map($=>$.aspiracao_doadora_id).filter(Boolean))],c=[...new Set(s.map($=>$.dose_semen_id).filter(Boolean))],[R,k]=await Promise.all([U.length>0?l.from("aspiracoes_doadoras").select("id, doadora_id").in("id",U):Promise.resolve({data:null}),c.length>0?l.from("doses_semen").select("id, touro_id, touro:touros(id, nome, registro, raca)").in("id",c):Promise.resolve({data:null})]),P=R.data,ce=k.data;if(ce&&(xe=new Map(ce.map($=>{const Q=$.touro,ae=Array.isArray(Q)?Q[0]:Q;return[$.id,(ae==null?void 0:ae.nome)||"Touro desconhecido"]})),s.forEach($=>{if($.dose_semen_id){const Q=xe.get($.dose_semen_id);if(Q){const ae=ge.get($.id);ge.set($.id,{...ae,touro_nome:Q})}}})),P){const $=[...new Set(P.map(Q=>Q.doadora_id))];if($.length>0){const{data:Q}=await l.from("doadoras").select("id, registro").in("id",$);if(Q){const ae=new Map(Q.map(oe=>[oe.id,oe.registro])),Be=new Map(P.map(oe=>[oe.id,oe.doadora_id]));s.forEach(oe=>{if(oe.aspiracao_doadora_id){const Me=Be.get(oe.aspiracao_doadora_id);if(Me){const He=ae.get(Me);if(He){const Ke=ge.get(oe.id);ge.set(oe.id,{...Ke,doadora_registro:He})}}}})}}}}}const Ae=new Map;g.forEach(s=>{var P,ce;if(!s.lote_fiv_id||!s.created_at)return;const U=s.created_at.split("T")[0],c=`${s.lote_fiv_id}-${U}`;let R=Ae.get(c);if(!R){const $=J.get(s.lote_fiv_id),Q=$?G.get($):void 0,ae=$?ne.get($)||[]:[],Be=ae.map(oe=>we.get(oe)).filter(oe=>!!oe);R={id:c,lote_fiv_id:s.lote_fiv_id,data_despacho:U,fazendas_destino_ids:ae,fazendas_destino_nomes:Be,pacote_info:Q||{id:$||"",data_aspiracao:U,quantidade_doadoras:0},embrioes:[],total:0,frescos:0,congelados:0},Ae.set(c,R)}const k=ge.get(s.lote_fiv_acasalamento_id||"");R.embrioes.push({...s,doadora_registro:k==null?void 0:k.doadora_registro,touro_nome:k==null?void 0:k.touro_nome,d7_pronto:(P=Le.get(s.id))==null?void 0:P.d7_pronto,d8_limite:(ce=Le.get(s.id))==null?void 0:ce.d8_limite}),R.total++,s.status_atual==="FRESCO"&&R.frescos++,s.status_atual==="CONGELADO"&&R.congelados++});const Te=[...new Set(Array.from(Ae.values()).map(s=>s.lote_fiv_id))],{data:Re}=await l.from("lotes_fiv").select("id, disponivel_para_transferencia").in("id",Te),qe=new Map((Re==null?void 0:Re.map(s=>[s.id,s.disponivel_para_transferencia===!0]))||[]),ve=Array.from(Ae.values()).map(s=>{const U=s.embrioes.filter(c=>!c.classificacao||c.classificacao.trim()==="").length;return{pacote:s,semClassificacao:U,total:s.total,disponivel:qe.get(s.lote_fiv_id)}}).filter(s=>s.disponivel!==!1&&s.total>0&&s.semClassificacao===0).map(s=>s.pacote).sort((s,U)=>U.data_despacho.localeCompare(s.data_despacho));u(ve)}catch(d){b({title:"Erro ao carregar pacotes de embriões",description:d instanceof Error?d.message:"Erro desconhecido",variant:"destructive"}),u([])}},[b]),A=o.useCallback(async()=>{var d;const a=F.trim().toLowerCase();if(!_&&!a){W([]);return}try{ue(!0);let v=l.from("embrioes").select("*").eq("status_atual","CONGELADO").not("cliente_id","is",null);_&&(v=v.eq("cliente_id",_));const[y,g]=await Promise.all([l.from("transferencias_embrioes").select("embriao_id"),v.order("created_at",{ascending:!1})]);if(y.error)throw y.error;if(g.error)throw g.error;const w=((d=y.data)==null?void 0:d.map(G=>G.embriao_id))||[],j=(g.data||[]).filter(G=>!w.includes(G.id)&&G.status_atual!=="TRANSFERIDO");if(j.length===0){W([]);return}W(j)}catch(v){b({title:"Erro ao carregar embriões congelados",description:v instanceof Error?v.message:"Erro desconhecido",variant:"destructive"}),W([])}finally{ue(!1)}},[_,F,b]),re=o.useCallback(async a=>{try{const{data:d,error:v}=await l.from("receptoras_cio_livre").select("receptora_id, data_cio").eq("status","DISPONIVEL").eq("fazenda_id",a);if(v&&v.code!=="PGRST205")throw v;const y=(d||[]).map(J=>J.receptora_id).filter(J=>!!J);if(y.length===0)return{receptoras:[],receptorasDisponiveis:0};const{data:g,error:w}=await l.from("receptoras").select("id, identificacao, status_reprodutivo").in("id",y);if(w)throw w;const j=new Map((d||[]).map(J=>[J.receptora_id,J.data_cio])),G=(g||[]).map(J=>({receptora_id:J.id,brinco:J.identificacao||"N/A",identificacao:J.identificacao||"",protocolo_id:void 0,protocolo_receptora_id:void 0,data_te_prevista:void 0,data_limite_te:void 0,quantidade_embrioes:0,ciclando_classificacao:void 0,qualidade_semaforo:void 0,origem:"CIO_LIVRE",data_cio:j.get(J.id),status_reprodutivo:J.status_reprodutivo}));return{receptoras:G,receptorasDisponiveis:G.length}}catch(d){return b({title:"Erro ao carregar receptoras",description:d instanceof Error?d.message:"Erro desconhecido",variant:"destructive"}),{receptoras:[],receptorasDisponiveis:0}}},[b]),se=o.useCallback(async(a,d)=>{const v=(d==null?void 0:d.contagem)??H,y=(d==null?void 0:d.info)??Z;try{let g=l.from("protocolos_sincronizacao").select("id");i&&(g=g.eq("passo2_data",i));const{data:w,error:j}=await g;if(j)throw j;const G=[...new Set((w||[]).map(c=>c.id).filter(Boolean))];if(G.length===0)return K([]),{receptorasDisponiveis:0};const{data:J,error:ne}=await l.from("v_protocolo_receptoras_status").select("receptora_id, brinco, data_te_prevista, data_limite_te, protocolo_id").eq("fase_ciclo","SINCRONIZADA").in("protocolo_id",G);if(ne&&ne.code!=="PGRST205")throw ne;const we=J||[],Se=[...new Set(we.map(c=>c.receptora_id).filter(Boolean))];if(Se.length===0)return K([]),{receptorasDisponiveis:0};const{data:he,error:Pe}=await l.from("vw_receptoras_fazenda_atual").select("receptora_id").in("receptora_id",Se).eq("fazenda_id_atual",a);if(Pe)throw Pe;const Le=new Set((he||[]).map(c=>c.receptora_id).filter(Boolean)),Ce=we.filter(c=>Le.has(c.receptora_id)),ze=[...new Set(Ce.map(c=>c.receptora_id).filter(Boolean))];if(ze.length===0)return K([]),{receptorasDisponiveis:0};const{data:ge,error:xe}=await l.from("receptoras").select("id, identificacao, status_reprodutivo").in("id",ze);if(xe)throw xe;const Ae=new Map((ge||[]).map(c=>[c.id,c])),Te=[...new Set(Ce.map(c=>c.protocolo_id).filter(Boolean))];let Re=[];if(Te.length>0){const{data:c,error:R}=await l.from("protocolo_receptoras").select("id, receptora_id, protocolo_id, status, ciclando_classificacao, qualidade_semaforo, observacoes").in("protocolo_id",Te).neq("status","INAPTA").neq("status","UTILIZADA");if(R&&R.code!=="PGRST205")throw R;Re=c||[]}const qe=new Map(Re.map(c=>[c.receptora_id,c]));let ve=Ce.map(c=>{const R=Ae.get(c.receptora_id),k=qe.get(c.receptora_id),P=v[c.receptora_id]||0;return{receptora_id:c.receptora_id,brinco:c.brinco||(R==null?void 0:R.identificacao)||"N/A",identificacao:(R==null?void 0:R.identificacao)||"",protocolo_id:(k==null?void 0:k.protocolo_id)||c.protocolo_id,protocolo_receptora_id:(k==null?void 0:k.id)||"",data_te_prevista:c.data_te_prevista,data_limite_te:c.data_limite_te,quantidade_embrioes:P,ciclando_classificacao:(k==null?void 0:k.ciclando_classificacao)??null,qualidade_semaforo:(k==null?void 0:k.qualidade_semaforo)??null,observacoes:(k==null?void 0:k.observacoes)??null,origem:"PROTOCOLO",status_reprodutivo:R==null?void 0:R.status_reprodutivo}}).filter(c=>c.status_reprodutivo==="SINCRONIZADA"||v[c.receptora_id]>0);if(t){const{receptoras:c}=await re(a);ve=[...ve,...c]}const s=Object.values(y).filter(c=>(v[c.receptora_id]||0)>=1),U=new Set(ve.map(c=>c.receptora_id));return s.forEach(c=>{U.has(c.receptora_id)||ve.push({...c,quantidade_embrioes:v[c.receptora_id]||0})}),ve=ve.map(c=>({...c,quantidade_embrioes:v[c.receptora_id]||0})),K(ve),{receptorasDisponiveis:ve.length}}catch(g){return b({title:"Erro ao carregar receptoras",description:g instanceof Error?g.message:"Erro desconhecido",variant:"destructive"}),K([]),{receptorasDisponiveis:0}}},[i,t,H,Z,re,b]),Ee=o.useCallback(async(a,d)=>{await se(a,d)},[se]);return o.useEffect(()=>{if(L.fazenda_id){const a=f.filter(d=>d.fazendas_destino_ids.includes(L.fazenda_id));x(a)}else x([])},[L.fazenda_id,f]),o.useEffect(()=>{(async()=>{if(le.length===0){me({}),D({});return}const{data:d,error:v}=await l.from("transferencias_embrioes").select("id, receptora_id, protocolo_receptora_id, receptoras(id, identificacao, status_reprodutivo)").in("id",le);if(v)return;const y={},g={};(d||[]).forEach(w=>{if(!w.receptora_id)return;y[w.receptora_id]=(y[w.receptora_id]||0)+1;const j=Array.isArray(w.receptoras)?w.receptoras[0]:w.receptoras;g[w.receptora_id]={receptora_id:w.receptora_id,brinco:(j==null?void 0:j.identificacao)||"N/A",identificacao:(j==null?void 0:j.identificacao)||"",protocolo_id:void 0,protocolo_receptora_id:w.protocolo_receptora_id||"",quantidade_embrioes:y[w.receptora_id],origem:w.protocolo_receptora_id?"PROTOCOLO":"CIO_LIVRE",status_reprodutivo:(j==null?void 0:j.status_reprodutivo)||"SERVIDA"}}),me(y),D(g)})()},[le]),{fazendas:V,clientes:z,pacotes:f,pacotesFiltrados:C,embrioesCongelados:_e,receptoras:Ne,setReceptoras:K,loading:de,loadingCongelados:fe,transferenciasSessao:E,setTransferenciasSessao:je,transferenciasIdsSessao:le,setTransferenciasIdsSessao:pe,contagemSessaoPorReceptora:H,setContagemSessaoPorReceptora:me,receptorasSessaoInfo:Z,setReceptorasSessaoInfo:D,loadFazendas:O,loadPacotes:h,loadClientes:B,loadEmbrioesCongelados:A,carregarReceptorasDaFazenda:se,recarregarReceptoras:Ee,salvarSessaoNoBanco:T,encerrarSessaoNoBanco:M,restaurarSessaoEmAndamento:q}}const be={origemEmbriao:"PACOTE",filtroClienteId:"",filtroRaca:"",dataPasso2:"",incluirCioLivre:!1,embrioesPage:1},Fe={showRelatorioDialog:!1,relatorioData:[],isVisualizacaoApenas:!1};function nt(){const[i,t]=o.useState(be.origemEmbriao),[_,F]=o.useState(be.filtroClienteId),[L,b]=o.useState(be.filtroRaca),[V,N]=o.useState(be.dataPasso2),[z,I]=o.useState(be.incluirCioLivre),[f,u]=o.useState(be.embrioesPage),[C,x]=o.useState(Fe.showRelatorioDialog),[_e,W]=o.useState(Fe.relatorioData),[Ne,K]=o.useState(Fe.isVisualizacaoApenas),de=o.useCallback(()=>{t(be.origemEmbriao),F(be.filtroClienteId),b(be.filtroRaca),N(be.dataPasso2),I(be.incluirCioLivre),u(be.embrioesPage)},[]),Y=o.useCallback(()=>{x(Fe.showRelatorioDialog),W(Fe.relatorioData),K(Fe.isVisualizacaoApenas)},[]),fe=o.useCallback(()=>{de(),Y()},[de,Y]),ue=o.useCallback(H=>{W(H),K(!0),x(!0)},[]),E=o.useCallback(H=>{W(H),K(!1),x(!0)},[]),je=o.useCallback(()=>{x(!1),K(!1)},[]),le=o.useCallback(H=>{t(H.origem_embriao==="CONGELADO"?"CONGELADO":"PACOTE"),F(H.filtro_cliente_id||""),b(H.filtro_raca||""),N(H.data_passo2||new Date().toISOString().split("T")[0]),I(!!H.incluir_cio_livre),H.embrioes_page&&u(H.embrioes_page)},[]),pe=o.useCallback(()=>({origemEmbriao:i,filtroClienteId:_,filtroRaca:L,dataPasso2:V,incluirCioLivre:z,embrioesPage:f}),[i,_,L,V,z,f]);return{origemEmbriao:i,setOrigemEmbriao:t,filtroClienteId:_,setFiltroClienteId:F,filtroRaca:L,setFiltroRaca:b,dataPasso2:V,setDataPasso2:N,incluirCioLivre:z,setIncluirCioLivre:I,embrioesPage:f,setEmbrioesPage:u,showRelatorioDialog:C,setShowRelatorioDialog:x,relatorioData:_e,setRelatorioData:W,isVisualizacaoApenas:Ne,setIsVisualizacaoApenas:K,resetFilters:de,resetRelatorio:Y,resetAll:fe,abrirRelatorioVisualizacao:ue,abrirRelatorioEncerramento:E,fecharRelatorio:je,aplicarFiltrosSessao:le,getFiltersState:pe}}function ct({formData:i,setFormData:t,origemEmbriao:_,receptoras:F,contagemSessaoPorReceptora:L,setContagemSessaoPorReceptora:b,receptorasSessaoInfo:V,setReceptorasSessaoInfo:N,transferenciasSessao:z,setTransferenciasSessao:I,transferenciasIdsSessao:f,setTransferenciasIdsSessao:u,numerosFixosMap:C,setSubmitting:x,setRelatorioData:_e,setShowRelatorioDialog:W,setIsVisualizacaoApenas:Ne,resetFiltros:K,loadPacotes:de,loadEmbrioesCongelados:Y,recarregarReceptoras:fe,encerrarSessaoNoBanco:ue}){const{toast:E}=oa(),je=o.useCallback(async D=>{try{const{data:T,error:M}=await l.from("protocolo_receptoras").select("protocolo_id").eq("id",D).single();if(M||!(T!=null&&T.protocolo_id))return;const n=T.protocolo_id,{data:m,error:q}=await l.from("protocolo_receptoras").select("status").eq("protocolo_id",n);if(q||!m)return;if(m.filter(O=>O.status==="APTA"||O.status==="INICIADA").length===0){const h=m.filter(A=>A.status==="UTILIZADA").length>0?"EM_TE":"FECHADO";await l.from("protocolos_sincronizacao").update({status:h}).eq("id",n)}}catch(T){console.error("Erro ao verificar status do protocolo:",T)}},[]),le=o.useCallback(async()=>{if(!i.receptora_id){E({title:"Nenhuma receptora selecionada",description:"Selecione uma receptora para descartar.",variant:"destructive"});return}const D=F.find(m=>m.receptora_id===i.receptora_id),T=(D==null?void 0:D.brinco)||i.receptora_id,M=(D==null?void 0:D.origem)||"PROTOCOLO",n=i.protocolo_receptora_id;try{if(x(!0),M==="CIO_LIVRE"){const{error:m}=await l.from("receptoras_cio_livre").update({status:"DESCARTADA"}).eq("receptora_id",i.receptora_id).eq("status","DISPONIVEL");if(m)throw m}else if(n){const{error:m}=await l.from("protocolo_receptoras").update({status:"INAPTA",motivo_inapta:"Descartada no menu de TE - não recebeu embrião"}).eq("id",n);if(m)throw m;await je(n)}i.receptora_id&&await l.from("receptoras").update({status_reprodutivo:"VAZIA"}).eq("id",i.receptora_id),E({title:"Receptora descartada",description:M==="CIO_LIVRE"?`${T} foi descartada e saiu da lista de cio livre.`:`${T} foi descartada e não receberá embrião neste protocolo.`}),t(m=>({...m,receptora_id:"",protocolo_receptora_id:""})),i.fazenda_id&&await fe(i.fazenda_id)}catch(m){E({title:"Erro ao descartar receptora",description:m instanceof Error?m.message:"Erro desconhecido",variant:"destructive"})}finally{x(!1)}},[i,F,t,x,fe,je,E]),pe=o.useCallback(async D=>{var q,B,O,h;D.preventDefault();const T=_==="PACOTE";if(!i.embriao_id){E({title:"Embrião não selecionado",description:"Por favor, selecione um embrião para realizar a transferência.",variant:"destructive"});return}if(!i.fazenda_id||!i.receptora_id||!i.data_te||T&&!i.pacote_id){E({title:"Erro de validação",description:"Todos os campos obrigatórios devem ser preenchidos",variant:"destructive"});return}const M=F.find(A=>A.receptora_id===i.receptora_id);if(!M){E({title:"Receptora não disponível",description:"A receptora selecionada não está disponível para transferência.",variant:"destructive"});return}const n=L[i.receptora_id]||0,m=n===1;if(n>=2){E({title:"Limite atingido",description:"Esta receptora já recebeu o máximo de 2 embriões permitidos.",variant:"destructive"});return}if(i.receptora_id&&!m){const A=M.status_reprodutivo||"VAZIA",re=M.origem==="CIO_LIVRE"?"SINCRONIZADA":A,se=Oa(re,"REALIZAR_TE");if(!se.valido){E({title:"Erro de validação",description:se.mensagem||"A receptora não pode receber embrião no estado atual",variant:"destructive"});return}}if(!i.veterinario_responsavel||i.veterinario_responsavel.trim()===""){E({title:"Erro de validação",description:"Veterinário responsável é obrigatório. Por favor, informe o nome do veterinário.",variant:"destructive"});return}try{x(!0);const A={embriao_id:i.embriao_id,receptora_id:i.receptora_id,protocolo_receptora_id:i.protocolo_receptora_id||null,data_te:i.data_te,tipo_te:_==="CONGELADO"?"CONGELADO":"FRESCO",veterinario_responsavel:i.veterinario_responsavel.trim(),tecnico_responsavel:((q=i.tecnico_responsavel)==null?void 0:q.trim())||null,status_te:"REALIZADA",observacoes:((B=i.observacoes)==null?void 0:B.trim())||null},{data:re,error:se}=await l.from("transferencias_embrioes").insert([A]).select("id");if(se){if(se.code==="23505"&&((O=se.message)!=null&&O.includes("unq_embriao_te_realizada"))){_==="CONGELADO"?Y():de();return}throw se}re&&((h=re[0])!=null&&h.id)&&u(d=>[...d,re[0].id]),await l.from("embrioes").update({status_atual:"TRANSFERIDO"}).eq("id",i.embriao_id),i.protocolo_receptora_id&&I(d=>d.includes(i.protocolo_receptora_id)?d:[...d,i.protocolo_receptora_id]);const Ee={...L};Ee[i.receptora_id]=(Ee[i.receptora_id]||0)+1,b(Ee);const a={...V};a[i.receptora_id]={...M,quantidade_embrioes:Ee[i.receptora_id]},N(a),E({title:"Transferência registrada",description:`Embrião transferido para ${M.brinco} com sucesso.`}),t(d=>({...d,embriao_id:"",receptora_id:"",protocolo_receptora_id:"",observacoes:""})),_==="CONGELADO"?Y():de(),i.fazenda_id&&await fe(i.fazenda_id,{contagem:Ee,info:a})}catch(A){E({title:"Erro ao registrar transferência",description:A instanceof Error?A.message:"Erro desconhecido",variant:"destructive"})}finally{x(!1)}},[i,_,F,L,V,t,x,u,I,b,N,de,Y,fe,E]),H=o.useCallback(async(D=!1)=>{if(!(f.length>0)){D||E({title:"Nenhuma transferência na sessão",description:"Não há transferências para gerar relatório.",variant:"destructive"});return}try{const{data:M,error:n}=await l.from("transferencias_embrioes").select(`
          *,
          embrioes (id, identificacao, classificacao, status_atual, lote_fiv_id, lote_fiv_acasalamento_id),
          receptoras (id, identificacao, nome)
        `).in("id",f).eq("status_te","REALIZADA").order("created_at",{ascending:!0});if(n)throw n;if(!M||M.length===0){E({title:"Erro ao gerar relatório",description:"Não foi possível encontrar as transferências da sessão.",variant:"destructive"});return}const m=M.map(h=>{var A;return(A=h.embrioes)==null?void 0:A.lote_fiv_acasalamento_id}).filter(h=>!!h),{doadorasMap:q,tourosMap:B}=await Ta(m),O=M.map(h=>{var d,v,y,g,w;const A=(d=h.embrioes)==null?void 0:d.lote_fiv_acasalamento_id,re=A&&q.get(A)||"N/A",se=A&&B.get(A)||"N/A";return{numero_embriao:((v=h.embrioes)==null?void 0:v.identificacao)||(C&&C.get(h.embriao_id||"")?String(C.get(h.embriao_id||"")):null)||(h.embriao_id?h.embriao_id.substring(0,8):"N/A"),doadora:re,touro:se,classificacao:((y=h.embrioes)==null?void 0:y.classificacao)||"N/A",receptora_brinco:((g=h.receptoras)==null?void 0:g.identificacao)||"N/A",receptora_nome:((w=h.receptoras)==null?void 0:w.nome)||"N/A",data_te:h.data_te,veterinario:h.veterinario_responsavel||"N/A",tecnico:h.tecnico_responsavel||"N/A",observacoes:h.observacoes||""}});_e(O),W(!0)}catch(M){E({title:"Erro ao gerar relatório",description:M instanceof Error?M.message:"Erro desconhecido",variant:"destructive"}),Ne(!1)}},[f,C,_e,W,Ne,E]),me=o.useCallback(async()=>{if(f.length===0){E({title:"Nenhuma transferência na sessão",description:"Não há transferências para visualizar.",variant:"destructive"});return}Ne(!0),await H(!0)},[f,Ne,H,E]),Z=o.useCallback(async()=>{if(f.length===0){E({title:"Nenhuma transferência na sessão",description:"Não há transferências para encerrar nesta sessão.",variant:"destructive"});return}try{x(!0);let D=[...z];if(D.length===0){const{data:B,error:O}=await l.from("transferencias_embrioes").select("protocolo_receptora_id").in("id",f);if(O)throw O;D=[...new Set((B||[]).map(h=>h.protocolo_receptora_id).filter(h=>!!h))]}const{data:T,error:M}=await l.from("transferencias_embrioes").select("receptora_id").in("id",f).eq("status_te","REALIZADA");if(M)throw M;const n=[...new Set((T||[]).map(B=>B.receptora_id).filter(Boolean))];if(n.length===0)throw new Error("Nenhuma receptora encontrada para encerrar a sessão.");const{error:m}=await l.rpc("encerrar_sessao_te",{p_receptora_ids:n,p_protocolo_receptora_ids:D});if(m)throw(m==null?void 0:m.code)==="PGRST202"?new Error("Função encerrar_sessao_te não encontrada no banco. Aplique o SQL em docs/db/003_encerrar_sessao_te.sql e tente novamente."):m;await ue(i.fazenda_id),E({title:"Sessão encerrada",description:`${f.length} transferência(s) finalizada(s) com sucesso.`});const q=i.fazenda_id;t({fazenda_id:"",pacote_id:"",protocolo_id:"",embriao_id:"",receptora_id:"",protocolo_receptora_id:"",data_te:new Date().toISOString().split("T")[0],veterinario_responsavel:"",tecnico_responsavel:"",observacoes:""}),I([]),u([]),b({}),N({}),K(),await de(),q&&await fe(q)}catch(D){E({title:"Erro ao encerrar sessão",description:D instanceof Error?D.message:"Erro desconhecido",variant:"destructive"})}finally{x(!1)}},[i,z,f,t,x,I,u,b,N,K,de,fe,ue,E]);return{handleDescartarReceptora:le,handleSubmit:pe,visualizarRelatorioSessao:me,gerarRelatorioSessao:H,handleEncerrarSessao:Z}}function dt({open:i,onOpenChange:t,relatorioData:_,fazendaNome:F,dataTe:L,veterinarioResponsavel:b,tecnicoResponsavel:V,isVisualizacaoApenas:N,submitting:z,onFechar:I,onConfirmarEncerrar:f}){return e.jsx(Pa,{open:i,onOpenChange:t,children:e.jsxs(La,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ma,{children:[e.jsxs(Fa,{className:"flex items-center gap-2",children:[e.jsx(Ha,{className:"w-5 h-5"}),"Relatório da Sessão de Transferência de Embriões"]}),e.jsxs(qa,{children:["Fazenda: ",F||"N/A"," | Data da TE: ",L?ra(L):"N/A"," | Total: ",_.length," transferência(s)"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Veterinário Responsável:"})," ",b||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Técnico Responsável:"})," ",V||"N/A"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Va,{children:[e.jsx(Ga,{children:e.jsxs(va,{children:[e.jsx(ke,{className:"text-center",children:"Código"}),e.jsx(ke,{children:"Doadora"}),e.jsx(ke,{children:"Touro"}),e.jsx(ke,{children:"Classificação"}),e.jsx(ke,{children:"Receptora (Brinco)"}),e.jsx(ke,{children:"Receptora (Nome)"}),e.jsx(ke,{children:"Data TE"}),e.jsx(ke,{children:"Observações"})]})}),e.jsx($a,{children:_.map((u,C)=>e.jsxs(va,{children:[e.jsx(De,{className:"text-center font-semibold",children:u.numero_embriao}),e.jsx(De,{children:u.doadora}),e.jsx(De,{children:u.touro}),e.jsx(De,{children:u.classificacao}),e.jsx(De,{className:"font-semibold",children:u.receptora_brinco}),e.jsx(De,{children:u.receptora_nome}),e.jsx(De,{children:u.data_te?ra(u.data_te):"N/A"}),e.jsx(De,{className:"text-sm text-slate-600",children:u.observacoes||"-"})]},C))})]})})]}),e.jsxs(Ba,{children:[e.jsx(ye,{type:"button",variant:"outline",onClick:I,children:"Fechar"}),!N&&e.jsx(ye,{type:"button",onClick:async()=>{I(),await f()},disabled:z,children:z?"Encerrando...":"Confirmar e Encerrar Sessão"})]})]})})}function lt({receptoras:i,selectedReceptoraId:t,contagemSessaoPorReceptora:_,submitting:F,onSelectReceptora:L,onDescartarReceptora:b}){const V=[{key:"brinco",label:"Receptora"},{key:"embrioes_count",label:"Embriões",width:"80px",align:"center"},{key:"action",label:"",width:"50px",excludeFromCard:!0}];return e.jsx(ia,{data:i,columns:V,rowKey:"receptora_id",selectionType:"radio",radioName:"receptora",selectedId:t,onSelect:N=>{const z=i.find(I=>I.receptora_id===N);z&&L(N,z.protocolo_receptora_id||"")},isRowDisabled:N=>(_[N.receptora_id]||0)>=2,emptyMessage:"Nenhuma receptora sincronizada encontrada",footerContent:`${i.length} receptora(s) disponível(is)`,renderCell:(N,z)=>{const I=_[N.receptora_id]||0,f=t===N.receptora_id;switch(z.key){case"brinco":return e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:N.brinco}),N.origem==="CIO_LIVRE"&&e.jsx($e,{variant:"outline",className:"text-[10px] px-1.5 py-0 h-4 bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-300 dark:border-emerald-800",children:"CIO"}),e.jsx(Za,{value:N.ciclando_classificacao}),e.jsx(Ua,{value:N.qualidade_semaforo})]}),N.observacoes&&e.jsx("p",{className:"text-[10px] text-muted-foreground truncate mt-0.5",title:N.observacoes,children:N.observacoes})]});case"embrioes_count":return I>0?e.jsxs("span",{className:"inline-flex items-center justify-center px-2 h-5 text-[10px] font-medium bg-primary/15 text-primary rounded",children:[I,"/2"]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"});case"action":return f?e.jsx(ye,{type:"button",variant:"ghost",size:"sm",onClick:u=>{u.stopPropagation(),b()},className:"h-6 w-6 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",disabled:F,title:"Descartar receptora",children:e.jsx(Wa,{className:"w-3.5 h-3.5"})}):null;default:return}}})}function pt({pacote:i,embrioes:t,numerosFixosMap:_,selectedEmbriaoId:F,embrioesPage:L,hasD8Limite:b,onSelectEmbriao:V,onPageChange:N}){const z=o.useMemo(()=>[...t].sort((f,u)=>{const C=f.identificacao||"",x=u.identificacao||"";if(C&&x)return C.localeCompare(x);if(C&&!x)return-1;if(!C&&x)return 1;const _e=_.get(f.id)||9999,W=_.get(u.id)||9999;return _e-W}),[t,_]),I=[{key:"identificacao",label:"Código",width:"60px",align:"center"},{key:"doadora_registro",label:"Doadora"},{key:"touro_nome",label:"Touro"},{key:"classificacao",label:"Class.",width:"70px",align:"center"},{key:"d7_pronto",label:"Dia",width:"50px",align:"center"}];return e.jsx(ia,{data:z,columns:I,rowKey:"id",selectionType:"radio",radioName:"embriao",selectedId:F,onSelect:V,pageSize:20,currentPage:L,onPageChange:N,emptyMessage:"Nenhum embrião disponível no pacote",headerContent:b&&e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-xs text-amber-700 dark:text-amber-400 bg-amber-50 dark:bg-amber-950/50 p-2 rounded-lg border border-amber-200 dark:border-amber-800",children:[e.jsx(Ja,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"Embriões em D8: transferir ou congelar hoje"})]}),footerContent:`${t.length} embrião(ões) disponível(is)`,renderCell:(f,u)=>{switch(u.key){case"identificacao":const C=_.get(f.id)||0;return e.jsx("span",{className:"text-xs font-medium font-mono text-foreground",children:f.identificacao||`#${C}`});case"doadora_registro":return e.jsx("span",{className:"text-sm text-foreground truncate",children:f.doadora_registro||"-"});case"touro_nome":return e.jsx("span",{className:"text-sm text-muted-foreground truncate",children:f.touro_nome||"-"});case"classificacao":return f.classificacao?e.jsx($e,{variant:"outline",className:"text-[10px] px-1.5 py-0 h-4",children:f.classificacao}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"});case"d7_pronto":return f.d8_limite?e.jsx($e,{variant:"destructive",className:"text-[10px] px-1.5 py-0 h-4",children:"D8"}):f.d7_pronto?e.jsx($e,{variant:"outline",className:"text-[10px] px-1.5 py-0 h-4 bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-300 dark:border-emerald-800",children:"D7"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"});default:return}}})}function mt({embrioes:i,selectedEmbriaoId:t,embrioesPage:_,loadingCongelados:F,filtroClienteId:L,filtroRaca:b,onSelectEmbriao:V,onPageChange:N}){const z=L||b.trim(),I=o.useMemo(()=>[...i].sort((C,x)=>{const _e=C.created_at?new Date(C.created_at).getTime():0;return(x.created_at?new Date(x.created_at).getTime():0)-_e}),[i]),f=[{key:"identificacao",label:"Código",width:"80px"},{key:"doadora_registro",label:"Doadora"},{key:"touro_nome",label:"Touro"},{key:"classificacao",label:"Class.",width:"70px",align:"center"}],u=()=>z?F?"Carregando embriões congelados...":"Nenhum embrião congelado encontrado":"Selecione um cliente ou informe a raça para listar embriões";return!z||F?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center border border-border rounded-lg",children:e.jsx("div",{className:"text-center py-6 text-sm text-muted-foreground",children:u()})}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[i.length," embrião(ões) disponível(is)"]})]}):e.jsx(ia,{data:I,columns:f,rowKey:"id",selectionType:"radio",radioName:"embriao",selectedId:t,onSelect:V,pageSize:20,currentPage:_,onPageChange:N,emptyMessage:u(),footerContent:`${i.length} embrião(ões) disponível(is)`,renderCell:(C,x)=>{switch(x.key){case"identificacao":return e.jsx("span",{className:"text-xs font-medium font-mono text-foreground",children:C.identificacao||C.id.substring(0,8)});case"doadora_registro":return e.jsx("span",{className:"text-sm text-foreground truncate",children:C.doadora_registro||"-"});case"touro_nome":return e.jsx("span",{className:"text-sm text-muted-foreground truncate",children:C.touro_nome||"-"});case"classificacao":return C.classificacao?e.jsx($e,{variant:"outline",className:"text-[10px] px-1.5 py-0 h-4",children:C.classificacao}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"});default:return}}})}const _t=20;function Zt(){var na;za();const{toast:i}=oa(),[t,_]=o.useState({fazenda_id:"",pacote_id:"",protocolo_id:"",receptora_id:"",protocolo_receptora_id:"",embriao_id:"",data_te:new Date().toISOString().split("T")[0],veterinario_responsavel:"",tecnico_responsavel:"",observacoes:""}),[F,L]=o.useState({data_te:"",veterinario_responsavel:"",tecnico_responsavel:""}),[b,V]=o.useState(!1),[N,z]=o.useState([]),[I,f]=o.useState([]),[u,C]=o.useState(!1),[x,_e]=o.useState("todos"),[W,Ne]=o.useState("todos"),[K,de]=o.useState(""),[Y,fe]=o.useState(""),[ue,E]=o.useState(""),[je,le]=o.useState([]),[pe,H]=o.useState(1),me=15,{origemEmbriao:Z,setOrigemEmbriao:D,filtroClienteId:T,setFiltroClienteId:M,filtroRaca:n,setFiltroRaca:m,dataPasso2:q,setDataPasso2:B,incluirCioLivre:O,setIncluirCioLivre:h,embrioesPage:A,setEmbrioesPage:re,showRelatorioDialog:se,setShowRelatorioDialog:Ee,relatorioData:a,setRelatorioData:d,isVisualizacaoApenas:v,setIsVisualizacaoApenas:y,resetAll:g,aplicarFiltrosSessao:w,fecharRelatorio:j}=nt(),{fazendas:G,clientes:J,pacotes:ne,pacotesFiltrados:we,embrioesCongelados:Se,receptoras:he,setReceptoras:Pe,loading:Le,loadingCongelados:Ce,transferenciasSessao:ze,setTransferenciasSessao:ge,transferenciasIdsSessao:xe,setTransferenciasIdsSessao:Ae,contagemSessaoPorReceptora:Te,setContagemSessaoPorReceptora:Re,receptorasSessaoInfo:qe,setReceptorasSessaoInfo:Qe,loadFazendas:ve,loadPacotes:s,loadClientes:U,loadEmbrioesCongelados:c,carregarReceptorasDaFazenda:R,recarregarReceptoras:k,salvarSessaoNoBanco:P,encerrarSessaoNoBanco:ce,restaurarSessaoEmAndamento:$}=st({dataPasso2:q,incluirCioLivre:O,filtroClienteId:T,filtroRaca:n,formData:t}),Q=ne.find(r=>r.id===t.pacote_id),ae=o.useMemo(()=>(Q==null?void 0:Q.embrioes.filter(r=>r.status_atual==="FRESCO"))||[],[Q]),Be=ae.some(r=>r.d8_limite),oe=o.useRef(0),Me=o.useMemo(()=>{if(!t.pacote_id||!Q)return new Map;const r=[...ae].sort((te,ee)=>{const Oe=te.doadora_registro||"",Ie=ee.doadora_registro||"";if(Oe!==Ie)return Oe.localeCompare(Ie);const Ze=te.created_at?new Date(te.created_at).getTime():0,Ue=ee.created_at?new Date(ee.created_at).getTime():0;return Ze!==Ue?Ze-Ue:(te.id||"").localeCompare(ee.id||"")}),S=new Map;return r.forEach((te,ee)=>{S.set(te.id,ee+1)}),S},[t.pacote_id,Q,ae]),{handleDescartarReceptora:He,handleSubmit:Ke,visualizarRelatorioSessao:Na,handleEncerrarSessao:sa}=ct({formData:t,setFormData:_,origemEmbriao:Z,receptoras:he,contagemSessaoPorReceptora:Te,setContagemSessaoPorReceptora:Re,receptorasSessaoInfo:qe,setReceptorasSessaoInfo:Qe,transferenciasSessao:ze,setTransferenciasSessao:ge,transferenciasIdsSessao:xe,setTransferenciasIdsSessao:Ae,numerosFixosMap:Me,setSubmitting:V,setRelatorioData:d,setShowRelatorioDialog:Ee,setIsVisualizacaoApenas:y,resetFiltros:g,loadPacotes:s,loadEmbrioesCongelados:c,recarregarReceptoras:k,encerrarSessaoNoBanco:ce}),ja=()=>{const r={fazenda_id:t.fazenda_id,pacote_id:t.pacote_id,data_passo2:q,data_te:t.data_te,veterinario_responsavel:t.veterinario_responsavel,tecnico_responsavel:t.tecnico_responsavel,origem_embriao:Z,filtro_cliente_id:T,filtro_raca:n,incluir_cio_livre:O,transferenciasSessao:ze,transferenciasIdsSessao:xe,embrioes_page:A};P(r)},Ea=async()=>{const{data:r}=await l.from("fazendas").select("id, nome").order("nome");le(r||[])};o.useCallback(async()=>{try{C(!0);let r=l.from("transferencias_embrioes").select(`
          id,
          receptora_id,
          embriao_id,
          data_te,
          tipo_te,
          veterinario_responsavel,
          tecnico_responsavel,
          observacoes,
          status_te,
          embrioes (id, identificacao, classificacao),
          receptoras (id, identificacao, nome)
        `).eq("status_te","REALIZADA").order("data_te",{ascending:!1}).limit(500);Y&&(r=r.gte("data_te",Y)),ue&&(r=r.lte("data_te",ue)),W&&W!=="todos"&&(r=r.eq("tipo_te",W));const{data:S,error:te}=await r;if(te)throw console.error("Erro ao buscar transferências:",te),new Error(te.message||"Erro ao buscar transferências");if(!S||S.length===0){z([]),f([]);return}const ee=[...new Set(S.map(p=>p.receptora_id).filter(Boolean))],{data:Oe,error:Ie}=await l.from("vw_receptoras_fazenda_atual").select("receptora_id, fazenda_id_atual, fazenda_nome_atual").in("receptora_id",ee);Ie&&console.error("Erro ao buscar view receptoras:",Ie);const Ze=new Map((Oe||[]).map(p=>[p.receptora_id,{id:p.fazenda_id_atual,nome:p.fazenda_nome_atual}])),Ue=S.map(p=>p.embriao_id).filter(Boolean),{data:ca}=await l.from("embrioes").select("id, lote_fiv_acasalamento_id").in("id",Ue),da=(ca||[]).map(p=>p.lote_fiv_acasalamento_id).filter(p=>!!p);let la=new Map,pa=new Map;if(da.length>0){const{data:p}=await l.from("lotes_fiv_acasalamentos").select(`
            id,
            doadoras (registro),
            touros (nome)
          `).in("id",da);(p||[]).forEach(X=>{var ie,Ge;(ie=X.doadoras)!=null&&ie.registro&&la.set(X.id,X.doadoras.registro),(Ge=X.touros)!=null&&Ge.nome&&pa.set(X.id,X.touros.nome)})}const Aa=new Map((ca||[]).map(p=>[p.id,p.lote_fiv_acasalamento_id])),ma=S.map(p=>{var Ge,_a,fa;const X=Ze.get(p.receptora_id),ie=Aa.get(p.embriao_id);return{id:p.id,receptora_id:p.receptora_id,receptora_brinco:((Ge=p.receptoras)==null?void 0:Ge.identificacao)||"-",receptora_nome:(_a=p.receptoras)==null?void 0:_a.nome,fazenda_nome:(X==null?void 0:X.nome)||"-",fazenda_id:X==null?void 0:X.id,data_te:p.data_te,embriao_identificacao:(fa=p.embrioes)==null?void 0:fa.identificacao,doadora_registro:ie?la.get(ie):void 0,touro_nome:ie?pa.get(ie):void 0,tipo_te:p.tipo_te,veterinario_responsavel:p.veterinario_responsavel,tecnico_responsavel:p.tecnico_responsavel,observacoes:p.observacoes}});z(ma);const Ve=new Map;ma.forEach(p=>{const X=`${p.fazenda_nome}|${p.data_te}|${p.veterinario_responsavel||""}`;Ve.has(X)||Ve.set(X,{id:X,fazenda_nome:p.fazenda_nome,fazenda_id:p.fazenda_id||"",data_te:p.data_te,veterinario_responsavel:p.veterinario_responsavel,tecnico_responsavel:p.tecnico_responsavel,total_receptoras:0,total_embrioes:0,frescos:0,congelados:0,transferencias:[]});const ie=Ve.get(X);ie.total_embrioes++,ie.transferencias.push(p),p.tipo_te==="FRESCO"?ie.frescos++:p.tipo_te==="CONGELADO"&&ie.congelados++,!ie.tecnico_responsavel&&p.tecnico_responsavel&&(ie.tecnico_responsavel=p.tecnico_responsavel)}),Ve.forEach(p=>{const X=new Set(p.transferencias.map(ie=>ie.receptora_id));p.total_receptoras=X.size});const ya=Array.from(Ve.values()).sort((p,X)=>(X.data_te||"").localeCompare(p.data_te||""));f(ya),H(1)}catch(r){console.error("Erro no loadHistorico:",r);const S=r instanceof Error?r.message:"Erro desconhecido";i({title:"Erro ao carregar histórico",description:S,variant:"destructive"})}finally{C(!1)}},[Y,ue,W,i]);const wa=async r=>{if(!r){_({...t,fazenda_id:"",pacote_id:"",protocolo_id:"",embriao_id:"",receptora_id:"",protocolo_receptora_id:""}),L({data_te:"",veterinario_responsavel:"",tecnico_responsavel:""}),ge([]),Ae([]),Pe([]);return}ge([]),Ae([]),L({data_te:"",veterinario_responsavel:"",tecnico_responsavel:""}),await R(r),_({...t,fazenda_id:r,pacote_id:"",protocolo_id:"",embriao_id:"",receptora_id:"",protocolo_receptora_id:""})},Ca=r=>{var te;const S=ne.find(ee=>ee.id===r);(te=S==null?void 0:S.pacote_info)!=null&&te.veterinario_responsavel&&!t.veterinario_responsavel?(_(ee=>({...ee,pacote_id:r,veterinario_responsavel:S.pacote_info.veterinario_responsavel||""})),L(ee=>({...ee,veterinario_responsavel:S.pacote_info.veterinario_responsavel||""}))):_(ee=>({...ee,pacote_id:r}))};o.useEffect(()=>{(async()=>{await Promise.all([ve(),s(),U(),Ea()]);const S=await $();S&&(w(S.filtros),L(S.camposPacote),_(te=>({...te,...S.formData,embriao_id:"",receptora_id:"",protocolo_receptora_id:"",observacoes:""})))})()},[]),o.useEffect(()=>{(t.fazenda_id||t.pacote_id||xe.length>0)&&ja()},[t.fazenda_id,t.pacote_id,t.protocolo_id,t.data_te,t.veterinario_responsavel,t.tecnico_responsavel,Z,T,n,q,O,ze.length,xe.length,A]),o.useEffect(()=>{ve()},[q]),o.useEffect(()=>{t.fazenda_id&&R(t.fazenda_id)},[t.fazenda_id,q,O]),o.useEffect(()=>{Z==="CONGELADO"&&(T||n.trim())&&c()},[Z,T,n]),o.useEffect(()=>{re(1)},[t.pacote_id]),o.useEffect(()=>{Z==="CONGELADO"&&(re(1),_(r=>({...r,embriao_id:""})))},[Z,T,n]),o.useEffect(()=>{!t.pacote_id||!Q||(oe.current+=1)},[t.pacote_id,Q,Me]),o.useEffect(()=>{const r=Math.max(1,Math.ceil(ae.length/_t));A>r&&re(r)},[ae.length,A]);const We=I.filter(r=>{var ee;const S=!K||r.fazenda_nome.toLowerCase().includes(K.toLowerCase())||((ee=r.veterinario_responsavel)==null?void 0:ee.toLowerCase().includes(K.toLowerCase()))||r.transferencias.some(Oe=>{var Ie;return Oe.receptora_brinco.toLowerCase().includes(K.toLowerCase())||((Ie=Oe.receptora_nome)==null?void 0:Ie.toLowerCase().includes(K.toLowerCase()))}),te=x==="todos"||r.fazenda_nome===x;return S&&te});return Math.ceil(We.length/me),We.slice((pe-1)*me,pe*me),We.reduce((r,S)=>({sessoes:r.sessoes+1,receptoras:r.receptoras+S.total_receptoras,embrioes:r.embrioes+S.total_embrioes,frescos:r.frescos+S.frescos,congelados:r.congelados+S.congelados}),{sessoes:0,receptoras:0,embrioes:0,frescos:0,congelados:0}),Le?e.jsx(Ra,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Da,{title:"Transferência de Embriões (TE)",description:"Destinar embriões para receptoras sincronizadas"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4 mb-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Ya,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Responsáveis"})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Veterinário *"}),e.jsx(ta,{placeholder:"Nome do veterinário",value:t.veterinario_responsavel,onChange:r=>_({...t,veterinario_responsavel:r.target.value}),className:"h-9"})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Técnico"}),e.jsx(ta,{placeholder:"Nome do técnico",value:t.tecnico_responsavel,onChange:r=>_({...t,tecnico_responsavel:r.target.value}),className:"h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-emerald-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(et,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Local"})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Fazenda *"}),e.jsxs(Je,{value:t.fazenda_id,onValueChange:wa,disabled:!t.veterinario_responsavel,children:[e.jsx(Xe,{className:"h-9",children:e.jsx(Ye,{placeholder:"Selecione a fazenda"})}),e.jsx(ea,{children:G.map(r=>e.jsx(aa,{value:r.id,children:r.nome},r.id))})]})]}),e.jsxs("div",{className:"w-[140px] flex-shrink-0",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Data TE *"}),e.jsx(ga,{value:t.data_te,onChange:r=>_({...t,data_te:r||""}),className:"h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),t.fazenda_id&&xe.length>0&&e.jsxs("div",{className:"flex items-end gap-2 ml-auto",children:[e.jsxs(ye,{type:"button",onClick:Na,variant:"outline",disabled:b,className:"h-9",title:"Visualizar relatório da sessão atual",children:[e.jsx(at,{className:"w-4 h-4 mr-2"}),"Ver (",xe.length,")"]}),e.jsxs(ye,{type:"button",onClick:sa,disabled:b,className:"h-9 px-6 bg-primary hover:bg-primary-dark shadow-sm",children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),b?"Encerrando...":`Encerrar (${xe.length})`]})]})]}),t.fazenda_id&&e.jsxs("div",{className:"flex flex-wrap items-end gap-4 mt-4 pt-4 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-blue-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(rt,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Receptoras"})]}),e.jsxs("div",{className:"w-[130px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Data 2º Passo"}),e.jsx(ga,{value:q,onChange:r=>B(r||""),className:"h-9"})]}),e.jsxs("div",{className:"flex items-center gap-2 h-9 self-end",children:[e.jsx(Xa,{id:"incluir-cio-livre",checked:O,onCheckedChange:h}),e.jsx(xa,{htmlFor:"incluir-cio-livre",className:"cursor-pointer text-xs",children:"Incluir CIO livre"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-amber-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(ba,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Origem"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(ye,{type:"button",variant:Z==="PACOTE"?"default":"outline",onClick:()=>D("PACOTE"),size:"sm",className:"h-8",children:[e.jsx(ba,{className:"w-3.5 h-3.5 mr-1.5"}),"Pacote"]}),e.jsxs(ye,{type:"button",variant:Z==="CONGELADO"?"default":"outline",onClick:()=>D("CONGELADO"),size:"sm",className:"h-8",children:[e.jsx(Ia,{className:"w-3.5 h-3.5 mr-1.5"}),"Congelado"]})]})]}),Z==="PACOTE"&&e.jsxs("div",{className:"flex-1 min-w-[220px] max-w-[300px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Pacote de Embriões *"}),e.jsxs(Je,{value:t.pacote_id,onValueChange:Ca,children:[e.jsx(Xe,{className:"h-9",children:e.jsx(Ye,{placeholder:"Selecione o pacote"})}),e.jsx(ea,{children:we.map(r=>{var S;return e.jsxs(aa,{value:r.id,children:[((S=r.pacote_info)==null?void 0:S.fazenda_nome)||"N/A"," - ",ra(r.data_despacho)," (",r.frescos," frescos)"]},r.id)})})]})]}),Z==="CONGELADO"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 min-w-[160px] max-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Cliente"}),e.jsxs(Je,{value:T,onValueChange:M,children:[e.jsx(Xe,{className:"h-9",children:e.jsx(Ye,{placeholder:"Selecione"})}),e.jsx(ea,{children:J.map(r=>e.jsx(aa,{value:r.id,children:r.nome},r.id))})]})]}),e.jsxs("div",{className:"flex-1 min-w-[140px] max-w-[160px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Raça"}),e.jsx(ta,{value:n,onChange:r=>m(r.target.value),placeholder:"Digite a raça",className:"h-9"})]})]})]}),t.veterinario_responsavel?t.fazenda_id?null:e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Selecione uma fazenda para ver as receptoras disponíveis"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Preencha o veterinário para selecionar a fazenda"})]}),t.fazenda_id&&e.jsxs("form",{onSubmit:Ke,children:[(t.pacote_id||Z==="CONGELADO"&&(T||n.trim()))&&e.jsx(ua,{className:"mb-4",children:e.jsx(ha,{className:"pt-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-2",children:"Receptoras"}),e.jsx("div",{className:"flex-1 min-h-[300px] max-h-[400px]",children:e.jsx(lt,{receptoras:he,selectedReceptoraId:t.receptora_id,contagemSessaoPorReceptora:Te,submitting:b,onSelectReceptora:(r,S)=>{_({...t,receptora_id:r,protocolo_receptora_id:S})},onDescartarReceptora:He})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h3",{className:"text-sm font-semibold text-foreground mb-2",children:["Embriões ",Z==="PACOTE"?"(Pacote)":"(Congelados)"]}),e.jsxs("div",{className:"flex-1 min-h-[300px] max-h-[400px]",children:[Z==="PACOTE"&&t.pacote_id&&Q&&e.jsx(pt,{pacote:Q,embrioes:ae,numerosFixosMap:Me,selectedEmbriaoId:t.embriao_id,embrioesPage:A,hasD8Limite:Be,onSelectEmbriao:r=>_({...t,embriao_id:r}),onPageChange:re}),Z==="CONGELADO"&&e.jsx(mt,{embrioes:Se,selectedEmbriaoId:t.embriao_id,embrioesPage:A,loadingCongelados:Ce,filtroClienteId:T,filtroRaca:n,onSelectEmbriao:r=>_({...t,embriao_id:r}),onPageChange:re})]})]})]})})}),t.embriao_id&&t.receptora_id&&e.jsx(ua,{children:e.jsx(ha,{className:"pt-4",children:e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(xa,{htmlFor:"observacoes",className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Observações"}),e.jsx(ka,{id:"observacoes",value:t.observacoes,onChange:r=>_({...t,observacoes:r.target.value}),placeholder:"Observações sobre a transferência",rows:2,className:"resize-none"})]}),e.jsx(ye,{type:"submit",disabled:b,className:"h-10 bg-primary hover:bg-primary-dark",children:b?"Registrando...":"Registrar Transferência"})]})})})]})]}),e.jsx(dt,{open:se,onOpenChange:Ee,relatorioData:a,fazendaNome:((na=G.find(r=>r.id===t.fazenda_id))==null?void 0:na.nome)||"N/A",dataTe:t.data_te,veterinarioResponsavel:t.veterinario_responsavel,tecnicoResponsavel:t.tecnico_responsavel,isVisualizacaoApenas:v,submitting:b,onFechar:j,onConfirmarEncerrar:sa})]})}export{Zt as default};
