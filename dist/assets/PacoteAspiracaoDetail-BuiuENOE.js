import{j as a,r as i,s as z,i as Da,a as Na,h as Aa,B as T}from"./index-6OJhfjKP.js";import{C as Y,a as aa,b as ea,d as sa}from"./card-D-gf0lmS.js";import{T as ya,a as wa,b as Z,c as P,d as Ea,e as R}from"./table-B_Z-CztY.js";import{D as $,a as Sa,b as M,c as B,d as J,e as G}from"./dialog-CFjhGf-B.js";import{A as ra,a as oa,b as ia,c as ta,d as na,e as da,f as ca,g as la}from"./alert-dialog-C4TLnUZs.js";import{I as N}from"./input-_UHZ9n1P.js";import{L as v}from"./label-BTrzYRkl.js";import{T as U}from"./textarea-DMqLWH95.js";import{S as ua,a as ma,b as ha,c as pa,d as K}from"./select-B7v4ZPbC.js";import{T as za,a as Fa,b as fa,c as va}from"./tabs-DFK_xrkO.js";import{B as xa}from"./badge-ChTtRB_d.js";import{P as ka}from"./PageHeader-P7sO2uqv.js";import{E as Oa}from"./EmptyState-CEfkJzHC.js";import{u as V}from"./use-toast-DasFaehQ.js";import{f as Ta}from"./dateUtils-eJ5e6apA.js";import{A as Ra}from"./arrow-left-B6Z7dGLk.js";import{L as Ia}from"./lock-B1qxSH_C.js";import{S as ga}from"./square-pen-CDisL43u.js";import{P as Pa}from"./plus-Dnfaq_2C.js";import"./index-CtR1jODk.js";import"./x-kO07YPaG.js";import"./check-CgmfRmMI.js";import"./index-ea8B15na.js";function H(r){const o=typeof r.atresicos=="string"?parseInt(r.atresicos)||0:r.atresicos||0,n=typeof r.degenerados=="string"?parseInt(r.degenerados)||0:r.degenerados||0,g=typeof r.expandidos=="string"?parseInt(r.expandidos)||0:r.expandidos||0,l=typeof r.desnudos=="string"?parseInt(r.desnudos)||0:r.desnudos||0,y=typeof r.viaveis=="string"?parseInt(r.viaveis)||0:r.viaveis||0;return o+n+g+l+y}function ja(r,o){if(!r)return"";const[n,g]=r.split(":").map(Number),l=n*60+g+o*60,y=Math.floor(l/60)%24,b=l%60;return`${String(y).padStart(2,"0")}:${String(b).padStart(2,"0")}`}const Ca={atresicos:"",degenerados:"",expandidos:"",desnudos:"",viaveis:""};function Q({data:r,onChange:o,disabled:n}){const g=H(r);return a.jsxs("div",{className:"border-t pt-4",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Contagem de Oócitos"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Atrésicos"}),a.jsx(N,{type:"number",min:"0",value:r.atresicos,onChange:l=>o("atresicos",l.target.value),disabled:n})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Degenerados"}),a.jsx(N,{type:"number",min:"0",value:r.degenerados,onChange:l=>o("degenerados",l.target.value),disabled:n})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Expandidos"}),a.jsx(N,{type:"number",min:"0",value:r.expandidos,onChange:l=>o("expandidos",l.target.value),disabled:n})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Desnudos"}),a.jsx(N,{type:"number",min:"0",value:r.desnudos,onChange:l=>o("desnudos",l.target.value),disabled:n})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Viáveis"}),a.jsx(N,{type:"number",min:"0",value:r.viaveis,onChange:l=>o("viaveis",l.target.value),disabled:n})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Total"}),a.jsx(N,{value:g,disabled:!0})]})]})]})}function Ha({pacoteId:r}){const{toast:o}=V(),[n,g]=i.useState(!0),[l,y]=i.useState(null),[b,F]=i.useState(""),[x,D]=i.useState([]),[t,m]=i.useState([]),[k,w]=i.useState([]),j=t.reduce((h,c)=>h+(c.total_oocitos||0),0),O=(l==null?void 0:l.status)==="FINALIZADO",p=i.useCallback(async()=>{if(!r)return[];const{data:h,error:c}=await z.from("aspiracoes_doadoras").select("*").eq("pacote_aspiracao_id",r).order("created_at",{ascending:!0});if(c)throw c;if(!h||h.length===0)return[];const s=h.map(S=>S.doadora_id),{data:u,error:d}=await z.from("doadoras").select("id, registro, nome").in("id",s);if(d)throw d;const q=new Map((u==null?void 0:u.map(S=>[S.id,S]))||[]);return h.map(S=>{const I=q.get(S.doadora_id);return{...S,doadora_nome:I==null?void 0:I.nome,doadora_registro:I==null?void 0:I.registro}})},[r]),C=i.useCallback(async(h,c)=>{const s=new Set(c.map(S=>S.doadora_id)),{data:u,error:d}=await z.from("doadoras").select("id, registro, nome").eq("fazenda_id",h).order("registro",{ascending:!0});if(d)throw d;const q=(u||[]).filter(S=>!s.has(S.id));w(q)},[]),E=i.useCallback(async h=>{const{data:c}=await z.from("pacotes_aspiracao_fazendas_destino").select("fazenda_destino_id").eq("pacote_aspiracao_id",h.id);if(!c||c.length===0){if(h.fazenda_destino_id){const{data:d}=await z.from("fazendas").select("nome").eq("id",h.fazenda_destino_id).single();if(d)return[d.nome]}return[]}const s=c.map(d=>d.fazenda_destino_id),{data:u}=await z.from("fazendas").select("id, nome").in("id",s);return u?u.map(d=>d.nome).filter(Boolean):[]},[]),A=i.useCallback(async()=>{if(r)try{g(!0);const{data:h,error:c}=await z.from("pacotes_aspiracao").select("*").eq("id",r).single();if(c)throw c;y(h);const[s,u,d]=await Promise.all([z.from("fazendas").select("nome").eq("id",h.fazenda_id).single(),E(h),p()]);if(s.error)throw s.error;F(s.data.nome),D(u),m(d),h.status==="EM_ANDAMENTO"&&await C(h.fazenda_id,d)}catch(h){o({title:"Erro ao carregar dados",description:h instanceof Error?h.message:"Erro desconhecido",variant:"destructive"})}finally{g(!1)}},[r,p,E,C,o]),f=i.useCallback(async()=>{if(!l)return;const h=await p();m(h),await C(l.fazenda_id,h)},[l,p,C]),_=i.useCallback(async h=>{r&&await z.from("pacotes_aspiracao").update({total_oocitos:h}).eq("id",r)},[r]);return{loading:n,pacote:l,setPacote:y,fazendaNome:b,fazendasDestinoNomes:x,aspiracoes:t,setAspiracoes:m,doadorasDisponiveis:k,totalOocitos:j,isFinalizado:O,loadData:A,reloadDoadorasDisponiveis:f,updatePacoteTotal:_}}const _a={doadora_id:"",horario_aspiracao:"",hora_final:"",...Ca,recomendacao_touro:"",observacoes:""};function qa({pacoteId:r,pacote:o,aspiracoes:n,totalOocitos:g,onSuccess:l,updatePacoteTotal:y}){const{toast:b}=V(),F=i.useRef(!1),[x,D]=i.useState(!1),[t,m]=i.useState(_a),[k,w]=i.useState(!1),[j,O]=i.useState(null),p=i.useCallback(()=>{m(_a)},[]),C=i.useCallback(()=>{if(o)if(n.length>0){const c=n[n.length-1];c.hora_final&&m(s=>({...s,horario_aspiracao:c.hora_final||"",hora_final:ja(c.hora_final||"",1)}))}else o.horario_inicio&&m(c=>({...c,horario_aspiracao:o.horario_inicio||"",hora_final:ja(o.horario_inicio||"",1)}))},[o,n]),E=i.useCallback((c,s)=>{m(u=>({...u,[c]:s}))},[]),A=i.useCallback(()=>t.doadora_id?t.hora_final.trim()?!(o!=null&&o.veterinario_responsavel)||!(o!=null&&o.tecnico_responsavel)?(b({title:"Erro de validação",description:"A aspiração deve ter veterinário e técnico responsáveis preenchidos. Por favor, edite a aspiração primeiro.",variant:"destructive"}),!1):n.find(s=>s.doadora_id===t.doadora_id)?(b({title:"Erro",description:"Esta doadora já foi aspirada nesta aspiração",variant:"destructive"}),!1):!0:(b({title:"Erro de validação",description:"Hora final é obrigatória",variant:"destructive"}),!1):(b({title:"Erro",description:"Selecione uma doadora",variant:"destructive"}),!1),[t,o,n,b]),f=i.useCallback(async()=>{if(x||F.current||!A())return;if(H(t)===0){O("add"),w(!0);return}await _()},[x,A,t]),_=i.useCallback(async()=>{if(!(x||F.current||!o||!r))try{F.current=!0,D(!0);const c=H(t),s={pacote_aspiracao_id:r,doadora_id:t.doadora_id,fazenda_id:o.fazenda_id,data_aspiracao:o.data_aspiracao,horario_aspiracao:t.horario_aspiracao||null,hora_final:t.hora_final,atresicos:parseInt(t.atresicos)||0,degenerados:parseInt(t.degenerados)||0,expandidos:parseInt(t.expandidos)||0,desnudos:parseInt(t.desnudos)||0,viaveis:parseInt(t.viaveis)||0,total_oocitos:c,veterinario_responsavel:o.veterinario_responsavel,tecnico_responsavel:o.tecnico_responsavel,recomendacao_touro:t.recomendacao_touro.trim()||null,observacoes:t.observacoes.trim()||null},{error:u}=await z.from("aspiracoes_doadoras").insert([s]);if(u){if(u.code==="23505"){b({title:"Erro",description:"Esta doadora já foi aspirada nesta aspiração",variant:"destructive"}),l();return}throw u}await y(g+c),b({title:"Doadora adicionada",description:"Doadora adicionada à aspiração com sucesso"}),p(),l()}catch(c){b({title:"Erro ao adicionar doadora",description:c instanceof Error?c.message:"Erro desconhecido",variant:"destructive"})}finally{D(!1),F.current=!1}},[x,o,r,t,g,y,p,l,b]),h=i.useCallback(async()=>{w(!1),j==="add"&&await _(),O(null)},[j,_]);return{formData:t,setFormData:m,updateField:E,submitting:x,showConfirmZeroOocitos:k,setShowConfirmZeroOocitos:w,pendingAction:j,setPendingAction:O,resetForm:p,initializeHorario:C,handleAddDoadora:f,executeAddDoadora:_,handleConfirmZeroOocitos:h,calculateTotal:()=>H(t)}}const La=["Holandesa","Jersey","Gir","Girolando"];function Va({pacoteId:r,pacote:o,addDoadoraForm:n,totalOocitos:g,onSuccess:l,updatePacoteTotal:y,setPendingAction:b,setShowConfirmZeroOocitos:F}){const{toast:x}=V(),[D,t]=i.useState(!1),[m,k]=i.useState({registro:"",raca:"",racaCustom:""}),[w,j]=i.useState(""),O=i.useCallback(()=>{k({registro:"",raca:"",racaCustom:""}),j("")},[]),p=i.useCallback(f=>{j(f),k(f==="Outra"?_=>({..._,raca:"",racaCustom:""}):_=>({..._,raca:f,racaCustom:""}))},[]),C=i.useCallback(()=>m.registro.trim()?(w==="Outra"?m.racaCustom.trim():m.raca.trim())?n.hora_final.trim()?!(o!=null&&o.veterinario_responsavel)||!(o!=null&&o.tecnico_responsavel)?(x({title:"Erro de validação",description:"A aspiração deve ter veterinário e técnico responsáveis preenchidos. Por favor, edite a aspiração primeiro.",variant:"destructive"}),!1):!0:(x({title:"Erro de validação",description:"Hora final é obrigatória",variant:"destructive"}),!1):(x({title:"Erro de validação",description:"Raça é obrigatória",variant:"destructive"}),!1):(x({title:"Erro de validação",description:"Registro é obrigatório",variant:"destructive"}),!1),[m,w,n,o,x]),E=i.useCallback(async()=>{if(D||!C())return;if(H(n)===0){b("create"),F(!0);return}await A()},[D,C,n,b,F]),A=i.useCallback(async()=>{if(!(!o||!r))try{t(!0);const f=w==="Outra"?m.racaCustom.trim():m.raca.trim(),_=m.registro.trim().toUpperCase(),{data:h,error:c}=await z.from("doadoras").select("id, registro, raca").ilike("registro",_).eq("raca",f);if(c&&c.code!=="PGRST116")throw c;if(h&&h.length>0){x({title:"Erro",description:`Já existe uma doadora com o registro ${m.registro.trim()} e raça ${f}`,variant:"destructive"});return}const{data:s,error:u}=await z.from("doadoras").insert([{fazenda_id:o.fazenda_id,registro:_,raca:f}]).select().single();if(u){if(u.code==="23505"){x({title:"Erro",description:`Já existe uma doadora com o registro ${m.registro.trim()} nesta fazenda`,variant:"destructive"});return}throw u}const d=H(n),q={pacote_aspiracao_id:r,doadora_id:s.id,fazenda_id:o.fazenda_id,data_aspiracao:o.data_aspiracao,horario_aspiracao:n.horario_aspiracao||null,hora_final:n.hora_final,atresicos:parseInt(n.atresicos)||0,degenerados:parseInt(n.degenerados)||0,expandidos:parseInt(n.expandidos)||0,desnudos:parseInt(n.desnudos)||0,viaveis:parseInt(n.viaveis)||0,total_oocitos:d,veterinario_responsavel:o.veterinario_responsavel,tecnico_responsavel:o.tecnico_responsavel,recomendacao_touro:n.recomendacao_touro.trim()||null,observacoes:n.observacoes.trim()||null},{error:S}=await z.from("aspiracoes_doadoras").insert([q]);if(S){if(S.code==="23505"){x({title:"Erro",description:"Esta doadora já foi aspirada nesta aspiração",variant:"destructive"}),l();return}throw S}await y(g+d),x({title:"Doadora criada e adicionada",description:"Doadora criada e adicionada à aspiração com sucesso"}),O(),l()}catch(f){x({title:"Erro ao criar doadora",description:f instanceof Error?f.message:"Erro desconhecido",variant:"destructive"})}finally{t(!1)}},[o,r,m,w,n,g,y,O,l,x]);return{formData:m,setFormData:k,racaSelecionada:w,racasPredefinidas:La,submitting:D,resetForm:O,handleRacaChange:p,handleCreateDoadora:E,executeCreateDoadora:A}}const ba={horario_aspiracao:"",hora_final:"",...Ca,recomendacao_touro:"",observacoes:""};function Za({totalOocitos:r,onSuccess:o,updatePacoteTotal:n}){const{toast:g}=V(),[l,y]=i.useState(!1),[b,F]=i.useState(!1),[x,D]=i.useState(null),[t,m]=i.useState(ba),k=i.useCallback(p=>{var C,E,A,f,_;D(p),m({horario_aspiracao:p.horario_aspiracao||"",hora_final:p.hora_final||"",atresicos:((C=p.atresicos)==null?void 0:C.toString())||"",degenerados:((E=p.degenerados)==null?void 0:E.toString())||"",expandidos:((A=p.expandidos)==null?void 0:A.toString())||"",desnudos:((f=p.desnudos)==null?void 0:f.toString())||"",viaveis:((_=p.viaveis)==null?void 0:_.toString())||"",recomendacao_touro:p.recomendacao_touro||"",observacoes:p.observacoes||""}),F(!0)},[]),w=i.useCallback(()=>{F(!1),D(null),m(ba)},[]),j=i.useCallback((p,C)=>{m(E=>({...E,[p]:C}))},[]),O=i.useCallback(async()=>{if(x){if(!t.hora_final.trim()){g({title:"Erro de validação",description:"Hora final é obrigatória",variant:"destructive"});return}try{y(!0);const p=H(t),C=x.total_oocitos||0,E=p-C,A={horario_aspiracao:t.horario_aspiracao||null,hora_final:t.hora_final,atresicos:parseInt(t.atresicos)||0,degenerados:parseInt(t.degenerados)||0,expandidos:parseInt(t.expandidos)||0,desnudos:parseInt(t.desnudos)||0,viaveis:parseInt(t.viaveis)||0,total_oocitos:p,recomendacao_touro:t.recomendacao_touro.trim()||null,observacoes:t.observacoes.trim()||null},{error:f}=await z.from("aspiracoes_doadoras").update(A).eq("id",x.id);if(f)throw f;await n(r+E),g({title:"Aspiração atualizada",description:"Aspiração da doadora atualizada com sucesso"}),w(),o()}catch(p){g({title:"Erro ao atualizar aspiração",description:p instanceof Error?p.message:"Erro desconhecido",variant:"destructive"})}finally{y(!1)}}},[x,t,r,n,w,o,g]);return{formData:t,setFormData:m,updateField:j,submitting:l,showDialog:b,setShowDialog:F,aspiracaoEditando:x,openEdit:k,closeEdit:w,handleSave:O,calculateTotal:()=>H(t)}}function me(){var W,X;const{id:r}=Da(),o=Na(),{toast:n}=V(),[g,l]=i.useState(!1),[y,b]=i.useState(!1),[F,x]=i.useState(!1),[D,t]=i.useState({veterinario_responsavel:"",tecnico_responsavel:""}),[m,k]=i.useState(!1),{loading:w,pacote:j,fazendaNome:O,fazendasDestinoNomes:p,aspiracoes:C,doadorasDisponiveis:E,totalOocitos:A,isFinalizado:f,loadData:_,reloadDoadorasDisponiveis:h,updatePacoteTotal:c}=Ha({pacoteId:r}),s=qa({pacoteId:r,pacote:j,aspiracoes:C,totalOocitos:A,onSuccess:()=>{l(!1),_()},updatePacoteTotal:c}),u=Va({pacoteId:r,pacote:j,addDoadoraForm:s.formData,totalOocitos:A,onSuccess:()=>{l(!1),s.resetForm(),_()},updatePacoteTotal:c,setPendingAction:s.setPendingAction,setShowConfirmZeroOocitos:s.setShowConfirmZeroOocitos}),d=Za({totalOocitos:A,onSuccess:_,updatePacoteTotal:c});i.useEffect(()=>{r&&_()},[r,_]),i.useEffect(()=>{g&&j&&(h(),s.initializeHorario())},[g]),i.useEffect(()=>{j&&t({veterinario_responsavel:j.veterinario_responsavel||"",tecnico_responsavel:j.tecnico_responsavel||""})},[j]);const q=async()=>{if(!D.veterinario_responsavel.trim()){n({title:"Erro de validação",description:"Veterinário responsável é obrigatório",variant:"destructive"});return}if(!D.tecnico_responsavel.trim()){n({title:"Erro de validação",description:"Técnico responsável é obrigatório",variant:"destructive"});return}try{k(!0);const{error:e}=await z.from("pacotes_aspiracao").update({veterinario_responsavel:D.veterinario_responsavel.trim(),tecnico_responsavel:D.tecnico_responsavel.trim(),updated_at:new Date().toISOString()}).eq("id",r);if(e)throw e;n({title:"Aspiração atualizada",description:"Informações da aspiração atualizadas com sucesso"}),x(!1),_()}catch(e){n({title:"Erro ao atualizar aspiração",description:e instanceof Error?e.message:"Erro desconhecido",variant:"destructive"})}finally{k(!1)}},S=async()=>{try{k(!0);const{error:e}=await z.from("pacotes_aspiracao").update({status:"FINALIZADO",updated_at:new Date().toISOString()}).eq("id",r);if(e)throw e;n({title:"Aspiração finalizada",description:"Aspiração finalizada com sucesso"}),b(!1),o("/aspiracoes")}catch(e){n({title:"Erro ao finalizar aspiração",description:e instanceof Error?e.message:"Erro desconhecido",variant:"destructive"})}finally{k(!1)}},I=async()=>{s.setShowConfirmZeroOocitos(!1),s.pendingAction==="add"?await s.executeAddDoadora():s.pendingAction==="create"&&await u.executeCreateDoadora(),s.setPendingAction(null)};return w?a.jsx(Aa,{}):j?a.jsxs("div",{className:"space-y-6",children:[a.jsx(ka,{title:`Aspiração - ${O}`,description:f?"Aspiração finalizada":"Gerenciar doadoras da aspiração",actions:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(T,{variant:"outline",size:"icon",onClick:()=>o("/aspiracoes"),children:a.jsx(Ra,{className:"w-4 h-4"})}),!f&&a.jsxs(T,{onClick:()=>b(!0),disabled:m||C.length===0,children:[a.jsx(Ia,{className:"w-4 h-4 mr-2"}),m?"Finalizando...":"Finalizar Pacote"]})]})}),a.jsxs(Y,{children:[a.jsx(aa,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(ea,{children:"Informações da Aspiração"}),!f&&a.jsxs(T,{variant:"outline",size:"sm",onClick:()=>x(!0),children:[a.jsx(ga,{className:"w-4 h-4 mr-2"}),"Editar"]})]})}),a.jsx(sa,{children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(v,{className:"text-muted-foreground",children:"Fazenda da Aspiração"}),a.jsx("p",{className:"font-medium",children:O})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx(v,{className:"text-muted-foreground",children:"Fazendas Destino"}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:p.length>0?p.map((e,L)=>a.jsx(xa,{variant:"outline",className:"font-medium",children:e},L)):a.jsx("p",{className:"font-medium text-muted-foreground",children:"-"})})]}),a.jsxs("div",{children:[a.jsx(v,{className:"text-muted-foreground",children:"Data da Aspiração"}),a.jsx("p",{className:"font-medium",children:Ta(j.data_aspiracao)})]}),a.jsxs("div",{children:[a.jsx(v,{className:"text-muted-foreground",children:"Horário de Início"}),a.jsx("p",{className:"font-medium",children:j.horario_inicio||"-"})]}),a.jsxs("div",{children:[a.jsx(v,{className:"text-muted-foreground",children:"Veterinário Responsável"}),a.jsx("p",{className:"font-medium",children:j.veterinario_responsavel||"-"})]}),a.jsxs("div",{children:[a.jsx(v,{className:"text-muted-foreground",children:"Técnico Responsável"}),a.jsx("p",{className:"font-medium",children:j.tecnico_responsavel||"-"})]}),a.jsxs("div",{children:[a.jsx(v,{className:"text-muted-foreground",children:"Status"}),a.jsx("div",{children:a.jsx(xa,{variant:f?"default":"secondary",children:f?"FINALIZADO":"EM ANDAMENTO"})})]}),a.jsxs("div",{children:[a.jsx(v,{className:"text-muted-foreground",children:"Total de Oócitos"}),a.jsx("p",{className:"font-medium text-lg",children:A})]})]})})]}),a.jsxs(Y,{children:[a.jsx(aa,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(ea,{children:["Doadoras Aspiradas (",C.length,")"]}),!f&&a.jsxs($,{open:g,onOpenChange:e=>{l(e),e||(s.resetForm(),u.resetForm())},children:[a.jsx(Sa,{asChild:!0,children:a.jsxs(T,{children:[a.jsx(Pa,{className:"w-4 h-4 mr-2"}),"Adicionar Doadora"]})}),a.jsxs(M,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(B,{children:[a.jsx(J,{children:"Adicionar Doadora à Aspiração"}),a.jsx(G,{children:"Selecione uma doadora existente ou cadastre uma nova"})]}),a.jsxs(za,{defaultValue:"existing",className:"w-full",children:[a.jsxs(Fa,{className:"grid w-full grid-cols-2",children:[a.jsx(fa,{value:"existing",children:"Doadora Existente"}),a.jsx(fa,{value:"new",children:"Cadastrar Nova"})]}),a.jsxs(va,{value:"existing",className:"space-y-4 mt-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Doadora *"}),a.jsxs(ua,{value:s.formData.doadora_id,onValueChange:e=>s.updateField("doadora_id",e),children:[a.jsx(ma,{children:a.jsx(ha,{placeholder:"Selecione uma doadora"})}),a.jsx(pa,{children:E.length===0?a.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Nenhuma doadora disponível nesta fazenda"}):E.map(e=>a.jsxs(K,{value:e.id,children:[e.registro," ",e.nome?`- ${e.nome}`:""]},e.id))})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Horário de Aspiração"}),a.jsx(N,{type:"time",value:s.formData.horario_aspiracao,onChange:e=>s.updateField("horario_aspiracao",e.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Hora Final *"}),a.jsx(N,{type:"time",value:s.formData.hora_final,onChange:e=>s.updateField("hora_final",e.target.value),required:!0})]})]}),a.jsx(Q,{data:s.formData,onChange:(e,L)=>s.updateField(e,L)}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Recomendação de Touro"}),a.jsx(N,{value:s.formData.recomendacao_touro,onChange:e=>s.updateField("recomendacao_touro",e.target.value),placeholder:"Recomendação de touro para esta doadora"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Observações"}),a.jsx(U,{value:s.formData.observacoes,onChange:e=>s.updateField("observacoes",e.target.value),placeholder:"Observações sobre esta aspiração",rows:2})]}),a.jsx(T,{onClick:s.handleAddDoadora,className:"w-full",disabled:s.submitting||E.length===0,children:s.submitting?"Adicionando...":"Adicionar"})]}),a.jsxs(va,{value:"new",className:"space-y-4 mt-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Registro *"}),a.jsx(N,{value:u.formData.registro,onChange:e=>u.setFormData({...u.formData,registro:e.target.value}),placeholder:"Registro da doadora"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Raça *"}),a.jsxs(ua,{value:u.racaSelecionada,onValueChange:u.handleRacaChange,children:[a.jsx(ma,{children:a.jsx(ha,{placeholder:"Selecione a raça"})}),a.jsxs(pa,{children:[u.racasPredefinidas.map(e=>a.jsx(K,{value:e,children:e},e)),a.jsx(K,{value:"Outra",children:"Outra"})]})]})]}),u.racaSelecionada==="Outra"&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Raça Customizada *"}),a.jsx(N,{value:u.formData.racaCustom,onChange:e=>u.setFormData({...u.formData,racaCustom:e.target.value}),placeholder:"Digite a raça"})]})]}),a.jsx(Q,{data:s.formData,onChange:(e,L)=>s.updateField(e,L)}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Recomendação de Touro"}),a.jsx(N,{value:s.formData.recomendacao_touro,onChange:e=>s.updateField("recomendacao_touro",e.target.value),placeholder:"Recomendação de touro para esta doadora"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Horário de Aspiração"}),a.jsx(N,{type:"time",value:s.formData.horario_aspiracao,onChange:e=>s.updateField("horario_aspiracao",e.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Hora Final *"}),a.jsx(N,{type:"time",value:s.formData.hora_final,onChange:e=>s.updateField("hora_final",e.target.value),required:!0})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Observações"}),a.jsx(U,{value:s.formData.observacoes,onChange:e=>s.updateField("observacoes",e.target.value),placeholder:"Observações sobre esta aspiração",rows:2})]}),a.jsx(T,{onClick:u.handleCreateDoadora,className:"w-full",disabled:u.submitting,children:u.submitting?"Criando...":"Criar e Adicionar"})]})]})]})]})]})}),a.jsx(sa,{children:a.jsxs(ya,{children:[a.jsx(wa,{children:a.jsxs(Z,{children:[a.jsx(P,{children:"Doadora"}),a.jsx(P,{children:"Registro"}),a.jsx(P,{children:"Horário"}),a.jsx(P,{children:"Viáveis"}),a.jsx(P,{children:"Total Oócitos"}),a.jsx(P,{children:"Recomendação Touro"}),a.jsx(P,{children:"Observações"}),!f&&a.jsx(P,{className:"text-right",children:"Ações"})]})}),a.jsx(Ea,{children:C.length===0?a.jsx(Z,{children:a.jsx(R,{colSpan:f?7:8,className:"text-center text-muted-foreground",children:"Nenhuma doadora adicionada à aspiração"})}):C.map(e=>a.jsxs(Z,{children:[a.jsx(R,{className:"font-medium",children:e.doadora_nome||"-"}),a.jsx(R,{children:e.doadora_registro||"-"}),a.jsx(R,{children:e.horario_aspiracao?`${e.horario_aspiracao}${e.hora_final?` - ${e.hora_final}`:""}`:"-"}),a.jsx(R,{className:"font-medium",children:e.viaveis||0}),a.jsx(R,{children:e.total_oocitos||0}),a.jsx(R,{children:e.recomendacao_touro||"-"}),a.jsx(R,{children:e.observacoes||"-"}),!f&&a.jsx(R,{className:"text-right",children:a.jsx(T,{variant:"ghost",size:"sm",onClick:()=>d.openEdit(e),children:a.jsx(ga,{className:"w-4 h-4"})})})]},e.id))})]})})]}),a.jsx($,{open:d.showDialog,onOpenChange:d.closeEdit,children:a.jsxs(M,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(B,{children:[a.jsxs(J,{children:["Editar Aspiração - ",((W=d.aspiracaoEditando)==null?void 0:W.doadora_nome)||((X=d.aspiracaoEditando)==null?void 0:X.doadora_registro)||"Doadora"]}),a.jsx(G,{children:"Edite os dados da aspiração da doadora"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Horário de Aspiração"}),a.jsx(N,{type:"time",value:d.formData.horario_aspiracao,onChange:e=>d.updateField("horario_aspiracao",e.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Hora Final *"}),a.jsx(N,{type:"time",value:d.formData.hora_final,onChange:e=>d.updateField("hora_final",e.target.value),required:!0})]})]}),a.jsx(Q,{data:d.formData,onChange:(e,L)=>d.updateField(e,L)}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Recomendação de Touro"}),a.jsx(N,{value:d.formData.recomendacao_touro,onChange:e=>d.updateField("recomendacao_touro",e.target.value),placeholder:"Recomendação de touro para esta doadora"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Observações"}),a.jsx(U,{value:d.formData.observacoes,onChange:e=>d.updateField("observacoes",e.target.value),placeholder:"Observações sobre esta aspiração",rows:3})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(T,{variant:"outline",onClick:d.closeEdit,disabled:d.submitting,children:"Cancelar"}),a.jsx(T,{onClick:d.handleSave,disabled:d.submitting,children:d.submitting?"Salvando...":"Salvar Alterações"})]})]})]})}),a.jsx(ra,{open:s.showConfirmZeroOocitos,onOpenChange:s.setShowConfirmZeroOocitos,children:a.jsxs(oa,{children:[a.jsxs(ia,{children:[a.jsx(ta,{children:"Confirmar Adição de Doadora sem Oócitos"}),a.jsxs(na,{children:["Esta doadora não possui nenhum oócito (total = 0). Deseja realmente adicioná-la à aspiração?",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Atenção:"})," Doadoras sem oócitos podem não ser úteis para o processo de FIV."]})]}),a.jsxs(da,{children:[a.jsx(ca,{disabled:s.submitting,children:"Cancelar"}),a.jsx(la,{onClick:I,disabled:s.submitting,className:"bg-orange-600 hover:bg-orange-700",children:s.submitting?"Adicionando...":"Sim, Adicionar Mesmo Assim"})]})]})}),a.jsx($,{open:F,onOpenChange:x,children:a.jsxs(M,{children:[a.jsxs(B,{children:[a.jsx(J,{children:"Editar Aspiração"}),a.jsx(G,{children:"Atualize as informações da aspiração"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Veterinário Responsável *"}),a.jsx(N,{value:D.veterinario_responsavel,onChange:e=>t({...D,veterinario_responsavel:e.target.value}),placeholder:"Nome do veterinário",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(v,{children:"Técnico Responsável *"}),a.jsx(N,{value:D.tecnico_responsavel,onChange:e=>t({...D,tecnico_responsavel:e.target.value}),placeholder:"Nome do técnico",required:!0})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(T,{variant:"outline",onClick:()=>x(!1),disabled:m,children:"Cancelar"}),a.jsx(T,{onClick:q,disabled:m,children:m?"Salvando...":"Salvar"})]})]})]})}),a.jsx(ra,{open:y,onOpenChange:b,children:a.jsxs(oa,{children:[a.jsxs(ia,{children:[a.jsx(ta,{children:"Finalizar Aspiração"}),a.jsxs(na,{children:["Tem certeza que deseja finalizar esta aspiração? Esta ação não pode ser desfeita.",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Atenção:"})," Após finalizar, a aspiração ficará apenas como histórico e não poderá ser editada.",a.jsx("br",{}),a.jsx("br",{}),"Total de oócitos na aspiração: ",a.jsx("strong",{children:A})]})]}),a.jsxs(da,{children:[a.jsx(ca,{disabled:m,children:"Cancelar"}),a.jsx(la,{onClick:S,disabled:m,children:m?"Finalizando...":"Finalizar Aspiração"})]})]})})]}):a.jsx(Oa,{title:"Aspiração não encontrada",description:"Volte para a lista e selecione outra aspiração.",action:a.jsx(T,{onClick:()=>o("/aspiracoes"),variant:"outline",children:"Voltar para Aspirações"})})}export{me as default};
