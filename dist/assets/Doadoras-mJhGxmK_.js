import{j as e,h as M,B as b,r as d,a as A,s as X,i as Z}from"./index-BPMeM9-O.js";import{C as B,a as H,b as P,d as I}from"./card-8azKTSNJ.js";import{T as G,a as O,b as y,c as u,d as $,e as x}from"./table-l_s8S0JA.js";import{D as K,a as Q,b as W,c as Y,d as ee,e as ae}from"./dialog-CLDnxY7R.js";import{S as q,a as V,b as U,c as J,d as _}from"./select-La4nrp5K.js";import{I as R}from"./input-tqcTRdPv.js";import{L as T}from"./label-fluRYl3j.js";import{P as se}from"./PageHeader-DQ4rM2jO.js";import{E as re}from"./EmptyState-yqSFIU3C.js";import{S as te}from"./search-SyV5imYB.js";import{X as ie}from"./x-BxiwAMrM.js";import{D as oe,P as le,G as ne}from"./DoadoraHistoricoAspiracoes-CMFzW4_-.js";import{f as ce}from"./dateUtils-eJ5e6apA.js";import{B as de}from"./badge-CeJDYfYs.js";import{u as me,c as he}from"./hooks-BRtq68sJ.js";import{u as ue}from"./useListFilter-Dbbi_Mbv.js";import"./index-D8U2jNcs.js";import{u as xe}from"./use-toast-BGNwDi9e.js";import{F as pe}from"./filter-DouKIrIu.js";import{P as fe}from"./plus-Ah0p7ggz.js";import{H as je}from"./history-TsBvJqZq.js";import{S as w}from"./star--IBMHPCH.js";import"./index-C5PY5DOm.js";import"./check-Bdb-Yd05.js";import"./index-BkgnAyi6.js";function ge({fazendas:s,selectedFazendaId:a,onFazendaChange:i,title:r="Selecione a Fazenda",placeholder:t="Selecione uma fazenda",required:o=!1}){return e.jsxs(B,{children:[e.jsx(H,{children:e.jsxs(P,{children:[r,o&&" *"]})}),e.jsx(I,{children:e.jsxs(q,{value:a,onValueChange:i,children:[e.jsx(V,{className:"w-full",children:e.jsx(U,{placeholder:t})}),e.jsx(J,{children:s.map(n=>e.jsx(_,{value:n.id,children:n.nome},n.id))})]})})]})}function k({className:s,...a}){return e.jsx("div",{className:M("animate-pulse rounded-md bg-muted",s),...a})}function ve({columns:s,rows:a=5,headers:i,showHeader:r=!0}){return e.jsxs(G,{children:[r&&e.jsx(O,{children:e.jsx(y,{children:i?i.map((t,o)=>e.jsx(u,{children:t},o)):Array.from({length:s}).map((t,o)=>e.jsx(u,{children:e.jsx(k,{className:"h-4 w-20"})},o))})}),e.jsx($,{children:Array.from({length:a}).map((t,o)=>e.jsx(y,{children:Array.from({length:s}).map((n,c)=>e.jsx(x,{children:e.jsx(k,{className:`h-4 ${c===0?"w-24":c===s-1?"w-16":"w-32"}`})},c))},o))})]})}function Ne({value:s,onChange:a,placeholder:i="Buscar...",label:r,id:t="search-input",className:o="",showClearButton:n=!0}){return e.jsxs("div",{className:`space-y-2 ${o}`,children:[r&&e.jsx(T,{htmlFor:t,children:r}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(R,{id:t,placeholder:i,value:s,onChange:c=>a(c.target.value),className:"pl-10 pr-10"}),n&&s&&e.jsx(b,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0 hover:bg-muted",onClick:()=>a(""),children:e.jsx(ie,{className:"w-4 h-4 text-muted-foreground"})})]})]})}const we=(s,a)=>{var i,r,t;return((i=s.nome)==null?void 0:i.toLowerCase().includes(a))||((r=s.registro)==null?void 0:r.toLowerCase().includes(a))||((t=s.raca)==null?void 0:t.toLowerCase().includes(a))||!1};function be(){const[s,a]=d.useState(""),[i,r]=d.useState(null),{data:t=[],isLoading:o,refetch:n}=me(),{data:c=[],isLoading:l,refetch:p}=he(s||void 0),{filtered:g,searchTerm:v,setSearchTerm:f,clearFilters:C,hasActiveFilters:D}=ue({data:c,searchFn:we});return{loading:o||(s?l:!1),fazendas:t,doadoras:c,filteredDoadoras:g,selectedFazendaId:s,setSelectedFazendaId:a,searchTerm:v,setSearchTerm:f,clearFilters:C,hasActiveFilters:D,historicoDoadoraId:i,setHistoricoDoadoraId:r,loadFazendas:async()=>{await n()},loadDoadoras:async()=>{s&&await p()}}}const Ce=["Holandesa","Jersey","Gir","Girolando"],L={registro:"",raca:"",racaCustom:""};function De({selectedFazendaId:s,onSuccess:a}){const i=A(),{toast:r}=xe(),[t,o]=d.useState(!1),[n,c]=d.useState(!1),[l,p]=d.useState(L),[g,v]=d.useState(""),f=d.useCallback(()=>{p(L),v("")},[]),C=d.useCallback(m=>{v(m),p(m==="Outra"?j=>({...j,raca:"",racaCustom:""}):j=>({...j,raca:m,racaCustom:""}))},[]),D=d.useCallback(m=>{o(m),m||f()},[f]),F=d.useCallback(async m=>{if(m.preventDefault(),!s){r({title:"Erro de validacao",description:"Selecione a fazenda primeiro",variant:"destructive"});return}if(!l.registro.trim()){r({title:"Erro de validacao",description:"Registro e obrigatorio",variant:"destructive"});return}const j=g==="Outra"?l.racaCustom.trim():l.raca.trim();if(!j){r({title:"Erro de validacao",description:"Raca e obrigatoria",variant:"destructive"});return}try{c(!0);const N={fazenda_id:s,registro:l.registro.trim(),raca:j},{data:h,error:S}=await X.from("doadoras").insert([N]).select().single();if(S)throw S;r({title:"Doadora criada",description:"Doadora criada com sucesso"}),o(!1),f(),a(),h!=null&&h.id&&i(`/doadoras/${h.id}`)}catch(N){const h=N instanceof Error?N.message:"Erro desconhecido";r({title:"Erro ao criar doadora",description:h.includes("RLS")||h.includes("policy")?"RLS esta bloqueando escrita. Configure politicas anon no Supabase.":h,variant:"destructive"})}finally{c(!1)}},[l,g,s,r,f,a,i]);return{formData:l,setFormData:p,racaSelecionada:g,setRacaSelecionada:v,showDialog:t,setShowDialog:o,submitting:n,resetForm:f,handleSubmit:F,handleDialogClose:D,handleRacaChange:C}}function aa(){var S,E;const s=A(),{loading:a,fazendas:i,filteredDoadoras:r,selectedFazendaId:t,setSelectedFazendaId:o,searchTerm:n,setSearchTerm:c,historicoDoadoraId:l,setHistoricoDoadoraId:p,loadFazendas:g,loadDoadoras:v}=be(),{formData:f,setFormData:C,racaSelecionada:D,showDialog:F,submitting:m,handleSubmit:j,handleDialogClose:N,handleRacaChange:h}=De({selectedFazendaId:t,onSuccess:v});return d.useEffect(()=>{g()},[g]),a&&i.length===0?e.jsx(Z,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Doadoras",description:"Gerenciar doadoras do sistema"}),e.jsx(ge,{fazendas:i,selectedFazendaId:t,onFazendaChange:o,placeholder:"Selecione uma fazenda para visualizar doadoras"}),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(pe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsx("div",{className:"flex-1 min-w-[280px]",children:e.jsx(Ne,{value:n,onChange:c,placeholder:"Buscar por nome ou registro..."})})]}),e.jsx(Se,{showDialog:F,handleDialogClose:N,formData:f,setFormData:C,racaSelecionada:D,handleRacaChange:h,submitting:m,handleSubmit:j})]})}),e.jsxs(B,{children:[e.jsx(H,{children:e.jsx(P,{children:"Lista de Doadoras"})}),e.jsx(I,{children:a?e.jsx(ve,{columns:8,rows:6,headers:["Registro","Nome","Ultima Aspiracao","Oocitos","Estado","Raca","Classificacao","Acoes"]}):e.jsx(ye,{doadoras:r,searchTerm:n,navigate:s,setHistoricoDoadoraId:p})})]}),l&&e.jsx(oe,{doadoraId:l,doadoraNome:((S=r.find(z=>z.id===l))==null?void 0:S.nome)||((E=r.find(z=>z.id===l))==null?void 0:E.registro),open:!!l,onClose:()=>p(null)})]}):e.jsx(re,{title:"Selecione uma fazenda",description:"Escolha uma fazenda para visualizar e gerenciar doadoras."})]})}function Se({showDialog:s,handleDialogClose:a,formData:i,setFormData:r,racaSelecionada:t,handleRacaChange:o,submitting:n,handleSubmit:c}){return e.jsxs(K,{open:s,onOpenChange:a,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(b,{children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Nova Doadora"]})}),e.jsxs(W,{className:"max-w-md",children:[e.jsxs(Y,{children:[e.jsx(ee,{children:"Criar Nova Doadora"}),e.jsx(ae,{children:"Preencha os campos basicos. As informacoes detalhadas podem ser preenchidas apos a criacao."})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"registro",children:"Registro *"}),e.jsx(R,{id:"registro",value:i.registro,onChange:l=>r({...i,registro:l.target.value}),placeholder:"Registro da doadora",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"raca",children:"Raca *"}),e.jsxs(q,{value:t,onValueChange:o,children:[e.jsx(V,{children:e.jsx(U,{placeholder:"Selecione a raca"})}),e.jsxs(J,{children:[Ce.map(l=>e.jsx(_,{value:l,children:l},l)),e.jsx(_,{value:"Outra",children:"Outra"})]})]}),t==="Outra"&&e.jsx(R,{id:"raca_custom",value:i.racaCustom,onChange:l=>r({...i,racaCustom:l.target.value,raca:l.target.value}),placeholder:"Digite a raca",className:"mt-2",required:!0})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(b,{type:"submit",className:"flex-1",disabled:n,children:n?"Salvando...":"Criar Doadora"}),e.jsx(b,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:n,children:"Cancelar"})]})]})]})]})}function ye({doadoras:s,searchTerm:a,navigate:i,setHistoricoDoadoraId:r}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(G,{children:[e.jsx(O,{children:e.jsxs(y,{children:[e.jsx(u,{children:"Registro"}),e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Ultima Aspiracao"}),e.jsx(u,{children:"Oocitos"}),e.jsx(u,{children:"Estado"}),e.jsx(u,{children:"Raca (Campos Especiais)"}),e.jsx(u,{children:"Classificacao"}),e.jsx(u,{className:"text-right",children:"Acoes"})]})}),e.jsx($,{children:s.length===0?e.jsx(y,{children:e.jsx(x,{colSpan:8,className:"text-center text-muted-foreground",children:a?"Nenhuma doadora encontrada":"Nenhuma doadora cadastrada nesta fazenda"})}):s.map(t=>e.jsx(Fe,{doadora:t,navigate:i,setHistoricoDoadoraId:r},t.id))})]})})}const Fe=d.memo(function({doadora:a,navigate:i,setHistoricoDoadoraId:r}){const t=ze(a);return e.jsxs(y,{className:"cursor-pointer hover:bg-muted",onClick:()=>i(`/doadoras/${a.id}`),children:[e.jsx(x,{className:"font-medium",children:a.registro}),e.jsx(x,{children:a.nome||"-"}),e.jsx(x,{children:a.ultima_aspiracao_data?ce(a.ultima_aspiracao_data):"-"}),e.jsx(x,{children:a.ultima_aspiracao_total_oocitos??"-"}),e.jsx(x,{children:e.jsx(de,{variant:"outline",className:a.disponivel_aspiracao?"bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/30":"bg-slate-500/10 text-slate-600 dark:text-slate-400 border-slate-500/30",children:a.disponivel_aspiracao?"Disponível":"Indisponível"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:a.raca||"-"}),t&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t})]})}),e.jsx(x,{children:_e(a.classificacao_genetica)}),e.jsx(x,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:o=>{o.stopPropagation(),r(a.id)},children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Histórico"]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:o=>{o.stopPropagation(),i(`/doadoras/${a.id}`)},title:"Editar doadora",children:e.jsx(le,{className:"w-4 h-4"})})]})})]})});function ze(s){if(s.raca==="Gir"){const a=[];return s.gpta&&a.push(`GPTA: ${s.gpta}`),s.controle_leiteiro&&a.push(`Controle Leiteiro: ${s.controle_leiteiro}`),s.beta_caseina&&a.push(`Beta Caseina: ${s.beta_caseina}`),s.link_abcz&&a.push("Link ABCZ"),a.length>0?a.join(", "):null}return null}function _e(s){if(!s)return"-";switch(s){case"1_estrela":return e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(w,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})});case"2_estrelas":return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx(w,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]});case"3_estrelas":return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx(w,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx(w,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]});case"diamante":return e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(ne,{className:"w-4 h-4 fill-blue-500 text-blue-500"})});default:return"-"}}export{aa as default};
