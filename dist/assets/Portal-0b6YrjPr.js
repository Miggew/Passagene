import{c as ue,d as pe,r as i,s as b,j as e,g as fe,H as B,D as G,S as Q,l as X}from"./index-CvlUDCD-.js";import{u as ge,C as n,c as d,a as w,b as C}from"./use-toast-BhbfqK05.js";import{T as F,a as R,b as u,c as o,d as I,e as r}from"./table-BAfLAU-a.js";import{S as Ne,a as ve,b as be,c as we,d as J}from"./select-CRV7QsOQ.js";import{I as K}from"./input-BiDTc9_9.js";import{B as E}from"./badge-C6XBkHcG.js";import{T as Ce,a as Ee,b as S,c as D}from"./tabs-DVZOasbN.js";import{E as T}from"./EmptyState-DFkj0E0i.js";import{M as Se}from"./map-pin-CAPZ6-1g.js";import{S as W}from"./search-B2NaMPhp.js";import"./index-BYe3zTS0.js";import"./index-CDlvsNjp.js";import"./check-BbN618wW.js";import"./index-Mm2kbPk7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=ue("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);function He(){var U;const{toast:Y}=ge(),{permissions:x}=pe(),[Z,z]=i.useState(!0),[Te,$]=i.useState(null),[ee,se]=i.useState(""),[_,ae]=i.useState({totalFazendas:0,totalDoses:0,totalEmbrioes:0,protocolosAtivos:0}),[O,te]=i.useState([]),[le,oe]=i.useState([]),[y,re]=i.useState([]),[M,ie]=i.useState([]),[h,ce]=i.useState(""),[j,ne]=i.useState(""),[A,de]=i.useState("todos"),q=x==null?void 0:x.isCliente,p=(U=x==null?void 0:x.profile)==null?void 0:U.cliente_id;i.useEffect(()=>{p?($(p),xe(p)):x&&!q&&z(!1)},[p,x,q]);const xe=async s=>{try{z(!0);const{data:a}=await b.from("clientes").select("nome").eq("id",s).single();a&&se(a.nome);const{data:t,error:l}=await b.from("fazendas").select("*").eq("cliente_id",s).order("nome");if(l)throw l;te(t||[]);const{data:c,error:m}=await b.from("doses_semen").select(`
          *,
          touro:touros(id, nome, registro, raca)
        `).eq("cliente_id",s).order("created_at",{ascending:!1});if(m)throw m;oe(c||[]);const{data:f,error:g}=await b.from("embrioes").select(`
          *,
          lote_fiv:lotes_fiv(id, data_abertura),
          acasalamento:lote_fiv_acasalamentos(
            id,
            dose_semen:doses_semen(
              id,
              touro:touros(id, nome, registro, raca)
            ),
            aspiracao:aspiracoes_doadoras(
              id,
              data_aspiracao,
              doadora:doadoras(id, registro, nome)
            )
          )
        `).eq("cliente_id",s).eq("status_atual","CONGELADO").order("data_congelamento",{ascending:!1});if(g)throw g;re(f||[]);const{data:N,error:v}=await b.from("protocolos").select(`
          id,
          codigo,
          status,
          data_inicio,
          fazenda:fazendas!inner(nome, cliente_id)
        `).eq("fazenda.cliente_id",s).in("status",["ATIVO","EM_ANDAMENTO","AGUARDANDO_TE"]).order("data_inicio",{ascending:!1}).limit(10);if(v)throw v;ie(N||[]);const L=(c||[]).reduce((he,je)=>he+(je.quantidade||0),0);ae({totalFazendas:(t||[]).length,totalDoses:L,totalEmbrioes:(f||[]).length,protocolosAtivos:(N||[]).length})}catch(a){Y({title:"Erro ao carregar dados",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{z(!1)}},P=le.filter(s=>{var t,l,c;const a=s.touro;return!h||((t=a==null?void 0:a.nome)==null?void 0:t.toLowerCase().includes(h.toLowerCase()))||((l=a==null?void 0:a.registro)==null?void 0:l.toLowerCase().includes(h.toLowerCase()))||((c=a==null?void 0:a.raca)==null?void 0:c.toLowerCase().includes(h.toLowerCase()))}),H=[...new Set(y.map(s=>s.classificacao).filter(Boolean))].sort(),V=y.filter(s=>{var f,g,N,v,L;const a=s.acasalamento,t=(f=a==null?void 0:a.aspiracao)==null?void 0:f.doadora,l=(g=a==null?void 0:a.dose_semen)==null?void 0:g.touro,c=!j||((N=s.identificacao)==null?void 0:N.toLowerCase().includes(j.toLowerCase()))||((v=t==null?void 0:t.registro)==null?void 0:v.toLowerCase().includes(j.toLowerCase()))||((L=l==null?void 0:l.nome)==null?void 0:L.toLowerCase().includes(j.toLowerCase())),m=A==="todos"||s.classificacao===A;return c&&m}),k=s=>s?new Date(s).toLocaleDateString("pt-BR"):"-",me=s=>{const t={ATIVO:{label:"Ativo",className:"bg-green-100 text-green-800"},EM_ANDAMENTO:{label:"Em Andamento",className:"bg-blue-100 text-blue-800"},AGUARDANDO_TE:{label:"Aguardando TE",className:"bg-yellow-100 text-yellow-800"}}[s]||{label:s,className:"bg-gray-100 text-gray-800"};return e.jsx(E,{className:t.className,children:t.label})};return!q||!p?e.jsx("div",{className:"space-y-6",children:e.jsx(T,{title:"Acesso restrito",description:"Esta área é exclusiva para usuários do tipo Cliente."})}):Z?e.jsx(fe,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Olá, ",ee]}),e.jsx("p",{className:"text-slate-500",children:"Bem-vindo ao seu portal"})]}),e.jsxs(Ce,{defaultValue:"resumo",className:"w-full",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-5",children:[e.jsxs(S,{value:"resumo",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Resumo"]}),e.jsxs(S,{value:"fazendas",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Fazendas"]}),e.jsxs(S,{value:"doses",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Doses"]}),e.jsxs(S,{value:"embrioes",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Embriões"]}),e.jsxs(S,{value:"protocolos",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Protocolos"]})]}),e.jsxs(D,{value:"resumo",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(n,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(B,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Fazendas"}),e.jsx("p",{className:"text-3xl font-bold",children:_.totalFazendas})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(G,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Doses de Sêmen"}),e.jsx("p",{className:"text-3xl font-bold",children:_.totalDoses})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-cyan-100 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 text-cyan-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Embriões Congelados"}),e.jsx("p",{className:"text-3xl font-bold",children:_.totalEmbrioes})]})]})})}),e.jsx(n,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(X,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Protocolos Ativos"}),e.jsx("p",{className:"text-3xl font-bold",children:_.protocolosAtivos})]})]})})})]}),y.length>0&&e.jsxs(n,{className:"mt-4",children:[e.jsx(w,{children:e.jsx(C,{className:"text-lg",children:"Embriões por Classificação"})}),e.jsx(d,{children:e.jsx("div",{className:"flex flex-wrap gap-3",children:H.map(s=>{const a=y.filter(t=>t.classificacao===s).length;return e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-100 rounded-lg",children:[e.jsx(E,{variant:"secondary",children:s}),e.jsx("span",{className:"font-semibold",children:a})]},s)})})})]})]}),e.jsx(D,{value:"fazendas",children:e.jsxs(n,{children:[e.jsx(w,{children:e.jsxs(C,{children:["Minhas Fazendas (",O.length,")"]})}),e.jsx(d,{children:O.length===0?e.jsx(T,{title:"Nenhuma fazenda",description:"Você ainda não possui fazendas cadastradas"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:O.map(s=>e.jsx(n,{className:"hover:shadow-md transition-shadow",children:e.jsxs(d,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.nome}),s.sigla&&e.jsx(E,{variant:"outline",className:"mt-1",children:s.sigla})]}),e.jsx(B,{className:"w-5 h-5 text-slate-400"})]}),s.localizacao&&e.jsxs("p",{className:"text-sm text-slate-500 mt-2 flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3"}),s.localizacao]}),s.responsavel&&e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:["Responsável: ",s.responsavel]})]})},s.id))})})]})}),e.jsx(D,{value:"doses",children:e.jsxs(n,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsx(C,{children:"Estoque de Doses de Sêmen"}),e.jsxs("div",{className:"relative max-w-xs",children:[e.jsx(W,{className:"absolute left-2 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(K,{placeholder:"Buscar touro...",value:h,onChange:s=>ce(s.target.value),className:"pl-8"})]})]})}),e.jsx(d,{children:P.length===0?e.jsx(T,{title:"Nenhuma dose encontrada",description:h?"Tente ajustar a busca":"Você não possui doses de sêmen em estoque"}):e.jsxs(F,{children:[e.jsx(R,{children:e.jsxs(u,{children:[e.jsx(o,{children:"Touro"}),e.jsx(o,{children:"Raça"}),e.jsx(o,{children:"Tipo"}),e.jsx(o,{className:"text-center",children:"Quantidade"})]})}),e.jsx(I,{children:P.map(s=>{var a,t,l;return e.jsxs(u,{children:[e.jsxs(r,{className:"font-medium",children:[((a=s.touro)==null?void 0:a.nome)||"Touro desconhecido",((t=s.touro)==null?void 0:t.registro)&&e.jsxs("span",{className:"text-slate-500 ml-2",children:["(",s.touro.registro,")"]})]}),e.jsx(r,{children:((l=s.touro)==null?void 0:l.raca)||"-"}),e.jsx(r,{children:e.jsx(E,{variant:s.tipo_semen==="SEXADO"?"default":"secondary",children:s.tipo_semen||"CONVENCIONAL"})}),e.jsx(r,{className:"text-center font-semibold",children:s.quantidade??0})]},s.id)})})]})})]})}),e.jsx(D,{value:"embrioes",children:e.jsxs(n,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs(C,{children:["Embriões Congelados (",V.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative max-w-xs",children:[e.jsx(W,{className:"absolute left-2 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(K,{placeholder:"Buscar...",value:j,onChange:s=>ne(s.target.value),className:"pl-8"})]}),e.jsxs(Ne,{value:A,onValueChange:de,children:[e.jsx(ve,{className:"w-[150px]",children:e.jsx(be,{placeholder:"Classificação"})}),e.jsxs(we,{children:[e.jsx(J,{value:"todos",children:"Todas"}),H.map(s=>e.jsx(J,{value:s,children:s},s))]})]})]})]})}),e.jsx(d,{children:V.length===0?e.jsx(T,{title:"Nenhum embrião encontrado",description:j||A!=="todos"?"Tente ajustar os filtros":"Você não possui embriões congelados"}):e.jsxs(F,{children:[e.jsx(R,{children:e.jsxs(u,{children:[e.jsx(o,{children:"Identificação"}),e.jsx(o,{children:"Classificação"}),e.jsx(o,{children:"Doadora"}),e.jsx(o,{children:"Touro"}),e.jsx(o,{children:"Data Cong."}),e.jsx(o,{children:"Localização"})]})}),e.jsx(I,{children:V.map(s=>{var c,m;const a=s.acasalamento,t=(c=a==null?void 0:a.aspiracao)==null?void 0:c.doadora,l=(m=a==null?void 0:a.dose_semen)==null?void 0:m.touro;return e.jsxs(u,{children:[e.jsx(r,{className:"font-medium font-mono text-sm",children:s.identificacao||"-"}),e.jsx(r,{children:s.classificacao?e.jsx(E,{variant:"secondary",children:s.classificacao}):"-"}),e.jsx(r,{children:(t==null?void 0:t.registro)||(t==null?void 0:t.nome)||"-"}),e.jsxs(r,{children:[(l==null?void 0:l.nome)||"-",(l==null?void 0:l.registro)&&e.jsxs("span",{className:"text-slate-500 text-xs ml-1",children:["(",l.registro,")"]})]}),e.jsx(r,{children:k(s.data_congelamento)}),e.jsx(r,{children:s.localizacao_atual||"-"})]},s.id)})})]})})]})}),e.jsx(D,{value:"protocolos",children:e.jsxs(n,{children:[e.jsx(w,{children:e.jsx(C,{children:"Protocolos Ativos"})}),e.jsx(d,{children:M.length===0?e.jsx(T,{title:"Nenhum protocolo ativo",description:"Você não possui protocolos em andamento"}):e.jsxs(F,{children:[e.jsx(R,{children:e.jsxs(u,{children:[e.jsx(o,{children:"Código"}),e.jsx(o,{children:"Fazenda"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Data Início"})]})}),e.jsx(I,{children:M.map(s=>{var a;return e.jsxs(u,{children:[e.jsx(r,{className:"font-medium",children:s.codigo}),e.jsx(r,{children:((a=s.fazenda)==null?void 0:a.nome)||"-"}),e.jsx(r,{children:me(s.status)}),e.jsx(r,{children:k(s.data_inicio)})]},s.id)})})]})})]})})]})]})}export{He as default};
