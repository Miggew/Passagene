import{r as x,s as _,j as e,B as Se,h as ze,f as ia}from"./index-6OJhfjKP.js";import{e as na,b as ca}from"./dataEnrichment-CmjlCNan.js";import{C,d as T,a as ge,b as ve,c as Ae}from"./card-D-gf0lmS.js";import{T as Fe,a as Pe,b as re,c as h,d as Ie,e as p}from"./table-B_Z-CztY.js";import{S as k,a as U,b as Z,c as Q,d as w}from"./select-B7v4ZPbC.js";import{I as X}from"./input-_UHZ9n1P.js";import{B as je}from"./badge-ChTtRB_d.js";import{T as da,a as la,b as He,c as Ge}from"./tabs-DFK_xrkO.js";import{P as ma}from"./PageHeader-P7sO2uqv.js";import{u as ua}from"./use-toast-DasFaehQ.js";import{v as xa}from"./receptoraStatus-Bay2bJct.js";import{D as be}from"./DatePickerBR-CEQaSWUC.js";import{g as ha,u as pa,a as fa,c as _a,D as J,C as ga,T as va,R as ja,v as ba,b as Ve}from"./useLotesTE-stbPxAew.js";import{S as Na}from"./stethoscope-C7NdjNoi.js";import{C as Ea,F as wa}from"./filter-cmdSYwTm.js";import{S as Ra}from"./save-CusHMB-Y.js";import{T as ya}from"./triangle-alert-pkIeF1ja.js";import{C as Da}from"./circle-check-big-BnGgGwro.js";import{C as Ca}from"./circle-x-WN3pf7hC.js";import{S as Ta}from"./search-DHWddfjN.js";import"./index-CtR1jODk.js";import"./check-CgmfRmMI.js";import"./index-ea8B15na.js";import"./chevron-right-BdMx8zjt.js";import"./popover-CUxnE3Xp.js";import"./dateUtils-eJ5e6apA.js";function ss(){const{toast:z}=ua(),Ne=ha(),[R,$e]=x.useState(""),[c,K]=x.useState(null),[j,A]=x.useState([]),[Me,Ee]=x.useState(!1),[we,Re]=x.useState(!1),[O,G]=x.useState({}),[g,oe]=x.useState({veterinario_responsavel:"",tecnico_responsavel:""}),[Oe,ye]=x.useState([]),[qe,De]=x.useState(!1),[ie,Be]=x.useState("todos"),[W,Le]=x.useState("todos"),[q,ke]=x.useState(""),[ne,Ue]=x.useState(""),[ce,Ze]=x.useState(""),[Qe,Xe]=x.useState([]),{fazendas:de,loadFazendas:le}=pa({statusReceptoraFiltro:"SERVIDA"}),Je=x.useCallback((a,s)=>({...a,veterinario_dg:s==null?void 0:s.veterinario_responsavel,tecnico_dg:s==null?void 0:s.tecnico_responsavel}),[]),{lotesTE:me,loading:ue,loadLotesTE:Ce}=fa({statusReceptoraFiltro:"SERVIDA",transformLote:Je});x.useEffect(()=>{le(),Ke()},[le]),x.useEffect(()=>{var a;if(R){const s=(a=de.find(d=>d.id===R))==null?void 0:a.nome;Ce(R,s)}else K(null),A([]),G({})},[R]),x.useEffect(()=>{c?((c.veterinario_dg||c.tecnico_dg)&&oe({veterinario_responsavel:c.veterinario_dg||g.veterinario_responsavel,tecnico_responsavel:c.tecnico_dg||g.tecnico_responsavel}),We(c)):(A([]),G({}))},[c]);const Ke=async()=>{const{data:a}=await _.from("fazendas").select("id, nome").order("nome");Xe(a||[])},Te=async()=>{try{De(!0);let a=_.from("diagnosticos_gestacao").select("*").eq("tipo_diagnostico","DG").order("data_diagnostico",{ascending:!1}).limit(500);ne&&(a=a.gte("data_diagnostico",ne)),ce&&(a=a.lte("data_diagnostico",ce)),W&&W!=="todos"&&(a=a.eq("resultado",W));const{data:s,error:d}=await a;if(d)throw console.error("Erro ao buscar diagnósticos:",d),new Error(d.message||"Erro ao buscar diagnósticos");if(!s||s.length===0){ye([]);return}const t=[...new Set(s.map(r=>r.receptora_id).filter(Boolean))],{data:u,error:y}=await _.from("receptoras").select("id, identificacao, nome").in("id",t);if(y)throw console.error("Erro ao buscar receptoras:",y),new Error(y.message||"Erro ao buscar receptoras");const I=new Map((u||[]).map(r=>[r.id,r])),{data:D,error:b}=await _.from("vw_receptoras_fazenda_atual").select("receptora_id, fazenda_id_atual, fazenda_nome_atual").in("receptora_id",t);b&&console.error("Erro ao buscar view receptoras:",b);const S=new Map((D||[]).map(r=>[r.receptora_id,r.fazenda_nome_atual])),B=s.map(r=>{const o=I.get(r.receptora_id);return{id:r.id,receptora_id:r.receptora_id,receptora_brinco:(o==null?void 0:o.identificacao)||"-",receptora_nome:o==null?void 0:o.nome,fazenda_nome:S.get(r.receptora_id)||"-",data_te:r.data_te,data_diagnostico:r.data_diagnostico,resultado:r.resultado,numero_gestacoes:r.numero_gestacoes,observacoes:r.observacoes,veterinario_responsavel:r.veterinario_responsavel,tecnico_responsavel:r.tecnico_responsavel}});ye(B)}catch(a){console.error("Erro no loadHistorico:",a);const s=a instanceof Error?a.message:typeof a=="object"&&a!==null&&"message"in a?String(a.message):"Erro desconhecido";z({title:"Erro ao carregar histórico",description:s,variant:"destructive"})}finally{De(!1)}},We=async a=>{var s,d;try{Ee(!0);const{data:t,error:u}=await _.from("vw_receptoras_fazenda_atual").select("receptora_id").eq("fazenda_id_atual",a.fazenda_id);if(u)throw u;const y=(t==null?void 0:t.map(n=>n.receptora_id))||[];if(y.length===0){A([]);return}const[I,D]=await Promise.all([_.from("receptoras").select("id, identificacao, nome, status_reprodutivo").in("id",y).eq("status_reprodutivo","SERVIDA"),_.from("transferencias_embrioes").select("id, receptora_id, embriao_id, data_te").in("receptora_id",y).eq("data_te",a.data_te).eq("status_te","REALIZADA")]);if(I.error)throw I.error;if(D.error)throw D.error;const b=I.data,S=D.data;if(!S||S.length===0){A([]);return}const B=(b==null?void 0:b.map(n=>n.id))||[],r=S.map(n=>n.embriao_id).filter(Boolean);let o=new Map;if(r.length>0){const{data:n,error:f}=await _.from("embrioes").select("id, identificacao, classificacao, lote_fiv_id, lote_fiv_acasalamento_id").in("id",r);if(f)throw f;o=new Map((n==null?void 0:n.map(N=>[N.id,N]))||[])}const l=[...new Set(Array.from(o.values()).map(n=>n.lote_fiv_id).filter(Boolean))],i=na(Array.from(o.values())),[m,v,V]=await Promise.all([l.length>0?_.from("lotes_fiv").select("id, data_abertura").in("id",l):Promise.resolve({data:[],error:null}),ca(i),_.from("diagnosticos_gestacao").select("*").in("receptora_id",B).eq("tipo_diagnostico","DG").eq("data_te",a.data_te).order("data_diagnostico",{ascending:!1})]);if(m.error)throw m.error;const H=new Map(((s=m.data)==null?void 0:s.map(n=>[n.id,n]))||[]),{doadorasMap:$,tourosMap:ta}=v,he=new Map;(d=V.data)==null||d.forEach(n=>{he.has(n.receptora_id)||he.set(n.receptora_id,n)});const ee=new Map;S.forEach(n=>{const f=`${n.receptora_id}-${n.data_te}`;ee.has(f)||ee.set(f,[]),ee.get(f).push(n)});const ae=[];ee.forEach(n=>{const f=n[0],N=b==null?void 0:b.find(te=>te.id===f.receptora_id);if(!N)return;const L=[];let se=null,fe=null;if(n.forEach(te=>{const E=o.get(te.embriao_id);if(!E)return;const _e=H.get(E.lote_fiv_id);if(!_e)return;se||(se=_e.data_abertura,fe=_a(_e.data_abertura));const ra=E.lote_fiv_acasalamento_id?$.get(E.lote_fiv_acasalamento_id):void 0,oa=E.lote_fiv_acasalamento_id?ta.get(E.lote_fiv_acasalamento_id):void 0;L.push({te_id:te.id,embriao_id:E.id,embriao_identificacao:E.identificacao,embriao_classificacao:E.classificacao,lote_fiv_id:E.lote_fiv_id,lote_fiv_acasalamento_id:E.lote_fiv_acasalamento_id,doadora_registro:ra,touro_nome:oa})}),L.length===0||!se||fe===null)return;const M=he.get(f.receptora_id);ae.push({receptora_id:f.receptora_id,brinco:N.identificacao,nome:N.nome,status_reprodutivo:N.status_reprodutivo,data_te:f.data_te,embrioes:L,data_abertura_lote:se,dias_gestacao:fe,diagnostico_existente:M?{id:M.id,data_diagnostico:M.data_diagnostico,resultado:M.resultado,numero_gestacoes:M.numero_gestacoes||void 0,observacoes:M.observacoes||void 0}:void 0})}),ae.sort((n,f)=>n.brinco.localeCompare(f.brinco)),A(ae);const pe={};ae.forEach(n=>{var f;if(n.diagnostico_existente){const N=n.diagnostico_existente.resultado,L=((f=n.diagnostico_existente.numero_gestacoes)==null?void 0:f.toString())||(N==="PRENHE"||N==="RETOQUE"?"1":"");pe[n.receptora_id]={resultado:N,numero_gestacoes:L,observacoes:n.diagnostico_existente.observacoes||"",data_diagnostico:n.diagnostico_existente.data_diagnostico}}else pe[n.receptora_id]={resultado:"",numero_gestacoes:"",observacoes:"",data_diagnostico:Ne}}),G(pe)}catch(t){z({title:"Erro ao carregar receptoras",description:t instanceof Error?t.message:"Erro desconhecido",variant:"destructive"}),A([])}finally{Ee(!1)}},Ye=(a,s)=>{G(d=>{const t=d[a]||{};let u=t.numero_gestacoes||"";return(s==="PRENHE"||s==="RETOQUE")&&!u?u="1":(s==="VAZIA"||s==="")&&(u=""),{...d,[a]:{...t,resultado:s,numero_gestacoes:u}}})},xe=(a,s,d)=>{G(t=>({...t,[a]:{...t[a],[s]:d}}))},ea=async()=>{var s,d;if(!c)return;if(!ba(g)){z({title:"Erro de validação",description:"Veterinário responsável é obrigatório",variant:"destructive"});return}const a=j.filter(t=>{const u=O[t.receptora_id];return!u||!u.resultado||!u.data_diagnostico});if(a.length>0){z({title:"Erro de validação",description:`Há ${a.length} receptora(s) sem resultado definido`,variant:"destructive"});return}try{Re(!0);for(const r of j){const o=r.status_reprodutivo||"VAZIA",l=xa(o,"REALIZAR_DG");if(!l.valido){z({title:"Erro de validação",description:`Receptora ${r.brinco}: ${l.mensagem}`,variant:"destructive"});return}}const t=[],u=[],y=[];if(j.forEach(r=>{var v,V,H;const o=O[r.receptora_id];if(!o||!o.resultado||!o.data_diagnostico)return;const l={receptora_id:r.receptora_id,data_te:r.data_te,tipo_diagnostico:"DG",data_diagnostico:o.data_diagnostico,resultado:o.resultado,observacoes:((v=o.observacoes)==null?void 0:v.trim())||void 0};o.resultado==="PRENHE"||o.resultado==="RETOQUE"?l.numero_gestacoes=o.numero_gestacoes?parseInt(o.numero_gestacoes):1:l.numero_gestacoes=0,(V=g.veterinario_responsavel)!=null&&V.trim()&&(l.veterinario_responsavel=g.veterinario_responsavel.trim()),(H=g.tecnico_responsavel)!=null&&H.trim()&&(l.tecnico_responsavel=g.tecnico_responsavel.trim()),r.diagnostico_existente?u.push({id:r.diagnostico_existente.id,...l}):t.push(l);let i,m=null;o.resultado==="PRENHE"?(i="PRENHE",m=Ve(r.data_abertura_lote)):o.resultado==="RETOQUE"?(i="PRENHE_RETOQUE",m=Ve(r.data_abertura_lote)):i="VAZIA",y.push({receptora_id:r.receptora_id,status:i,dataParto:m})}),t.length>0){const{data:r}=await _.from("diagnosticos_gestacao").select("id, receptora_id, data_te, tipo_diagnostico").in("receptora_id",[...new Set(t.map(i=>i.receptora_id))]).eq("tipo_diagnostico","DG"),o=new Map;r==null||r.forEach(i=>{const m=`${i.receptora_id}-${i.data_te}-${i.tipo_diagnostico}`;o.set(m,i.id)});const l=[];if(t.forEach(i=>{const m=`${i.receptora_id}-${i.data_te}-${i.tipo_diagnostico}`,v=o.get(m);v?u.push({id:v,...i}):l.push(i)}),l.length>0){const{error:i}=await _.from("diagnosticos_gestacao").insert(l);if(i)if((s=i.message)!=null&&s.includes("column")||i.code==="42703"){const m=l.map(({veterinario_responsavel:V,tecnico_responsavel:H,...$})=>$),{error:v}=await _.from("diagnosticos_gestacao").insert(m);if(v)throw new Error(`Erro ao inserir diagnósticos: ${v.message}`)}else throw new Error(`Erro ao inserir diagnósticos: ${i.message}`)}}const I=u.map(async r=>{var m;const{id:o,...l}=r;let{error:i}=await _.from("diagnosticos_gestacao").update(l).eq("id",o);if(i&&((m=i.message)!=null&&m.includes("column")||i.code==="42703")){const{veterinario_responsavel:v,tecnico_responsavel:V,...H}=l,{error:$}=await _.from("diagnosticos_gestacao").update(H).eq("id",o);if($)throw new Error(`Erro ao atualizar diagnóstico: ${$.message}`)}else if(i)throw new Error(`Erro ao atualizar diagnóstico: ${i.message}`)});await Promise.all(I);const D=new Map;y.forEach(({receptora_id:r,status:o,dataParto:l})=>{const i=`${o}|${l||"null"}`;D.has(i)||D.set(i,{ids:[],dataParto:l||null}),D.get(i).ids.push(r)});const b=Array.from(D.entries()).map(async([r,{ids:o,dataParto:l}])=>{const i=r.split("|")[0],m={status_reprodutivo:i};l?m.data_provavel_parto=l:i==="VAZIA"&&(m.data_provavel_parto=null);const{error:v}=await _.from("receptoras").update(m).in("id",o);if(v)throw new Error("Erro ao atualizar status das receptoras")});await Promise.all(b);const S=j.every(r=>{const o=O[r.receptora_id];return o&&o.resultado&&o.data_diagnostico});z({title:"Lote salvo com sucesso",description:S?`${j.length} diagnóstico(s) registrado(s). Lote fechado.`:`${j.length} diagnóstico(s) registrado(s)`}),S?(K(null),A([]),G({})):K({...c,veterinario_dg:g.veterinario_responsavel.trim(),tecnico_dg:g.tecnico_responsavel.trim(),status:"ABERTO"});const B=(d=de.find(r=>r.id===R))==null?void 0:d.nome;le(),R&&Ce(R,B)}catch(t){z({title:"Erro ao salvar lote",description:t instanceof Error?t.message:"Erro desconhecido",variant:"destructive"})}finally{Re(!1)}},aa=j.every(a=>{const s=O[a.receptora_id];return s&&s.resultado&&s.data_diagnostico}),Y=a=>{if(!a)return"-";const[s,d,t]=a.split("-");return`${t}/${d}/${s}`},F=Oe.filter(a=>{var t;const s=!q||a.receptora_brinco.toLowerCase().includes(q.toLowerCase())||((t=a.receptora_nome)==null?void 0:t.toLowerCase().includes(q.toLowerCase()))||a.fazenda_nome.toLowerCase().includes(q.toLowerCase()),d=ie==="todos"||a.fazenda_nome===ie;return s&&d}),P={total:F.length,prenhes:F.filter(a=>a.resultado==="PRENHE").length,vazias:F.filter(a=>a.resultado==="VAZIA").length,retoques:F.filter(a=>a.resultado==="RETOQUE").length},sa=P.total>0?Math.round((P.prenhes+P.retoques)/P.total*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ma,{title:"Diagnóstico de Gestação (DG)",description:"Registrar diagnósticos de gestação por lote de TE"}),e.jsxs(da,{defaultValue:"nova-sessao",className:"w-full",children:[e.jsxs(la,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(He,{value:"nova-sessao",className:"gap-2",children:[e.jsx(Na,{className:"h-4 w-4"}),"Nova Sessão"]}),e.jsxs(He,{value:"historico",className:"gap-2",onClick:()=>Te(),children:[e.jsx(Ea,{className:"h-4 w-4"}),"Histórico"]})]}),e.jsxs(Ge,{value:"nova-sessao",className:"mt-4",children:[e.jsx(C,{className:"mb-4",children:e.jsxs(T,{className:"pt-4 pb-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-[180px] max-w-[220px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Veterinário"}),e.jsx(X,{placeholder:"Nome do veterinário",value:g.veterinario_responsavel,onChange:a=>oe(s=>({...s,veterinario_responsavel:a.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px] max-w-[220px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Técnico"}),e.jsx(X,{placeholder:"Nome do técnico",value:g.tecnico_responsavel,onChange:a=>oe(s=>({...s,tecnico_responsavel:a.target.value})),className:"h-9"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px] max-w-[220px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Fazenda"}),e.jsxs(k,{value:R,onValueChange:$e,disabled:!g.veterinario_responsavel,children:[e.jsx(U,{className:"h-9",children:e.jsx(Z,{placeholder:"Selecione a fazenda"})}),e.jsx(Q,{children:de.map(a=>e.jsx(w,{value:a.id,children:a.nome},a.id))})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px] max-w-[280px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Lote TE"}),e.jsxs(k,{value:(c==null?void 0:c.id)||"",onValueChange:a=>{const s=me.find(d=>d.id===a);K(s||null)},disabled:!R||ue,children:[e.jsx(U,{className:"h-9",children:e.jsx(Z,{placeholder:ue?"Carregando...":"Selecione o lote"})}),e.jsx(Q,{children:me.map(a=>{const s=a.dias_gestacao!==void 0&&a.dias_gestacao<J.DG;return e.jsx(w,{value:a.id,children:e.jsxs("span",{className:s?"text-amber-600":"",children:[Y(a.data_te)," • ",a.dias_gestacao??"?","d • ",a.quantidade_receptoras," rec.",s&&" ⚠️"]})},a.id)})})]})]}),e.jsxs(Se,{onClick:ea,disabled:!c||!aa||we||(c==null?void 0:c.status)==="FECHADO"||(c==null?void 0:c.dias_gestacao)!==void 0&&c.dias_gestacao<J.DG,className:"h-9 bg-primary hover:bg-primary-dark",children:[e.jsx(Ra,{className:"h-4 w-4 mr-2"}),we?"Salvando...":"Salvar"]})]}),g.veterinario_responsavel?R?me.length===0&&!ue?e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"Nenhum lote de TE pendente nesta fazenda"}):c&&c.dias_gestacao!==void 0&&c.dias_gestacao<J.DG?e.jsxs("div",{className:"flex items-center gap-2 mt-2 p-2 bg-amber-50 border border-amber-200 rounded-md",children:[e.jsx(ya,{className:"h-4 w-4 text-amber-600 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"Atenção:"})," Este lote está com ",c.dias_gestacao," dias de gestação. O DG só pode ser realizado a partir de ",e.jsxs("strong",{children:[J.DG," dias"]}),". Faltam ",e.jsxs("strong",{children:[J.DG-c.dias_gestacao," dias"]}),"."]})]}):null:e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Selecione uma fazenda para ver os lotes disponíveis"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Preencha o veterinário para selecionar a fazenda"})]})}),Me?e.jsx(C,{children:e.jsx(T,{className:"py-8",children:e.jsx(ze,{})})}):c&&j.length>0?e.jsxs(C,{children:[e.jsx(ge,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx(ve,{className:"text-base",children:"Receptoras do Lote"}),e.jsxs(Ae,{children:[j.length," receptora(s) • TE em ",Y(c.data_te)]})]}),c.status==="FECHADO"&&e.jsx(je,{variant:"secondary",children:"Lote Fechado"})]})})}),e.jsx(T,{className:"pt-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(Pe,{children:e.jsxs(re,{children:[e.jsx(h,{children:"Receptora"}),e.jsx(h,{children:"Dias Gest."}),e.jsx(h,{children:"Embrião"}),e.jsx(h,{children:"Doadora × Touro"}),e.jsx(h,{children:"Data DG"}),e.jsx(h,{children:"Resultado"}),e.jsx(h,{children:"Nº Gest."}),e.jsx(h,{children:"Obs."})]})}),e.jsx(Ie,{children:j.map(a=>{const s=O[a.receptora_id]||{resultado:"",numero_gestacoes:"",observacoes:"",data_diagnostico:Ne},d=c.status==="FECHADO";return e.jsxs(re,{children:[e.jsx(p,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.brinco,a.nome&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["(",a.nome,")"]})]})}),e.jsx(p,{children:e.jsxs(je,{variant:"outline",className:"font-mono",children:[a.dias_gestacao,"d"]})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-0.5",children:a.embrioes.map((t,u)=>e.jsxs("div",{className:"text-sm",children:[t.embriao_identificacao||`#${u+1}`,t.embriao_classificacao&&e.jsxs("span",{className:"text-muted-foreground text-xs ml-1",children:["(",t.embriao_classificacao,")"]})]},t.te_id))})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-0.5 text-sm",children:a.embrioes.map(t=>e.jsxs("div",{children:[t.doadora_registro||"-",t.touro_nome&&` × ${t.touro_nome}`]},t.te_id))})}),e.jsx(p,{children:e.jsx(be,{value:s.data_diagnostico,onChange:t=>xe(a.receptora_id,"data_diagnostico",t||""),className:"w-32",disabled:d})}),e.jsx(p,{children:e.jsxs(k,{value:s.resultado,onValueChange:t=>Ye(a.receptora_id,t),disabled:d,children:[e.jsx(U,{className:"w-28 h-9",children:e.jsx(Z,{placeholder:"--"})}),e.jsxs(Q,{children:[e.jsx(w,{value:"PRENHE",children:"PRENHE"}),e.jsx(w,{value:"VAZIA",children:"VAZIA"}),e.jsx(w,{value:"RETOQUE",children:"RETOQUE"})]})]})}),e.jsx(p,{children:s.resultado==="PRENHE"||s.resultado==="RETOQUE"?e.jsx(X,{type:"number",min:"1",max:"3",value:s.numero_gestacoes,onChange:t=>xe(a.receptora_id,"numero_gestacoes",t.target.value),className:"w-16 h-9",disabled:d}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(p,{children:e.jsx(X,{value:s.observacoes,onChange:t=>xe(a.receptora_id,"observacoes",t.target.value),placeholder:"Obs.",className:"w-32 h-9",disabled:d})})]},a.receptora_id)})})]})})})]}):c&&j.length===0?e.jsx(C,{children:e.jsx(T,{className:"py-8 text-center text-muted-foreground",children:"Nenhuma receptora encontrada neste lote"})}):null]}),e.jsxs(Ge,{value:"historico",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(C,{className:"bg-card",children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total de DGs"}),e.jsx("p",{className:"text-2xl font-bold",children:P.total})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ga,{className:"h-6 w-6 text-primary"})})]})})}),e.jsx(C,{className:"bg-card",children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Prenhes"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:P.prenhes})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-green-500/10 flex items-center justify-center",children:e.jsx(Da,{className:"h-6 w-6 text-green-600"})})]})})}),e.jsx(C,{className:"bg-card",children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Vazias"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:P.vazias})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-red-500/10 flex items-center justify-center",children:e.jsx(Ca,{className:"h-6 w-6 text-red-600"})})]})})}),e.jsx(C,{className:"bg-card",children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Taxa Prenhez"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[sa,"%"]})]}),e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(va,{className:"h-6 w-6 text-primary"})})]})})})]}),e.jsxs(C,{children:[e.jsx(ge,{className:"pb-4",children:e.jsxs(ve,{className:"text-lg flex items-center gap-2",children:[e.jsx(wa,{className:"h-5 w-5"}),"Filtros"]})}),e.jsxs(T,{children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ta,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(X,{placeholder:"Brinco, nome, fazenda...",value:q,onChange:a=>ke(a.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Fazenda"}),e.jsxs(k,{value:ie,onValueChange:Be,children:[e.jsx(U,{children:e.jsx(Z,{placeholder:"Todas as fazendas"})}),e.jsxs(Q,{children:[e.jsx(w,{value:"todos",children:"Todas as fazendas"}),Qe.map(a=>e.jsx(w,{value:a.nome,children:a.nome},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Resultado"}),e.jsxs(k,{value:W,onValueChange:Le,children:[e.jsx(U,{children:e.jsx(Z,{placeholder:"Todos"})}),e.jsxs(Q,{children:[e.jsx(w,{value:"todos",children:"Todos"}),e.jsx(w,{value:"PRENHE",children:"Prenhe"}),e.jsx(w,{value:"VAZIA",children:"Vazia"}),e.jsx(w,{value:"RETOQUE",children:"Retoque"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Data Início"}),e.jsx(be,{value:ne,onChange:a=>Ue(a||"")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Data Fim"}),e.jsx(be,{value:ce,onChange:a=>Ze(a||"")})]})]}),e.jsxs(Se,{onClick:Te,className:"mt-4 bg-primary hover:bg-primary-dark",children:[e.jsx(ja,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]})]}),e.jsxs(C,{children:[e.jsxs(ge,{children:[e.jsx(ve,{className:"text-lg",children:"Histórico de Diagnósticos"}),e.jsxs(Ae,{children:[F.length," registro(s) encontrado(s)"]})]}),e.jsx(T,{children:qe?e.jsx(ze,{}):F.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'Nenhum diagnóstico encontrado. Clique em "Atualizar" para carregar os dados.'}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(Pe,{children:e.jsxs(re,{children:[e.jsx(h,{children:"Receptora"}),e.jsx(h,{children:"Fazenda"}),e.jsx(h,{children:"Data TE"}),e.jsx(h,{children:"Data DG"}),e.jsx(h,{children:"Resultado"}),e.jsx(h,{children:"Nº Gest."}),e.jsx(h,{children:"Veterinário"}),e.jsx(h,{children:"Técnico"}),e.jsx(h,{children:"Observações"})]})}),e.jsx(Ie,{children:F.map(a=>e.jsxs(re,{children:[e.jsxs(p,{className:"font-medium",children:[a.receptora_brinco,a.receptora_nome&&e.jsxs("span",{className:"text-muted-foreground text-sm ml-2",children:["(",a.receptora_nome,")"]})]}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ia,{className:"h-4 w-4 text-muted-foreground"}),a.fazenda_nome]})}),e.jsx(p,{children:Y(a.data_te)}),e.jsx(p,{children:Y(a.data_diagnostico)}),e.jsx(p,{children:e.jsx(je,{variant:"outline",className:a.resultado==="PRENHE"?"bg-green-500/10 text-green-600 border-green-500/30":a.resultado==="VAZIA"?"bg-red-500/10 text-red-600 border-red-500/30":"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:a.resultado})}),e.jsx(p,{className:"text-center",children:a.numero_gestacoes||"-"}),e.jsx(p,{children:a.veterinario_responsavel||"-"}),e.jsx(p,{children:a.tecnico_responsavel||"-"}),e.jsx(p,{className:"max-w-[200px] truncate",children:a.observacoes||"-"})]},a.id))})]})})})]})]})]})]})}export{ss as default};
