import{r as i,s as S,j as e,f as pe,B as h,D as je,X as fe}from"./index-B-7HRnm0.js";import{C as ge,a as ve,b as _e,d as Ne}from"./card-DdhhEbXV.js";import{T as Se,a as Ce,b as k,c as j,d as De,e as x}from"./table-fky3lpGR.js";import{D as J,f as be,a as K,b as Y,c as Z,d as $}from"./dialog-CIXjHraQ.js";import{S as f,a as g,b as v,c as _,d as l}from"./select-B0M3FCy4.js";import{I as F}from"./input-D2h8r4MO.js";import{L as p}from"./label-vBcRjcSu.js";import{P as Ee}from"./PageHeader-CT7CFo0W.js";import{E as we}from"./EmptyState-gn01eel2.js";import{u as ye}from"./use-toast-DDUqdzpY.js";import{A as Te,a as Ae,b as qe,c as Le,d as Oe,e as Fe,f as Ve,g as Ie}from"./alert-dialog-CSZ8uCy0.js";import{B as ee}from"./badge-BCHVCiM7.js";import{P as Me}from"./plus-Cnek-_uY.js";import{S as z}from"./search-DcAWDjHO.js";import{U as ke}from"./users-B1VQ-Dt9.js";import{S as ze}from"./square-pen-BpOU0zlP.js";import{T as Re}from"./trash-2-czF2ENAT.js";import"./index-B4eR1KA_.js";import"./check-C6h7QFZL.js";function os(){const[se,ae]=i.useState([]),[R,te]=i.useState([]),[X,ie]=i.useState([]),[re,H]=i.useState(!0),[oe,V]=i.useState(!1),[ne,w]=i.useState(!1),[le,I]=i.useState(!1),[c,N]=i.useState(!1),[B,P]=i.useState(null),[u,Q]=i.useState(null),{toast:n}=ye(),[r,C]=i.useState({touro_id:"",cliente_id:"",tipo_semen:"",quantidade:""}),[o,D]=i.useState({touro_id:"",cliente_id:"",tipo_semen:"",quantidade:""}),[b,U]=i.useState(""),[y,G]=i.useState(""),[T,W]=i.useState("");i.useEffect(()=>{A()},[]);const A=async()=>{try{H(!0);const{data:s,error:t}=await S.from("touros").select("*").order("nome",{ascending:!0});if(t)throw t;te(s||[]);const{data:a,error:q}=await S.from("clientes").select("id, nome").order("nome",{ascending:!0});if(q)throw q;ie(a||[]);const{data:L,error:E}=await S.from("doses_semen").select("*").order("created_at",{ascending:!1});if(E)throw E;const O=new Map((s==null?void 0:s.map(d=>[d.id,d]))||[]),he=new Map((a==null?void 0:a.map(d=>[d.id,d.nome]))||[]),xe=(L||[]).map(d=>{const m=O.get(d.touro_id);return{...d,cliente_nome:d.cliente_id?he.get(d.cliente_id):void 0,touro_nome:m==null?void 0:m.nome,touro_registro:m==null?void 0:m.registro,touro_raca:m==null?void 0:m.raca}});ae(xe)}catch(s){n({title:"Erro ao carregar dados",description:s instanceof Error?s.message:"Erro desconhecido",variant:"destructive"})}finally{H(!1)}},de=async s=>{if(s.preventDefault(),!r.touro_id){n({title:"Erro de validação",description:"Selecione um touro do catálogo",variant:"destructive"});return}if(!r.cliente_id){n({title:"Erro de validação",description:"Selecione um cliente",variant:"destructive"});return}if(!r.tipo_semen){n({title:"Erro de validação",description:"Selecione o tipo de sêmen",variant:"destructive"});return}try{N(!0);const t={touro_id:r.touro_id,cliente_id:r.cliente_id,tipo_semen:r.tipo_semen,quantidade:parseInt(r.quantidade)||0},{error:a}=await S.from("doses_semen").insert([t]).select();if(a)throw a;n({title:"Dose criada",description:"Dose de sêmen criada com sucesso"}),V(!1),C({touro_id:"",cliente_id:"",tipo_semen:"",quantidade:""}),A()}catch(t){const a=t instanceof Error?t.message:"Erro desconhecido";n({title:"Erro ao criar dose",description:a.includes("RLS")||a.includes("policy")?"RLS está bloqueando escrita. Configure políticas anon no Supabase.":a,variant:"destructive"})}finally{N(!1)}},ce=s=>{var t;P(s),D({touro_id:s.touro_id,cliente_id:s.cliente_id||"",tipo_semen:s.tipo_semen||"",quantidade:((t=s.quantidade)==null?void 0:t.toString())||""}),w(!0)},me=async s=>{if(s.preventDefault(),!!B){if(!o.touro_id){n({title:"Erro de validação",description:"Selecione um touro do catálogo",variant:"destructive"});return}if(!o.cliente_id){n({title:"Erro de validação",description:"Selecione um cliente",variant:"destructive"});return}try{N(!0);const t={touro_id:o.touro_id,cliente_id:o.cliente_id,tipo_semen:o.tipo_semen,quantidade:parseInt(o.quantidade)||0},{error:a}=await S.from("doses_semen").update(t).eq("id",B.id);if(a)throw a;n({title:"Dose atualizada",description:"Dose de sêmen atualizada com sucesso"}),w(!1),P(null),A()}catch(t){const a=t instanceof Error?t.message:"Erro desconhecido";n({title:"Erro ao atualizar dose",description:a.includes("RLS")||a.includes("policy")?"RLS está bloqueando escrita. Configure políticas anon no Supabase.":a,variant:"destructive"})}finally{N(!1)}}},ue=async()=>{if(u)try{N(!0);const{error:s}=await S.from("doses_semen").delete().eq("id",u.id);if(s)throw s;n({title:"Dose excluída",description:"Dose de sêmen excluída com sucesso"}),I(!1),Q(null),A()}catch(s){const t=s instanceof Error?s.message:"Erro desconhecido";n({title:"Erro ao excluir dose",description:t,variant:"destructive"})}finally{N(!1)}},M=se.filter(s=>{var L,E,O;const t=!b||((L=s.touro_nome)==null?void 0:L.toLowerCase().includes(b.toLowerCase()))||((E=s.touro_registro)==null?void 0:E.toLowerCase().includes(b.toLowerCase())),a=!y||((O=s.cliente_nome)==null?void 0:O.toLowerCase().includes(y.toLowerCase())),q=!T||s.tipo_semen===T;return t&&a&&q});return re?e.jsx(pe,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ee,{title:"Doses de Sêmen",description:"Gerenciar doses de sêmen dos clientes relacionadas aos touros do catálogo",actions:e.jsxs(J,{open:oe,onOpenChange:V,children:[e.jsx(be,{asChild:!0,children:e.jsxs(h,{children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Nova Dose"]})}),e.jsxs(K,{className:"max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Criar Nova Dose de Sêmen"}),e.jsx($,{children:"Selecione um touro do catálogo e um cliente para criar a dose"})]}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"touro_id",children:"Touro do Catálogo *"}),e.jsxs(f,{value:r.touro_id,onValueChange:s=>C({...r,touro_id:s}),children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Selecione o touro"})}),e.jsx(_,{children:R.map(s=>e.jsxs(l,{value:s.id,children:[s.nome," (",s.registro,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cliente_id",children:"Cliente *"}),e.jsxs(f,{value:r.cliente_id,onValueChange:s=>C({...r,cliente_id:s}),children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Selecione o cliente"})}),e.jsx(_,{children:X.map(s=>e.jsx(l,{value:s.id,children:s.nome},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"tipo_semen",children:"Tipo de Sêmen *"}),e.jsxs(f,{value:r.tipo_semen,onValueChange:s=>C({...r,tipo_semen:s}),children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Selecione o tipo"})}),e.jsxs(_,{children:[e.jsx(l,{value:"CONVENCIONAL",children:"CONVENCIONAL"}),e.jsx(l,{value:"SEXADO",children:"SEXADO"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"quantidade",children:"Quantidade"}),e.jsx(F,{id:"quantidade",type:"number",min:"0",value:r.quantidade,onChange:s=>C({...r,quantidade:s.target.value}),placeholder:"Quantidade de doses"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(h,{type:"submit",className:"flex-1",disabled:c,children:c?"Salvando...":"Salvar"}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>V(!1),disabled:c,children:"Cancelar"})]})]})]})]})}),e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(z,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Touro"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Nome ou registro do touro...",value:b,onChange:s=>U(s.target.value),className:"pl-9 h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-emerald-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Cliente"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[180px]",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Nome do cliente...",value:y,onChange:s=>G(s.target.value),className:"pl-9 h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-blue-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(je,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Tipo"})]}),e.jsx("div",{className:"w-[160px]",children:e.jsxs(f,{value:T||"all",onValueChange:s=>W(s==="all"?"":s),children:[e.jsx(g,{className:"h-9",children:e.jsx(v,{placeholder:"Todos os tipos"})}),e.jsxs(_,{children:[e.jsx(l,{value:"all",children:"Todos os tipos"}),e.jsx(l,{value:"CONVENCIONAL",children:"CONVENCIONAL"}),e.jsx(l,{value:"SEXADO",children:"SEXADO"})]})]})})]}),(b||y||T)&&e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{U(""),G(""),W("")},className:"h-9 ml-auto",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})]})}),e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsxs(_e,{children:["Lista de Doses de Sêmen (",M.length,")"]})}),e.jsx(Ne,{children:e.jsxs(Se,{children:[e.jsx(Ce,{children:e.jsxs(k,{children:[e.jsx(j,{children:"Touro"}),e.jsx(j,{children:"Registro"}),e.jsx(j,{children:"Raça"}),e.jsx(j,{children:"Cliente"}),e.jsx(j,{children:"Tipo"}),e.jsx(j,{children:"Quantidade"}),e.jsx(j,{className:"text-right",children:"Ações"})]})}),e.jsx(De,{children:M.length===0?e.jsx(k,{children:e.jsx(x,{colSpan:7,className:"text-center text-muted-foreground",children:e.jsx(we,{title:"Nenhuma dose cadastrada",description:"Cadastre a primeira dose para começar."})})}):M.map(s=>e.jsxs(k,{children:[e.jsx(x,{className:"font-medium",children:s.touro_nome||"-"}),e.jsx(x,{children:s.touro_registro||"-"}),e.jsx(x,{children:s.touro_raca?e.jsx(ee,{variant:"outline",children:s.touro_raca}):"-"}),e.jsx(x,{children:s.cliente_nome||"-"}),e.jsx(x,{children:s.tipo_semen?e.jsx(ee,{variant:"secondary",children:s.tipo_semen}):"-"}),e.jsx(x,{children:s.quantidade??"-"}),e.jsx(x,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ce(s),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{Q(s),I(!0)},children:e.jsx(Re,{className:"w-4 h-4 text-red-600"})})]})})]},s.id))})]})})]}),e.jsx(J,{open:ne,onOpenChange:w,children:e.jsxs(K,{className:"max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Editar Dose de Sêmen"}),e.jsx($,{children:"Atualizar dados da dose"})]}),e.jsxs("form",{onSubmit:me,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit_touro_id",children:"Touro do Catálogo *"}),e.jsxs(f,{value:o.touro_id,onValueChange:s=>D({...o,touro_id:s}),children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Selecione o touro"})}),e.jsx(_,{children:R.map(s=>e.jsxs(l,{value:s.id,children:[s.nome," (",s.registro,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit_cliente_id",children:"Cliente *"}),e.jsxs(f,{value:o.cliente_id,onValueChange:s=>D({...o,cliente_id:s}),children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Selecione o cliente"})}),e.jsx(_,{children:X.map(s=>e.jsx(l,{value:s.id,children:s.nome},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit_tipo_semen",children:"Tipo de Sêmen *"}),e.jsxs(f,{value:o.tipo_semen,onValueChange:s=>D({...o,tipo_semen:s}),children:[e.jsx(g,{children:e.jsx(v,{placeholder:"Selecione o tipo"})}),e.jsxs(_,{children:[e.jsx(l,{value:"CONVENCIONAL",children:"CONVENCIONAL"}),e.jsx(l,{value:"SEXADO",children:"SEXADO"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit_quantidade",children:"Quantidade"}),e.jsx(F,{id:"edit_quantidade",type:"number",min:"0",value:o.quantidade,onChange:s=>D({...o,quantidade:s.target.value}),placeholder:"Quantidade de doses"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(h,{type:"submit",className:"flex-1",disabled:c,children:c?"Salvando...":"Salvar Alterações"}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>w(!1),disabled:c,children:"Cancelar"})]})]})]})}),e.jsx(Te,{open:le,onOpenChange:I,children:e.jsxs(Ae,{children:[e.jsxs(qe,{children:[e.jsx(Le,{children:"Confirmar Exclusão"}),e.jsxs(Oe,{children:['Tem certeza que deseja excluir a dose do touro "',u==null?void 0:u.touro_nome,'" do cliente "',u==null?void 0:u.cliente_nome,'"? Esta ação não pode ser desfeita.']})]}),e.jsxs(Fe,{children:[e.jsx(Ve,{disabled:c,children:"Cancelar"}),e.jsx(Ie,{onClick:ue,disabled:c,className:"bg-red-600 hover:bg-red-700",children:c?"Excluindo...":"Excluir"})]})]})})]})}export{os as default};
