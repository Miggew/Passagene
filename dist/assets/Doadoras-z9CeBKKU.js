import{c as H,r as o,s as E,j as a,a as T,g as B,f as O,B as z}from"./index-DM5u2d-F.js";import{C as G,a as $,b as q,d as M}from"./card-B_EQ6x91.js";import{T as V,a as Z,b as k,c as v,d as J,e as f}from"./table-CEKyj1ed.js";import{D as Q,b as U,c as K,d as W,e as X,a as ra}from"./dialog-2y4jBKyr.js";import{S as Y,a as aa,b as ea,c as sa,d as F}from"./select-B_NoJ61H.js";import{I as R}from"./input-CtUEWea1.js";import{L as A}from"./label-Bhhf9ayq.js";import{P as ta}from"./PageHeader-JgO8x5IE.js";import{E as ia}from"./EmptyState-ChaxWsz8.js";import{u as P}from"./use-toast-BOUGyrIz.js";import{B as oa}from"./badge-D_AVhbx8.js";import{S as ca}from"./search-QDhw42Qv.js";import{P as la}from"./plus-DJrruxx9.js";import{H as na}from"./history-Xos89q5T.js";import"./index-CWb7Yp_3.js";import"./index-sCsFC1oc.js";import"./x-DsJYRTDR.js";import"./index-ClZPXJQX.js";import"./index-BEVMOrkK.js";import"./check-Y5eEMkO8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=H("Gem",[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=H("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=H("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);function ha({doadoraId:e,doadoraNome:s,open:t,onClose:i}){const[c,h]=o.useState([]),[u,C]=o.useState(!1),{toast:r}=P();o.useEffect(()=>{t&&e&&m()},[t,e]);const m=async()=>{try{C(!0);const{data:n,error:x}=await E.from("aspiracoes_doadoras").select("*").eq("doadora_id",e).order("data_aspiracao",{ascending:!1});if(x)throw x;h(n||[])}catch(n){r({title:"Erro ao carregar histórico",description:n instanceof Error?n.message:"Erro desconhecido",variant:"destructive"})}finally{C(!1)}};return a.jsx(Q,{open:t,onOpenChange:i,children:a.jsxs(U,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(K,{children:[a.jsx(W,{children:"Histórico de Aspirações"}),a.jsx(X,{children:s?`Aspirações da doadora: ${s}`:"Histórico completo de aspirações"})]}),u?a.jsx("div",{className:"py-8",children:a.jsx(T,{})}):a.jsx("div",{className:"mt-4",children:c.length===0?a.jsx("p",{className:"text-center text-slate-500 py-8",children:"Nenhuma aspiração registrada para esta doadora"}):a.jsxs(V,{children:[a.jsx(Z,{children:a.jsxs(k,{children:[a.jsx(v,{children:"Data"}),a.jsx(v,{children:"Quantidade de Oócitos"}),a.jsx(v,{children:"Veterinário"}),a.jsx(v,{children:"Técnico"})]})}),a.jsx(J,{children:c.map(n=>a.jsxs(k,{children:[a.jsx(f,{children:B(n.data_aspiracao)}),a.jsx(f,{className:"font-medium",children:n.total_oocitos??"-"}),a.jsx(f,{children:n.veterinario_responsavel||"-"}),a.jsx(f,{children:n.tecnico_responsavel||"-"})]},n.id))})]})})]})})}function ua(){const{toast:e}=P(),[s,t]=o.useState(!0),[i,c]=o.useState([]),[h,u]=o.useState([]),[C,r]=o.useState([]),[m,n]=o.useState(""),[x,N]=o.useState(""),[b,_]=o.useState(null),D=o.useCallback(()=>{if(!x.trim()){r(h);return}const l=x.toLowerCase(),d=h.filter(g=>{var w,y,L;return((w=g.nome)==null?void 0:w.toLowerCase().includes(l))||((y=g.registro)==null?void 0:y.toLowerCase().includes(l))||((L=g.raca)==null?void 0:L.toLowerCase().includes(l))});r(d)},[h,x]);o.useEffect(()=>{D()},[D]);const p=o.useCallback(async()=>{try{t(!0);const{data:l,error:d}=await E.from("fazendas").select("id, nome").order("nome",{ascending:!0});if(d)throw d;c(l||[])}catch(l){e({title:"Erro ao carregar fazendas",description:l instanceof Error?l.message:"Erro desconhecido",variant:"destructive"})}finally{t(!1)}},[e]),j=o.useCallback(async()=>{if(!m){u([]),r([]);return}try{t(!0);const{data:l,error:d}=await E.from("doadoras").select("*").eq("fazenda_id",m).order("created_at",{ascending:!1});if(d)throw d;const g=await Promise.all((l||[]).map(async w=>{const{data:y,error:L}=await E.from("aspiracoes_doadoras").select("total_oocitos, data_aspiracao").eq("doadora_id",w.id).order("data_aspiracao",{ascending:!1}).limit(1).maybeSingle();return L||!y?{...w,ultima_aspiracao_total_oocitos:void 0,ultima_aspiracao_data:void 0}:{...w,ultima_aspiracao_total_oocitos:y.total_oocitos,ultima_aspiracao_data:y.data_aspiracao}}));u(g),r(g)}catch(l){e({title:"Erro ao carregar doadoras",description:l instanceof Error?l.message:"Erro desconhecido",variant:"destructive"})}finally{t(!1)}},[m,e]);return o.useEffect(()=>{m?j():(u([]),r([]))},[m,j]),{loading:s,fazendas:i,doadoras:h,filteredDoadoras:C,selectedFazendaId:m,setSelectedFazendaId:n,searchTerm:x,setSearchTerm:N,historicoDoadoraId:b,setHistoricoDoadoraId:_,loadFazendas:p,loadDoadoras:j}}const xa=["Holandesa","Jersey","Gir","Girolando"],I={registro:"",raca:"",racaCustom:""};function fa({selectedFazendaId:e,onSuccess:s}){const t=O(),{toast:i}=P(),[c,h]=o.useState(!1),[u,C]=o.useState(!1),[r,m]=o.useState(I),[n,x]=o.useState(""),N=o.useCallback(()=>{m(I),x("")},[]),b=o.useCallback(p=>{x(p),m(p==="Outra"?j=>({...j,raca:"",racaCustom:""}):j=>({...j,raca:p,racaCustom:""}))},[]),_=o.useCallback(p=>{h(p),p||N()},[N]),D=o.useCallback(async p=>{if(p.preventDefault(),!e){i({title:"Erro de validacao",description:"Selecione a fazenda primeiro",variant:"destructive"});return}if(!r.registro.trim()){i({title:"Erro de validacao",description:"Registro e obrigatorio",variant:"destructive"});return}const j=n==="Outra"?r.racaCustom.trim():r.raca.trim();if(!j){i({title:"Erro de validacao",description:"Raca e obrigatoria",variant:"destructive"});return}try{C(!0);const l={fazenda_id:e,registro:r.registro.trim(),raca:j},{data:d,error:g}=await E.from("doadoras").insert([l]).select().single();if(g)throw g;i({title:"Doadora criada",description:"Doadora criada com sucesso"}),h(!1),N(),s(),d!=null&&d.id&&t(`/doadoras/${d.id}`)}catch(l){const d=l instanceof Error?l.message:"Erro desconhecido";i({title:"Erro ao criar doadora",description:d.includes("RLS")||d.includes("policy")?"RLS esta bloqueando escrita. Configure politicas anon no Supabase.":d,variant:"destructive"})}finally{C(!1)}},[r,n,e,i,N,s,t]);return{formData:r,setFormData:m,racaSelecionada:n,setRacaSelecionada:x,showDialog:c,setShowDialog:h,submitting:u,resetForm:N,handleSubmit:D,handleDialogClose:_,handleRacaChange:b}}function qa(){var g,w;const e=O(),{loading:s,fazendas:t,filteredDoadoras:i,selectedFazendaId:c,setSelectedFazendaId:h,searchTerm:u,setSearchTerm:C,historicoDoadoraId:r,setHistoricoDoadoraId:m,loadFazendas:n,loadDoadoras:x}=ua(),{formData:N,setFormData:b,racaSelecionada:_,showDialog:D,submitting:p,handleSubmit:j,handleDialogClose:l,handleRacaChange:d}=fa({selectedFazendaId:c,onSuccess:x});return o.useEffect(()=>{n()},[n]),s&&t.length===0?a.jsx(T,{}):a.jsxs("div",{className:"space-y-6",children:[a.jsx(ta,{title:"Doadoras",description:"Gerenciar doadoras do sistema"}),a.jsx(pa,{fazendas:t,selectedFazendaId:c,setSelectedFazendaId:h}),c?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(ja,{searchTerm:u,setSearchTerm:C}),a.jsx(ga,{showDialog:D,handleDialogClose:l,formData:N,setFormData:b,racaSelecionada:_,handleRacaChange:d,submitting:p,handleSubmit:j})]}),a.jsxs(G,{children:[a.jsx($,{children:a.jsx(q,{children:"Lista de Doadoras"})}),a.jsx(M,{children:s?a.jsx("div",{className:"py-8",children:a.jsx(T,{})}):a.jsx(va,{doadoras:i,searchTerm:u,navigate:e,setHistoricoDoadoraId:m})})]}),r&&a.jsx(ha,{doadoraId:r,doadoraNome:((g=i.find(y=>y.id===r))==null?void 0:g.nome)||((w=i.find(y=>y.id===r))==null?void 0:w.registro),open:!!r,onClose:()=>m(null)})]}):a.jsx(ia,{title:"Selecione uma fazenda",description:"Escolha uma fazenda para visualizar e gerenciar doadoras."})]})}function pa({fazendas:e,selectedFazendaId:s,setSelectedFazendaId:t}){return a.jsxs(G,{children:[a.jsx($,{children:a.jsx(q,{children:"Selecione a Fazenda"})}),a.jsx(M,{children:a.jsxs(Y,{value:s,onValueChange:t,children:[a.jsx(aa,{className:"w-full",children:a.jsx(ea,{placeholder:"Selecione uma fazenda para visualizar doadoras"})}),a.jsx(sa,{children:e.map(i=>a.jsx(F,{value:i.id,children:i.nome},i.id))})]})})]})}function ja({searchTerm:e,setSearchTerm:s}){return a.jsx("div",{className:"flex items-center gap-4 flex-1",children:a.jsxs("div",{className:"relative flex-1 max-w-md",children:[a.jsx(ca,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),a.jsx(R,{placeholder:"Buscar por nome ou registro...",value:e,onChange:t=>s(t.target.value),className:"pl-10"})]})})}function ga({showDialog:e,handleDialogClose:s,formData:t,setFormData:i,racaSelecionada:c,handleRacaChange:h,submitting:u,handleSubmit:C}){return a.jsxs(Q,{open:e,onOpenChange:s,children:[a.jsx(ra,{asChild:!0,children:a.jsxs(z,{className:"bg-green-600 hover:bg-green-700",children:[a.jsx(la,{className:"w-4 h-4 mr-2"}),"Nova Doadora"]})}),a.jsxs(U,{className:"max-w-md",children:[a.jsxs(K,{children:[a.jsx(W,{children:"Criar Nova Doadora"}),a.jsx(X,{children:"Preencha os campos basicos. As informacoes detalhadas podem ser preenchidas apos a criacao."})]}),a.jsxs("form",{onSubmit:C,className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(A,{htmlFor:"registro",children:"Registro *"}),a.jsx(R,{id:"registro",value:t.registro,onChange:r=>i({...t,registro:r.target.value}),placeholder:"Registro da doadora",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(A,{htmlFor:"raca",children:"Raca *"}),a.jsxs(Y,{value:c,onValueChange:h,children:[a.jsx(aa,{children:a.jsx(ea,{placeholder:"Selecione a raca"})}),a.jsxs(sa,{children:[xa.map(r=>a.jsx(F,{value:r,children:r},r)),a.jsx(F,{value:"Outra",children:"Outra"})]})]}),c==="Outra"&&a.jsx(R,{id:"raca_custom",value:t.racaCustom,onChange:r=>i({...t,racaCustom:r.target.value,raca:r.target.value}),placeholder:"Digite a raca",className:"mt-2",required:!0})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx(z,{type:"submit",className:"flex-1 bg-green-600 hover:bg-green-700",disabled:u,children:u?"Salvando...":"Criar Doadora"}),a.jsx(z,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:u,children:"Cancelar"})]})]})]})]})}function va({doadoras:e,searchTerm:s,navigate:t,setHistoricoDoadoraId:i}){return a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(V,{children:[a.jsx(Z,{children:a.jsxs(k,{children:[a.jsx(v,{children:"Registro"}),a.jsx(v,{children:"Nome"}),a.jsx(v,{children:"Ultima Aspiracao"}),a.jsx(v,{children:"Oocitos"}),a.jsx(v,{children:"Estado"}),a.jsx(v,{children:"Raca (Campos Especiais)"}),a.jsx(v,{children:"Classificacao"}),a.jsx(v,{className:"text-right",children:"Acoes"})]})}),a.jsx(J,{children:e.length===0?a.jsx(k,{children:a.jsx(f,{colSpan:8,className:"text-center text-slate-500",children:s?"Nenhuma doadora encontrada":"Nenhuma doadora cadastrada nesta fazenda"})}):e.map(c=>a.jsx(Ca,{doadora:c,navigate:t,setHistoricoDoadoraId:i},c.id))})]})})}function Ca({doadora:e,navigate:s,setHistoricoDoadoraId:t}){const i=ya(e);return a.jsxs(k,{className:"cursor-pointer hover:bg-slate-50",onClick:()=>s(`/doadoras/${e.id}`),children:[a.jsx(f,{className:"font-medium",children:e.registro}),a.jsx(f,{children:e.nome||"-"}),a.jsx(f,{children:e.ultima_aspiracao_data?B(e.ultima_aspiracao_data):"-"}),a.jsx(f,{children:e.ultima_aspiracao_total_oocitos??"-"}),a.jsx(f,{children:a.jsx(oa,{variant:e.disponivel_aspiracao?"default":"secondary",children:e.disponivel_aspiracao?"Disponivel":"Indisponivel"})}),a.jsx(f,{children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{children:e.raca||"-"}),i&&a.jsx("span",{className:"text-xs text-slate-500",children:i})]})}),a.jsx(f,{children:Na(e.classificacao_genetica)}),a.jsx(f,{className:"text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx(z,{variant:"ghost",size:"sm",onClick:c=>{c.stopPropagation(),t(e.id)},title:"Ver historico de aspiracoes",children:a.jsx(na,{className:"w-4 h-4"})}),a.jsx(z,{variant:"ghost",size:"sm",onClick:c=>{c.stopPropagation(),s(`/doadoras/${e.id}`)},title:"Editar doadora",children:a.jsx(ma,{className:"w-4 h-4"})})]})})]})}function ya(e){if(e.raca==="Gir"){const s=[];return e.gpta&&s.push(`GPTA: ${e.gpta}`),e.controle_leiteiro&&s.push(`Controle Leiteiro: ${e.controle_leiteiro}`),e.beta_caseina&&s.push(`Beta Caseina: ${e.beta_caseina}`),e.link_abcz&&s.push("Link ABCZ"),s.length>0?s.join(", "):null}return null}function Na(e){if(!e)return"-";switch(e){case"1_estrela":return a.jsx("div",{className:"flex items-center gap-1",children:a.jsx(S,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})});case"2_estrelas":return a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(S,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),a.jsx(S,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]});case"3_estrelas":return a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(S,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),a.jsx(S,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),a.jsx(S,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]});case"diamante":return a.jsx("div",{className:"flex items-center gap-1",children:a.jsx(da,{className:"w-4 h-4 fill-blue-500 text-blue-500"})});default:return"-"}}export{qa as default};
