import{c as rs,e as $e,r as t,s as y,j as e,f as ye,H as De,al as Ne,B as $,X as Le,am as ts,b as os,i as is,m as ns,P as ze,h as ls,n as Be,l as Ie,an as ds,q as qe,a as cs,ao as ms,D as Ve,ac as us}from"./index-B-7HRnm0.js";import{P as xs}from"./PageHeader-CT7CFo0W.js";import{C as ae,d as re}from"./card-DdhhEbXV.js";import{h as ve}from"./error-handler-CBBt1r71.js";import{U as je}from"./users-B1VQ-Dt9.js";import{U as hs}from"./user-check-BrP8ddMU.js";import{C as Re}from"./chevron-right-DntnbvYp.js";import{f as Ge,p as He}from"./pt-BR-DS62bWKG.js";import{I as O}from"./input-D2h8r4MO.js";import{L as F}from"./label-vBcRjcSu.js";import{T as Ke}from"./textarea-RmDl789L.js";import{D as we,a as Ce,b as _e,c as ke,d as Pe,e as ps}from"./dialog-CIXjHraQ.js";import{E as be}from"./EmptyState-gn01eel2.js";import{u as Se}from"./use-toast-DDUqdzpY.js";import{F as Te}from"./filter-WiIDhzCI.js";import{S as Ee}from"./search-DcAWDjHO.js";import{P as le}from"./plus-Cnek-_uY.js";import{E as We}from"./eye-C2rdP5in.js";import{S as te,a as oe,b as ie,c as ne,d as V,u as fs}from"./select-B0M3FCy4.js";import{N as gs,i as vs,e as js,b as bs,g as Ns,a as ys}from"./coordinates-DV_iSMgh.js";import{C as ws}from"./check-C6h7QFZL.js";import{B as Y}from"./badge-BCHVCiM7.js";import{S as me}from"./switch-DtAGOp8o.js";import{S as Xe}from"./square-pen-BpOU0zlP.js";import{S as Cs}from"./skeleton-Ba6ODj6_.js";import{S as Oe}from"./star-X44RvruR.js";import{T as _s}from"./trash-2-czF2ENAT.js";import{S as ks}from"./save-DAusptDg.js";import"./differenceInCalendarDays-CrzntjZV.js";import"./index-B4eR1KA_.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=rs("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);function Es({onNavigateToTab:l}){const{isAdmin:w}=$e(),[k,L]=t.useState(!0),[p,x]=t.useState({totalClientes:0,totalFazendas:0,totalUsuarios:0,usuariosAtivos:0,usuariosAdmin:0,usuariosOperacional:0,usuariosCliente:0}),[T,M]=t.useState([]),[d,E]=t.useState([]);t.useEffect(()=>{j()},[]);const j=async()=>{try{L(!0);const{data:u,error:v}=await y.from("clientes").select("id, nome, created_at").order("created_at",{ascending:!1});if(v)throw v;const{data:_,error:S}=await y.from("fazendas").select("id, nome, created_at").order("created_at",{ascending:!1});if(S)throw S;let f=[];if(w){const{data:N,error:i}=await y.from("user_profiles").select("id, active, user_type");if(i)throw i;f=N||[]}x({totalClientes:(u==null?void 0:u.length)||0,totalFazendas:(_==null?void 0:_.length)||0,totalUsuarios:f.length,usuariosAtivos:f.filter(N=>N.active).length,usuariosAdmin:f.filter(N=>N.user_type==="admin").length,usuariosOperacional:f.filter(N=>N.user_type==="operacional").length,usuariosCliente:f.filter(N=>N.user_type==="cliente").length}),M((u||[]).slice(0,5)),E((_||[]).slice(0,5))}catch(u){ve(u,"Erro ao carregar dados do dashboard")}finally{L(!1)}},C=u=>{try{return Ge(new Date(u),"dd/MM/yyyy",{locale:He})}catch{return"-"}};return k?e.jsx(ye,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ae,{className:"cursor-pointer transition-all hover:shadow-md hover:border-primary/30",onClick:()=>l("clientes"),children:e.jsx(re,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Clientes"}),e.jsx("p",{className:"text-2xl font-bold",children:p.totalClientes})]})]})})}),e.jsx(ae,{className:"cursor-pointer transition-all hover:shadow-md hover:border-primary/30",onClick:()=>l("fazendas"),children:e.jsx(re,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center",children:e.jsx(De,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Fazendas"}),e.jsx("p",{className:"text-2xl font-bold",children:p.totalFazendas})]})]})})}),w&&e.jsx(ae,{className:"cursor-pointer transition-all hover:shadow-md hover:border-primary/30",onClick:()=>l("usuarios"),children:e.jsx(re,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-violet-500/10 flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Usuarios"}),e.jsx("p",{className:"text-2xl font-bold",children:p.totalUsuarios})]})]})})}),w&&e.jsx(ae,{className:"cursor-pointer transition-all hover:shadow-md hover:border-primary/30",onClick:()=>l("usuarios"),children:e.jsx(re,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-500/10 flex items-center justify-center",children:e.jsx(hs,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Ativos"}),e.jsx("p",{className:"text-2xl font-bold",children:p.usuariosAtivos})]})]})})})]}),w&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(ae,{className:"bg-primary/5 border-primary/20",children:e.jsxs(re,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Admins"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:p.usuariosAdmin})]})}),e.jsx(ae,{className:"bg-sky-500/5 border-sky-500/20",children:e.jsxs(re,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Operacionais"}),e.jsx("p",{className:"text-xl font-bold text-sky-600",children:p.usuariosOperacional})]})}),e.jsx(ae,{className:"bg-amber-500/5 border-amber-500/20",children:e.jsxs(re,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Clientes"}),e.jsx("p",{className:"text-xl font-bold text-amber-600",children:p.usuariosCliente})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gradient-to-r from-muted/80 via-muted/60 to-muted/80 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 rounded-full bg-primary/40"}),e.jsx("span",{className:"text-sm font-semibold",children:"Ultimos Clientes"})]}),e.jsxs("button",{onClick:()=>l("clientes"),className:"text-xs text-muted-foreground hover:text-primary flex items-center gap-1 transition-colors",children:["Ver todos ",e.jsx(Re,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:T.length===0?e.jsx("div",{className:"px-4 py-6 text-center text-sm text-muted-foreground",children:"Nenhum cliente cadastrado"}):T.map((u,v)=>e.jsxs("div",{className:`group px-4 py-3 flex items-center justify-between transition-colors hover:bg-primary/5 ${v%2===1?"bg-muted/20":""}`,children:[e.jsx("span",{className:"font-medium text-sm group-hover:text-primary transition-colors truncate",children:u.nome}),e.jsx("span",{className:"text-xs text-muted-foreground",children:C(u.created_at)})]},u.id))})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gradient-to-r from-muted/80 via-muted/60 to-muted/80 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 rounded-full bg-emerald-500/40"}),e.jsx("span",{className:"text-sm font-semibold",children:"Ultimas Fazendas"})]}),e.jsxs("button",{onClick:()=>l("fazendas"),className:"text-xs text-muted-foreground hover:text-primary flex items-center gap-1 transition-colors",children:["Ver todas ",e.jsx(Re,{className:"w-3 h-3"})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:d.length===0?e.jsx("div",{className:"px-4 py-6 text-center text-sm text-muted-foreground",children:"Nenhuma fazenda cadastrada"}):d.map((u,v)=>e.jsxs("div",{className:`group px-4 py-3 flex items-center justify-between transition-colors hover:bg-primary/5 ${v%2===1?"bg-muted/20":""}`,children:[e.jsx("span",{className:"font-medium text-sm group-hover:text-primary transition-colors truncate",children:u.nome}),e.jsx("span",{className:"text-xs text-muted-foreground",children:C(u.created_at)})]},u.id))})]})]})]})}const pe=15;function As(){const{toast:l}=Se(),[w,k]=t.useState([]),[L,p]=t.useState(!0),[x,T]=t.useState(""),[M,d]=t.useState(!1),[E,j]=t.useState(null),[C,u]=t.useState(!1),[v,_]=t.useState({nome:"",telefone:"",endereco:""}),[S,f]=t.useState(1);t.useEffect(()=>{N()},[]);const N=async()=>{try{p(!0);const{data:n,error:g}=await y.from("clientes").select("*").order("nome",{ascending:!0});if(g)throw g;const{data:D,error:H}=await y.from("fazendas").select("cliente_id");if(H)throw H;const K=new Map;(D||[]).forEach(J=>{const B=K.get(J.cliente_id)||0;K.set(J.cliente_id,B+1)});const ee=(n||[]).map(J=>({...J,fazendas_count:K.get(J.id)||0}));k(ee)}catch(n){ve(n,"Erro ao carregar clientes")}finally{p(!1)}},i=t.useMemo(()=>{if(!x)return w;const n=x.toLowerCase();return w.filter(g=>{var D,H,K;return((D=g.nome)==null?void 0:D.toLowerCase().includes(n))||((H=g.telefone)==null?void 0:H.toLowerCase().includes(n))||((K=g.endereco)==null?void 0:K.toLowerCase().includes(n))})},[w,x]),A=Math.ceil(i.length/pe),z=t.useMemo(()=>{const n=(S-1)*pe;return i.slice(n,n+pe)},[i,S]);t.useEffect(()=>{f(1)},[x]);const R=n=>{n?(j(n),_({nome:n.nome||"",telefone:n.telefone||"",endereco:n.endereco||""})):(j(null),_({nome:"",telefone:"",endereco:""})),d(!0)},o=()=>{d(!1),j(null),_({nome:"",telefone:"",endereco:""})},U=async n=>{if(n.preventDefault(),!v.nome.trim()){l({title:"Erro de validacao",description:"Nome e obrigatorio",variant:"destructive"});return}try{if(u(!0),E){const{error:g}=await y.from("clientes").update({nome:v.nome.trim(),telefone:v.telefone.trim()||null,endereco:v.endereco.trim()||null}).eq("id",E.id);if(g)throw g;l({title:"Cliente atualizado",description:"Cliente atualizado com sucesso"})}else{const{error:g}=await y.from("clientes").insert([{nome:v.nome.trim(),telefone:v.telefone.trim()||null,endereco:v.endereco.trim()||null}]);if(g)throw g;l({title:"Cliente criado",description:"Cliente criado com sucesso"})}o(),N()}catch(g){ve(g,"Erro ao salvar cliente")}finally{u(!1)}},I=n=>{try{return Ge(new Date(n),"dd/MM/yyyy",{locale:He})}catch{return"-"}},G=n=>{R(n)};return L?e.jsx(ye,{}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[250px]",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Buscar por nome, telefone ou endereco...",value:x,onChange:n=>T(n.target.value),className:"pl-9 h-9"})]})]}),x&&e.jsxs($,{variant:"outline",size:"sm",onClick:()=>T(""),className:"h-9",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Limpar"]}),e.jsxs($,{onClick:()=>R(),className:"h-9 ml-auto",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Novo Cliente"]})]})}),i.length===0?e.jsx(be,{title:"Nenhum cliente encontrado",description:x?"Tente ajustar os filtros de busca":"Cadastre o primeiro cliente para comecar.",action:!x&&e.jsxs($,{onClick:()=>R(),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Novo Cliente"]})}):e.jsxs("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-muted/80 via-muted/60 to-muted/80 border-b border-border",children:e.jsxs("div",{className:"grid grid-cols-[2fr_1fr_1.5fr_0.8fr_1fr_0.6fr] text-[10px] font-semibold text-muted-foreground uppercase tracking-wider",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 rounded-full bg-primary/40"}),"Nome"]}),e.jsx("div",{className:"px-3 py-3",children:"Telefone"}),e.jsx("div",{className:"px-3 py-3",children:"Endereco"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Fazendas"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Cadastro"}),e.jsx("div",{className:"px-2 py-3"})]})}),e.jsx("div",{className:"divide-y divide-border/50",children:z.map((n,g)=>e.jsxs("div",{className:`
                  group grid grid-cols-[2fr_1fr_1.5fr_0.8fr_1fr_0.6fr] items-center cursor-pointer transition-all duration-150
                  hover:bg-gradient-to-r hover:from-primary/5 hover:via-transparent hover:to-transparent
                  ${g%2===0?"bg-transparent":"bg-muted/20"}
                `,onClick:()=>G(n),children:[e.jsxs("div",{className:"px-4 py-3.5 flex items-center gap-3",children:[e.jsx("div",{className:"w-0.5 h-8 rounded-full bg-transparent group-hover:bg-primary transition-colors"}),e.jsx("span",{className:"font-medium text-sm truncate group-hover:text-primary transition-colors",children:n.nome})]}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:n.telefone||"-"}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:n.endereco||"-"}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:e.jsx("span",{className:`
                    inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-semibold rounded-md
                    ${(n.fazendas_count||0)>0?"bg-primary/10 text-primary group-hover:bg-primary/20":"bg-muted text-muted-foreground"} transition-colors
                  `,children:n.fazendas_count||0})}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-center text-muted-foreground",children:n.created_at?I(n.created_at):"-"}),e.jsx("div",{className:"px-2 py-3.5 flex justify-center gap-1",children:e.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center bg-transparent group-hover:bg-primary/10 transition-colors",children:e.jsx(We,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors"})})})]},n.id))}),A>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-muted/30 via-transparent to-muted/30 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[(S-1)*pe+1,"-",Math.min(S*pe,i.length)]})," ","de"," ",e.jsx("span",{className:"font-medium text-foreground",children:i.length})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>f(n=>Math.max(1,n-1)),disabled:S===1,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-0.5 mx-2",children:Array.from({length:Math.min(5,A)},(n,g)=>{let D;return A<=5||S<=3?D=g+1:S>=A-2?D=A-4+g:D=S-2+g,e.jsx("button",{onClick:()=>f(D),className:`
                          w-8 h-8 text-xs font-medium rounded-md transition-all
                          ${S===D?"bg-primary/15 text-primary shadow-sm":"text-muted-foreground hover:bg-muted hover:text-foreground"}
                        `,children:D},D)})}),e.jsx("button",{onClick:()=>f(n=>Math.min(A,n+1)),disabled:S===A,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Proximo"})]})]})]}),e.jsx(we,{open:M,onOpenChange:d,children:e.jsxs(Ce,{className:"max-w-md",children:[e.jsxs(_e,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-5 h-5 text-primary"}),E?"Editar Cliente":"Novo Cliente"]}),e.jsx(Pe,{children:E?`Editando ${E.nome}`:"Preencha os dados do novo cliente"})]}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"nome",children:"Nome *"}),e.jsx(O,{id:"nome",value:v.nome,onChange:n=>_({...v,nome:n.target.value}),placeholder:"Nome do cliente",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"telefone",children:"Telefone"}),e.jsx(O,{id:"telefone",value:v.telefone,onChange:n=>_({...v,telefone:n.target.value}),placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"endereco",children:"Endereco"}),e.jsx(Ke,{id:"endereco",value:v.endereco,onChange:n=>_({...v,endereco:n.target.value}),placeholder:"Endereco completo",rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx($,{type:"submit",className:"flex-1",disabled:C,children:C?"Salvando...":E?"Salvar":"Criar Cliente"}),e.jsx($,{type:"button",variant:"outline",onClick:o,disabled:C,children:"Cancelar"})]})]})]})})]})}const fe=15;function Fs(){const l=os(),{toast:w}=Se(),[k,L]=t.useState([]),[p,x]=t.useState([]),[T,M]=t.useState(!0),[d,E]=t.useState(""),[j,C]=t.useState("todos"),[u,v]=t.useState(!1),[_,S]=t.useState(null),[f,N]=t.useState(!1),[i,A]=t.useState({nome:"",sigla:"",cliente_id:"",localizacao:"",latitude:"",longitude:"",mapsLink:"",responsavel:"",contato_responsavel:""}),[z,R]=t.useState(null),[o,U]=t.useState(null),[I,G]=t.useState(1);t.useEffect(()=>{n()},[]);const n=async()=>{try{M(!0);const{data:s,error:c}=await y.from("clientes").select("*").order("nome");if(c)throw c;x(s||[]);const{data:m,error:P}=await y.from("fazendas").select("*").order("nome",{ascending:!0});if(P)throw P;const q=new Map((s||[]).map(r=>[r.id,r.nome])),W=m==null?void 0:m.map(r=>({...r,cliente_nome:q.get(r.cliente_id)}));L(W||[])}catch(s){ve(s,"Erro ao carregar dados")}finally{M(!1)}},g=t.useMemo(()=>k.filter(s=>{var P,q,W,r;const c=!d||((P=s.nome)==null?void 0:P.toLowerCase().includes(d.toLowerCase()))||((q=s.cliente_nome)==null?void 0:q.toLowerCase().includes(d.toLowerCase()))||((W=s.responsavel)==null?void 0:W.toLowerCase().includes(d.toLowerCase()))||((r=s.localizacao)==null?void 0:r.toLowerCase().includes(d.toLowerCase())),m=j==="todos"||s.cliente_id===j;return c&&m}),[k,d,j]),D=Math.ceil(g.length/fe),H=t.useMemo(()=>{const s=(I-1)*fe;return g.slice(s,s+fe)},[g,I]);t.useEffect(()=>{G(1)},[d,j]);const K=s=>{if(A(m=>({...m,mapsLink:s})),R(null),!s.trim())return;if(vs(s)){R("Links curtos (goo.gl) nao sao suportados. Abra o link no navegador e copie a URL completa.");return}const c=js(s);c&&A(m=>({...m,mapsLink:s,latitude:c.lat,longitude:c.lng}))},ee=(s,c)=>{const m={...i,[s]:c};if(A(m),m.latitude&&m.longitude){const P=parseFloat(m.latitude),q=parseFloat(m.longitude);U(bs(P,q))}else U(null)},J=s=>{S(null),A({nome:"",sigla:"",cliente_id:"",localizacao:"",latitude:"",longitude:"",mapsLink:"",responsavel:"",contato_responsavel:""}),R(null),U(null),v(!0)},B=()=>{v(!1),S(null),A({nome:"",sigla:"",cliente_id:"",localizacao:"",latitude:"",longitude:"",mapsLink:"",responsavel:"",contato_responsavel:""}),R(null),U(null)},de=async s=>{if(s.preventDefault(),!i.nome.trim()){w({title:"Erro de validacao",description:"Nome da fazenda e obrigatorio",variant:"destructive"});return}if(!i.cliente_id){w({title:"Erro de validacao",description:"Selecione um cliente",variant:"destructive"});return}try{N(!0);const c={nome:i.nome.trim(),sigla:i.sigla.trim().toUpperCase()||null,cliente_id:i.cliente_id,localizacao:i.localizacao.trim()||null,latitude:i.latitude?parseFloat(i.latitude):null,longitude:i.longitude?parseFloat(i.longitude):null,responsavel:i.responsavel.trim()||null,contato_responsavel:i.contato_responsavel.trim()||null};if(_){const{error:m}=await y.from("fazendas").update(c).eq("id",_.id);if(m)throw m;w({title:"Fazenda atualizada",description:"Fazenda atualizada com sucesso"})}else{const{error:m}=await y.from("fazendas").insert([c]);if(m)throw m;w({title:"Fazenda criada",description:"Fazenda criada com sucesso"})}B(),n()}catch(c){ve(c,"Erro ao salvar fazenda")}finally{N(!1)}},Q=s=>{if(s.latitude&&s.longitude){const c=Ns(s.latitude,s.longitude);window.open(c,"_blank")}else if(s.localizacao){const c=ys(s.localizacao);window.open(c,"_blank")}},ce=s=>s.latitude&&s.longitude||s.localizacao,a=s=>{l(`/fazendas/${s.id}`)},b=()=>{E(""),C("todos")};return T?e.jsx(ye,{}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[250px]",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Buscar por nome, cliente, responsavel...",value:d,onChange:s=>E(s.target.value),className:"pl-9 h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-amber-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(je,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Cliente"})]}),e.jsx("div",{className:"w-[200px]",children:e.jsxs(te,{value:j,onValueChange:C,children:[e.jsx(oe,{className:"h-9",children:e.jsx(ie,{placeholder:"Cliente"})}),e.jsxs(ne,{children:[e.jsx(V,{value:"todos",children:"Todos os clientes"}),p.map(s=>e.jsx(V,{value:s.id,children:s.nome},s.id))]})]})})]}),(d||j!=="todos")&&e.jsxs($,{variant:"outline",size:"sm",onClick:b,className:"h-9",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Limpar"]}),e.jsxs($,{onClick:()=>J(),className:"h-9 ml-auto",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Nova Fazenda"]})]})}),g.length===0?e.jsx(be,{title:"Nenhuma fazenda encontrada",description:d||j!=="todos"?"Tente ajustar os filtros de busca":"Cadastre uma fazenda para comecar.",action:!(d||j!=="todos")&&e.jsxs($,{onClick:()=>J(),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Nova Fazenda"]})}):e.jsxs("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-muted/80 via-muted/60 to-muted/80 border-b border-border",children:e.jsxs("div",{className:"grid grid-cols-[1.5fr_1.2fr_1fr_1fr_1fr_0.6fr] text-[10px] font-semibold text-muted-foreground uppercase tracking-wider",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 rounded-full bg-primary/40"}),"Nome"]}),e.jsx("div",{className:"px-3 py-3",children:"Cliente"}),e.jsx("div",{className:"px-3 py-3",children:"Responsavel"}),e.jsx("div",{className:"px-3 py-3",children:"Contato"}),e.jsx("div",{className:"px-3 py-3",children:"Localizacao"}),e.jsx("div",{className:"px-2 py-3"})]})}),e.jsx("div",{className:"divide-y divide-border/50",children:H.map((s,c)=>e.jsxs("div",{className:`
                  group grid grid-cols-[1.5fr_1.2fr_1fr_1fr_1fr_0.6fr] items-center cursor-pointer transition-all duration-150
                  hover:bg-gradient-to-r hover:from-primary/5 hover:via-transparent hover:to-transparent
                  ${c%2===0?"bg-transparent":"bg-muted/20"}
                `,onClick:()=>a(s),children:[e.jsxs("div",{className:"px-4 py-3.5 flex items-center gap-3",children:[e.jsx("div",{className:"w-0.5 h-8 rounded-full bg-transparent group-hover:bg-primary transition-colors"}),e.jsx("span",{className:"font-medium text-sm truncate group-hover:text-primary transition-colors",children:s.nome})]}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:s.cliente_nome||"-"}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:s.responsavel||"-"}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:s.contato_responsavel||"-"}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:s.localizacao||"-"}),e.jsxs("div",{className:"px-2 py-3.5 flex justify-center gap-1",children:[ce(s)&&e.jsx("button",{onClick:m=>{m.stopPropagation(),Q(s)},className:"w-8 h-8 rounded-md flex items-center justify-center bg-transparent hover:bg-emerald-500/10 transition-colors",title:"Navegar",children:e.jsx(gs,{className:"w-4 h-4 text-muted-foreground hover:text-emerald-600 transition-colors"})}),e.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center bg-transparent group-hover:bg-primary/10 transition-colors",children:e.jsx(We,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors"})})]})]},s.id))}),D>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-muted/30 via-transparent to-muted/30 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[(I-1)*fe+1,"-",Math.min(I*fe,g.length)]})," ","de"," ",e.jsx("span",{className:"font-medium text-foreground",children:g.length})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>G(s=>Math.max(1,s-1)),disabled:I===1,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-0.5 mx-2",children:Array.from({length:Math.min(5,D)},(s,c)=>{let m;return D<=5||I<=3?m=c+1:I>=D-2?m=D-4+c:m=I-2+c,e.jsx("button",{onClick:()=>G(m),className:`
                          w-8 h-8 text-xs font-medium rounded-md transition-all
                          ${I===m?"bg-primary/15 text-primary shadow-sm":"text-muted-foreground hover:bg-muted hover:text-foreground"}
                        `,children:m},m)})}),e.jsx("button",{onClick:()=>G(s=>Math.min(D,s+1)),disabled:I===D,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Proximo"})]})]})]}),e.jsx(we,{open:u,onOpenChange:v,children:e.jsxs(Ce,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(_e,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),_?"Editar Fazenda":"Nova Fazenda"]}),e.jsx(Pe,{children:_?`Editando ${_.nome}`:"Preencha os dados da nova fazenda"})]}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"nome",children:"Nome da Fazenda *"}),e.jsx(O,{id:"nome",value:i.nome,onChange:s=>A({...i,nome:s.target.value}),placeholder:"Nome da fazenda",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"sigla",children:"Sigla (2-3 caracteres)"}),e.jsx(O,{id:"sigla",value:i.sigla,onChange:s=>{const c=s.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,3);A({...i,sigla:c})},placeholder:"Ex: SC, BV",maxLength:3,className:"w-24 uppercase"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usada para identificar embrioes (ex: SC-2401-001)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"cliente_id",children:"Cliente *"}),e.jsxs(te,{value:i.cliente_id,onValueChange:s=>A({...i,cliente_id:s}),children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Selecione o cliente"})}),e.jsx(ne,{children:p.map(s=>e.jsx(V,{value:s.id,children:s.nome},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"localizacao",children:"Localizacao"}),e.jsx(O,{id:"localizacao",value:i.localizacao,onChange:s=>A({...i,localizacao:s.target.value}),placeholder:"Cidade, Estado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"mapsLink",children:"Link do Google Maps"}),e.jsx(O,{id:"mapsLink",value:i.mapsLink,onChange:s=>K(s.target.value),placeholder:"Cole aqui o link compartilhado do Maps",className:z?"border-red-500":""}),z&&e.jsx("p",{className:"text-xs text-red-500",children:z}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cole um link do Google Maps para preencher as coordenadas automaticamente"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"latitude",children:"Latitude"}),e.jsx(O,{id:"latitude",type:"number",step:"any",value:i.latitude,onChange:s=>ee("latitude",s.target.value),placeholder:"-23.550520",className:o===!1?"border-red-500":o===!0?"border-green-500":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"longitude",children:"Longitude"}),e.jsx(O,{id:"longitude",type:"number",step:"any",value:i.longitude,onChange:s=>ee("longitude",s.target.value),placeholder:"-46.633308",className:o===!1?"border-red-500":o===!0?"border-green-500":""})]})]}),o===!1&&e.jsx("p",{className:"text-xs text-red-500",children:"Coordenadas fora do range valido (lat: -90 a 90, lng: -180 a 180)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"responsavel",children:"Responsavel"}),e.jsx(O,{id:"responsavel",value:i.responsavel,onChange:s=>A({...i,responsavel:s.target.value}),placeholder:"Nome do responsavel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"contato_responsavel",children:"Contato do Responsavel"}),e.jsx(O,{id:"contato_responsavel",value:i.contato_responsavel,onChange:s=>A({...i,contato_responsavel:s.target.value}),placeholder:"Telefone ou email"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx($,{type:"submit",className:"flex-1",disabled:f,children:f?"Salvando...":_?"Salvar":"Criar Fazenda"}),e.jsx($,{type:"button",variant:"outline",onClick:B,disabled:f,children:"Cancelar"})]})]})]})})]})}var Ae="Checkbox",[Ds,ha]=is(Ae),[Ls,Me]=Ds(Ae);function zs(l){const{__scopeCheckbox:w,checked:k,children:L,defaultChecked:p,disabled:x,form:T,name:M,onCheckedChange:d,required:E,value:j="on",internal_do_not_use_render:C}=l,[u,v]=ls({prop:k,defaultProp:p??!1,onChange:d,caller:Ae}),[_,S]=t.useState(null),[f,N]=t.useState(null),i=t.useRef(!1),A=_?!!T||!!_.closest("form"):!0,z={checked:u,disabled:x,setChecked:v,control:_,setControl:S,name:M,form:T,value:j,hasConsumerStoppedPropagationRef:i,required:E,defaultChecked:se(p)?!1:p,isFormControl:A,bubbleInput:f,setBubbleInput:N};return e.jsx(Ls,{scope:w,...z,children:Ps(C)?C(z):L})}var Je="CheckboxTrigger",Ze=t.forwardRef(({__scopeCheckbox:l,onKeyDown:w,onClick:k,...L},p)=>{const{control:x,value:T,disabled:M,checked:d,required:E,setControl:j,setChecked:C,hasConsumerStoppedPropagationRef:u,isFormControl:v,bubbleInput:_}=Me(Je,l),S=Be(p,j),f=t.useRef(d);return t.useEffect(()=>{const N=x==null?void 0:x.form;if(N){const i=()=>C(f.current);return N.addEventListener("reset",i),()=>N.removeEventListener("reset",i)}},[x,C]),e.jsx(ze.button,{type:"button",role:"checkbox","aria-checked":se(d)?"mixed":d,"aria-required":E,"data-state":as(d),"data-disabled":M?"":void 0,disabled:M,value:T,...L,ref:S,onKeyDown:Ie(w,N=>{N.key==="Enter"&&N.preventDefault()}),onClick:Ie(k,N=>{C(i=>se(i)?!0:!i),_&&v&&(u.current=N.isPropagationStopped(),u.current||N.stopPropagation())})})});Ze.displayName=Je;var Ue=t.forwardRef((l,w)=>{const{__scopeCheckbox:k,name:L,checked:p,defaultChecked:x,required:T,disabled:M,value:d,onCheckedChange:E,form:j,...C}=l;return e.jsx(zs,{__scopeCheckbox:k,checked:p,defaultChecked:x,disabled:M,required:T,onCheckedChange:E,name:L,form:j,value:d,internal_do_not_use_render:({isFormControl:u})=>e.jsxs(e.Fragment,{children:[e.jsx(Ze,{...C,ref:w,__scopeCheckbox:k}),u&&e.jsx(ss,{__scopeCheckbox:k})]})})});Ue.displayName=Ae;var Qe="CheckboxIndicator",Ye=t.forwardRef((l,w)=>{const{__scopeCheckbox:k,forceMount:L,...p}=l,x=Me(Qe,k);return e.jsx(ns,{present:L||se(x.checked)||x.checked===!0,children:e.jsx(ze.span,{"data-state":as(x.checked),"data-disabled":x.disabled?"":void 0,...p,ref:w,style:{pointerEvents:"none",...l.style}})})});Ye.displayName=Qe;var es="CheckboxBubbleInput",ss=t.forwardRef(({__scopeCheckbox:l,...w},k)=>{const{control:L,hasConsumerStoppedPropagationRef:p,checked:x,defaultChecked:T,required:M,disabled:d,name:E,value:j,form:C,bubbleInput:u,setBubbleInput:v}=Me(es,l),_=Be(k,v),S=fs(x),f=ds(L);t.useEffect(()=>{const i=u;if(!i)return;const A=window.HTMLInputElement.prototype,R=Object.getOwnPropertyDescriptor(A,"checked").set,o=!p.current;if(S!==x&&R){const U=new Event("click",{bubbles:o});i.indeterminate=se(x),R.call(i,se(x)?!1:x),i.dispatchEvent(U)}},[u,S,x,p]);const N=t.useRef(se(x)?!1:x);return e.jsx(ze.input,{type:"checkbox","aria-hidden":!0,defaultChecked:T??N.current,required:M,disabled:d,name:E,value:j,form:C,...w,tabIndex:-1,ref:_,style:{...w.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ss.displayName=es;function Ps(l){return typeof l=="function"}function se(l){return l==="indeterminate"}function as(l){return se(l)?"indeterminate":l?"checked":"unchecked"}const Fe=t.forwardRef(({className:l,...w},k)=>e.jsx(Ue,{ref:k,className:qe("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",l),...w,children:e.jsx(Ye,{className:qe("flex items-center justify-center text-current"),children:e.jsx(ws,{className:"h-4 w-4"})})}));Fe.displayName=Ue.displayName;const ge=15;function Ts(){const{toast:l}=Se(),{permissions:w}=cs(),[k,L]=t.useState(!0),[p,x]=t.useState([]),[T,M]=t.useState([]),[d,E]=t.useState([]),[j,C]=t.useState(""),[u,v]=t.useState("todos"),[_,S]=t.useState(!1),[f,N]=t.useState(null),[i,A]=t.useState(!1),[z,R]=t.useState(1),[o,U]=t.useState({nome:"",email:"",user_type:"operacional",cliente_id:"",clientes_vinculados:[],active:!0,hub_permissions:[]}),I=w==null?void 0:w.isAdmin;t.useEffect(()=>{I&&G()},[I]);const G=async()=>{try{L(!0);const{data:a,error:b}=await y.from("hubs").select("*").order("display_order");if(b)throw b;M(a||[]);const{data:s,error:c}=await y.from("clientes").select("id, nome").order("nome");if(c)throw c;E(s||[]);const{data:m,error:P}=await y.from("user_profiles").select("*").order("nome");if(P)throw P;const{data:q,error:W}=await y.from("user_hub_permissions").select("user_id, hub_code").eq("can_access",!0);if(W)throw W;const{data:r,error:h}=await y.from("user_clientes").select("user_id, cliente_id");if(h)throw h;const ue=new Map;(q||[]).forEach(Z=>{const he=ue.get(Z.user_id)||[];he.push(Z.hub_code),ue.set(Z.user_id,he)});const X=new Map;(r||[]).forEach(Z=>{const he=X.get(Z.user_id)||[];he.push(Z.cliente_id),X.set(Z.user_id,he)});const xe=(m||[]).map(Z=>({...Z,hub_permissions:ue.get(Z.id)||[],clientes_vinculados:X.get(Z.id)||[]}));x(xe)}catch(a){l({title:"Erro ao carregar dados",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{L(!1)}},n=t.useMemo(()=>p.filter(a=>{var c,m;const b=!j||((c=a.nome)==null?void 0:c.toLowerCase().includes(j.toLowerCase()))||((m=a.email)==null?void 0:m.toLowerCase().includes(j.toLowerCase())),s=u==="todos"||a.user_type===u;return b&&s}),[p,j,u]),g=Math.ceil(n.length/ge),D=t.useMemo(()=>{const a=(z-1)*ge;return n.slice(a,a+ge)},[n,z]);t.useEffect(()=>{R(1)},[j,u]);const H=a=>{a?(N(a),U({nome:a.nome||"",email:a.email||"",user_type:a.user_type,cliente_id:a.cliente_id||"",clientes_vinculados:a.clientes_vinculados||[],active:a.active,hub_permissions:a.hub_permissions})):(N(null),U({nome:"",email:"",user_type:"operacional",cliente_id:"",clientes_vinculados:[],active:!0,hub_permissions:[]})),S(!0)},K=()=>{S(!1),N(null),U({nome:"",email:"",user_type:"operacional",cliente_id:"",clientes_vinculados:[],active:!0,hub_permissions:[]})},ee=a=>{U(b=>{const s=b.hub_permissions;return s.includes(a)?{...b,hub_permissions:s.filter(c=>c!==a)}:{...b,hub_permissions:[...s,a]}})},J=a=>{U(b=>{const s=b.clientes_vinculados;return s.includes(a)?{...b,clientes_vinculados:s.filter(c=>c!==a)}:{...b,clientes_vinculados:[...s,a]}})},B=async a=>{if(a.preventDefault(),!o.nome.trim()||!o.email.trim()){l({title:"Erro de validacao",description:"Nome e email sao obrigatorios",variant:"destructive"});return}if(o.user_type==="cliente"&&!o.cliente_id){l({title:"Erro de validacao",description:"Selecione um cliente para usuarios do tipo Cliente",variant:"destructive"});return}try{if(A(!0),f){const{error:b}=await y.from("user_profiles").update({nome:o.nome,user_type:o.user_type,cliente_id:o.user_type==="cliente"?o.cliente_id:null,active:o.active}).eq("id",f.id);if(b)throw b;const{error:s}=await y.from("user_hub_permissions").delete().eq("user_id",f.id);if(s)throw s;if(o.hub_permissions.length>0&&o.user_type!=="admin"){const m=o.hub_permissions.map(q=>({user_id:f.id,hub_code:q,can_access:!0})),{error:P}=await y.from("user_hub_permissions").insert(m);if(P)throw P}const{error:c}=await y.from("user_clientes").delete().eq("user_id",f.id);if(c)throw c;if(o.user_type==="operacional"&&o.clientes_vinculados.length>0){const m=o.clientes_vinculados.map(q=>({user_id:f.id,cliente_id:q})),{error:P}=await y.from("user_clientes").insert(m);if(P)throw P}l({title:"Usuario atualizado",description:"Perfil e permissoes atualizados com sucesso"})}else{const{data:b,error:s}=await y.from("user_profiles").select("id").eq("email",o.email.toLowerCase()).maybeSingle();if(s)throw s;if(b){l({title:"Usuario ja existe",description:"Ja existe um perfil para este email. Use a opcao de editar.",variant:"destructive"});return}const{data:c,error:m}=await y.from("user_profiles").insert({nome:o.nome,email:o.email.toLowerCase(),user_type:o.user_type,cliente_id:o.user_type==="cliente"?o.cliente_id:null,active:o.active}).select().single();if(m)throw m;if(o.hub_permissions.length>0&&o.user_type!=="admin"){const P=o.hub_permissions.map(W=>({user_id:c.id,hub_code:W,can_access:!0})),{error:q}=await y.from("user_hub_permissions").insert(P);if(q)throw q}if(o.user_type==="operacional"&&o.clientes_vinculados.length>0){const P=o.clientes_vinculados.map(W=>({user_id:c.id,cliente_id:W})),{error:q}=await y.from("user_clientes").insert(P);if(q)throw q}l({title:"Usuario criado",description:"Perfil criado. O usuario precisa fazer cadastro com este email."})}K(),G()}catch(b){l({title:"Erro ao salvar",description:b instanceof Error?b.message:"Erro desconhecido",variant:"destructive"})}finally{A(!1)}},de=async a=>{try{const{error:b}=await y.from("user_profiles").update({active:!a.active}).eq("id",a.id);if(b)throw b;l({title:a.active?"Usuario desativado":"Usuario ativado",description:`${a.nome} foi ${a.active?"desativado":"ativado"}`}),G()}catch(b){l({title:"Erro ao atualizar",description:b instanceof Error?b.message:"Erro desconhecido",variant:"destructive"})}},Q=a=>{switch(a){case"admin":return e.jsx(Y,{className:"bg-primary/10 text-primary border-primary/30",children:"Admin"});case"cliente":return e.jsx(Y,{className:"bg-amber-500/10 text-amber-600 border-amber-500/30",children:"Cliente"});default:return e.jsx(Y,{variant:"outline",className:"text-muted-foreground",children:"Operacional"})}},ce=()=>{C(""),v("todos")};return I?k?e.jsx(ye,{}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[250px]",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Buscar por nome ou email...",value:j,onChange:a=>C(a.target.value),className:"pl-9 h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-emerald-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Tipo"})]}),e.jsx("div",{className:"w-[160px]",children:e.jsxs(te,{value:u,onValueChange:v,children:[e.jsx(oe,{className:"h-9",children:e.jsx(ie,{placeholder:"Tipo"})}),e.jsxs(ne,{children:[e.jsx(V,{value:"todos",children:"Todos"}),e.jsx(V,{value:"admin",children:"Admin"}),e.jsx(V,{value:"operacional",children:"Operacional"}),e.jsx(V,{value:"cliente",children:"Cliente"})]})]})})]}),(j||u!=="todos")&&e.jsxs($,{variant:"outline",size:"sm",onClick:ce,className:"h-9",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Limpar"]}),e.jsxs($,{onClick:()=>H(),className:"h-9 ml-auto",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Novo Usuario"]})]})}),n.length===0?e.jsx(be,{title:"Nenhum usuario encontrado",description:j||u!=="todos"?"Tente ajustar os filtros":"Cadastre o primeiro usuario",action:!(j||u!=="todos")&&e.jsxs($,{onClick:()=>H(),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Novo Usuario"]})}):e.jsxs("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-muted/80 via-muted/60 to-muted/80 border-b border-border",children:e.jsxs("div",{className:"grid grid-cols-[1.5fr_1.5fr_0.8fr_1.5fr_0.6fr_0.6fr] text-[10px] font-semibold text-muted-foreground uppercase tracking-wider",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 rounded-full bg-primary/40"}),"Nome"]}),e.jsx("div",{className:"px-3 py-3",children:"Email"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Tipo"}),e.jsx("div",{className:"px-3 py-3",children:"Acesso"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Ativo"}),e.jsx("div",{className:"px-2 py-3"})]})}),e.jsx("div",{className:"divide-y divide-border/50",children:D.map((a,b)=>e.jsxs("div",{className:`
                  group grid grid-cols-[1.5fr_1.5fr_0.8fr_1.5fr_0.6fr_0.6fr] items-center transition-all duration-150
                  hover:bg-gradient-to-r hover:from-primary/5 hover:via-transparent hover:to-transparent
                  ${b%2===0?"bg-transparent":"bg-muted/20"}
                  ${a.active?"":"opacity-50"}
                `,children:[e.jsxs("div",{className:"px-4 py-3.5 flex items-center gap-3",children:[e.jsx("div",{className:"w-0.5 h-8 rounded-full bg-transparent group-hover:bg-primary transition-colors"}),e.jsx("span",{className:"font-medium text-sm truncate group-hover:text-primary transition-colors",children:a.nome||"-"})]}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:a.email}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:Q(a.user_type)}),e.jsx("div",{className:"px-3 py-3.5",children:a.user_type==="admin"?e.jsx("span",{className:"text-primary text-xs font-medium",children:"Acesso total"}):a.user_type==="operacional"&&a.clientes_vinculados.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.clientes_vinculados.slice(0,2).map(s=>{var m;const c=d.find(P=>P.id===s);return e.jsx(Y,{className:"text-[10px] px-1.5 py-0 bg-amber-500/10 text-amber-600 border-amber-500/30",children:((m=c==null?void 0:c.nome)==null?void 0:m.substring(0,10))||s.substring(0,8)},s)}),a.clientes_vinculados.length>2&&e.jsxs(Y,{variant:"outline",className:"text-[10px] px-1.5 py-0",children:["+",a.clientes_vinculados.length-2]})]}):a.hub_permissions.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.hub_permissions.slice(0,3).map(s=>e.jsx(Y,{variant:"outline",className:"text-[10px] px-1.5 py-0",children:s},s)),a.hub_permissions.length>3&&e.jsxs(Y,{variant:"outline",className:"text-[10px] px-1.5 py-0",children:["+",a.hub_permissions.length-3]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"Nenhum"})}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:e.jsx(me,{checked:a.active,onCheckedChange:()=>de(a)})}),e.jsx("div",{className:"px-2 py-3.5 flex justify-center",children:e.jsx($,{variant:"ghost",size:"sm",onClick:()=>H(a),className:"h-8 w-8 p-0",children:e.jsx(Xe,{className:"w-4 h-4"})})})]},a.id))}),g>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-muted/30 via-transparent to-muted/30 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[(z-1)*ge+1,"-",Math.min(z*ge,n.length)]})," ","de"," ",e.jsx("span",{className:"font-medium text-foreground",children:n.length})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>R(a=>Math.max(1,a-1)),disabled:z===1,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-0.5 mx-2",children:Array.from({length:Math.min(5,g)},(a,b)=>{let s;return g<=5||z<=3?s=b+1:z>=g-2?s=g-4+b:s=z-2+b,e.jsx("button",{onClick:()=>R(s),className:`
                          w-8 h-8 text-xs font-medium rounded-md transition-all
                          ${z===s?"bg-primary/15 text-primary shadow-sm":"text-muted-foreground hover:bg-muted hover:text-foreground"}
                        `,children:s},s)})}),e.jsx("button",{onClick:()=>R(a=>Math.min(g,a+1)),disabled:z===g,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Proximo"})]})]})]}),e.jsx(we,{open:_,onOpenChange:S,children:e.jsxs(Ce,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(_e,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary"}),f?"Editar Usuario":"Novo Usuario"]}),e.jsx(Pe,{children:f?`Editando ${f.nome||f.email}`:"Preencha os dados do novo usuario"})]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"nome",children:"Nome *"}),e.jsx(O,{id:"nome",value:o.nome,onChange:a=>U({...o,nome:a.target.value}),placeholder:"Nome completo",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"email",children:"Email *"}),e.jsx(O,{id:"email",type:"email",value:o.email,onChange:a=>U({...o,email:a.target.value}),placeholder:"email@exemplo.com",required:!0,disabled:!!f}),!f&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"O usuario precisara fazer cadastro com este email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"user_type",children:"Tipo de Usuario *"}),e.jsxs(te,{value:o.user_type,onValueChange:a=>U({...o,user_type:a}),children:[e.jsx(oe,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(V,{value:"admin",children:"Admin (acesso total)"}),e.jsx(V,{value:"operacional",children:"Operacional"}),e.jsx(V,{value:"cliente",children:"Cliente"})]})]})]}),o.user_type==="cliente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"cliente_id",children:"Cliente Vinculado *"}),e.jsxs(te,{value:o.cliente_id,onValueChange:a=>U({...o,cliente_id:a}),children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Selecione o cliente"})}),e.jsx(ne,{children:d.map(a=>e.jsx(V,{value:a.id,children:a.nome},a.id))})]})]}),o.user_type==="operacional"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Clientes Vinculados"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Selecione os clientes que este operacional tera acesso"}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto border rounded-lg p-3 space-y-2",children:d.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-2",children:"Nenhum cliente cadastrado"}):d.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{id:`cliente-${a.id}`,checked:o.clientes_vinculados.includes(a.id),onCheckedChange:()=>J(a.id)}),e.jsx("label",{htmlFor:`cliente-${a.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:a.nome})]},a.id))}),o.clientes_vinculados.length===0&&e.jsx("p",{className:"text-xs text-amber-600",children:"Sem clientes vinculados, o operacional nao vera dados na dashboard"}),o.clientes_vinculados.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[o.clientes_vinculados.length," cliente(s) selecionado(s)"]})]}),o.user_type!=="admin"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Permissoes de Acesso"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 p-3 border rounded-lg",children:T.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{id:`hub-${a.code}`,checked:o.hub_permissions.includes(a.code),onCheckedChange:()=>ee(a.code)}),e.jsx("label",{htmlFor:`hub-${a.code}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:a.name})]},a.id))}),o.hub_permissions.length===0&&e.jsx("p",{className:"text-xs text-amber-600",children:"Sem permissoes, o usuario nao tera acesso a nenhum hub"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{id:"active",checked:o.active,onCheckedChange:a=>U({...o,active:a})}),e.jsx(F,{htmlFor:"active",children:"Usuario ativo"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx($,{type:"submit",className:"flex-1",disabled:i,children:i?"Salvando...":f?"Salvar":"Criar Usuario"}),e.jsx($,{type:"button",variant:"outline",onClick:K,disabled:i,children:"Cancelar"})]})]})]})})]}):e.jsx(be,{title:"Acesso negado",description:"Apenas administradores podem acessar esta area."})}function Ms(){const{toast:l}=Se(),[w,k]=t.useState(!0),[L,p]=t.useState(!1),[x,T]=t.useState([]),[M,d]=t.useState(!1),[E,j]=t.useState(null),[C,u]=t.useState("doadora"),[v,_]=t.useState(""),[S,f]=t.useState(""),[N,i]=t.useState(!1),[A,z]=t.useState(""),[R,o]=t.useState(""),[U,I]=t.useState(!1),[G,n]=t.useState(!0),[g,D]=t.useState("0"),[H,K]=t.useState([]),[ee,J]=t.useState([]),[B,de]=t.useState(""),Q=t.useCallback(async()=>{try{k(!0);const{data:r,error:h}=await y.from("catalogo_genetica").select("*").order("ordem").order("created_at",{ascending:!1});if(h)throw h;const ue=await Promise.all((r||[]).map(async X=>{if(X.tipo==="doadora"&&X.doadora_id){const{data:xe}=await y.from("doadoras").select("nome, registro, raca").eq("id",X.doadora_id).single();return{...X,...xe}}else if(X.tipo==="touro"&&X.touro_id){const{data:xe}=await y.from("touros").select("nome, registro, raca").eq("id",X.touro_id).single();return{...X,...xe}}return X}));T(ue)}catch(r){console.error("[AdminCatalogoTab] Erro ao carregar:",r),l({title:"Erro ao carregar catlogo",description:r instanceof Error?r.message:"Erro desconhecido",variant:"destructive"})}finally{k(!1)}},[l]),ce=t.useCallback(async()=>{try{const{data:r}=await y.from("doadoras").select("id, nome, registro, raca").order("nome");K(r||[]);const{data:h}=await y.from("touros").select("id, nome, registro, raca").order("nome");J(h||[])}catch(r){console.error("[AdminCatalogoTab] Erro ao carregar animais:",r)}},[]);t.useEffect(()=>{Q(),ce()},[Q,ce]);const a=()=>{u("doadora"),_(""),f(""),i(!1),z(""),o(""),I(!1),n(!0),D("0"),de(""),j(null)},b=()=>{a(),d(!0)},s=r=>{var h;j(r),u(r.tipo),_(r.tipo==="doadora"?r.doadora_id||"":r.touro_id||""),f(((h=r.preco)==null?void 0:h.toString())||""),i(r.preco_negociavel),z(r.descricao||""),o(r.foto_principal||""),I(r.destaque),n(r.ativo),D(r.ordem.toString()),d(!0)},c=async()=>{if(!v){l({title:"Erro",description:"Selecione um animal",variant:"destructive"});return}try{p(!0);const r={tipo:C,doadora_id:C==="doadora"?v:null,touro_id:C==="touro"?v:null,preco:S?parseFloat(S):null,preco_negociavel:N,descricao:A||null,foto_principal:R||null,destaque:U,ativo:G,ordem:parseInt(g)||0};if(E){const{error:h}=await y.from("catalogo_genetica").update(r).eq("id",E.id);if(h)throw h;l({title:"Item atualizado com sucesso"})}else{const{error:h}=await y.from("catalogo_genetica").insert(r);if(h)throw h;l({title:"Item adicionado ao catlogo"})}d(!1),a(),Q()}catch(r){console.error("[AdminCatalogoTab] Erro ao salvar:",r),l({title:"Erro ao salvar",description:r instanceof Error?r.message:"Erro desconhecido",variant:"destructive"})}finally{p(!1)}},m=async r=>{if(confirm(`Remover "${r.nome||r.registro}" do catlogo?`))try{const{error:h}=await y.from("catalogo_genetica").delete().eq("id",r.id);if(h)throw h;l({title:"Item removido do catlogo"}),Q()}catch(h){console.error("[AdminCatalogoTab] Erro ao deletar:",h),l({title:"Erro ao remover",description:h instanceof Error?h.message:"Erro desconhecido",variant:"destructive"})}},P=async r=>{try{const{error:h}=await y.from("catalogo_genetica").update({destaque:!r.destaque}).eq("id",r.id);if(h)throw h;Q()}catch(h){console.error("[AdminCatalogoTab] Erro ao atualizar destaque:",h)}},q=async r=>{try{const{error:h}=await y.from("catalogo_genetica").update({ativo:!r.ativo}).eq("id",r.id);if(h)throw h;Q()}catch(h){console.error("[AdminCatalogoTab] Erro ao atualizar status:",h)}},W=C==="doadora"?H.filter(r=>{var h;return!B||((h=r.nome)==null?void 0:h.toLowerCase().includes(B.toLowerCase()))||r.registro.toLowerCase().includes(B.toLowerCase())}):ee.filter(r=>{var h;return!B||((h=r.nome)==null?void 0:h.toLowerCase().includes(B.toLowerCase()))||r.registro.toLowerCase().includes(B.toLowerCase())});return w?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((r,h)=>e.jsx(Cs,{className:"h-16 rounded-xl"},h))}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Catlogo Gentico"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerencie os animais disponveis para venda na vitrine"})]}),e.jsxs($,{onClick:b,className:"bg-primary hover:bg-primary/90",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Adicionar ao Catlogo"]})]}),x.length>0?e.jsxs("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-muted/80 via-muted/60 to-muted/80 border-b border-border",children:e.jsxs("div",{className:"grid grid-cols-[2fr_1fr_1fr_0.8fr_0.8fr_0.6fr] text-[10px] font-semibold text-muted-foreground uppercase tracking-wider",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 rounded-full bg-primary/40"}),"Animal"]}),e.jsx("div",{className:"px-3 py-3",children:"Raa"}),e.jsx("div",{className:"px-3 py-3 text-right",children:"Preo"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Destaque"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Ativo"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Aes"})]})}),e.jsx("div",{className:"divide-y divide-border/50",children:x.map((r,h)=>e.jsxs("div",{className:`group grid grid-cols-[2fr_1fr_1fr_0.8fr_0.8fr_0.6fr] items-center transition-all duration-150 hover:bg-gradient-to-r hover:from-primary/5 hover:via-transparent hover:to-transparent ${h%2===0?"bg-transparent":"bg-muted/20"}`,children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-0.5 h-8 rounded-full bg-transparent group-hover:bg-primary transition-colors"}),e.jsxs(Y,{variant:"outline",className:r.tipo==="doadora"?"text-pink-600 border-pink-500/30":"text-blue-600 border-blue-500/30",children:[e.jsx(ms,{className:"w-3 h-3 mr-1"}),r.tipo==="doadora"?"Doadora":"Touro"]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate group-hover:text-primary transition-colors",children:r.nome||r.registro}),r.nome&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:r.registro})]})]}),e.jsx("div",{className:"px-3 py-3",children:r.raca&&e.jsxs(Y,{variant:"outline",className:"text-xs",children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),r.raca]})}),e.jsx("div",{className:"px-3 py-3 text-right",children:r.preco?e.jsx("span",{className:"font-medium text-primary",children:r.preco.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"Consultar"})}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:e.jsx("button",{onClick:()=>P(r),className:`p-1.5 rounded-md transition-colors ${r.destaque?"bg-amber-500/20 text-amber-500":"bg-muted text-muted-foreground hover:text-amber-500"}`,children:e.jsx(Oe,{className:`w-4 h-4 ${r.destaque?"fill-current":""}`})})}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:e.jsx(me,{checked:r.ativo,onCheckedChange:()=>q(r)})}),e.jsxs("div",{className:"px-3 py-3 flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>s(r),className:"p-1.5 rounded-md bg-transparent hover:bg-primary/10 text-muted-foreground hover:text-primary transition-colors",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>m(r),className:"p-1.5 rounded-md bg-transparent hover:bg-red-500/10 text-muted-foreground hover:text-red-500 transition-colors",children:e.jsx(_s,{className:"w-4 h-4"})})]})]},r.id))})]}):e.jsx("div",{className:"rounded-xl border border-dashed border-border p-12",children:e.jsx(be,{title:"Catlogo vazio",description:"Adicione doadoras e touros ao catlogo para exibi-los na vitrine de gentica"})}),e.jsx(we,{open:M,onOpenChange:d,children:e.jsxs(Ce,{className:"max-w-lg",children:[e.jsx(_e,{children:e.jsx(ke,{children:E?"Editar Item do Catlogo":"Adicionar ao Catlogo"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Tipo"}),e.jsxs(te,{value:C,onValueChange:r=>{u(r),_("")},disabled:!!E,children:[e.jsx(oe,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(V,{value:"doadora",children:"Doadora"}),e.jsx(V,{value:"touro",children:"Touro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Animal"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Buscar por nome ou registro...",value:B,onChange:r=>de(r.target.value),className:"pl-9",disabled:!!E})]}),e.jsxs(te,{value:v,onValueChange:_,disabled:!!E,children:[e.jsx(oe,{children:e.jsx(ie,{placeholder:"Selecione o animal"})}),e.jsx(ne,{className:"max-h-60",children:W.map(r=>e.jsxs(V,{value:r.id,children:[r.nome||r.registro," ",r.nome&&`(${r.registro})`]},r.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Preo (R$)"}),e.jsx(O,{type:"number",placeholder:"0,00",value:S,onChange:r=>f(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Ordem"}),e.jsx(O,{type:"number",value:g,onChange:r=>D(r.target.value)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{checked:N,onCheckedChange:i}),e.jsx(F,{children:"Preo negocivel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"URL da foto principal (opcional)"}),e.jsx(O,{placeholder:"https://...",value:R,onChange:r=>o(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Descrio para o catlogo (opcional)"}),e.jsx(Ke,{placeholder:"Descrio comercial do animal...",value:A,onChange:r=>z(r.target.value),rows:3})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{checked:U,onCheckedChange:I}),e.jsxs(F,{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-4 h-4 text-amber-500"}),"Destaque"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{checked:G,onCheckedChange:n}),e.jsx(F,{children:"Ativo no catlogo"})]})]})]}),e.jsxs(ps,{children:[e.jsx($,{variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsxs($,{onClick:c,disabled:L,children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),L?"Salvando...":"Salvar"]})]})]})})]})}const Us=[{value:"visao-geral",label:"Visao Geral",icon:Ss},{value:"clientes",label:"Clientes",icon:je},{value:"fazendas",label:"Fazendas",icon:De},{value:"catalogo",label:"Catalogo",icon:Ve,adminOnly:!0},{value:"usuarios",label:"Usuarios",icon:Ne,adminOnly:!0}];function pa(){const[l,w]=us(),{isAdmin:k}=$e(),L=l.get("tab")||"visao-geral",[p,x]=t.useState(L),T=Us.filter(d=>!d.adminOnly||k);t.useEffect(()=>{l.get("tab")!==p&&w({tab:p},{replace:!0})},[p,l,w]),t.useEffect(()=>{l.get("tab")==="usuarios"&&!k&&x("visao-geral")},[l,k]);const M=d=>{x(d)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(xs,{title:"Painel Administrativo",description:"Gerencie clientes, fazendas e usuarios do sistema"}),e.jsx("div",{className:"rounded-xl border border-border bg-card p-1.5",children:e.jsx("div",{className:"flex gap-1",children:T.map(({value:d,label:E,icon:j})=>{const C=p===d;return e.jsxs("button",{onClick:()=>M(d),className:`
                  relative flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg
                  text-sm font-medium transition-all duration-200
                  ${C?"bg-muted/80 text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-muted/40"}
                `,children:[C&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-10 h-0.5 bg-primary rounded-full"}),e.jsx("div",{className:`
                  flex items-center justify-center w-7 h-7 rounded-md transition-colors
                  ${C?"bg-primary/15":"bg-muted/50"}
                `,children:e.jsx(j,{className:`w-4 h-4 ${C?"text-primary":"text-muted-foreground"}`})}),e.jsx("span",{className:"hidden sm:inline",children:E})]},d)})})}),p==="visao-geral"&&e.jsx(Es,{onNavigateToTab:M}),p==="clientes"&&e.jsx(As,{}),p==="fazendas"&&e.jsx(Fs,{}),p==="catalogo"&&k&&e.jsx(Ms,{}),p==="usuarios"&&k&&e.jsx(Ts,{})]})}export{pa as default};
