import{c as Me,r as n,s as L,j as e,B as T,n as Da,x as ya,y as Ea,z as Ps,A as Is,E as We,t as $e,m as I,P as Se,G as ks,I as As,J as zs,K as Ts,N as Os,q as Ma,g as ve,k as aa,h as Fs}from"./index-6OJhfjKP.js";import{S as ra,a as na,b as ia,c as ca,d as ge,f as Bs,u as Ls,C as $s,e as Gs}from"./select-B7v4ZPbC.js";import{L as be}from"./label-BTrzYRkl.js";import{P as Ks}from"./PageHeader-P7sO2uqv.js";import{E as Us}from"./EmptyState-CEfkJzHC.js";import{u as Sa}from"./use-toast-DasFaehQ.js";import{h as qs}from"./error-handler-CXUXfXq4.js";import{u as Vs,e as Hs}from"./hooks-C-EbYPHQ.js";import{d as Xs,t as Ys,f as Ws}from"./dateUtils-eJ5e6apA.js";import{P as Js,h as Zs,b as Qs,R as et,F as at,u as st,a as ga}from"./index-CtR1jODk.js";import{c as Ra,I as tt,R as ot}from"./index-ea8B15na.js";import{a as Pa,C as rt}from"./chevron-right-BdMx8zjt.js";import{C as sa}from"./check-CgmfRmMI.js";import{C as nt,a as it,d as ct}from"./card-D-gf0lmS.js";import{B as Ee}from"./badge-ChTtRB_d.js";import{S as lt}from"./StatusBadge-BqOiwe1r.js";import{S as va}from"./star-Jbk2qlDA.js";import{T as ta}from"./sheet-Cx1WcZpC.js";import{T as Ia}from"./trash-2-C555fPdQ.js";import{C as dt,D as ka}from"./DatePickerBR-CEQaSWUC.js";import{M as ut}from"./map-pin-CuMBtep0.js";import{T as _a}from"./triangle-alert-pkIeF1ja.js";import{P as ft}from"./package-Ci8DGI0W.js";import{X as mt}from"./x-kO07YPaG.js";import{D as Ge,b as Ke,c as Ue,d as qe,e as Je,f as pt}from"./dialog-CFjhGf-B.js";import{I as ht}from"./input-_UHZ9n1P.js";import{T as xt}from"./textarea-DMqLWH95.js";import"./statusLabels-IklKT8dE.js";import"./popover-CUxnE3Xp.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=Me("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=Me("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=Me("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=Me("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=Me("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=Me("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),Aa="embrioes_filtros",ba=20,wt=()=>{try{const a=localStorage.getItem(Aa);return a?JSON.parse(a):{}}catch{return{}}},Ct=a=>a?Xs(a,Ys()):null;function jt(){const a=n.useMemo(()=>wt(),[]),[t,s]=n.useState([]),[o,i]=n.useState([]),[r,d]=n.useState(!1),{data:u=[],refetch:h}=Vs(),{data:C=[],refetch:v}=Hs(),[f,w]=n.useState(a.selectedFazendaDestinoId??""),[E,b]=n.useState(a.paginasPacotes??{}),[M,R]=n.useState({});n.useEffect(()=>{const p={selectedFazendaDestinoId:f,paginasPacotes:E};localStorage.setItem(Aa,JSON.stringify(p))},[f,E]),n.useEffect(()=>{b(p=>{let N=!1;const D={...p};return o.forEach(z=>{const O=Math.max(1,Math.ceil(z.embrioes.length/ba));if(!D[z.id]){D[z.id]=1,N=!0;return}D[z.id]>O&&(D[z.id]=O,N=!0)}),N?D:p})},[o]);const $=n.useCallback(p=>(M[p.id]??p.classificacao??"").trim(),[M]),P=n.useCallback(p=>{const N={BE:0,BN:0,BX:0,BL:0,BI:0};let D=0;return p.embrioes.forEach(z=>{const O=$(z).toUpperCase();if(!O){D+=1;return}O==="BE"?N.BE+=1:O==="BN"?N.BN+=1:O==="BX"?N.BX+=1:O==="BL"?N.BL+=1:O==="BI"&&(N.BI+=1)}),{semClassificacao:D,classificados:N,total:p.total,todosClassificados:p.total>0&&D===0}},[$]),k=n.useCallback(async()=>{await h()},[h]),Y=n.useCallback(async()=>{await v()},[v]),_=n.useCallback(async()=>{try{d(!0);const{data:p,error:N}=await L.from("embrioes").select("*").in("status_atual",["FRESCO","CONGELADO"]).is("cliente_id",null).order("created_at",{ascending:!1});if(N)throw N;if(!p||p.length===0){s([]),i([]),d(!1);return}const D=[...new Set(p.filter(c=>c.lote_fiv_acasalamento_id).map(c=>c.lote_fiv_acasalamento_id))],z=[...new Set(p.filter(c=>c.lote_fiv_id).map(c=>c.lote_fiv_id))],O=[...new Set(p.filter(c=>c.fazenda_destino_id).map(c=>c.fazenda_destino_id))];if(D.length===0){s(p),i([]),d(!1);return}const[H,he]=await Promise.all([L.from("lote_fiv_acasalamentos").select("id, aspiracao_doadora_id, dose_semen_id").in("id",D),z.length>0?L.from("lotes_fiv").select("id, pacote_aspiracao_id, data_fecundacao, disponivel_para_transferencia").in("id",z):Promise.resolve({data:null,error:null})]);if(H.error)throw H.error;const Q=H.data||[],ee=he.data||[],ne=[...new Set(Q.map(c=>c.aspiracao_doadora_id))],xe=[...new Set(Q.map(c=>c.dose_semen_id))],X=[...new Set(ee.map(c=>c.pacote_aspiracao_id).filter(Boolean))],g=new Map,F=new Map,G=new Map;ee.forEach(c=>{c.pacote_aspiracao_id&&g.set(c.id,c.pacote_aspiracao_id),c.data_fecundacao&&F.set(c.id,c.data_fecundacao),G.set(c.id,c.disponivel_para_transferencia===!0)});const[V,ie,de]=await Promise.all([ne.length>0?L.from("aspiracoes_doadoras").select("id, doadora_id, pacote_aspiracao_id").in("id",ne):Promise.resolve({data:null,error:null}),xe.length>0?L.from("doses_semen").select("id, touro_id, touro:touros(id, nome, registro, raca)").in("id",xe):Promise.resolve({data:null,error:null}),X.length>0?L.from("pacotes_aspiracao").select("id, data_aspiracao, fazenda_id, fazenda_destino_id, horario_inicio, veterinario_responsavel, total_oocitos").in("id",X):Promise.resolve({data:null,error:null})]);if(V.error)throw V.error;if(ie.error)throw ie.error;const J=V.data||[],oe=ie.data||[],Z=de.data||[],K=[...new Set(J.map(c=>c.doadora_id))],U=new Set(O);Z.forEach(c=>{c.fazenda_id&&U.add(c.fazenda_id),c.fazenda_destino_id&&U.add(c.fazenda_destino_id)});const[ue,ce,Re]=await Promise.all([K.length>0?L.from("doadoras").select("id, registro").in("id",K):Promise.resolve({data:null,error:null}),U.size>0?L.from("fazendas").select("id, nome").in("id",Array.from(U)):Promise.resolve({data:null,error:null}),X.length>0?L.from("pacotes_aspiracao_fazendas_destino").select("pacote_aspiracao_id, fazenda_destino_id").in("pacote_aspiracao_id",X):Promise.resolve({data:null,error:null})]);if(ue.error)throw ue.error;const fe=ue.data||[],me=ce.data||[],Pe=Re.data||[],_e=new Map(me.map(c=>[c.id,c.nome])),pe=new Map;Pe.forEach(c=>{const q=pe.get(c.pacote_aspiracao_id)||[];q.includes(c.fazenda_destino_id)||q.push(c.fazenda_destino_id),pe.set(c.pacote_aspiracao_id,q)}),Z.forEach(c=>{if(c.fazenda_destino_id){const q=pe.get(c.id)||[];q.includes(c.fazenda_destino_id)||q.push(c.fazenda_destino_id),pe.set(c.id,q)}});const we=new Map;J.forEach(c=>{c.pacote_aspiracao_id&&we.set(c.pacote_aspiracao_id,(we.get(c.pacote_aspiracao_id)||0)+1)});const Ce=new Map;Z.forEach(c=>{Ce.set(c.id,{id:c.id,data_aspiracao:c.data_aspiracao,fazenda_nome:_e.get(c.fazenda_id),quantidade_doadoras:we.get(c.id)||0,horario_inicio:c.horario_inicio,veterinario_responsavel:c.veterinario_responsavel,total_oocitos:c.total_oocitos})});const Ie=new Map(J.map(c=>[c.id,c])),j=new Map(fe.map(c=>[c.id,c])),y=new Map(oe.map(c=>[c.id,c])),l=new Map(Q.map(c=>[c.id,c])),m=p.map(c=>{var te;const q=c.lote_fiv_acasalamento_id?l.get(c.lote_fiv_acasalamento_id):void 0,le=q?Ie.get(q.aspiracao_doadora_id):void 0,se=le?j.get(le.doadora_id):void 0,Ae=q?y.get(q.dose_semen_id):void 0,ye=c.lote_fiv_id?g.get(c.lote_fiv_id):void 0,ze=ye?Ce.get(ye):void 0;return{...c,doadora_registro:se==null?void 0:se.registro,touro_nome:(te=Ae==null?void 0:Ae.touro)==null?void 0:te.nome,fazenda_destino_nome:c.fazenda_destino_id?_e.get(c.fazenda_destino_id):void 0,data_aspiracao:ze==null?void 0:ze.data_aspiracao,pacote_aspiracao_id:ye}}),x=new Map;m.forEach(c=>{var xa;if(!c.lote_fiv_id)return;const q=((xa=c.created_at)==null?void 0:xa.split("T")[0])||"",le=`${c.lote_fiv_id}_${q}`,se=c.lote_fiv_id?g.get(c.lote_fiv_id):void 0,Ae=se?Ce.get(se):void 0,ye=se?pe.get(se)||[]:[],ze=ye.map(je=>_e.get(je)||"N/A");x.has(le)||x.set(le,{id:le,lote_fiv_id:c.lote_fiv_id,data_despacho:q,data_fecundacao:c.lote_fiv_id?F.get(c.lote_fiv_id):void 0,fazendas_destino_ids:ye,fazendas_destino_nomes:ze,pacote_info:Ae||{id:se||"",data_aspiracao:"",quantidade_doadoras:0},embrioes:[],total:0,frescos:0,congelados:0,sem_classificacao:0,classificados:{BE:0,BN:0,BX:0,BL:0,BI:0}});const te=x.get(le);if(te.embrioes.push(c),te.total++,c.status_atual==="FRESCO"&&te.frescos++,c.status_atual==="CONGELADO"&&te.congelados++,!c.classificacao)te.sem_classificacao++;else{const je=c.classificacao.toUpperCase();je==="BE"?te.classificados.BE++:je==="BN"?te.classificados.BN++:je==="BX"?te.classificados.BX++:je==="BL"?te.classificados.BL++:je==="BI"&&te.classificados.BI++}});const S=(f?Array.from(x.values()).filter(c=>c.fazendas_destino_ids.includes(f)):Array.from(x.values())).sort((c,q)=>{const le=new Date(c.data_despacho).getTime();return new Date(q.data_despacho).getTime()-le});S.forEach(c=>{c.todos_classificados=c.total>0&&c.sem_classificacao===0,c.disponivel_para_transferencia=G.get(c.lote_fiv_id)===!0});const ae=new Set(S.map(c=>c.id)),ke=m.filter(c=>{var se;if(!c.lote_fiv_id)return!1;const q=((se=c.created_at)==null?void 0:se.split("T")[0])||"",le=`${c.lote_fiv_id}_${q}`;return ae.has(le)});s(ke),i(S)}catch(p){qs(p,"Erro ao carregar embriões")}finally{d(!1)}},[f]),A=n.useCallback(async()=>{await _()},[_]);return{embrioes:t,pacotes:o,fazendas:u,clientes:C,loading:r,selectedFazendaDestinoId:f,setSelectedFazendaDestinoId:w,paginasPacotes:E,setPaginasPacotes:b,pageSize:ba,loadData:_,loadFazendas:k,loadClientes:Y,reloadData:A,getClassificacaoAtual:$,getResumoPacote:P,classificacoesPendentes:M,setClassificacoesPendentes:R}}const Te=async(a,t,s,o,i,r)=>{try{await L.from("historico_embrioes").insert([{embriao_id:a,status_anterior:t,status_novo:s,tipo_operacao:o,fazenda_id:i||null,observacoes:r||null,data_mudanca:new Date().toISOString()}])}catch{}};function bt({embrioes:a,pacotes:t,classificacoesPendentes:s,setClassificacoesPendentes:o,onSuccess:i}){const{toast:r}=Sa(),d=new Date().toISOString().split("T")[0],[u,h]=n.useState(new Set),[C,v]=n.useState(!1),[f,w]=n.useState(!1),[E,b]=n.useState(!1),[M,R]=n.useState(!1),[$,P]=n.useState(!1),[k,Y]=n.useState(!1),[_,A]=n.useState(!1),[p,N]=n.useState({data_congelamento:d,localizacao_atual:"",cliente_id:""}),[D,z]=n.useState({data_descarte:d,observacoes:""}),[O,H]=n.useState({cliente_id:""}),[he,Q]=n.useState(null),[ee,ne]=n.useState(null),[xe,X]=n.useState(null),[g,F]=n.useState(null),[G,V]=n.useState([]),[ie,de]=n.useState([]),[J,oe]=n.useState(!1),[Z,K]=n.useState(!1),U=n.useCallback(j=>{h(y=>{const l=new Set(y);return l.has(j)?l.delete(j):l.add(j),l})},[]),ue=n.useCallback(j=>{const y=t.find(x=>x.id===j);if(!y)return;const l=y.embrioes.filter(x=>x.status_atual==="FRESCO").map(x=>x.id),m=l.every(x=>u.has(x));h(x=>{const B=new Set(x);return m?l.forEach(S=>B.delete(S)):l.forEach(S=>B.add(S)),B})},[t,u]),ce=n.useCallback(()=>{h(new Set),v(!1)},[]),Re=n.useCallback(j=>u.has(j),[u]),fe=n.useCallback(async j=>{try{oe(!0);const{data:y,error:l}=await L.from("historico_embrioes").select("*, fazenda:fazendas(nome)").eq("embriao_id",j).order("data_mudanca",{ascending:!1});if(l)throw l;de(y||[])}catch(y){r({title:"Erro ao carregar histórico",description:y instanceof Error?y.message:"Erro desconhecido",variant:"destructive"})}finally{oe(!1)}},[r]),me=n.useCallback(async()=>{if(u.size===0){r({title:"Nenhum embrião selecionado",description:"Selecione pelo menos um embrião para congelar.",variant:"destructive"});return}const j=Array.from(u),l=a.filter(m=>j.includes(m.id)).filter(m=>!m.classificacao||m.classificacao.trim()==="");if(l.length>0){r({title:"Classificação obrigatória",description:`${l.length} embrião(ões) não possui(em) classificação. Classifique antes de congelar.`,variant:"destructive"});return}if(!p.localizacao_atual.trim()){r({title:"Localização obrigatória",description:"Informe a localização de armazenamento.",variant:"destructive"});return}if(!p.cliente_id){r({title:"Cliente obrigatório",description:"Selecione o cliente dono do embrião.",variant:"destructive"});return}try{K(!0);const{error:m}=await L.from("embrioes").update({status_atual:"CONGELADO",data_congelamento:p.data_congelamento,localizacao_atual:p.localizacao_atual.trim(),cliente_id:p.cliente_id}).in("id",j);if(m)throw m;for(const x of j){const B=a.find(S=>S.id===x);await Te(x,(B==null?void 0:B.status_atual)||null,"CONGELADO","CONGELAMENTO",null,`Congelado em ${p.localizacao_atual.trim()}`)}r({title:"Embriões congelados",description:`${j.length} embrião(ões) congelado(s) com sucesso.`}),w(!1),ce(),N({data_congelamento:d,localizacao_atual:"",cliente_id:""}),await i()}catch(m){r({title:"Erro ao congelar embriões",description:m instanceof Error?m.message:"Erro desconhecido",variant:"destructive"})}finally{K(!1)}},[u,p,a,d,r,ce,i]),Pe=n.useCallback(async()=>{if(u.size===0){r({title:"Nenhum embrião selecionado",description:"Selecione pelo menos um embrião para descartar.",variant:"destructive"});return}try{K(!0);const j=Array.from(u),{error:y}=await L.from("embrioes").update({status_atual:"DESCARTADO",data_descarte:D.data_descarte,observacoes:D.observacoes.trim()||null}).in("id",j);if(y)throw y;for(const l of j){const m=a.find(x=>x.id===l);await Te(l,(m==null?void 0:m.status_atual)||null,"DESCARTADO","DESCARTE",null,D.observacoes.trim()||null)}r({title:"Embriões descartados",description:`${j.length} embrião(ões) descartado(s).`}),b(!1),ce(),z({data_descarte:d,observacoes:""}),await i()}catch(j){r({title:"Erro ao descartar embriões",description:j instanceof Error?j.message:"Erro desconhecido",variant:"destructive"})}finally{K(!1)}},[u,D,a,d,r,ce,i]),_e=n.useCallback(async j=>{if(u.size===0){r({title:"Nenhum embrião selecionado",description:"Selecione pelo menos um embrião.",variant:"destructive"});return}if(!O.cliente_id){r({title:"Cliente não selecionado",description:"Selecione o cliente de destino.",variant:"destructive"});return}try{K(!0);const y=Array.from(u),{error:l}=await L.from("embrioes").update({cliente_id:O.cliente_id}).in("id",y);if(l)throw l;const m=j.find(x=>x.id===O.cliente_id);for(const x of y)await Te(x,null,"DIRECIONADO","DESTINACAO",null,`Direcionado para cliente: ${(m==null?void 0:m.nome)||"N/A"}`);r({title:"Embriões direcionados",description:`${y.length} embrião(ões) direcionado(s) para ${(m==null?void 0:m.nome)||"cliente"}.`}),P(!1),ce(),H({cliente_id:""}),await i()}catch(y){r({title:"Erro ao direcionar embriões",description:y instanceof Error?y.message:"Erro desconhecido",variant:"destructive"})}finally{K(!1)}},[u,O,r,ce,i]),pe=n.useCallback(async()=>{const j=Object.entries(s);if(j.length===0){r({title:"Nenhuma classificação pendente",description:"Não há classificações para salvar."});return}try{K(!0);for(const[y,l]of j){const{error:m}=await L.from("embrioes").update({classificacao:l.toUpperCase()}).eq("id",y);if(m)throw m;await Te(y,null,l.toUpperCase(),"CLASSIFICACAO",null,`Classificado como ${l.toUpperCase()}`)}r({title:"Classificações salvas",description:`${j.length} embrião(ões) classificado(s).`}),o({}),await i()}catch(y){r({title:"Erro ao salvar classificações",description:y instanceof Error?y.message:"Erro desconhecido",variant:"destructive"})}finally{K(!1)}},[s,o,r,i]),we=n.useCallback(async()=>{R(!1),Q(null)},[]),Ce=n.useCallback(async()=>{if(ee)try{K(!0);const{error:j}=await L.from("embrioes").update({status_atual:"DESCARTADO",data_descarte:D.data_descarte,observacoes:D.observacoes.trim()||null}).eq("id",ee.id);if(j)throw j;await Te(ee.id,ee.status_atual,"DESCARTADO","DESCARTE",null,D.observacoes.trim()||null),r({title:"Embrião descartado",description:"Embrião descartado com sucesso."}),b(!1),ne(null),z({data_descarte:d,observacoes:""}),await i()}catch(j){r({title:"Erro ao descartar embrião",description:j instanceof Error?j.message:"Erro desconhecido",variant:"destructive"})}finally{K(!1)}},[ee,D,d,r,i]),Ie=n.useCallback(async()=>{if(g)try{if(K(!0),await L.from("pacotes_aspiracao_fazendas_destino").delete().eq("pacote_aspiracao_id",g.pacote_info.id),G.length>0){const j=G.map(l=>({pacote_aspiracao_id:g.pacote_info.id,fazenda_destino_id:l})),{error:y}=await L.from("pacotes_aspiracao_fazendas_destino").insert(j);if(y)throw y}r({title:"Fazendas destino atualizadas",description:"As fazendas destino foram atualizadas com sucesso."}),A(!1),F(null),V([]),await i()}catch(j){r({title:"Erro ao salvar fazendas destino",description:j instanceof Error?j.message:"Erro desconhecido",variant:"destructive"})}finally{K(!1)}},[g,G,r,i]);return{embrioesSelecionados:u,setEmbrioesSelecionados:h,showAcoesEmMassa:C,setShowAcoesEmMassa:v,showCongelarDialog:f,setShowCongelarDialog:w,showDescartarDialog:E,setShowDescartarDialog:b,showClassificarDialog:M,setShowClassificarDialog:R,showDirecionarClienteDialog:$,setShowDirecionarClienteDialog:P,showHistoricoDialog:k,setShowHistoricoDialog:Y,showEditarFazendasDestinoDialog:_,setShowEditarFazendasDestinoDialog:A,congelarData:p,setCongelarData:N,descartarData:D,setDescartarData:z,direcionarClienteData:O,setDirecionarClienteData:H,classificarEmbriao:he,setClassificarEmbriao:Q,descartarEmbriao:ee,setDescartarEmbriao:ne,historicoEmbriao:xe,setHistoricoEmbriao:X,pacoteEditandoFazendas:g,setPacoteEditandoFazendas:F,fazendasDestinoSelecionadas:G,setFazendasDestinoSelecionadas:V,historico:ie,loadingHistorico:J,submitting:Z,handleCongelarEmMassa:me,handleDescartarEmMassa:Pe,handleDirecionarClienteEmMassa:_e,handleSalvarClassificacoesPendentes:pe,handleClassificarEmbriao:we,handleDescartarEmbriao:Ce,loadHistorico:fe,handleSalvarFazendasDestino:Ie,toggleEmbriaoSelecionado:U,selecionarTodosPacote:ue,limparSelecao:ce,isEmbriaoSelecionado:Re}}function za({value:a,onChange:t,onSubmit:s,onCancel:o,submitting:i,buttonLabel:r}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Classificação *"}),e.jsxs(ra,{value:a,onValueChange:t,children:[e.jsx(na,{children:e.jsx(ia,{placeholder:"Selecione"})}),e.jsxs(ca,{children:[e.jsx(ge,{value:"BE",children:"BE (Blastocisto Excelente)"}),e.jsx(ge,{value:"BN",children:"BN (Blastocisto Normal)"}),e.jsx(ge,{value:"BX",children:"BX (Blastocisto Regular)"}),e.jsx(ge,{value:"BL",children:"BL (Blastocisto Limitado)"}),e.jsx(ge,{value:"BI",children:"BI (Blastocisto Irregular)"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(T,{onClick:s,className:"flex-1 bg-primary hover:bg-primary-dark",disabled:i,children:i?"Salvando...":r}),e.jsx(T,{variant:"outline",onClick:o,disabled:i,children:"Cancelar"})]})]})}var oa=["Enter"," "],Nt=["ArrowDown","PageUp","Home"],Ta=["ArrowUp","PageDown","End"],Dt=[...Nt,...Ta],yt={ltr:[...oa,"ArrowRight"],rtl:[...oa,"ArrowLeft"]},Et={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ve="Menu",[Be,Mt,St]=Bs(Ve),[Ne,Oa]=Da(Ve,[St,ya,Ra]),Ze=ya(),Fa=Ra(),[Rt,De]=Ne(Ve),[Pt,He]=Ne(Ve),Ba=a=>{const{__scopeMenu:t,open:s=!1,children:o,dir:i,onOpenChange:r,modal:d=!0}=a,u=Ze(t),[h,C]=n.useState(null),v=n.useRef(!1),f=Ea(r),w=Ls(i);return n.useEffect(()=>{const E=()=>{v.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>v.current=!1;return document.addEventListener("keydown",E,{capture:!0}),()=>{document.removeEventListener("keydown",E,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),e.jsx(Ps,{...u,children:e.jsx(Rt,{scope:t,open:s,onOpenChange:f,content:h,onContentChange:C,children:e.jsx(Pt,{scope:t,onClose:n.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:v,dir:w,modal:d,children:o})})})};Ba.displayName=Ve;var It="MenuAnchor",la=n.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a,i=Ze(s);return e.jsx(Is,{...i,...o,ref:t})});la.displayName=It;var da="MenuPortal",[kt,La]=Ne(da,{forceMount:void 0}),$a=a=>{const{__scopeMenu:t,forceMount:s,children:o,container:i}=a,r=De(da,t);return e.jsx(kt,{scope:t,forceMount:s,children:e.jsx(We,{present:s||r.open,children:e.jsx(Js,{asChild:!0,container:i,children:o})})})};$a.displayName=da;var re="MenuContent",[At,ua]=Ne(re),Ga=n.forwardRef((a,t)=>{const s=La(re,a.__scopeMenu),{forceMount:o=s.forceMount,...i}=a,r=De(re,a.__scopeMenu),d=He(re,a.__scopeMenu);return e.jsx(Be.Provider,{scope:a.__scopeMenu,children:e.jsx(We,{present:o||r.open,children:e.jsx(Be.Slot,{scope:a.__scopeMenu,children:d.modal?e.jsx(zt,{...i,ref:t}):e.jsx(Tt,{...i,ref:t})})})})}),zt=n.forwardRef((a,t)=>{const s=De(re,a.__scopeMenu),o=n.useRef(null),i=$e(t,o);return n.useEffect(()=>{const r=o.current;if(r)return Zs(r)},[]),e.jsx(fa,{...a,ref:i,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:I(a.onFocusOutside,r=>r.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),Tt=n.forwardRef((a,t)=>{const s=De(re,a.__scopeMenu);return e.jsx(fa,{...a,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>s.onOpenChange(!1)})}),Ot=As("MenuContent.ScrollLock"),fa=n.forwardRef((a,t)=>{const{__scopeMenu:s,loop:o=!1,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:d,disableOutsidePointerEvents:u,onEntryFocus:h,onEscapeKeyDown:C,onPointerDownOutside:v,onFocusOutside:f,onInteractOutside:w,onDismiss:E,disableOutsideScroll:b,...M}=a,R=De(re,s),$=He(re,s),P=Ze(s),k=Fa(s),Y=Mt(s),[_,A]=n.useState(null),p=n.useRef(null),N=$e(t,p,R.onContentChange),D=n.useRef(0),z=n.useRef(""),O=n.useRef(0),H=n.useRef(null),he=n.useRef("right"),Q=n.useRef(0),ee=b?et:n.Fragment,ne=b?{as:Ot,allowPinchZoom:!0}:void 0,xe=g=>{var Z,K;const F=z.current+g,G=Y().filter(U=>!U.disabled),V=document.activeElement,ie=(Z=G.find(U=>U.ref.current===V))==null?void 0:Z.textValue,de=G.map(U=>U.textValue),J=Yt(de,F,ie),oe=(K=G.find(U=>U.textValue===J))==null?void 0:K.ref.current;(function U(ue){z.current=ue,window.clearTimeout(D.current),ue!==""&&(D.current=window.setTimeout(()=>U(""),1e3))})(F),oe&&setTimeout(()=>oe.focus())};n.useEffect(()=>()=>window.clearTimeout(D.current),[]),Qs();const X=n.useCallback(g=>{var G,V;return he.current===((G=H.current)==null?void 0:G.side)&&Jt(g,(V=H.current)==null?void 0:V.area)},[]);return e.jsx(At,{scope:s,searchRef:z,onItemEnter:n.useCallback(g=>{X(g)&&g.preventDefault()},[X]),onItemLeave:n.useCallback(g=>{var F;X(g)||((F=p.current)==null||F.focus(),A(null))},[X]),onTriggerLeave:n.useCallback(g=>{X(g)&&g.preventDefault()},[X]),pointerGraceTimerRef:O,onPointerGraceIntentChange:n.useCallback(g=>{H.current=g},[]),children:e.jsx(ee,{...ne,children:e.jsx(at,{asChild:!0,trapped:i,onMountAutoFocus:I(r,g=>{var F;g.preventDefault(),(F=p.current)==null||F.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:e.jsx(zs,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:C,onPointerDownOutside:v,onFocusOutside:f,onInteractOutside:w,onDismiss:E,children:e.jsx(ot,{asChild:!0,...k,dir:$.dir,orientation:"vertical",loop:o,currentTabStopId:_,onCurrentTabStopIdChange:A,onEntryFocus:I(h,g=>{$.isUsingKeyboardRef.current||g.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Ts,{role:"menu","aria-orientation":"vertical","data-state":os(R.open),"data-radix-menu-content":"",dir:$.dir,...P,...M,ref:N,style:{outline:"none",...M.style},onKeyDown:I(M.onKeyDown,g=>{const G=g.target.closest("[data-radix-menu-content]")===g.currentTarget,V=g.ctrlKey||g.altKey||g.metaKey,ie=g.key.length===1;G&&(g.key==="Tab"&&g.preventDefault(),!V&&ie&&xe(g.key));const de=p.current;if(g.target!==de||!Dt.includes(g.key))return;g.preventDefault();const oe=Y().filter(Z=>!Z.disabled).map(Z=>Z.ref.current);Ta.includes(g.key)&&oe.reverse(),Ht(oe)}),onBlur:I(a.onBlur,g=>{g.currentTarget.contains(g.target)||(window.clearTimeout(D.current),z.current="")}),onPointerMove:I(a.onPointerMove,Le(g=>{const F=g.target,G=Q.current!==g.clientX;if(g.currentTarget.contains(F)&&G){const V=g.clientX>Q.current?"right":"left";he.current=V,Q.current=g.clientX}}))})})})})})})});Ga.displayName=re;var Ft="MenuGroup",ma=n.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a;return e.jsx(Se.div,{role:"group",...o,ref:t})});ma.displayName=Ft;var Bt="MenuLabel",Ka=n.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a;return e.jsx(Se.div,{...o,ref:t})});Ka.displayName=Bt;var Xe="MenuItem",Na="menu.itemSelect",Qe=n.forwardRef((a,t)=>{const{disabled:s=!1,onSelect:o,...i}=a,r=n.useRef(null),d=He(Xe,a.__scopeMenu),u=ua(Xe,a.__scopeMenu),h=$e(t,r),C=n.useRef(!1),v=()=>{const f=r.current;if(!s&&f){const w=new CustomEvent(Na,{bubbles:!0,cancelable:!0});f.addEventListener(Na,E=>o==null?void 0:o(E),{once:!0}),ks(f,w),w.defaultPrevented?C.current=!1:d.onClose()}};return e.jsx(Ua,{...i,ref:h,disabled:s,onClick:I(a.onClick,v),onPointerDown:f=>{var w;(w=a.onPointerDown)==null||w.call(a,f),C.current=!0},onPointerUp:I(a.onPointerUp,f=>{var w;C.current||(w=f.currentTarget)==null||w.click()}),onKeyDown:I(a.onKeyDown,f=>{const w=u.searchRef.current!=="";s||w&&f.key===" "||oa.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});Qe.displayName=Xe;var Ua=n.forwardRef((a,t)=>{const{__scopeMenu:s,disabled:o=!1,textValue:i,...r}=a,d=ua(Xe,s),u=Fa(s),h=n.useRef(null),C=$e(t,h),[v,f]=n.useState(!1),[w,E]=n.useState("");return n.useEffect(()=>{const b=h.current;b&&E((b.textContent??"").trim())},[r.children]),e.jsx(Be.ItemSlot,{scope:s,disabled:o,textValue:i??w,children:e.jsx(tt,{asChild:!0,...u,focusable:!o,children:e.jsx(Se.div,{role:"menuitem","data-highlighted":v?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...r,ref:C,onPointerMove:I(a.onPointerMove,Le(b=>{o?d.onItemLeave(b):(d.onItemEnter(b),b.defaultPrevented||b.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:I(a.onPointerLeave,Le(b=>d.onItemLeave(b))),onFocus:I(a.onFocus,()=>f(!0)),onBlur:I(a.onBlur,()=>f(!1))})})})}),Lt="MenuCheckboxItem",qa=n.forwardRef((a,t)=>{const{checked:s=!1,onCheckedChange:o,...i}=a;return e.jsx(Wa,{scope:a.__scopeMenu,checked:s,children:e.jsx(Qe,{role:"menuitemcheckbox","aria-checked":Ye(s)?"mixed":s,...i,ref:t,"data-state":ha(s),onSelect:I(i.onSelect,()=>o==null?void 0:o(Ye(s)?!0:!s),{checkForDefaultPrevented:!1})})})});qa.displayName=Lt;var Va="MenuRadioGroup",[$t,Gt]=Ne(Va,{value:void 0,onValueChange:()=>{}}),Ha=n.forwardRef((a,t)=>{const{value:s,onValueChange:o,...i}=a,r=Ea(o);return e.jsx($t,{scope:a.__scopeMenu,value:s,onValueChange:r,children:e.jsx(ma,{...i,ref:t})})});Ha.displayName=Va;var Xa="MenuRadioItem",Ya=n.forwardRef((a,t)=>{const{value:s,...o}=a,i=Gt(Xa,a.__scopeMenu),r=s===i.value;return e.jsx(Wa,{scope:a.__scopeMenu,checked:r,children:e.jsx(Qe,{role:"menuitemradio","aria-checked":r,...o,ref:t,"data-state":ha(r),onSelect:I(o.onSelect,()=>{var d;return(d=i.onValueChange)==null?void 0:d.call(i,s)},{checkForDefaultPrevented:!1})})})});Ya.displayName=Xa;var pa="MenuItemIndicator",[Wa,Kt]=Ne(pa,{checked:!1}),Ja=n.forwardRef((a,t)=>{const{__scopeMenu:s,forceMount:o,...i}=a,r=Kt(pa,s);return e.jsx(We,{present:o||Ye(r.checked)||r.checked===!0,children:e.jsx(Se.span,{...i,ref:t,"data-state":ha(r.checked)})})});Ja.displayName=pa;var Ut="MenuSeparator",Za=n.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a;return e.jsx(Se.div,{role:"separator","aria-orientation":"horizontal",...o,ref:t})});Za.displayName=Ut;var qt="MenuArrow",Qa=n.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a,i=Ze(s);return e.jsx(Os,{...i,...o,ref:t})});Qa.displayName=qt;var Vt="MenuSub",[Nr,es]=Ne(Vt),Oe="MenuSubTrigger",as=n.forwardRef((a,t)=>{const s=De(Oe,a.__scopeMenu),o=He(Oe,a.__scopeMenu),i=es(Oe,a.__scopeMenu),r=ua(Oe,a.__scopeMenu),d=n.useRef(null),{pointerGraceTimerRef:u,onPointerGraceIntentChange:h}=r,C={__scopeMenu:a.__scopeMenu},v=n.useCallback(()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]);return n.useEffect(()=>v,[v]),n.useEffect(()=>{const f=u.current;return()=>{window.clearTimeout(f),h(null)}},[u,h]),e.jsx(la,{asChild:!0,...C,children:e.jsx(Ua,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":i.contentId,"data-state":os(s.open),...a,ref:Ma(t,i.onTriggerChange),onClick:f=>{var w;(w=a.onClick)==null||w.call(a,f),!(a.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),s.open||s.onOpenChange(!0))},onPointerMove:I(a.onPointerMove,Le(f=>{r.onItemEnter(f),!f.defaultPrevented&&!a.disabled&&!s.open&&!d.current&&(r.onPointerGraceIntentChange(null),d.current=window.setTimeout(()=>{s.onOpenChange(!0),v()},100))})),onPointerLeave:I(a.onPointerLeave,Le(f=>{var E,b;v();const w=(E=s.content)==null?void 0:E.getBoundingClientRect();if(w){const M=(b=s.content)==null?void 0:b.dataset.side,R=M==="right",$=R?-5:5,P=w[R?"left":"right"],k=w[R?"right":"left"];r.onPointerGraceIntentChange({area:[{x:f.clientX+$,y:f.clientY},{x:P,y:w.top},{x:k,y:w.top},{x:k,y:w.bottom},{x:P,y:w.bottom}],side:M}),window.clearTimeout(u.current),u.current=window.setTimeout(()=>r.onPointerGraceIntentChange(null),300)}else{if(r.onTriggerLeave(f),f.defaultPrevented)return;r.onPointerGraceIntentChange(null)}})),onKeyDown:I(a.onKeyDown,f=>{var E;const w=r.searchRef.current!=="";a.disabled||w&&f.key===" "||yt[o.dir].includes(f.key)&&(s.onOpenChange(!0),(E=s.content)==null||E.focus(),f.preventDefault())})})})});as.displayName=Oe;var ss="MenuSubContent",ts=n.forwardRef((a,t)=>{const s=La(re,a.__scopeMenu),{forceMount:o=s.forceMount,...i}=a,r=De(re,a.__scopeMenu),d=He(re,a.__scopeMenu),u=es(ss,a.__scopeMenu),h=n.useRef(null),C=$e(t,h);return e.jsx(Be.Provider,{scope:a.__scopeMenu,children:e.jsx(We,{present:o||r.open,children:e.jsx(Be.Slot,{scope:a.__scopeMenu,children:e.jsx(fa,{id:u.contentId,"aria-labelledby":u.triggerId,...i,ref:C,align:"start",side:d.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:v=>{var f;d.isUsingKeyboardRef.current&&((f=h.current)==null||f.focus()),v.preventDefault()},onCloseAutoFocus:v=>v.preventDefault(),onFocusOutside:I(a.onFocusOutside,v=>{v.target!==u.trigger&&r.onOpenChange(!1)}),onEscapeKeyDown:I(a.onEscapeKeyDown,v=>{d.onClose(),v.preventDefault()}),onKeyDown:I(a.onKeyDown,v=>{var E;const f=v.currentTarget.contains(v.target),w=Et[d.dir].includes(v.key);f&&w&&(r.onOpenChange(!1),(E=u.trigger)==null||E.focus(),v.preventDefault())})})})})})});ts.displayName=ss;function os(a){return a?"open":"closed"}function Ye(a){return a==="indeterminate"}function ha(a){return Ye(a)?"indeterminate":a?"checked":"unchecked"}function Ht(a){const t=document.activeElement;for(const s of a)if(s===t||(s.focus(),document.activeElement!==t))return}function Xt(a,t){return a.map((s,o)=>a[(t+o)%a.length])}function Yt(a,t,s){const i=t.length>1&&Array.from(t).every(C=>C===t[0])?t[0]:t,r=s?a.indexOf(s):-1;let d=Xt(a,Math.max(r,0));i.length===1&&(d=d.filter(C=>C!==s));const h=d.find(C=>C.toLowerCase().startsWith(i.toLowerCase()));return h!==s?h:void 0}function Wt(a,t){const{x:s,y:o}=a;let i=!1;for(let r=0,d=t.length-1;r<t.length;d=r++){const u=t[r],h=t[d],C=u.x,v=u.y,f=h.x,w=h.y;v>o!=w>o&&s<(f-C)*(o-v)/(w-v)+C&&(i=!i)}return i}function Jt(a,t){if(!t)return!1;const s={x:a.clientX,y:a.clientY};return Wt(s,t)}function Le(a){return t=>t.pointerType==="mouse"?a(t):void 0}var Zt=Ba,Qt=la,eo=$a,ao=Ga,so=ma,to=Ka,oo=Qe,ro=qa,no=Ha,io=Ya,co=Ja,lo=Za,uo=Qa,fo=as,mo=ts,ea="DropdownMenu",[po,Dr]=Da(ea,[Oa]),W=Oa(),[ho,rs]=po(ea),ns=a=>{const{__scopeDropdownMenu:t,children:s,dir:o,open:i,defaultOpen:r,onOpenChange:d,modal:u=!0}=a,h=W(t),C=n.useRef(null),[v,f]=st({prop:i,defaultProp:r??!1,onChange:d,caller:ea});return e.jsx(ho,{scope:t,triggerId:ga(),triggerRef:C,contentId:ga(),open:v,onOpenChange:f,onOpenToggle:n.useCallback(()=>f(w=>!w),[f]),modal:u,children:e.jsx(Zt,{...h,open:v,onOpenChange:f,dir:o,modal:u,children:s})})};ns.displayName=ea;var is="DropdownMenuTrigger",cs=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,disabled:o=!1,...i}=a,r=rs(is,s),d=W(s);return e.jsx(Qt,{asChild:!0,...d,children:e.jsx(Se.button,{type:"button",id:r.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":r.open?r.contentId:void 0,"data-state":r.open?"open":"closed","data-disabled":o?"":void 0,disabled:o,...i,ref:Ma(t,r.triggerRef),onPointerDown:I(a.onPointerDown,u=>{!o&&u.button===0&&u.ctrlKey===!1&&(r.onOpenToggle(),r.open||u.preventDefault())}),onKeyDown:I(a.onKeyDown,u=>{o||(["Enter"," "].includes(u.key)&&r.onOpenToggle(),u.key==="ArrowDown"&&r.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(u.key)&&u.preventDefault())})})})});cs.displayName=is;var xo="DropdownMenuPortal",ls=a=>{const{__scopeDropdownMenu:t,...s}=a,o=W(t);return e.jsx(eo,{...o,...s})};ls.displayName=xo;var ds="DropdownMenuContent",us=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=rs(ds,s),r=W(s),d=n.useRef(!1);return e.jsx(ao,{id:i.contentId,"aria-labelledby":i.triggerId,...r,...o,ref:t,onCloseAutoFocus:I(a.onCloseAutoFocus,u=>{var h;d.current||(h=i.triggerRef.current)==null||h.focus(),d.current=!1,u.preventDefault()}),onInteractOutside:I(a.onInteractOutside,u=>{const h=u.detail.originalEvent,C=h.button===0&&h.ctrlKey===!0,v=h.button===2||C;(!i.modal||v)&&(d.current=!0)}),style:{...a.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});us.displayName=ds;var go="DropdownMenuGroup",vo=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(so,{...i,...o,ref:t})});vo.displayName=go;var _o="DropdownMenuLabel",fs=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(to,{...i,...o,ref:t})});fs.displayName=_o;var wo="DropdownMenuItem",ms=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(oo,{...i,...o,ref:t})});ms.displayName=wo;var Co="DropdownMenuCheckboxItem",ps=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(ro,{...i,...o,ref:t})});ps.displayName=Co;var jo="DropdownMenuRadioGroup",bo=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(no,{...i,...o,ref:t})});bo.displayName=jo;var No="DropdownMenuRadioItem",hs=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(io,{...i,...o,ref:t})});hs.displayName=No;var Do="DropdownMenuItemIndicator",xs=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(co,{...i,...o,ref:t})});xs.displayName=Do;var yo="DropdownMenuSeparator",gs=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(lo,{...i,...o,ref:t})});gs.displayName=yo;var Eo="DropdownMenuArrow",Mo=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(uo,{...i,...o,ref:t})});Mo.displayName=Eo;var So="DropdownMenuSubTrigger",vs=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(fo,{...i,...o,ref:t})});vs.displayName=So;var Ro="DropdownMenuSubContent",_s=n.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,i=W(s);return e.jsx(mo,{...i,...o,ref:t,style:{...a.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});_s.displayName=Ro;var Po=ns,Io=cs,ko=ls,ws=us,Cs=fs,js=ms,bs=ps,Ns=hs,Ds=xs,ys=gs,Es=vs,Ms=_s;const Ao=Po,zo=Io,To=n.forwardRef(({className:a,inset:t,children:s,...o},i)=>e.jsxs(Es,{ref:i,className:ve("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",a),...o,children:[s,e.jsx(Pa,{className:"ml-auto h-4 w-4"})]}));To.displayName=Es.displayName;const Oo=n.forwardRef(({className:a,...t},s)=>e.jsx(Ms,{ref:s,className:ve("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));Oo.displayName=Ms.displayName;const Ss=n.forwardRef(({className:a,sideOffset:t=4,...s},o)=>e.jsx(ko,{children:e.jsx(ws,{ref:o,sideOffset:t,className:ve("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})}));Ss.displayName=ws.displayName;const Fe=n.forwardRef(({className:a,inset:t,...s},o)=>e.jsx(js,{ref:o,className:ve("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",a),...s}));Fe.displayName=js.displayName;const Fo=n.forwardRef(({className:a,children:t,checked:s,...o},i)=>e.jsxs(bs,{ref:i,className:ve("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ds,{children:e.jsx(sa,{className:"h-4 w-4"})})}),t]}));Fo.displayName=bs.displayName;const Bo=n.forwardRef(({className:a,children:t,...s},o)=>e.jsxs(Ns,{ref:o,className:ve("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ds,{children:e.jsx(gt,{className:"h-2 w-2 fill-current"})})}),t]}));Bo.displayName=Ns.displayName;const Lo=n.forwardRef(({className:a,inset:t,...s},o)=>e.jsx(Cs,{ref:o,className:ve("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",a),...s}));Lo.displayName=Cs.displayName;const Rs=n.forwardRef(({className:a,...t},s)=>e.jsx(ys,{ref:s,className:ve("-mx-1 my-1 h-px bg-muted",a),...t}));Rs.displayName=ys.displayName;function $o({pacote:a,embrioesSelecionados:t,paginaAtual:s,pageSize:o,totalSelecionados:i,getClassificacaoAtual:r,onToggleSelecionarEmbriao:d,onSelecionarTodosDaPagina:u,onSetPagina:h,onClassificar:C,onCongelar:v,onDescartar:f,onToggleEstrela:w}){const E=a.disponivel_para_transferencia===!0,b=[...a.embrioes].sort((_,A)=>{const p=_.identificacao||"",N=A.identificacao||"";return p&&N?p.localeCompare(N):p&&!N?-1:!p&&N?1:(_.created_at||"").localeCompare(A.created_at||"")}),M=Math.max(1,Math.ceil(b.length/o)),R=Math.min(s,M),$=(R-1)*o,P=b.slice($,$+o),k=P.every(_=>t.has(_.id)),Y=P.some(_=>t.has(_.id));return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 pb-2 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(T,{variant:"ghost",size:"sm",onClick:()=>u(P),className:"h-8 px-2",children:[k?e.jsx(wa,{className:"w-4 h-4 text-primary"}):e.jsx(Ca,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-xs",children:k?"Desmarcar":"Selecionar página"})]}),(Y||i>0)&&e.jsxs("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:[P.filter(_=>t.has(_.id)).length," selecionados"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[b.length," embriões"]}),e.jsx("span",{className:"mx-1",children:"•"}),e.jsxs("span",{children:["Pág. ",R,"/",M]})]})]}),e.jsx("div",{className:"grid gap-2",children:P.map((_,A)=>{const p=t.has(_.id),N=r(_),D=_.status_atual==="FRESCO";return _.status_atual,e.jsxs("div",{className:`
                group relative flex flex-col sm:flex-row sm:items-center gap-3 p-3 rounded-lg border transition-all
                ${p?"bg-primary-subtle border-primary/30 shadow-sm":"bg-card border-border hover:border-primary/30 hover:shadow-sm"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>d(_.id),className:"flex-shrink-0 p-1 rounded hover:bg-muted",children:p?e.jsx(wa,{className:"w-5 h-5 text-primary"}):e.jsx(Ca,{className:"w-5 h-5 text-muted-foreground/50 group-hover:text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[_.identificacao?e.jsx("span",{className:"font-mono text-sm font-medium text-foreground truncate",children:_.identificacao}):e.jsx("span",{className:"text-sm text-amber-600 dark:text-amber-400 italic",title:"Embrião sem código de rastreabilidade",children:"Sem código"}),e.jsxs("span",{className:"text-xs text-muted-foreground sm:hidden",children:[_.doadora_registro||"-"," × ",_.touro_nome||"-"]})]})]}),e.jsx("div",{className:"hidden sm:flex flex-1 items-center gap-4 min-w-0",children:e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-foreground truncate",title:_.doadora_registro||"-",children:_.doadora_registro||"-"}),e.jsx("span",{className:"text-muted-foreground",children:"×"}),e.jsx("span",{className:"text-foreground truncate",title:_.touro_nome||"-",children:_.touro_nome||"-"})]})})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap sm:flex-nowrap",children:[_.estrela&&e.jsx(va,{className:"w-4 h-4 text-amber-500 fill-amber-500",title:"Embrião Top"}),N?e.jsx(Ee,{variant:"outline",className:"bg-primary-subtle text-primary-subtle-foreground border-primary/30 text-xs",children:N}):e.jsx(Ee,{variant:"outline",className:"text-muted-foreground border-dashed text-xs",children:"Sem classificação"}),e.jsx(lt,{status:_.status_atual}),_.localizacao_atual&&e.jsx(Ee,{variant:"outline",className:"bg-secondary text-secondary-foreground border-primary/20 text-xs hidden lg:inline-flex",children:_.localizacao_atual})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:ml-2",children:[!E&&e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>C(_),className:"h-8 w-8 p-0 text-primary hover:text-primary-dark hover:bg-primary-subtle",title:"Classificar",children:e.jsx(ta,{className:"w-4 h-4"})}),D&&N&&e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>v(_),className:"h-8 w-8 p-0 text-blue-500 hover:text-blue-600 hover:bg-secondary",title:"Congelar",children:e.jsx(aa,{className:"w-4 h-4"})})]}),e.jsxs(Ao,{children:[e.jsx(zo,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-muted-foreground hover:text-foreground",children:e.jsx(vt,{className:"w-4 h-4"})})}),e.jsxs(Ss,{align:"end",className:"w-48",children:[!E&&e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{onClick:()=>C(_),children:[e.jsx(ta,{className:"w-4 h-4 mr-2 text-primary"}),"Classificar"]}),D&&e.jsxs(Fe,{onClick:()=>v(_),disabled:!N,className:N?"":"opacity-50",children:[e.jsx(aa,{className:"w-4 h-4 mr-2 text-blue-500"}),"Congelar",!N&&e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:"Classificar primeiro"})]}),w&&e.jsxs(Fe,{onClick:()=>w(_),children:[e.jsx(va,{className:`w-4 h-4 mr-2 ${_.estrela?"text-amber-500 fill-amber-500":"text-muted-foreground"}`}),_.estrela?"Remover estrela":"Marcar como Top"]}),e.jsx(Rs,{})]}),e.jsxs(Fe,{onClick:()=>f(_),className:"text-destructive focus:text-destructive focus:bg-destructive/10",children:[e.jsx(Ia,{className:"w-4 h-4 mr-2"}),"Descartar"]})]})]})]})]},_.id)})}),M>1&&e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Mostrando ",$+1,"-",Math.min($+o,b.length)," de ",b.length]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:()=>h(Math.max(1,R-1)),disabled:R===1,className:"h-8 w-8 p-0",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("div",{className:"hidden sm:flex items-center gap-1",children:Array.from({length:Math.min(5,M)},(_,A)=>{let p;return M<=5||R<=3?p=A+1:R>=M-2?p=M-4+A:p=R-2+A,e.jsx(T,{variant:R===p?"default":"ghost",size:"sm",onClick:()=>h(p),className:"h-8 w-8 p-0 text-xs",children:p},p)})}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>h(Math.min(M,R+1)),disabled:R===M,className:"h-8 w-8 p-0",children:e.jsx(Pa,{className:"w-4 h-4"})})]})]})]})}function Go({pacote:a,expandido:t,onToggleExpandir:s,onEditarFazendasDestino:o,onDespachar:i,resumoPacote:r,embrioesSelecionados:d,paginaAtual:u,pageSize:h,getClassificacaoAtual:C,onToggleSelecionarEmbriao:v,onSelecionarTodosDaPagina:f,onSetPagina:w,onClassificar:E,onCongelar:b,onDescartar:M,onToggleEstrela:R}){const $=a.embrioes.filter(N=>d.has(N.id)).length,P=Ct(a.data_fecundacao),k=P===7,Y=P===8,_=P!==null&&P>8;let A="from-green-500",p="bg-green-50 dark:bg-green-950";return Y&&(A="from-orange-500",p="bg-orange-50 dark:bg-orange-950"),_&&(A="from-red-500",p="bg-red-50 dark:bg-red-950"),e.jsxs(nt,{className:"overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:`h-1 bg-gradient-to-r ${A} to-transparent`}),e.jsx(it,{className:"pb-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:s,className:"flex-shrink-0 p-1 rounded-md hover:bg-muted transition-colors mt-0.5",children:t?e.jsx($s,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(Gs,{className:"w-5 h-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold text-foreground",children:a.pacote_info.fazenda_nome||"Fazenda não identificada"}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),a.fazendas_destino_nomes.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.fazendas_destino_nomes.map((N,D)=>e.jsxs(Ee,{variant:"secondary",className:"text-xs font-normal",children:[e.jsx(ut,{className:"w-3 h-3 mr-1"}),N]},D)),e.jsx(T,{variant:"ghost",size:"sm",onClick:o,className:"h-6 w-6 p-0 text-muted-foreground hover:text-foreground",title:"Editar fazendas destino",children:e.jsx(_t,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:"Sem destino definido"}),e.jsx(T,{variant:"ghost",size:"sm",onClick:o,className:"h-6 px-2 text-xs text-primary hover:text-primary-dark",children:"Definir"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-xs text-muted-foreground",children:[a.data_despacho&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rt,{className:"w-3 h-3"}),"Despacho: ",Ws(a.data_despacho)]}),P!==null&&a.frescos>0&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full ${p}`,children:[k&&e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"w-3 h-3 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-green-700 dark:text-green-300 font-medium",children:"D7 - Ideal"})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsx(_a,{className:"w-3 h-3 text-orange-600 dark:text-orange-400 animate-pulse"}),e.jsx("span",{className:"text-orange-700 dark:text-orange-300 font-medium",children:"D8 - Último dia!"})]}),_&&e.jsxs(e.Fragment,{children:[e.jsx(_a,{className:"w-3 h-3 text-red-600 dark:text-red-400"}),e.jsxs("span",{className:"text-red-700 dark:text-red-300 font-medium",children:["D",P," - Vencido"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 lg:gap-6 pl-9 lg:pl-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:a.total}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"embriões"})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-amber-400"}),e.jsxs("span",{className:"text-foreground",children:[a.frescos," frescos"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsxs("span",{className:"text-foreground",children:[a.congelados," congelados"]})]}),r.semClassificacao>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-muted-foreground/50"}),e.jsxs("span",{className:"text-muted-foreground",children:[r.semClassificacao," sem classif."]})]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 min-w-[160px]",children:r.todosClassificados?e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{variant:"outline",className:"justify-center bg-primary-subtle dark:bg-primary/20 text-primary-dark dark:text-primary-light border-primary/30",children:[e.jsx(sa,{className:"w-3 h-3 mr-1"}),"Todos classificados"]}),a.disponivel_para_transferencia?e.jsxs(Ee,{variant:"outline",className:"justify-center bg-blue-50 dark:bg-blue-950 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-800",children:[e.jsx(ja,{className:"w-3 h-3 mr-1"}),"Pronto para transferência"]}):e.jsxs(T,{size:"sm",onClick:i,className:"h-8",children:[e.jsx(ja,{className:"w-4 h-4 mr-2"}),"Despachar"]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-foreground px-1",children:[e.jsx("span",{children:"Classificação"}),e.jsxs("span",{className:"font-medium",children:[r.total-r.semClassificacao,"/",r.total]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-primary-dark rounded-full transition-all",style:{width:`${(r.total-r.semClassificacao)/r.total*100}%`}})})]})})]})]})}),t&&e.jsx(ct,{className:"pt-4",children:e.jsx("div",{className:"border-t border-border pt-4",children:e.jsx($o,{pacote:a,embrioesSelecionados:d,paginaAtual:u,pageSize:h,totalSelecionados:$,getClassificacaoAtual:C,onToggleSelecionarEmbriao:v,onSelecionarTodosDaPagina:f,onSetPagina:w,onClassificar:E,onCongelar:b,onDescartar:M,onToggleEstrela:R})})})]})}function Ko({selectedCount:a,onClassificar:t,onCongelar:s,onDescartar:o,onCancelar:i}){return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 animate-in slide-in-from-bottom-5 duration-300",children:e.jsx("div",{className:"bg-card border-t border-border shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-primary-subtle text-primary-subtle-foreground px-3 py-1.5 rounded-full",children:[e.jsx(ft,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-sm",children:[a," selecionado(s)"]})]}),e.jsxs(T,{variant:"ghost",size:"sm",onClick:i,className:"text-muted-foreground hover:text-foreground h-8",children:[e.jsx(mt,{className:"w-4 h-4 mr-1"}),"Limpar"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:t,className:"h-9 border-primary/30 text-primary hover:bg-primary-subtle",children:[e.jsx(ta,{className:"w-4 h-4 mr-2"}),"Classificar"]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:s,className:"h-9 border-primary/20 text-foreground hover:bg-secondary",children:[e.jsx(aa,{className:"w-4 h-4 mr-2 text-blue-500"}),"Congelar"]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:o,className:"h-9 border-destructive/30 text-destructive hover:bg-destructive/10",children:[e.jsx(Ia,{className:"w-4 h-4 mr-2"}),"Descartar"]})]})]})})})})}function Uo({open:a,onOpenChange:t,embriao:s,classificacao:o,onClassificacaoChange:i,onSubmit:r,submitting:d}){return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ke,{className:"max-w-md",children:[e.jsxs(Ue,{children:[e.jsx(qe,{children:"Classificar Embrião"}),e.jsx(Je,{children:(s==null?void 0:s.identificacao)||"Embrião selecionado"})]}),e.jsx(za,{value:o,onChange:i,onSubmit:r,onCancel:()=>t(!1),submitting:d,buttonLabel:"Salvar Classificação"})]})})}function qo({open:a,onOpenChange:t,count:s,classificacao:o,onClassificacaoChange:i,onSubmit:r,submitting:d}){return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ke,{className:"max-w-md",children:[e.jsxs(Ue,{children:[e.jsxs(qe,{children:["Classificar ",s," Embrião(ões)"]}),e.jsx(Je,{children:"Mesma classificação para todos"})]}),e.jsx(za,{value:o,onChange:i,onSubmit:r,onCancel:()=>t(!1),submitting:d,buttonLabel:`Classificar ${s}`})]})})}function Vo({open:a,onOpenChange:t,count:s,data:o,clientes:i,onDataChange:r,onSubmit:d,submitting:u}){return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ke,{className:"max-w-md",children:[e.jsxs(Ue,{children:[e.jsxs(qe,{children:["Congelar ",s," Embrião(ões)"]}),e.jsx(Je,{children:"Defina os dados do congelamento e o cliente dono do embrião"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Data de Congelamento *"}),e.jsx(ka,{value:o.data_congelamento,onChange:h=>r({...o,data_congelamento:h||""}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Localização (Botijão) *"}),e.jsx(ht,{value:o.localizacao_atual,onChange:h=>r({...o,localizacao_atual:h.target.value}),placeholder:"Ex: Botijão 1, Canister A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Cliente (Dono do Embrião) *"}),e.jsxs(ra,{value:o.cliente_id,onValueChange:h=>r({...o,cliente_id:h}),children:[e.jsx(na,{children:e.jsx(ia,{placeholder:"Selecione o cliente"})}),e.jsx(ca,{children:i.map(h=>e.jsx(ge,{value:h.id,children:h.nome},h.id))})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(T,{onClick:d,className:"flex-1",disabled:u||!o.cliente_id,children:u?"Congelando...":"Congelar"}),e.jsx(T,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"})]})]})]})})}function Ho({open:a,onOpenChange:t,count:s,data:o,onDataChange:i,onSubmit:r,submitting:d}){return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ke,{className:"max-w-md",children:[e.jsx(Ue,{children:e.jsxs(qe,{children:["Descartar ",s," Embrião(ões)"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Data de Descarte *"}),e.jsx(ka,{value:o.data_descarte,onChange:u=>i({...o,data_descarte:u||""}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Observações / Motivo"}),e.jsx(xt,{value:o.observacoes,onChange:u=>i({...o,observacoes:u.target.value}),placeholder:"Motivo do descarte (opcional)",rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(T,{onClick:r,className:"flex-1 bg-red-600 hover:bg-red-700",disabled:d,children:d?"Descartando...":"Descartar"}),e.jsx(T,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"})]})]})]})})}function Xo({open:a,onOpenChange:t,pacote:s,fazendas:o,fazendasSelecionadas:i,onFazendasChange:r,onSubmit:d,submitting:u}){const h=(C,v)=>{r(v?[...i,C]:i.filter(f=>f!==C))};return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ke,{className:"max-w-md",children:[e.jsxs(Ue,{children:[e.jsx(qe,{children:"Editar Fazendas Destino"}),e.jsx(Je,{children:"Selecione as fazendas destino do pacote"})]}),s&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto border border-border rounded-md p-3",children:o.map(C=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-muted p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:i.includes(C.id),onChange:v=>h(C.id,v.target.checked),className:"rounded border-border"}),e.jsx("span",{className:"text-sm text-foreground",children:C.nome})]},C.id))})}),e.jsxs(pt,{children:[e.jsx(T,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),e.jsx(T,{onClick:d,disabled:u,children:u?"Salvando...":"Salvar"})]})]})})}function yr(){const{toast:a}=Sa(),{embrioes:t,pacotes:s,fazendas:o,clientes:i,loading:r,selectedFazendaDestinoId:d,setSelectedFazendaDestinoId:u,paginasPacotes:h,setPaginasPacotes:C,pageSize:v,loadData:f,loadFazendas:w,loadClientes:E,reloadData:b,getClassificacaoAtual:M,getResumoPacote:R,classificacoesPendentes:$,setClassificacoesPendentes:P}=jt(),{embrioesSelecionados:k,setEmbrioesSelecionados:Y,showAcoesEmMassa:_,setShowAcoesEmMassa:A,showCongelarDialog:p,setShowCongelarDialog:N,showDescartarDialog:D,setShowDescartarDialog:z,showClassificarDialog:O,setShowClassificarDialog:H,showEditarFazendasDestinoDialog:he,setShowEditarFazendasDestinoDialog:Q,congelarData:ee,setCongelarData:ne,descartarData:xe,setDescartarData:X,classificarEmbriao:g,setClassificarEmbriao:F,pacoteEditandoFazendas:G,setPacoteEditandoFazendas:V,fazendasDestinoSelecionadas:ie,setFazendasDestinoSelecionadas:de,submitting:J,handleCongelarEmMassa:oe,handleDescartarEmMassa:Z,handleSalvarFazendasDestino:K,limparSelecao:U}=bt({embrioes:t,pacotes:s,classificacoesPendentes:$,setClassificacoesPendentes:P,onSuccess:b}),ue=async l=>{try{const m=!l.estrela,{error:x}=await L.from("embrioes").update({estrela:m}).eq("id",l.id);if(x)throw x;a({title:m?"Embrião marcado como Top":"Estrela removida",description:m?"Embrião marcado com estrela.":"Estrela removida do embrião."}),await b()}catch(m){a({title:"Erro ao atualizar embrião",description:m instanceof Error?m.message:"Erro desconhecido",variant:"destructive"})}},[ce,Re]=n.useState(new Set),[fe,me]=n.useState({classificacao:""});n.useEffect(()=>{w(),E()},[w,E]),n.useEffect(()=>{f()},[d,f]);const Pe=l=>{Re(m=>{const x=new Set(m);return x.has(l)?x.delete(l):x.add(l),x})},_e=l=>{Y(m=>{const x=new Set(m);return x.has(l)?x.delete(l):x.add(l),A(x.size>0),x})},pe=l=>{Y(m=>{const x=new Set(m);return l.every(S=>x.has(S.id))?l.forEach(S=>x.delete(S.id)):l.forEach(S=>x.add(S.id)),A(x.size>0),x})},we=l=>h[l]??1,Ce=(l,m)=>{C(x=>({...x,[l]:m}))},Ie=()=>{if(!g||!fe.classificacao){a({title:"Erro de validação",description:"Classificação é obrigatória",variant:"destructive"});return}P(l=>({...l,[g.id]:fe.classificacao})),a({title:"Classificação pendente",description:'Use "Despachar para o campo" para salvar.'}),H(!1),F(null),me({classificacao:""}),U()},j=()=>{if(k.size===0||!fe.classificacao){a({title:"Erro de validação",description:"Selecione embriões e classificação",variant:"destructive"});return}const l=Array.from(k);P(m=>{const x={...m};return l.forEach(B=>{x[B]=fe.classificacao}),x}),a({title:"Classificações pendentes",description:'Use "Despachar para o campo" para salvar.'}),H(!1),me({classificacao:""}),U()},y=async l=>{if(!R(l).todosClassificados){a({title:"Classificação pendente",description:"Classifique todos os embriões antes de despachar.",variant:"destructive"});return}try{const x=new Date().toISOString().split("T")[0],B=l.embrioes.filter(S=>{const ae=M(S);return ae&&ae!==(S.classificacao||"").trim()});B.length>0&&await Promise.all(B.map(S=>L.from("embrioes").update({classificacao:M(S),data_classificacao:x}).eq("id",S.id))),await L.from("lotes_fiv").update({disponivel_para_transferencia:!0}).eq("id",l.lote_fiv_id),a({title:"Pacote despachado",description:"Disponível para transferência."}),P(S=>{const ae={...S};return B.forEach(ke=>delete ae[ke.id]),ae}),await b()}catch(x){a({title:"Erro ao despachar",description:x instanceof Error?x.message:"Erro desconhecido",variant:"destructive"})}};return r?e.jsx(Fs,{}):e.jsxs("div",{className:`space-y-6 ${_?"pb-24":""}`,children:[e.jsx(Ks,{title:"Embriões",description:"Gerenciar pacotes de embriões para transferência, congelamento ou descarte"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 bg-card p-4 rounded-lg border border-border shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{htmlFor:"fazenda_destino",className:"text-sm font-medium whitespace-nowrap",children:"Fazenda Destino:"}),e.jsxs(ra,{value:d||"all",onValueChange:l=>u(l==="all"?"":l),children:[e.jsx(na,{className:"w-[200px] sm:w-[280px]",children:e.jsx(ia,{placeholder:"Todas as fazendas"})}),e.jsxs(ca,{children:[e.jsx(ge,{value:"all",children:"Todas as fazendas"}),o.map(l=>e.jsx(ge,{value:l.id,children:l.nome},l.id))]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.length," pacote(s) encontrado(s)"]})]}),s.length===0?e.jsx(Us,{title:"Nenhum pacote encontrado",description:"Selecione outra fazenda ou verifique se há pacotes disponíveis.",action:d?e.jsx(T,{variant:"outline",onClick:()=>u(""),children:"Limpar filtro"}):void 0}):e.jsx("div",{className:"space-y-4",children:s.map(l=>e.jsx(Go,{pacote:l,expandido:ce.has(l.id),onToggleExpandir:()=>Pe(l.id),onEditarFazendasDestino:()=>{V(l),de([...l.fazendas_destino_ids]),Q(!0)},onDespachar:()=>y(l),resumoPacote:R(l),embrioesSelecionados:k,paginaAtual:we(l.id),pageSize:v,getClassificacaoAtual:M,onToggleSelecionarEmbriao:_e,onSelecionarTodosDaPagina:pe,onSetPagina:m=>Ce(l.id,m),onClassificar:m=>{F(m),me({classificacao:M(m)||""}),H(!0)},onCongelar:m=>{if(!M(m)){a({title:"Classificação obrigatória",description:"Classifique o embrião primeiro.",variant:"destructive"});return}Y(new Set([m.id])),ne({data_congelamento:new Date().toISOString().split("T")[0],localizacao_atual:"",cliente_id:""}),N(!0)},onDescartar:m=>{Y(new Set([m.id])),X({data_descarte:new Date().toISOString().split("T")[0],observacoes:""}),z(!0)},onToggleEstrela:ue},l.id))}),_&&e.jsx(Ko,{selectedCount:k.size,onClassificar:()=>{const m=Array.from(k).filter(x=>{const B=s.find(S=>S.embrioes.some(ae=>ae.id===x));return(B==null?void 0:B.disponivel_para_transferencia)===!0}).length;if(m>0){a({title:"Ação não permitida",description:`${m} embrião(ões) já foram despachados e não podem ser reclassificados.`,variant:"destructive"});return}me({classificacao:""}),H(!0)},onCongelar:()=>{const l=Array.from(k),m=l.filter(S=>{const ae=s.find(ke=>ke.embrioes.some(c=>c.id===S));return(ae==null?void 0:ae.disponivel_para_transferencia)===!0}).length;if(m>0){a({title:"Ação não permitida",description:`${m} embrião(ões) já foram despachados e não podem ser congelados.`,variant:"destructive"});return}const B=t.filter(S=>l.includes(S.id)).filter(S=>!M(S));if(B.length>0){a({title:"Classificação obrigatória",description:`${B.length} embrião(ões) não possui(em) classificação. Classifique antes de congelar.`,variant:"destructive"});return}ne({data_congelamento:new Date().toISOString().split("T")[0],localizacao_atual:"",cliente_id:""}),N(!0)},onDescartar:()=>{X({data_descarte:new Date().toISOString().split("T")[0],observacoes:""}),z(!0)},onCancelar:U}),e.jsx(Uo,{open:O&&!!g,onOpenChange:l=>{l||(H(!1),F(null))},embriao:g,classificacao:fe.classificacao,onClassificacaoChange:l=>me({classificacao:l}),onSubmit:Ie,submitting:J}),e.jsx(qo,{open:O&&!g&&k.size>0,onOpenChange:l=>!l&&H(!1),count:k.size,classificacao:fe.classificacao,onClassificacaoChange:l=>me({classificacao:l}),onSubmit:j,submitting:J}),e.jsx(Vo,{open:p,onOpenChange:N,count:k.size,data:ee,clientes:i,onDataChange:ne,onSubmit:oe,submitting:J}),e.jsx(Ho,{open:D,onOpenChange:z,count:k.size,data:xe,onDataChange:X,onSubmit:Z,submitting:J}),e.jsx(Xo,{open:he,onOpenChange:l=>{Q(l),l||V(null)},pacote:G,fazendas:o,fazendasSelecionadas:ie,onFazendasChange:de,onSubmit:K,submitting:J})]})}export{yr as default};
