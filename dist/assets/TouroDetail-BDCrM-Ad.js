import{i as B,a as P,r as l,s as k,j as e,h as G,B as _}from"./index-TMaXuGT-.js";import{C as p,d as u,a as v,b as x}from"./card-DMaHdbj2.js";import{I as d}from"./input-CS01soKQ.js";import{L as i}from"./label-CDZKlFri.js";import{T as F}from"./textarea-4z0ihLXQ.js";import{S as V,a as q,b as I,c as O,d as A}from"./select-mKWZhFeY.js";import{S as H}from"./switch-B_EUsKic.js";import{P as M}from"./PageHeader-B9IxJGm-.js";import{E as $}from"./EmptyState-BdHwPhgd.js";import{u as J}from"./use-toast-BfiUt0Jw.js";import{C as U}from"./CamposDinamicosPorRaca-BmoMPiWU.js";import{A as z}from"./arrow-left-BZEOW66l.js";import{B as Y}from"./beef-XcQHWfCD.js";import{S as K}from"./save-9hoiBVyp.js";import"./index-CbBZSCMq.js";import"./index-CleRECL4.js";import"./check-BrBvYO5V.js";const Q=["Holandesa","Jersey","Gir","Girolando","Nelore","Angus","Brahman","Hereford","Simmental","Tabapuã","Sindi","Caracu","Canchim","Senepol","Brangus","Gir Leiteiro","Guzerá"];function ge(){const{id:g}=B(),j=P(),{toast:c}=J(),[w,N]=l.useState(!0),[y,C]=l.useState(!1),[E,T]=l.useState(null),[o,s]=l.useState({registro:"",nome:"",raca:"",data_nascimento:"",proprietario:"",fazenda_nome:"",pai_registro:"",pai_nome:"",mae_registro:"",mae_nome:"",genealogia_texto:"",link_catalogo:"",foto_url:"",link_video:"",observacoes:"",disponivel:!0}),[t,b]=l.useState({dados_geneticos:{},dados_producao:{},dados_conformacao:{},medidas_fisicas:{},dados_saude_reproducao:{},caseinas:{},outros_dados:{}});l.useEffect(()=>{g&&S()},[g]);const S=async()=>{try{N(!0);const{data:a,error:r}=await k.from("touros").select("*").eq("id",g).single();if(r)throw r;T(a),s({registro:a.registro||"",nome:a.nome||"",raca:a.raca||"",data_nascimento:a.data_nascimento||"",proprietario:a.proprietario||"",fazenda_nome:a.fazenda_nome||"",pai_registro:a.pai_registro||"",pai_nome:a.pai_nome||"",mae_registro:a.mae_registro||"",mae_nome:a.mae_nome||"",genealogia_texto:a.genealogia_texto||"",link_catalogo:a.link_catalogo||"",foto_url:a.foto_url||"",link_video:a.link_video||"",observacoes:a.observacoes||"",disponivel:a.disponivel??!0}),b({dados_geneticos:a.dados_geneticos||{},dados_producao:a.dados_producao||{},dados_conformacao:a.dados_conformacao||{},medidas_fisicas:a.medidas_fisicas||{},dados_saude_reproducao:a.dados_saude_reproducao||{},caseinas:a.caseinas||{},outros_dados:a.outros_dados||{}})}catch(a){c({title:"Erro ao carregar dados",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{N(!1)}},D=async a=>{if(a.preventDefault(),!o.registro.trim()){c({title:"Erro de validação",description:"Registro é obrigatório",variant:"destructive"});return}if(!o.nome.trim()){c({title:"Erro de validação",description:"Nome é obrigatório",variant:"destructive"});return}try{C(!0);const r=R=>{const f={};return Object.entries(R).forEach(([L,h])=>{h!=null&&h!==""&&(f[L]=h)}),Object.keys(f).length>0?f:null},n={registro:o.registro.trim(),nome:o.nome.trim(),raca:o.raca||void 0,data_nascimento:o.data_nascimento||void 0,proprietario:o.proprietario.trim()||void 0,fazenda_nome:o.fazenda_nome.trim()||void 0,pai_registro:o.pai_registro.trim()||void 0,pai_nome:o.pai_nome.trim()||void 0,mae_registro:o.mae_registro.trim()||void 0,mae_nome:o.mae_nome.trim()||void 0,genealogia_texto:o.genealogia_texto.trim()||void 0,link_catalogo:o.link_catalogo.trim()||void 0,foto_url:o.foto_url.trim()||void 0,link_video:o.link_video.trim()||void 0,observacoes:o.observacoes.trim()||void 0,disponivel:o.disponivel,dados_geneticos:r(t.dados_geneticos)||void 0,dados_producao:r(t.dados_producao)||void 0,dados_conformacao:r(t.dados_conformacao)||void 0,medidas_fisicas:r(t.medidas_fisicas)||void 0,dados_saude_reproducao:r(t.dados_saude_reproducao)||void 0,caseinas:r(t.caseinas)||void 0,outros_dados:r(t.outros_dados)||void 0},{error:m}=await k.from("touros").update(n).eq("id",g);if(m)throw m;c({title:"Touro atualizado",description:"Touro atualizado com sucesso"}),S()}catch(r){const n=r instanceof Error?r.message:"Erro desconhecido";c({title:"Erro ao atualizar touro",description:n.includes("RLS")||n.includes("policy")?"RLS está bloqueando escrita. Configure políticas anon no Supabase.":n,variant:"destructive"})}finally{C(!1)}};return w?e.jsx(G,{}):E?e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{title:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-8 h-8"}),o.nome||o.registro]}),description:`${o.registro}${o.raca?` • ${o.raca}`:""}`,actions:e.jsx(_,{onClick:()=>j("/touros"),variant:"outline",size:"icon",children:e.jsx(z,{className:"w-4 h-4"})})}),o.foto_url&&e.jsx(p,{children:e.jsx(u,{className:"pt-6",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:o.foto_url,alt:o.nome,className:"max-w-md w-full h-auto rounded-lg shadow-md",onError:a=>{a.target.style.display="none"}})})})}),e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(v,{children:e.jsx(x,{children:"Informações Básicas"})}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"registro",children:"Registro *"}),e.jsx(d,{id:"registro",value:o.registro,onChange:a=>s({...o,registro:a.target.value}),placeholder:"Registro do touro",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"nome",children:"Nome *"}),e.jsx(d,{id:"nome",value:o.nome,onChange:a=>s({...o,nome:a.target.value}),placeholder:"Nome do touro",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"raca",children:"Raça"}),e.jsxs(V,{value:o.raca,onValueChange:a=>s({...o,raca:a}),children:[e.jsx(q,{children:e.jsx(I,{placeholder:"Selecione a raça"})}),e.jsx(O,{children:Q.map(a=>e.jsx(A,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"data_nascimento",children:"Data de Nascimento"}),e.jsx(d,{id:"data_nascimento",type:"date",value:o.data_nascimento,onChange:a=>s({...o,data_nascimento:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"proprietario",children:"Proprietário"}),e.jsx(d,{id:"proprietario",value:o.proprietario,onChange:a=>s({...o,proprietario:a.target.value}),placeholder:"Nome do proprietário"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"fazenda_nome",children:"Fazenda"}),e.jsx(d,{id:"fazenda_nome",value:o.fazenda_nome,onChange:a=>s({...o,fazenda_nome:a.target.value}),placeholder:"Nome da fazenda"})]})]})})]}),o.raca&&e.jsx(U,{raca:o.raca,valores:{...t.dados_geneticos,...t.dados_producao,...t.dados_conformacao,...t.medidas_fisicas,...t.dados_saude_reproducao,...t.caseinas,...t.outros_dados},onChange:(a,r,n)=>{b(m=>({...m,[n]:{...m[n],[a]:r===""?void 0:r}}))}}),e.jsxs(p,{children:[e.jsx(v,{children:e.jsx(x,{children:"Pedigree"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pai_registro",children:"Registro do Pai"}),e.jsx(d,{id:"pai_registro",value:o.pai_registro,onChange:a=>s({...o,pai_registro:a.target.value}),placeholder:"Registro do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pai_nome",children:"Nome do Pai"}),e.jsx(d,{id:"pai_nome",value:o.pai_nome,onChange:a=>s({...o,pai_nome:a.target.value}),placeholder:"Nome do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"mae_registro",children:"Registro da Mãe"}),e.jsx(d,{id:"mae_registro",value:o.mae_registro,onChange:a=>s({...o,mae_registro:a.target.value}),placeholder:"Registro da mãe"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"mae_nome",children:"Nome da Mãe"}),e.jsx(d,{id:"mae_nome",value:o.mae_nome,onChange:a=>s({...o,mae_nome:a.target.value}),placeholder:"Nome da mãe"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"genealogia_texto",children:"Genealogia Completa (Texto)"}),e.jsx(F,{id:"genealogia_texto",value:o.genealogia_texto,onChange:a=>s({...o,genealogia_texto:a.target.value}),placeholder:"Genealogia completa em formato texto",rows:4})]})]})]}),e.jsxs(p,{children:[e.jsx(v,{children:e.jsx(x,{children:"Links e Mídia"})}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"link_catalogo",children:"Link do Catálogo"}),e.jsx(d,{id:"link_catalogo",type:"url",value:o.link_catalogo,onChange:a=>s({...o,link_catalogo:a.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"foto_url",children:"URL da Foto"}),e.jsx(d,{id:"foto_url",type:"url",value:o.foto_url,onChange:a=>s({...o,foto_url:a.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"link_video",children:"Link do Vídeo (YouTube, etc.)"}),e.jsx(d,{id:"link_video",type:"url",value:o.link_video,onChange:a=>s({...o,link_video:a.target.value}),placeholder:"https://..."})]})]})})]}),e.jsxs(p,{children:[e.jsx(v,{children:e.jsx(x,{children:"Outros"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{htmlFor:"disponivel",children:"Disponível no Catálogo"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Indica se o touro está disponível no catálogo"})]}),e.jsx(H,{id:"disponivel",checked:o.disponivel,onCheckedChange:a=>s({...o,disponivel:a})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"observacoes",children:"Observações"}),e.jsx(F,{id:"observacoes",value:o.observacoes,onChange:a=>s({...o,observacoes:a.target.value}),placeholder:"Observações adicionais sobre o touro",rows:4})]})]})]}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>j("/touros"),children:"Cancelar"}),e.jsxs(_,{type:"submit",disabled:y,children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),y?"Salvando...":"Salvar Alterações"]})]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsx($,{title:"Touro não encontrado",description:"Volte para a lista e selecione outro touro.",action:e.jsxs(_,{onClick:()=>j("/touros"),variant:"outline",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Voltar para Catálogo de Touros"]})})})}export{ge as default};
