import{r as m,s as p,j as e,i as S,L as g,B as f,U as _,g as B}from"./index-BPMeM9-O.js";import{C as x,d as h,a as F,b as P}from"./card-8azKTSNJ.js";import{I as D}from"./input-tqcTRdPv.js";import{T as H,a as M,b as N,c as t,d as R,e as n}from"./table-l_s8S0JA.js";import{P as k}from"./PageHeader-DQ4rM2jO.js";import{E as I}from"./EmptyState-yqSFIU3C.js";import{h as U}from"./error-handler-B0L1mfY3.js";import{P as A}from"./plus-Ah0p7ggz.js";import{M as G}from"./map-pin-B27L4YNJ.js";import{F as V}from"./filter-DouKIrIu.js";import{S as W}from"./search-SyV5imYB.js";import{X}from"./x-BxiwAMrM.js";import{E as $}from"./eye-CZithoXn.js";import"./use-toast-BGNwDi9e.js";function de(){const[o,C]=m.useState([]),[v,w]=m.useState(!0),[l,u]=m.useState("");m.useEffect(()=>{b()},[]);const b=async()=>{try{const{data:s,error:a}=await p.from("clientes").select("*").order("nome",{ascending:!0});if(a)throw a;const{data:c,error:d}=await p.from("fazendas").select("cliente_id");if(d)throw d;const r=new Map;(c||[]).forEach(i=>{const L=r.get(i.cliente_id)||0;r.set(i.cliente_id,L+1)});const y=(s||[]).map(i=>({...i,fazendas_count:r.get(i.id)||0}));C(y)}catch(s){U(s,"Erro ao carregar clientes")}finally{w(!1)}},j=o.filter(s=>{var c,d,r;if(!l)return!0;const a=l.toLowerCase();return((c=s.nome)==null?void 0:c.toLowerCase().includes(a))||((d=s.telefone)==null?void 0:d.toLowerCase().includes(a))||((r=s.endereco)==null?void 0:r.toLowerCase().includes(a))}),z=o.length,T=o.reduce((s,a)=>s+(a.fazendas_count||0),0),E=o.filter(s=>(s.fazendas_count||0)>0).length;return v?e.jsx(S,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{title:"Clientes",description:"Gerenciar clientes do sistema",actions:e.jsx(g,{to:"/clientes/novo",children:e.jsxs(f,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Novo Cliente"]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de Clientes"}),e.jsx("p",{className:"text-2xl font-bold",children:z})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Com Fazendas"}),e.jsx("p",{className:"text-2xl font-bold",children:E})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Fazendas"}),e.jsx("p",{className:"text-2xl font-bold",children:T})]})]})})})]}),e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(V,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[250px]",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Buscar por nome, telefone ou endereço...",value:l,onChange:s=>u(s.target.value),className:"pl-9 h-9"})]})]}),l&&e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>u(""),className:"h-9",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Limpar"]})]})}),e.jsxs(x,{children:[e.jsx(F,{children:e.jsxs(P,{children:["Clientes (",j.length,")"]})}),e.jsx(h,{children:j.length===0?e.jsx(I,{title:"Nenhum cliente encontrado",description:l?"Tente ajustar os filtros de busca":"Cadastre o primeiro cliente para começar."}):e.jsxs(H,{children:[e.jsx(M,{children:e.jsxs(N,{children:[e.jsx(t,{children:"Nome"}),e.jsx(t,{children:"Telefone"}),e.jsx(t,{children:"Endereço"}),e.jsx(t,{children:"Fazendas"}),e.jsx(t,{children:"Cadastrado em"}),e.jsx(t,{className:"text-right",children:"Ações"})]})}),e.jsx(R,{children:j.map(s=>e.jsxs(N,{children:[e.jsx(n,{className:"font-medium",children:s.nome}),e.jsx(n,{children:s.telefone||"-"}),e.jsx(n,{children:s.endereco||"-"}),e.jsx(n,{children:s.fazendas_count?e.jsx("span",{className:"text-primary font-medium",children:s.fazendas_count}):e.jsx("span",{className:"text-muted-foreground",children:"0"})}),e.jsx(n,{children:s.created_at?new Date(s.created_at).toLocaleDateString("pt-BR"):"-"}),e.jsx(n,{className:"text-right",children:e.jsx(g,{to:`/clientes/${s.id}`,children:e.jsxs(f,{variant:"ghost",size:"sm",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Ver"]})})})]},s.id))})]})})]})]})}export{de as default};
