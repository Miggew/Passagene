import{j as e,i as H,a as U,r as h,s as R,g as Z,h as S,D as K}from"./index-CvlUDCD-.js";import{u as Q,C as E,a as y,b as w,c as G}from"./use-toast-BhbfqK05.js";import{I as t}from"./input-BiDTc9_9.js";import{L as l}from"./label-BIMTC7_j.js";import{T as W}from"./textarea-CWzGJoHk.js";import{S as J,a as P,b as T,c as q,d as v}from"./select-CRV7QsOQ.js";import{P as X}from"./PageHeader-Don16aHL.js";import{E as Y}from"./EmptyState-DFkj0E0i.js";import{S as ee}from"./switch-ba9VhPoo.js";import{A as B}from"./arrow-left-DavZAJTM.js";import{S as ae}from"./save-D1vit_u_.js";import"./index-BYe3zTS0.js";import"./index-CDlvsNjp.js";import"./check-BbN618wW.js";function se({value:o,onChange:f,doadoraNome:u,doadoraRegistro:O}){const n=(r,N,A)=>{f({...o,[r]:{...o[r],[N]:A}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-700 mb-4",children:"Genealogia"}),e.jsx("div",{className:"bg-slate-50 rounded-lg p-6 border border-slate-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("div",{className:"bg-white border-2 border-slate-400 rounded-lg p-4 shadow-sm min-w-[200px] text-center",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900 mb-1",children:u||"Doadora"}),e.jsx("div",{className:"text-xs text-slate-600",children:O||"REGISTRO"})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-white border-2 border-blue-500 rounded-lg p-3 shadow-sm min-w-[180px]",children:[e.jsx(l,{className:"text-xs text-blue-700 font-medium mb-2 block",children:"Pai"}),e.jsx(t,{placeholder:"Nome",value:o.pai.nome,onChange:r=>n("pai","nome",r.target.value),className:"mb-2 text-sm"}),e.jsx(t,{placeholder:"Registro",value:o.pai.registro,onChange:r=>n("pai","registro",r.target.value),className:"text-xs"})]}),e.jsxs("div",{className:"bg-white border-2 border-red-500 rounded-lg p-3 shadow-sm min-w-[180px]",children:[e.jsx(l,{className:"text-xs text-red-700 font-medium mb-2 block",children:"Mãe"}),e.jsx(t,{placeholder:"Nome",value:o.mae.nome,onChange:r=>n("mae","nome",r.target.value),className:"mb-2 text-sm"}),e.jsx(t,{placeholder:"Registro",value:o.mae.registro,onChange:r=>n("mae","registro",r.target.value),className:"text-xs"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"bg-white border-2 border-blue-500 rounded-lg p-3 shadow-sm min-w-[160px]",children:[e.jsx(l,{className:"text-xs text-blue-700 font-medium mb-2 block",children:"Avô Paterno"}),e.jsx(t,{placeholder:"Nome",value:o.pai_pai.nome,onChange:r=>n("pai_pai","nome",r.target.value),className:"mb-2 text-xs"}),e.jsx(t,{placeholder:"Registro",value:o.pai_pai.registro,onChange:r=>n("pai_pai","registro",r.target.value),className:"text-xs"})]}),e.jsxs("div",{className:"bg-white border-2 border-red-500 rounded-lg p-3 shadow-sm min-w-[160px]",children:[e.jsx(l,{className:"text-xs text-red-700 font-medium mb-2 block",children:"Avó Paterna"}),e.jsx(t,{placeholder:"Nome",value:o.pai_mae.nome,onChange:r=>n("pai_mae","nome",r.target.value),className:"mb-2 text-xs"}),e.jsx(t,{placeholder:"Registro",value:o.pai_mae.registro,onChange:r=>n("pai_mae","registro",r.target.value),className:"text-xs"})]}),e.jsxs("div",{className:"bg-white border-2 border-blue-500 rounded-lg p-3 shadow-sm min-w-[160px]",children:[e.jsx(l,{className:"text-xs text-blue-700 font-medium mb-2 block",children:"Avô Materno"}),e.jsx(t,{placeholder:"Nome",value:o.mae_pai.nome,onChange:r=>n("mae_pai","nome",r.target.value),className:"mb-2 text-xs"}),e.jsx(t,{placeholder:"Registro",value:o.mae_pai.registro,onChange:r=>n("mae_pai","registro",r.target.value),className:"text-xs"})]}),e.jsxs("div",{className:"bg-white border-2 border-red-500 rounded-lg p-3 shadow-sm min-w-[160px]",children:[e.jsx(l,{className:"text-xs text-red-700 font-medium mb-2 block",children:"Avó Materna"}),e.jsx(t,{placeholder:"Nome",value:o.mae_mae.nome,onChange:r=>n("mae_mae","nome",r.target.value),className:"mb-2 text-xs"}),e.jsx(t,{placeholder:"Registro",value:o.mae_mae.registro,onChange:r=>n("mae_mae","registro",r.target.value),className:"text-xs"})]})]})]})})]})}function _e(){const{id:o}=H(),f=U(),{toast:u}=Q(),[O,n]=h.useState(!0),[r,N]=h.useState(!1),[A,$]=h.useState(null),[L,V]=h.useState(null),z=["Holandesa","Jersey","Gir","Girolando"],[_,D]=h.useState(""),[a,c]=h.useState({registro:"",nome:"",raca:"",racaCustom:"",genealogia_texto:"",foto_url:"",gpta:"",controle_leiteiro:"",beta_caseina:"",link_abcz:"",disponivel_aspiracao:!0,classificacao_genetica:""}),[d,F]=h.useState({pai:{nome:"",registro:""},mae:{nome:"",registro:""},pai_pai:{nome:"",registro:""},pai_mae:{nome:"",registro:""},mae_pai:{nome:"",registro:""},mae_mae:{nome:"",registro:""}});h.useEffect(()=>{o&&I()},[o]);const I=async()=>{var s,k;try{n(!0);const{data:i,error:p}=await R.from("doadoras").select("*").eq("id",o).single();if(p)throw p;if($(i),i.fazenda_id){const{data:C,error:x}=await R.from("fazendas").select("*").eq("id",i.fazenda_id).single();if(x)throw x;V(C)}const j=i.raca||"",b=z.includes(j);D(b?j:"Outra");let m={pai:{nome:i.pai_nome||"",registro:i.pai_registro||""},mae:{nome:i.mae_nome||"",registro:i.mae_registro||""},pai_pai:{nome:"",registro:""},pai_mae:{nome:"",registro:""},mae_pai:{nome:"",registro:""},mae_mae:{nome:"",registro:""}},g=i.genealogia_texto||"";if(g.includes("[GENEALOGIA_JSON]"))try{const C=g.match(/\[GENEALOGIA_JSON\](.*?)\[\/GENEALOGIA_JSON\]/s);if(C){const x=JSON.parse(C[1]);m={pai:x.pai||m.pai,mae:x.mae||m.mae,pai_pai:x.pai_pai||m.pai_pai,pai_mae:x.pai_mae||m.pai_mae,mae_pai:x.mae_pai||m.mae_pai,mae_mae:x.mae_mae||m.mae_mae},g=g.replace(/\[GENEALOGIA_JSON\].*?\[\/GENEALOGIA_JSON\]/s,"").trim()}}catch{}c({registro:i.registro||"",nome:i.nome||"",raca:b?j:"",racaCustom:b?"":j,genealogia_texto:g,foto_url:i.foto_url||"",gpta:((s=i.gpta)==null?void 0:s.toString())||"",controle_leiteiro:((k=i.controle_leiteiro)==null?void 0:k.toString())||"",beta_caseina:i.beta_caseina||"",link_abcz:i.link_abcz||"",disponivel_aspiracao:i.disponivel_aspiracao??!0,classificacao_genetica:i.classificacao_genetica||""}),F(m)}catch(i){u({title:"Erro ao carregar dados",description:i instanceof Error?i.message:"Erro desconhecido",variant:"destructive"})}finally{n(!1)}},M=async s=>{if(s.preventDefault(),!a.registro.trim()){u({title:"Erro de validação",description:"Registro é obrigatório",variant:"destructive"});return}if(!(_==="Outra"?a.racaCustom.trim():a.raca.trim())){u({title:"Erro de validação",description:"Raça é obrigatória",variant:"destructive"});return}try{N(!0);const i=_==="Outra"?a.racaCustom.trim():a.raca.trim(),p={registro:a.registro.trim(),nome:a.nome.trim()||null,raca:i,pai_registro:d.pai.registro.trim()||null,pai_nome:d.pai.nome.trim()||null,mae_registro:d.mae.registro.trim()||null,mae_nome:d.mae.nome.trim()||null,foto_url:a.foto_url.trim()||null,gpta:a.gpta?parseFloat(a.gpta):null,controle_leiteiro:a.controle_leiteiro?parseFloat(a.controle_leiteiro):null,beta_caseina:a.beta_caseina.trim()||null,link_abcz:a.link_abcz.trim()||null,disponivel_aspiracao:a.disponivel_aspiracao,classificacao_genetica:a.classificacao_genetica||null},j={pai:d.pai,mae:d.mae,pai_pai:d.pai_pai,pai_mae:d.pai_mae,mae_pai:d.mae_pai,mae_mae:d.mae_mae};if(Object.values(j).some(g=>g.nome.trim()||g.registro.trim())){const g=JSON.stringify(j);p.genealogia_texto=a.genealogia_texto.trim()?`${a.genealogia_texto}

[GENEALOGIA_JSON]${g}[/GENEALOGIA_JSON]`:`[GENEALOGIA_JSON]${g}[/GENEALOGIA_JSON]`}else p.genealogia_texto=a.genealogia_texto.trim()||null;const{error:m}=await R.from("doadoras").update(p).eq("id",o);if(m)throw m;u({title:"Doadora atualizada",description:"Doadora atualizada com sucesso"}),I()}catch(i){const p=i instanceof Error?i.message:"Erro desconhecido";u({title:"Erro ao atualizar doadora",description:p.includes("RLS")||p.includes("policy")?"RLS está bloqueando escrita. Configure políticas anon no Supabase.":p,variant:"destructive"})}finally{N(!1)}};return O?e.jsx(Z,{}):A?e.jsxs("div",{className:"space-y-6",children:[e.jsx(X,{title:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-8 h-8"}),a.nome||a.registro]}),description:`${a.registro}${L?` • ${L.nome}`:""}`,actions:e.jsx(S,{onClick:()=>f("/doadoras"),variant:"outline",size:"icon",children:e.jsx(B,{className:"w-4 h-4"})})}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs(E,{children:[e.jsx(y,{children:e.jsx(w,{children:"Informações Básicas"})}),e.jsx(G,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"registro",children:"Registro *"}),e.jsx(t,{id:"registro",value:a.registro,onChange:s=>c({...a,registro:s.target.value}),placeholder:"Registro da doadora",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"nome",children:"Nome"}),e.jsx(t,{id:"nome",value:a.nome,onChange:s=>c({...a,nome:s.target.value}),placeholder:"Nome da doadora"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"raca",children:"Raça *"}),e.jsxs(J,{value:_,onValueChange:s=>{D(s),c(s==="Outra"?{...a,raca:"",racaCustom:""}:{...a,raca:s,racaCustom:""})},children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Selecione a raça"})}),e.jsxs(q,{children:[z.map(s=>e.jsx(v,{value:s,children:s},s)),e.jsx(v,{value:"Outra",children:"Outra"})]})]}),_==="Outra"&&e.jsx(t,{id:"raca_custom",value:a.racaCustom,onChange:s=>c({...a,racaCustom:s.target.value,raca:s.target.value}),placeholder:"Digite a raça",className:"mt-2",required:!0}),_&&_!=="Outra"&&e.jsx("div",{className:"mt-2 text-xs text-slate-500"})]})]})})]}),e.jsxs(E,{children:[e.jsx(y,{children:e.jsx(w,{children:"Genealogia"})}),e.jsxs(G,{children:[e.jsx(se,{value:d,onChange:F,doadoraNome:a.nome||a.registro,doadoraRegistro:a.registro}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(l,{htmlFor:"genealogia_texto",children:"Observações sobre Genealogia"}),e.jsx(W,{id:"genealogia_texto",value:a.genealogia_texto,onChange:s=>c({...a,genealogia_texto:s.target.value}),placeholder:"Informações adicionais sobre genealogia (opcional)",rows:3})]})]})]}),_==="Gir"&&e.jsxs(E,{children:[e.jsx(y,{children:e.jsx(w,{children:"Informações Específicas - Raça Gir"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"gpta",children:"GPTA"}),e.jsx(t,{id:"gpta",type:"number",value:a.gpta,onChange:s=>c({...a,gpta:s.target.value}),placeholder:"GPTA"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"controle_leiteiro",children:"Controle Leiteiro"}),e.jsx(t,{id:"controle_leiteiro",type:"number",value:a.controle_leiteiro,onChange:s=>c({...a,controle_leiteiro:s.target.value}),placeholder:"Controle Leiteiro"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"beta_caseina",children:"Beta Caseína"}),e.jsx(t,{id:"beta_caseina",value:a.beta_caseina,onChange:s=>c({...a,beta_caseina:s.target.value}),placeholder:"Beta Caseína"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"link_abcz",children:"Link ABCZ"}),e.jsx(t,{id:"link_abcz",type:"url",value:a.link_abcz,onChange:s=>c({...a,link_abcz:s.target.value}),placeholder:"URL do link ABCZ"})]})]})]}),e.jsxs(E,{children:[e.jsx(y,{children:e.jsx(w,{children:"Informações Adicionais"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{htmlFor:"disponivel_aspiracao",children:"Disponível para Aspiração"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Indica se a doadora está disponível para aspiração"})]}),e.jsx(ee,{id:"disponivel_aspiracao",checked:a.disponivel_aspiracao,onCheckedChange:s=>c({...a,disponivel_aspiracao:s})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"classificacao_genetica",children:"Classificação Genética"}),e.jsxs(J,{value:a.classificacao_genetica,onValueChange:s=>c({...a,classificacao_genetica:s}),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Selecione a classificação"})}),e.jsxs(q,{children:[e.jsx(v,{value:"1_estrela",children:"1 Estrela"}),e.jsx(v,{value:"2_estrelas",children:"2 Estrelas"}),e.jsx(v,{value:"3_estrelas",children:"3 Estrelas"}),e.jsx(v,{value:"diamante",children:"Diamante"})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Classificação opcional do preço da genética"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"foto_url",children:"Foto"}),e.jsx(t,{id:"foto_url",type:"url",value:a.foto_url,onChange:s=>c({...a,foto_url:s.target.value}),placeholder:"URL da foto"})]})]})]}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>f("/doadoras"),children:"Cancelar"}),e.jsxs(S,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:r,children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),r?"Salvando...":"Salvar Alterações"]})]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsx(Y,{title:"Doadora não encontrada",description:"Volte para a lista e selecione outra doadora.",action:e.jsxs(S,{onClick:()=>f("/doadoras"),variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Voltar para Doadoras"]})})})}export{_e as default};
