import{j as a,r as n,s as S,k as _a,a as ba,i as Na,B as R}from"./index-BPMeM9-O.js";import{C as X,d as Y,a as Ca,b as Da}from"./card-8azKTSNJ.js";import{D as M,a as ya,b as Z,c as $,d as B,e as J}from"./dialog-CLDnxY7R.js";import{A as aa,a as ea,b as sa,c as ra,d as oa,e as ia,f as ta,g as na}from"./alert-dialog-CLsWNiMN.js";import{I as w}from"./input-tqcTRdPv.js";import{L as j}from"./label-fluRYl3j.js";import{T as G}from"./textarea-B1aXpqcj.js";import{S as da,a as ca,b as la,c as ua,d as K}from"./select-La4nrp5K.js";import{T as wa,a as Aa,b as ma,c as pa}from"./tabs-siaSXH49.js";import{B as ha}from"./badge-CeJDYfYs.js";import{E as Ea}from"./EmptyState-yqSFIU3C.js";import{C as V,D as Sa}from"./index-BkgnAyi6.js";import{u as L}from"./use-toast-BGNwDi9e.js";import{f as za}from"./dateUtils-eJ5e6apA.js";import{A as ka}from"./arrow-left-CjWJp082.js";import{L as Fa}from"./lock-DPdGTaHJ.js";import{S as xa}from"./square-pen-qjgDjx3q.js";import{P as Oa}from"./plus-Ah0p7ggz.js";import"./index-C5PY5DOm.js";import"./x-BxiwAMrM.js";import"./check-Bdb-Yd05.js";import"./index-DWxJzuQO.js";function q(r){const o=typeof r.atresicos=="string"?parseInt(r.atresicos)||0:r.atresicos||0,d=typeof r.degenerados=="string"?parseInt(r.degenerados)||0:r.degenerados||0,_=typeof r.expandidos=="string"?parseInt(r.expandidos)||0:r.expandidos||0,l=typeof r.desnudos=="string"?parseInt(r.desnudos)||0:r.desnudos||0,A=typeof r.viaveis=="string"?parseInt(r.viaveis)||0:r.viaveis||0;return o+d+_+l+A}function fa(r,o){if(!r)return"";const[d,_]=r.split(":").map(Number),l=d*60+_+o*60,A=Math.floor(l/60)%24,N=l%60;return`${String(A).padStart(2,"0")}:${String(N).padStart(2,"0")}`}const ja={atresicos:"",degenerados:"",expandidos:"",desnudos:"",viaveis:""};function U({data:r,onChange:o,disabled:d}){const _=q(r);return a.jsxs("div",{className:"border-t pt-4",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Contagem de Oócitos"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Atrésicos"}),a.jsx(w,{type:"number",min:"0",value:r.atresicos,onChange:l=>o("atresicos",l.target.value),disabled:d})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Degenerados"}),a.jsx(w,{type:"number",min:"0",value:r.degenerados,onChange:l=>o("degenerados",l.target.value),disabled:d})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Expandidos"}),a.jsx(w,{type:"number",min:"0",value:r.expandidos,onChange:l=>o("expandidos",l.target.value),disabled:d})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Desnudos"}),a.jsx(w,{type:"number",min:"0",value:r.desnudos,onChange:l=>o("desnudos",l.target.value),disabled:d})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Viáveis"}),a.jsx(w,{type:"number",min:"0",value:r.viaveis,onChange:l=>o("viaveis",l.target.value),disabled:d})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Total"}),a.jsx(w,{value:_,disabled:!0})]})]})]})}function Ta({pacoteId:r}){const{toast:o}=L(),[d,_]=n.useState(!0),[l,A]=n.useState(null),[N,z]=n.useState(""),[m,C]=n.useState([]),[i,u]=n.useState([]),[k,E]=n.useState([]),b=i.reduce((t,x)=>t+(x.total_oocitos||0),0),F=(l==null?void 0:l.status)==="FINALIZADO",p=i.length>0&&i[i.length-1].hora_final||"",f=n.useCallback(async()=>{if(!r)return[];const{data:t,error:x}=await S.from("aspiracoes_doadoras").select("*").eq("pacote_aspiracao_id",r).order("created_at",{ascending:!0});if(x)throw x;if(!t||t.length===0)return[];const s=t.map(T=>T.doadora_id),{data:h,error:c}=await S.from("doadoras").select("id, registro, nome").in("id",s);if(c)throw c;const I=new Map((h==null?void 0:h.map(T=>[T.id,T]))||[]);return t.map(T=>{const H=I.get(T.doadora_id);return{...T,doadora_nome:H==null?void 0:H.nome,doadora_registro:H==null?void 0:H.registro}})},[r]),y=n.useCallback(async(t,x)=>{const s=new Set(x.map(T=>T.doadora_id)),{data:h,error:c}=await S.from("doadoras").select("id, registro, nome").eq("fazenda_id",t).order("registro",{ascending:!0});if(c)throw c;const I=(h||[]).filter(T=>!s.has(T.id));E(I)},[]),D=n.useCallback(async t=>{const{data:x}=await S.from("pacotes_aspiracao_fazendas_destino").select("fazenda_destino_id").eq("pacote_aspiracao_id",t.id);if(!x||x.length===0){if(t.fazenda_destino_id){const{data:c}=await S.from("fazendas").select("nome").eq("id",t.fazenda_destino_id).single();if(c)return[c.nome]}return[]}const s=x.map(c=>c.fazenda_destino_id),{data:h}=await S.from("fazendas").select("id, nome").in("id",s);return h?h.map(c=>c.nome).filter(Boolean):[]},[]),v=n.useCallback(async()=>{if(r)try{_(!0);const{data:t,error:x}=await S.from("pacotes_aspiracao").select("*").eq("id",r).single();if(x)throw x;A(t);const[s,h,c]=await Promise.all([S.from("fazendas").select("nome").eq("id",t.fazenda_id).single(),D(t),f()]);if(s.error)throw s.error;z(s.data.nome),C(h),u(c),t.status==="EM_ANDAMENTO"&&await y(t.fazenda_id,c)}catch(t){o({title:"Erro ao carregar dados",description:t instanceof Error?t.message:"Erro desconhecido",variant:"destructive"})}finally{_(!1)}},[r,f,D,y,o]),g=n.useCallback(async()=>{if(!l)return;const t=await f();u(t),await y(l.fazenda_id,t)},[l,f,y]),O=n.useCallback(async t=>{r&&await S.from("pacotes_aspiracao").update({total_oocitos:t}).eq("id",r)},[r]);return{loading:d,pacote:l,setPacote:A,fazendaNome:N,fazendasDestinoNomes:m,aspiracoes:i,setAspiracoes:u,doadorasDisponiveis:k,totalOocitos:b,horarioFim:p,isFinalizado:F,loadData:v,reloadDoadorasDisponiveis:g,updatePacoteTotal:O}}const va={doadora_id:"",horario_aspiracao:"",hora_final:"",...ja,recomendacao_touro:"",observacoes:""};function Ra({pacoteId:r,pacote:o,aspiracoes:d,totalOocitos:_,onSuccess:l,updatePacoteTotal:A}){const{toast:N}=L(),z=n.useRef(!1),[m,C]=n.useState(!1),[i,u]=n.useState(va),[k,E]=n.useState(!1),[b,F]=n.useState(null),p=n.useCallback(()=>{u(va)},[]),f=n.useCallback(()=>{if(o)if(d.length>0){const t=d[d.length-1];t.hora_final&&u(x=>({...x,horario_aspiracao:t.hora_final||"",hora_final:fa(t.hora_final||"",1)}))}else o.horario_inicio&&u(t=>({...t,horario_aspiracao:o.horario_inicio||"",hora_final:fa(o.horario_inicio||"",1)}))},[o,d]),y=n.useCallback((t,x)=>{u(s=>({...s,[t]:x}))},[]),D=n.useCallback(()=>i.doadora_id?i.hora_final.trim()?!(o!=null&&o.veterinario_responsavel)||!(o!=null&&o.tecnico_responsavel)?(N({title:"Erro de validação",description:"A aspiração deve ter veterinário e técnico responsáveis preenchidos. Por favor, edite a aspiração primeiro.",variant:"destructive"}),!1):d.find(x=>x.doadora_id===i.doadora_id)?(N({title:"Erro",description:"Esta doadora já foi aspirada nesta aspiração",variant:"destructive"}),!1):!0:(N({title:"Erro de validação",description:"Hora final é obrigatória",variant:"destructive"}),!1):(N({title:"Erro",description:"Selecione uma doadora",variant:"destructive"}),!1),[i,o,d,N]),v=n.useCallback(async()=>{if(m||z.current||!D())return;if(q(i)===0){F("add"),E(!0);return}await g()},[m,D,i]),g=n.useCallback(async()=>{if(!(m||z.current||!o||!r))try{z.current=!0,C(!0);const t=q(i),x={pacote_aspiracao_id:r,doadora_id:i.doadora_id,fazenda_id:o.fazenda_id,data_aspiracao:o.data_aspiracao,horario_aspiracao:i.horario_aspiracao||null,hora_final:i.hora_final,atresicos:parseInt(i.atresicos)||0,degenerados:parseInt(i.degenerados)||0,expandidos:parseInt(i.expandidos)||0,desnudos:parseInt(i.desnudos)||0,viaveis:parseInt(i.viaveis)||0,total_oocitos:t,veterinario_responsavel:o.veterinario_responsavel,tecnico_responsavel:o.tecnico_responsavel,recomendacao_touro:i.recomendacao_touro.trim()||null,observacoes:i.observacoes.trim()||null},{error:s}=await S.from("aspiracoes_doadoras").insert([x]);if(s){if(s.code==="23505"){N({title:"Erro",description:"Esta doadora já foi aspirada nesta aspiração",variant:"destructive"}),l();return}throw s}await A(_+t),N({title:"Doadora adicionada",description:"Doadora adicionada à aspiração com sucesso"}),p(),l()}catch(t){N({title:"Erro ao adicionar doadora",description:t instanceof Error?t.message:"Erro desconhecido",variant:"destructive"})}finally{C(!1),z.current=!1}},[m,o,r,i,_,A,p,l,N]),O=n.useCallback(async()=>{E(!1),b==="add"&&await g(),F(null)},[b,g]);return{formData:i,setFormData:u,updateField:y,submitting:m,showConfirmZeroOocitos:k,setShowConfirmZeroOocitos:E,pendingAction:b,setPendingAction:F,resetForm:p,initializeHorario:f,handleAddDoadora:v,executeAddDoadora:g,handleConfirmZeroOocitos:O,calculateTotal:()=>q(i)}}const Ia=["Holandesa","Jersey","Gir","Girolando"];function Pa({pacoteId:r,pacote:o,addDoadoraForm:d,totalOocitos:_,onSuccess:l,updatePacoteTotal:A,setPendingAction:N,setShowConfirmZeroOocitos:z}){const{toast:m}=L(),[C,i]=n.useState(!1),[u,k]=n.useState({registro:"",raca:"",racaCustom:""}),[E,b]=n.useState(""),F=n.useCallback(()=>{k({registro:"",raca:"",racaCustom:""}),b("")},[]),p=n.useCallback(v=>{b(v),k(v==="Outra"?g=>({...g,raca:"",racaCustom:""}):g=>({...g,raca:v,racaCustom:""}))},[]),f=n.useCallback(()=>u.registro.trim()?(E==="Outra"?u.racaCustom.trim():u.raca.trim())?d.hora_final.trim()?!(o!=null&&o.veterinario_responsavel)||!(o!=null&&o.tecnico_responsavel)?(m({title:"Erro de validação",description:"A aspiração deve ter veterinário e técnico responsáveis preenchidos. Por favor, edite a aspiração primeiro.",variant:"destructive"}),!1):!0:(m({title:"Erro de validação",description:"Hora final é obrigatória",variant:"destructive"}),!1):(m({title:"Erro de validação",description:"Raça é obrigatória",variant:"destructive"}),!1):(m({title:"Erro de validação",description:"Registro é obrigatório",variant:"destructive"}),!1),[u,E,d,o,m]),y=n.useCallback(async()=>{if(C||!f())return;if(q(d)===0){N("create"),z(!0);return}await D()},[C,f,d,N,z]),D=n.useCallback(async()=>{if(!(!o||!r))try{i(!0);const v=E==="Outra"?u.racaCustom.trim():u.raca.trim(),g=u.registro.trim().toUpperCase(),{data:O,error:t}=await S.from("doadoras").select("id, registro, raca").ilike("registro",g).eq("raca",v);if(t&&t.code!=="PGRST116")throw t;if(O&&O.length>0){m({title:"Erro",description:`Já existe uma doadora com o registro ${u.registro.trim()} e raça ${v}`,variant:"destructive"});return}const{data:x,error:s}=await S.from("doadoras").insert([{fazenda_id:o.fazenda_id,registro:g,raca:v}]).select().single();if(s){if(s.code==="23505"){m({title:"Erro",description:`Já existe uma doadora com o registro ${u.registro.trim()} nesta fazenda`,variant:"destructive"});return}throw s}const h=q(d),c={pacote_aspiracao_id:r,doadora_id:x.id,fazenda_id:o.fazenda_id,data_aspiracao:o.data_aspiracao,horario_aspiracao:d.horario_aspiracao||null,hora_final:d.hora_final,atresicos:parseInt(d.atresicos)||0,degenerados:parseInt(d.degenerados)||0,expandidos:parseInt(d.expandidos)||0,desnudos:parseInt(d.desnudos)||0,viaveis:parseInt(d.viaveis)||0,total_oocitos:h,veterinario_responsavel:o.veterinario_responsavel,tecnico_responsavel:o.tecnico_responsavel,recomendacao_touro:d.recomendacao_touro.trim()||null,observacoes:d.observacoes.trim()||null},{error:I}=await S.from("aspiracoes_doadoras").insert([c]);if(I){if(I.code==="23505"){m({title:"Erro",description:"Esta doadora já foi aspirada nesta aspiração",variant:"destructive"}),l();return}throw I}await A(_+h),m({title:"Doadora criada e adicionada",description:"Doadora criada e adicionada à aspiração com sucesso"}),F(),l()}catch(v){m({title:"Erro ao criar doadora",description:v instanceof Error?v.message:"Erro desconhecido",variant:"destructive"})}finally{i(!1)}},[o,r,u,E,d,_,A,F,l,m]);return{formData:u,setFormData:k,racaSelecionada:E,racasPredefinidas:Ia,submitting:C,resetForm:F,handleRacaChange:p,handleCreateDoadora:y,executeCreateDoadora:D}}const ga={horario_aspiracao:"",hora_final:"",...ja,recomendacao_touro:"",observacoes:""};function Ha({totalOocitos:r,onSuccess:o,updatePacoteTotal:d}){const{toast:_}=L(),[l,A]=n.useState(!1),[N,z]=n.useState(!1),[m,C]=n.useState(null),[i,u]=n.useState(ga),k=n.useCallback(p=>{var f,y,D,v,g;C(p),u({horario_aspiracao:p.horario_aspiracao||"",hora_final:p.hora_final||"",atresicos:((f=p.atresicos)==null?void 0:f.toString())||"",degenerados:((y=p.degenerados)==null?void 0:y.toString())||"",expandidos:((D=p.expandidos)==null?void 0:D.toString())||"",desnudos:((v=p.desnudos)==null?void 0:v.toString())||"",viaveis:((g=p.viaveis)==null?void 0:g.toString())||"",recomendacao_touro:p.recomendacao_touro||"",observacoes:p.observacoes||""}),z(!0)},[]),E=n.useCallback(()=>{z(!1),C(null),u(ga)},[]),b=n.useCallback((p,f)=>{u(y=>({...y,[p]:f}))},[]),F=n.useCallback(async()=>{if(m){if(!i.hora_final.trim()){_({title:"Erro de validação",description:"Hora final é obrigatória",variant:"destructive"});return}try{A(!0);const p=q(i),f=m.total_oocitos||0,y=p-f,D={horario_aspiracao:i.horario_aspiracao||null,hora_final:i.hora_final,atresicos:parseInt(i.atresicos)||0,degenerados:parseInt(i.degenerados)||0,expandidos:parseInt(i.expandidos)||0,desnudos:parseInt(i.desnudos)||0,viaveis:parseInt(i.viaveis)||0,total_oocitos:p,recomendacao_touro:i.recomendacao_touro.trim()||null,observacoes:i.observacoes.trim()||null},{error:v}=await S.from("aspiracoes_doadoras").update(D).eq("id",m.id);if(v)throw v;await d(r+y),_({title:"Aspiração atualizada",description:"Aspiração da doadora atualizada com sucesso"}),E(),o()}catch(p){_({title:"Erro ao atualizar aspiração",description:p instanceof Error?p.message:"Erro desconhecido",variant:"destructive"})}finally{A(!1)}}},[m,i,r,d,E,o,_]);return{formData:i,setFormData:u,updateField:b,submitting:l,showDialog:N,setShowDialog:z,aspiracaoEditando:m,openEdit:k,closeEdit:E,handleSave:F,calculateTotal:()=>q(i)}}function ne(){var Q,W;const{id:r}=_a(),o=ba(),{toast:d}=L(),[_,l]=n.useState(!1),[A,N]=n.useState(!1),[z,m]=n.useState(!1),[C,i]=n.useState({veterinario_responsavel:"",tecnico_responsavel:""}),[u,k]=n.useState(!1),{loading:E,pacote:b,fazendaNome:F,fazendasDestinoNomes:p,aspiracoes:f,doadorasDisponiveis:y,totalOocitos:D,horarioFim:v,isFinalizado:g,loadData:O,reloadDoadorasDisponiveis:t,updatePacoteTotal:x}=Ta({pacoteId:r}),s=Ra({pacoteId:r,pacote:b,aspiracoes:f,totalOocitos:D,onSuccess:()=>{l(!1),O()},updatePacoteTotal:x}),h=Pa({pacoteId:r,pacote:b,addDoadoraForm:s.formData,totalOocitos:D,onSuccess:()=>{l(!1),s.resetForm(),O()},updatePacoteTotal:x,setPendingAction:s.setPendingAction,setShowConfirmZeroOocitos:s.setShowConfirmZeroOocitos}),c=Ha({totalOocitos:D,onSuccess:O,updatePacoteTotal:x});n.useEffect(()=>{r&&O()},[r,O]),n.useEffect(()=>{_&&b&&(t(),s.initializeHorario())},[_]),n.useEffect(()=>{b&&i({veterinario_responsavel:b.veterinario_responsavel||"",tecnico_responsavel:b.tecnico_responsavel||""})},[b]);const I=async()=>{if(!C.veterinario_responsavel.trim()){d({title:"Erro de validação",description:"Veterinário responsável é obrigatório",variant:"destructive"});return}if(!C.tecnico_responsavel.trim()){d({title:"Erro de validação",description:"Técnico responsável é obrigatório",variant:"destructive"});return}try{k(!0);const{error:e}=await S.from("pacotes_aspiracao").update({veterinario_responsavel:C.veterinario_responsavel.trim(),tecnico_responsavel:C.tecnico_responsavel.trim(),updated_at:new Date().toISOString()}).eq("id",r);if(e)throw e;d({title:"Aspiração atualizada",description:"Informações da aspiração atualizadas com sucesso"}),m(!1),O()}catch(e){d({title:"Erro ao atualizar aspiração",description:e instanceof Error?e.message:"Erro desconhecido",variant:"destructive"})}finally{k(!1)}},T=async()=>{try{k(!0);const{error:e}=await S.from("pacotes_aspiracao").update({status:"FINALIZADO",updated_at:new Date().toISOString()}).eq("id",r);if(e)throw e;d({title:"Aspiração finalizada",description:"Aspiração finalizada com sucesso"}),N(!1),o("/aspiracoes")}catch(e){d({title:"Erro ao finalizar aspiração",description:e instanceof Error?e.message:"Erro desconhecido",variant:"destructive"})}finally{k(!1)}},H=async()=>{s.setShowConfirmZeroOocitos(!1),s.pendingAction==="add"?await s.executeAddDoadora():s.pendingAction==="create"&&await h.executeCreateDoadora(),s.setPendingAction(null)};return E?a.jsx(Na,{}):b?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(R,{variant:"ghost",size:"sm",onClick:()=>o(-1),children:a.jsx(ka,{className:"w-4 h-4"})}),a.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Relatório da Aspiração"})]}),!g&&a.jsxs(R,{onClick:()=>N(!0),disabled:u||f.length===0,children:[a.jsx(Fa,{className:"w-4 h-4 mr-2"}),u?"Finalizando...":"Finalizar Pacote"]})]}),a.jsx(X,{children:a.jsxs(Y,{className:"pt-4 pb-4",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Fazenda"}),a.jsx("p",{className:"text-base font-semibold text-foreground",children:F})]}),a.jsx("div",{className:"h-8 w-px bg-border"}),a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Data"}),a.jsx("p",{className:"text-sm text-foreground",children:za(b.data_aspiracao)})]}),a.jsx("div",{className:"h-8 w-px bg-border"}),a.jsx("div",{children:a.jsx(ha,{variant:g?"default":"outline",className:g?"bg-primary hover:bg-primary-dark":"border-amber-500 bg-amber-50 text-amber-700 dark:bg-amber-950 dark:text-amber-400",children:g?"Finalizado":"Em Andamento"})}),!g&&a.jsxs(R,{variant:"outline",size:"sm",className:"h-7",onClick:()=>m(!0),children:[a.jsx(xa,{className:"w-3.5 h-3.5 mr-1"}),"Editar"]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-xs text-muted-foreground",children:"Doadoras:"}),a.jsx(V,{value:f.length,variant:"default"})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-xs text-muted-foreground",children:"Oócitos:"}),a.jsx(V,{value:D,variant:"primary"})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-xs text-muted-foreground",children:"Média:"}),a.jsx(V,{value:f.length>0?(D/f.length).toFixed(1):"0",variant:"info"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4 pt-3 border-t border-border",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("h4",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wide",children:"Início"}),a.jsx("p",{className:"text-xs text-foreground",children:b.horario_inicio||"—"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("h4",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wide",children:"Fim"}),a.jsx("p",{className:"text-xs text-foreground",children:v||"—"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("h4",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wide",children:"Veterinário"}),a.jsx("p",{className:"text-xs text-foreground",children:b.veterinario_responsavel||"—"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("h4",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wide",children:"Técnico"}),a.jsx("p",{className:"text-xs text-foreground",children:b.tecnico_responsavel||"—"})]}),a.jsxs("div",{className:"space-y-1 lg:col-span-2",children:[a.jsx("h4",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wide",children:"Fazendas Destino"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:p.length>0?p.map((e,P)=>a.jsx(ha,{variant:"outline",className:"text-[10px] px-1.5 py-0",children:e},P)):a.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})})]})]})]})}),a.jsxs(X,{children:[a.jsx(Ca,{className:"pb-2 pt-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(Da,{className:"text-base",children:["Doadoras Aspiradas (",f.length,")"]}),!g&&a.jsxs(M,{open:_,onOpenChange:e=>{l(e),e||(s.resetForm(),h.resetForm())},children:[a.jsx(ya,{asChild:!0,children:a.jsxs(R,{size:"sm",children:[a.jsx(Oa,{className:"w-4 h-4 mr-2"}),"Adicionar Doadora"]})}),a.jsxs(Z,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[a.jsxs($,{children:[a.jsx(B,{children:"Adicionar Doadora à Aspiração"}),a.jsx(J,{children:"Selecione uma doadora existente ou cadastre uma nova"})]}),a.jsxs(wa,{defaultValue:"existing",className:"w-full",children:[a.jsxs(Aa,{className:"grid w-full grid-cols-2",children:[a.jsx(ma,{value:"existing",children:"Doadora Existente"}),a.jsx(ma,{value:"new",children:"Cadastrar Nova"})]}),a.jsxs(pa,{value:"existing",className:"space-y-4 mt-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Doadora *"}),a.jsxs(da,{value:s.formData.doadora_id,onValueChange:e=>s.updateField("doadora_id",e),children:[a.jsx(ca,{children:a.jsx(la,{placeholder:"Selecione uma doadora"})}),a.jsx(ua,{children:y.length===0?a.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Nenhuma doadora disponível nesta fazenda"}):y.map(e=>a.jsxs(K,{value:e.id,children:[e.registro," ",e.nome?`- ${e.nome}`:""]},e.id))})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Horário de Aspiração"}),a.jsx(w,{type:"time",value:s.formData.horario_aspiracao,onChange:e=>s.updateField("horario_aspiracao",e.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Hora Final *"}),a.jsx(w,{type:"time",value:s.formData.hora_final,onChange:e=>s.updateField("hora_final",e.target.value),required:!0})]})]}),a.jsx(U,{data:s.formData,onChange:(e,P)=>s.updateField(e,P)}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Recomendação de Touro"}),a.jsx(w,{value:s.formData.recomendacao_touro,onChange:e=>s.updateField("recomendacao_touro",e.target.value),placeholder:"Recomendação de touro para esta doadora"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Observações"}),a.jsx(G,{value:s.formData.observacoes,onChange:e=>s.updateField("observacoes",e.target.value),placeholder:"Observações sobre esta aspiração",rows:2})]}),a.jsx(R,{onClick:s.handleAddDoadora,className:"w-full",disabled:s.submitting||y.length===0,children:s.submitting?"Adicionando...":"Adicionar"})]}),a.jsxs(pa,{value:"new",className:"space-y-4 mt-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Registro *"}),a.jsx(w,{value:h.formData.registro,onChange:e=>h.setFormData({...h.formData,registro:e.target.value}),placeholder:"Registro da doadora"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Raça *"}),a.jsxs(da,{value:h.racaSelecionada,onValueChange:h.handleRacaChange,children:[a.jsx(ca,{children:a.jsx(la,{placeholder:"Selecione a raça"})}),a.jsxs(ua,{children:[h.racasPredefinidas.map(e=>a.jsx(K,{value:e,children:e},e)),a.jsx(K,{value:"Outra",children:"Outra"})]})]})]}),h.racaSelecionada==="Outra"&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Raça Customizada *"}),a.jsx(w,{value:h.formData.racaCustom,onChange:e=>h.setFormData({...h.formData,racaCustom:e.target.value}),placeholder:"Digite a raça"})]})]}),a.jsx(U,{data:s.formData,onChange:(e,P)=>s.updateField(e,P)}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Recomendação de Touro"}),a.jsx(w,{value:s.formData.recomendacao_touro,onChange:e=>s.updateField("recomendacao_touro",e.target.value),placeholder:"Recomendação de touro para esta doadora"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Horário de Aspiração"}),a.jsx(w,{type:"time",value:s.formData.horario_aspiracao,onChange:e=>s.updateField("horario_aspiracao",e.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Hora Final *"}),a.jsx(w,{type:"time",value:s.formData.hora_final,onChange:e=>s.updateField("hora_final",e.target.value),required:!0})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Observações"}),a.jsx(G,{value:s.formData.observacoes,onChange:e=>s.updateField("observacoes",e.target.value),placeholder:"Observações sobre esta aspiração",rows:2})]}),a.jsx(R,{onClick:h.handleCreateDoadora,className:"w-full",disabled:h.submitting,children:h.submitting?"Criando...":"Criar e Adicionar"})]})]})]})]})]})}),a.jsx(Y,{className:"pt-0 pb-2",children:a.jsx(Sa,{data:f,rowKey:"id",rowNumber:!0,emptyMessage:"Nenhuma doadora adicionada à aspiração",columns:[{key:"doadora_nome",label:"Doadora"},{key:"doadora_registro",label:"Registro"},{key:"horario",label:"Horário"},{key:"viaveis",label:"Viáv.",align:"center"},{key:"total_oocitos",label:"Total",align:"center"},{key:"recomendacao_touro",label:"Rec. Touro"},{key:"observacoes",label:"Obs."}],renderCell:(e,P)=>{switch(P.key){case"doadora_nome":return a.jsx("span",{className:"font-medium text-foreground",children:e.doadora_nome||"—"});case"doadora_registro":return a.jsx("span",{className:"text-xs text-muted-foreground",children:e.doadora_registro||"—"});case"horario":return a.jsx("span",{className:"text-xs text-foreground whitespace-nowrap",children:e.horario_aspiracao?`${e.horario_aspiracao}${e.hora_final?`-${e.hora_final}`:""}`:"—"});case"viaveis":return a.jsx(V,{value:e.viaveis||0,variant:"primary"});case"total_oocitos":return a.jsx(V,{value:e.total_oocitos||0,variant:"default"});case"recomendacao_touro":return a.jsx("span",{className:"text-xs text-muted-foreground truncate",children:e.recomendacao_touro||"—"});case"observacoes":return a.jsx("span",{className:"text-xs text-muted-foreground truncate",children:e.observacoes||"—"});default:return null}},actions:g?void 0:e=>a.jsx(R,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>c.openEdit(e),children:a.jsx(xa,{className:"w-4 h-4"})})})})]}),a.jsx(M,{open:c.showDialog,onOpenChange:c.closeEdit,children:a.jsxs(Z,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[a.jsxs($,{children:[a.jsxs(B,{children:["Editar Aspiração - ",((Q=c.aspiracaoEditando)==null?void 0:Q.doadora_nome)||((W=c.aspiracaoEditando)==null?void 0:W.doadora_registro)||"Doadora"]}),a.jsx(J,{children:"Edite os dados da aspiração da doadora"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Horário de Aspiração"}),a.jsx(w,{type:"time",value:c.formData.horario_aspiracao,onChange:e=>c.updateField("horario_aspiracao",e.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Hora Final *"}),a.jsx(w,{type:"time",value:c.formData.hora_final,onChange:e=>c.updateField("hora_final",e.target.value),required:!0})]})]}),a.jsx(U,{data:c.formData,onChange:(e,P)=>c.updateField(e,P)}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Recomendação de Touro"}),a.jsx(w,{value:c.formData.recomendacao_touro,onChange:e=>c.updateField("recomendacao_touro",e.target.value),placeholder:"Recomendação de touro para esta doadora"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Observações"}),a.jsx(G,{value:c.formData.observacoes,onChange:e=>c.updateField("observacoes",e.target.value),placeholder:"Observações sobre esta aspiração",rows:3})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(R,{variant:"outline",onClick:c.closeEdit,disabled:c.submitting,children:"Cancelar"}),a.jsx(R,{onClick:c.handleSave,disabled:c.submitting,children:c.submitting?"Salvando...":"Salvar Alterações"})]})]})]})}),a.jsx(aa,{open:s.showConfirmZeroOocitos,onOpenChange:s.setShowConfirmZeroOocitos,children:a.jsxs(ea,{children:[a.jsxs(sa,{children:[a.jsx(ra,{children:"Confirmar Adição de Doadora sem Oócitos"}),a.jsxs(oa,{children:["Esta doadora não possui nenhum oócito (total = 0). Deseja realmente adicioná-la à aspiração?",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Atenção:"})," Doadoras sem oócitos podem não ser úteis para o processo de FIV."]})]}),a.jsxs(ia,{children:[a.jsx(ta,{disabled:s.submitting,children:"Cancelar"}),a.jsx(na,{onClick:H,disabled:s.submitting,className:"bg-orange-600 hover:bg-orange-700",children:s.submitting?"Adicionando...":"Sim, Adicionar Mesmo Assim"})]})]})}),a.jsx(M,{open:z,onOpenChange:m,children:a.jsxs(Z,{children:[a.jsxs($,{children:[a.jsx(B,{children:"Editar Aspiração"}),a.jsx(J,{children:"Atualize as informações da aspiração"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Veterinário Responsável *"}),a.jsx(w,{value:C.veterinario_responsavel,onChange:e=>i({...C,veterinario_responsavel:e.target.value}),placeholder:"Nome do veterinário",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(j,{children:"Técnico Responsável *"}),a.jsx(w,{value:C.tecnico_responsavel,onChange:e=>i({...C,tecnico_responsavel:e.target.value}),placeholder:"Nome do técnico",required:!0})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(R,{variant:"outline",onClick:()=>m(!1),disabled:u,children:"Cancelar"}),a.jsx(R,{onClick:I,disabled:u,children:u?"Salvando...":"Salvar"})]})]})]})}),a.jsx(aa,{open:A,onOpenChange:N,children:a.jsxs(ea,{children:[a.jsxs(sa,{children:[a.jsx(ra,{children:"Finalizar Aspiração"}),a.jsxs(oa,{children:["Tem certeza que deseja finalizar esta aspiração? Esta ação não pode ser desfeita.",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Atenção:"})," Após finalizar, a aspiração ficará apenas como histórico e não poderá ser editada.",a.jsx("br",{}),a.jsx("br",{}),"Total de oócitos na aspiração: ",a.jsx("strong",{children:D})]})]}),a.jsxs(ia,{children:[a.jsx(ta,{disabled:u,children:"Cancelar"}),a.jsx(na,{onClick:T,disabled:u,children:u?"Finalizando...":"Finalizar Aspiração"})]})]})})]}):a.jsx(Ea,{title:"Aspiração não encontrada",description:"Volte para a lista e selecione outra aspiração.",action:a.jsx(R,{onClick:()=>o("/aspiracoes"),variant:"outline",children:"Voltar para Aspirações"})})}export{ne as default};
