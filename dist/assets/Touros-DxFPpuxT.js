import{r as x,s as G,a as A,j as e,i as I,B as b,D as q}from"./index-BPMeM9-O.js";import{C as $,a as M,b as U,d as J}from"./card-8azKTSNJ.js";import{T as K,a as Q,b as w,c as _,d as X,e as g}from"./table-l_s8S0JA.js";import{D as Y,a as W,b as Z,c as D,d as ee,e as ae}from"./dialog-CLDnxY7R.js";import{S as E,a as z,b as P,c as V,d as k}from"./select-La4nrp5K.js";import{I as h}from"./input-tqcTRdPv.js";import{L as m}from"./label-fluRYl3j.js";import{T as F}from"./textarea-B1aXpqcj.js";import{P as se}from"./PageHeader-DQ4rM2jO.js";import{E as oe}from"./EmptyState-yqSFIU3C.js";import{B as re}from"./badge-CeJDYfYs.js";import{C as ie}from"./CamposDinamicosPorRaca-DPrUBGvT.js";import{d as le,b as ne}from"./hooks-BRtq68sJ.js";import{u as te}from"./useListFilter-Dbbi_Mbv.js";import"./index-D8U2jNcs.js";import{u as de}from"./use-toast-BGNwDi9e.js";import{P as ce}from"./plus-Ah0p7ggz.js";import{F as me}from"./filter-DouKIrIu.js";import{S as ue}from"./search-SyV5imYB.js";import{X as he}from"./x-BxiwAMrM.js";import{E as pe}from"./eye-CZithoXn.js";import"./index-C5PY5DOm.js";import"./check-Bdb-Yd05.js";const B=["Holandesa","Jersey","Gir","Girolando","Nelore","Angus","Brahman","Hereford","Simmental","Tabapuã","Sindi","Caracu","Canchim","Senepol","Brangus","Gir Leiteiro","Guzerá"],xe=(o,i)=>{var a,r,u;return((a=o.nome)==null?void 0:a.toLowerCase().includes(i))||((r=o.registro)==null?void 0:r.toLowerCase().includes(i))||((u=o.raca)==null?void 0:u.toLowerCase().includes(i))||!1},ge={raca:(o,i)=>o.raca===i};function je(){const{data:o=[],isLoading:i,error:a,refetch:r}=le();ne();const{filtered:u,searchTerm:c,setSearchTerm:l,filterValues:p,setFilterValue:n,clearFilters:s,hasActiveFilters:j}=te({data:o,searchFn:xe,extraFilters:ge}),f=p.raca||"";return{loading:i,error:a,touros:o,filteredTouros:u,searchTerm:c,setSearchTerm:l,filtroRaca:f,setFiltroRaca:v=>n("raca",v),clearFilters:s,hasActiveFilters:j,loadTouros:async()=>{await r()},refetch:()=>r()}}const R={registro:"",nome:"",raca:"",data_nascimento:"",proprietario:"",fazenda_nome:"",pai_registro:"",pai_nome:"",mae_registro:"",mae_nome:"",genealogia_texto:"",link_catalogo:"",foto_url:"",link_video:"",observacoes:""},L={dados_geneticos:{},dados_producao:{},dados_conformacao:{},medidas_fisicas:{},dados_saude_reproducao:{},caseinas:{},outros_dados:{}};function ve({onSuccess:o}){const{toast:i}=de(),[a,r]=x.useState(!1),[u,c]=x.useState(!1),[l,p]=x.useState(R),[n,s]=x.useState(L),j=x.useCallback(()=>{p(R),s(L)},[]),f=x.useCallback((v,t,d)=>{s(N=>({...N,[d]:{...N[d],[v]:t===""?void 0:t}}))},[]),C=x.useCallback(()=>({...n.dados_geneticos,...n.dados_producao,...n.dados_conformacao,...n.medidas_fisicas,...n.dados_saude_reproducao,...n.caseinas,...n.outros_dados}),[n]),T=x.useCallback(async v=>{if(v.preventDefault(),!l.registro.trim()){i({title:"Erro de validacao",description:"Registro e obrigatorio",variant:"destructive"});return}if(!l.nome.trim()){i({title:"Erro de validacao",description:"Nome e obrigatorio",variant:"destructive"});return}if(!l.raca){i({title:"Erro de validacao",description:"Raca e obrigatoria",variant:"destructive"});return}try{c(!0);const t=H=>{const S={};return Object.entries(H).forEach(([O,y])=>{y!=null&&y!==""&&(S[O]=y)}),Object.keys(S).length>0?S:{}},d={registro:l.registro.trim(),nome:l.nome.trim(),raca:l.raca,data_nascimento:l.data_nascimento||null,proprietario:l.proprietario.trim()||null,fazenda_nome:l.fazenda_nome.trim()||null,pai_registro:l.pai_registro.trim()||null,pai_nome:l.pai_nome.trim()||null,mae_registro:l.mae_registro.trim()||null,mae_nome:l.mae_nome.trim()||null,genealogia_texto:l.genealogia_texto.trim()||null,link_catalogo:l.link_catalogo.trim()||null,foto_url:l.foto_url.trim()||null,link_video:l.link_video.trim()||null,observacoes:l.observacoes.trim()||null,disponivel:!0,dados_geneticos:t(n.dados_geneticos),dados_producao:t(n.dados_producao),dados_conformacao:t(n.dados_conformacao),medidas_fisicas:t(n.medidas_fisicas),dados_saude_reproducao:t(n.dados_saude_reproducao),caseinas:t(n.caseinas),outros_dados:t(n.outros_dados)},{error:N}=await G.from("touros").insert([d]);if(N)throw N;i({title:"Touro cadastrado",description:"Touro cadastrado com sucesso no catalogo"}),r(!1),j(),o()}catch(t){let d="Erro desconhecido";t&&typeof t=="object"&&"message"in t?d=t.message:typeof t=="string"&&(d=t),d.includes("RLS")||d.includes("policy")?d="RLS esta bloqueando escrita. Configure politicas anon no Supabase.":d.includes("duplicate")||d.includes("unique")?d="Ja existe um touro com este registro no catalogo.":(d.includes("null value")||d.includes("NOT NULL"))&&(d="Um ou mais campos obrigatorios nao foram preenchidos. Verifique o formulario."),i({title:"Erro ao cadastrar touro",description:d,variant:"destructive"})}finally{c(!1)}},[l,n,i,j,o]);return{formData:l,setFormData:p,dadosDinamicos:n,showDialog:a,setShowDialog:r,submitting:u,resetForm:j,handleCampoDinamicoChange:f,handleSubmit:T,getValoresDinamicos:C}}function Je(){const o=A(),{loading:i,filteredTouros:a,searchTerm:r,setSearchTerm:u,filtroRaca:c,setFiltroRaca:l,loadTouros:p}=je(),{formData:n,setFormData:s,showDialog:j,setShowDialog:f,submitting:C,resetForm:T,handleCampoDinamicoChange:v,handleSubmit:t,getValoresDinamicos:d}=ve({onSuccess:p});return x.useEffect(()=>{p()},[p]),i?e.jsx(I,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Catalogo de Touros",description:"Gerenciar catalogo de touros para FIV",actions:e.jsx(be,{showDialog:j,setShowDialog:f,formData:n,setFormData:s,submitting:C,resetForm:T,handleCampoDinamicoChange:v,handleSubmit:t,getValoresDinamicos:d})}),e.jsxs($,{children:[e.jsx(M,{children:e.jsx(U,{children:"Lista de Touros"})}),e.jsxs(J,{children:[e.jsx(_e,{searchTerm:r,setSearchTerm:u,filtroRaca:c,setFiltroRaca:l}),e.jsx(fe,{touros:a,navigate:o})]})]})]})}function _e({searchTerm:o,setSearchTerm:i,filtroRaca:a,setFiltroRaca:r}){const u=o||a;return e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4 mb-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(me,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[250px]",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Buscar por nome, registro ou raça...",value:o,onChange:c=>i(c.target.value),className:"pl-9 h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-emerald-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(q,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Raça"})]}),e.jsx("div",{className:"w-[180px]",children:e.jsxs(E,{value:a||"all",onValueChange:c=>r(c==="all"?"":c),children:[e.jsx(z,{className:"h-9",children:e.jsx(P,{placeholder:"Todas as raças"})}),e.jsxs(V,{children:[e.jsx(k,{value:"all",children:"Todas as raças"}),B.map(c=>e.jsx(k,{value:c,children:c},c))]})]})})]}),u&&e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>{i(""),r("")},className:"h-9 ml-auto",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})]})})}function fe({touros:o,navigate:i}){return e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs(w,{children:[e.jsx(_,{children:"Registro"}),e.jsx(_,{children:"Nome"}),e.jsx(_,{children:"Raca"}),e.jsx(_,{children:"NM$"}),e.jsx(_,{children:"TPI"}),e.jsx(_,{children:"PTAT"}),e.jsx(_,{className:"text-right",children:"Acoes"})]})}),e.jsx(X,{children:o.length===0?e.jsx(w,{children:e.jsx(g,{colSpan:7,className:"text-center text-muted-foreground",children:e.jsx(oe,{title:"Nenhum touro cadastrado",description:"Cadastre o primeiro touro para comecar."})})}):o.map(a=>e.jsx(Ne,{touro:a,navigate:i},a.id))})]})}function Ne({touro:o,navigate:i}){return e.jsxs(w,{children:[e.jsx(g,{className:"font-medium",children:o.registro}),e.jsx(g,{children:o.nome}),e.jsx(g,{children:o.raca?e.jsx(re,{variant:"outline",children:o.raca}):"-"}),e.jsx(g,{children:o.nm_dolares!==null&&o.nm_dolares!==void 0?`+${o.nm_dolares}`:"-"}),e.jsx(g,{children:o.tpi!==null&&o.tpi!==void 0?`+${o.tpi}`:"-"}),e.jsx(g,{children:o.ptat!==null&&o.ptat!==void 0?`+${o.ptat}`:"-"}),e.jsx(g,{className:"text-right",children:e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>i(`/touros/${o.id}`),children:e.jsx(pe,{className:"w-4 h-4"})})})]})}function be({showDialog:o,setShowDialog:i,formData:a,setFormData:r,submitting:u,resetForm:c,handleCampoDinamicoChange:l,handleSubmit:p,getValoresDinamicos:n}){return e.jsxs(Y,{open:o,onOpenChange:s=>{i(s),s||c()},children:[e.jsx(W,{asChild:!0,children:e.jsxs(b,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Novo Touro"]})}),e.jsxs(Z,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(ee,{children:"Cadastrar Novo Touro"}),e.jsx(ae,{children:"Adicione um touro ao catalogo. Os clientes poderao ter doses deste touro."})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"registro",children:"Registro *"}),e.jsx(h,{id:"registro",value:a.registro,onChange:s=>r({...a,registro:s.target.value}),placeholder:"Ex: 250HO14579",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"nome",children:"Nome *"}),e.jsx(h,{id:"nome",value:a.nome,onChange:s=>r({...a,nome:s.target.value}),placeholder:"Ex: HANCOCK",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"raca",children:"Raca"}),e.jsxs(E,{value:a.raca,onValueChange:s=>r({...a,raca:s}),children:[e.jsx(z,{children:e.jsx(P,{placeholder:"Selecione a raca"})}),e.jsx(V,{children:B.map(s=>e.jsx(k,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"data_nascimento",children:"Data de Nascimento"}),e.jsx(h,{id:"data_nascimento",type:"date",value:a.data_nascimento,onChange:s=>r({...a,data_nascimento:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"proprietario",children:"Proprietario"}),e.jsx(h,{id:"proprietario",value:a.proprietario,onChange:s=>r({...a,proprietario:s.target.value}),placeholder:"Nome do proprietario"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"fazenda_nome",children:"Fazenda"}),e.jsx(h,{id:"fazenda_nome",value:a.fazenda_nome,onChange:s=>r({...a,fazenda_nome:s.target.value}),placeholder:"Nome da fazenda"})]})]}),a.raca&&e.jsx("div",{className:"border-t pt-4",children:e.jsx(ie,{raca:a.raca,valores:n(),onChange:l})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Pedigree"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pai_registro",children:"Registro do Pai"}),e.jsx(h,{id:"pai_registro",value:a.pai_registro,onChange:s=>r({...a,pai_registro:s.target.value}),placeholder:"Registro do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pai_nome",children:"Nome do Pai"}),e.jsx(h,{id:"pai_nome",value:a.pai_nome,onChange:s=>r({...a,pai_nome:s.target.value}),placeholder:"Nome do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"mae_registro",children:"Registro da Mae"}),e.jsx(h,{id:"mae_registro",value:a.mae_registro,onChange:s=>r({...a,mae_registro:s.target.value}),placeholder:"Registro da mae"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"mae_nome",children:"Nome da Mae"}),e.jsx(h,{id:"mae_nome",value:a.mae_nome,onChange:s=>r({...a,mae_nome:s.target.value}),placeholder:"Nome da mae"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(m,{htmlFor:"genealogia_texto",children:"Genealogia Completa (Texto)"}),e.jsx(F,{id:"genealogia_texto",value:a.genealogia_texto,onChange:s=>r({...a,genealogia_texto:s.target.value}),placeholder:"Genealogia completa em formato texto",rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"link_catalogo",children:"Link do Catalogo"}),e.jsx(h,{id:"link_catalogo",type:"url",value:a.link_catalogo,onChange:s=>r({...a,link_catalogo:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"foto_url",children:"URL da Foto"}),e.jsx(h,{id:"foto_url",type:"url",value:a.foto_url,onChange:s=>r({...a,foto_url:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"link_video",children:"Link do Video (YouTube, etc.)"}),e.jsx(h,{id:"link_video",type:"url",value:a.link_video,onChange:s=>r({...a,link_video:s.target.value}),placeholder:"https://..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"observacoes",children:"Observacoes"}),e.jsx(F,{id:"observacoes",value:a.observacoes,onChange:s=>r({...a,observacoes:s.target.value}),placeholder:"Observacoes adicionais sobre o touro",rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(b,{type:"submit",className:"flex-1",disabled:u,children:u?"Salvando...":"Cadastrar Touro"}),e.jsx(b,{type:"button",variant:"outline",onClick:()=>{i(!1),c()},disabled:u,children:"Cancelar"})]})]})]})]})}export{Je as default};
