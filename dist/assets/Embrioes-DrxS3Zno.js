import{c as We,f as ns,r as c,s as h,j as e,a as da,B as l,g as Ye}from"./index-DmNymSE5.js";import{C as Ke,a as ma,b as fa,d as Ze}from"./card-SrkIpKk5.js";import{T as cs,a as ls,b as ha,c as R,d as ds,e as q}from"./table-BEqiB4gi.js";import{D as ie,b as te,c as oe,d as re,e as ne,f as ms}from"./dialog-j4QKUGZf.js";import{S as Ae,a as Ie,b as Oe,c as Fe,d as N,C as fs,e as hs}from"./select-yD1hylSL.js";import{I as us}from"./input-CUsCheD8.js";import{L as z}from"./label-u6KawL_e.js";import{P as ps}from"./PageHeader-C6hPTib0.js";import{E as xs}from"./EmptyState-8CewmVht.js";import{S as ua}from"./StatusBadge-UrqKsWCC.js";import{B as H}from"./badge-BB9l9AxT.js";import{h as Te}from"./error-handler-CVxXqVfW.js";import{u as _s}from"./use-toast-8Wh80yTN.js";import{T as gs}from"./textarea-BuM8ilf-.js";import{T as Qe,S as js,a as vs,b as Cs,c as Ss,d as Ns}from"./sheet-DWUaBWrd.js";import{D as pa}from"./DatePickerBR-DL95UOFW.js";import{T as xa}from"./triangle-alert-LWvbwqzk.js";import{S as bs}from"./square-pen-D0yg8shX.js";import{S as _a}from"./snowflake-BapSu9_S.js";import{T as ga}from"./trash-2-DPVvnTdd.js";import{H as Es}from"./history-Ijd8nAqu.js";import{P as ws}from"./package-Be7lPzXE.js";import"./index-BMCBZPUE.js";import"./index-C79PyqkA.js";import"./x-BKw_NAIH.js";import"./index-BoubMqWY.js";import"./index-BMurdLVa.js";import"./check-D6LfuFSM.js";import"./statusLabels-IklKT8dE.js";import"./popover-BabFSUJ1.js";import"./calendar-u0e6cTgk.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=We("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=We("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=We("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Ds=I=>{if(!I)return null;const S=new Date,ce=S.getFullYear()+"-"+String(S.getMonth()+1).padStart(2,"0")+"-"+String(S.getDate()).padStart(2,"0"),[G,le,de]=ce.split("-").map(Number),[Me,B,be]=I.split("-").map(Number),ke=Date.UTC(G,le-1,de),V=Date.UTC(Me,B-1,be);return Math.floor((ke-V)/(1e3*60*60*24))},Sa="embrioes_filtros",zs=()=>{try{const I=localStorage.getItem(Sa);return I?JSON.parse(I):{}}catch{return{}}};function ni(){ns();const I=zs(),[S,ce]=c.useState([]),[G,le]=c.useState([]),[de,Me]=c.useState([]),[B,be]=c.useState(I.selectedFazendaDestinoId??""),[ke,V]=c.useState(!1),[Le,Na]=c.useState(new Set),[d,E]=c.useState(new Set),[ba,O]=c.useState(!1),[Ea,me]=c.useState(!1),[wa,fe]=c.useState(!1),[ea,y]=c.useState(!1),[Da,he]=c.useState(!1),[za,aa]=c.useState(!1),[sa,Ba]=c.useState([]),[p,w]=c.useState(!1),[U,ue]=c.useState(null),[Bs,ya]=c.useState(null),[J,Pa]=c.useState(null),[ia,Aa]=c.useState([]),[Ia,ta]=c.useState(!1),[Oa,Ee]=c.useState(!1),[Y,Re]=c.useState(null),[pe,xe]=c.useState([]),{toast:f}=_s(),[qe,oa]=c.useState(I.paginasPacotes??{}),we=20,[F,De]=c.useState({data_congelamento:new Date().toISOString().split("T")[0],localizacao_atual:""}),[K,$]=c.useState({classificacao:""}),[Fa,He]=c.useState({}),[Z,_e]=c.useState({data_descarte:new Date().toISOString().split("T")[0],observacoes:""}),[ge,ze]=c.useState({cliente_id:""}),v=a=>(Fa[a.id]??a.classificacao??"").trim(),ra=a=>{const i={BE:0,BN:0,BX:0,BL:0,BI:0};let o=0;return a.embrioes.forEach(t=>{const r=v(t).toUpperCase();if(!r){o+=1;return}r==="BE"?i.BE+=1:r==="BN"?i.BN+=1:r==="BX"?i.BX+=1:r==="BL"?i.BL+=1:r==="BI"&&(i.BI+=1)}),{semClassificacao:o,classificados:i,total:a.total,todosClassificados:a.total>0&&o===0}};c.useEffect(()=>{Ma(),Ta()},[]),c.useEffect(()=>{const a={selectedFazendaDestinoId:B,paginasPacotes:qe};localStorage.setItem(Sa,JSON.stringify(a))},[B,qe]),c.useEffect(()=>{oa(a=>{let i=!1;const o={...a};return G.forEach(t=>{const r=Math.max(1,Math.ceil(t.embrioes.length/we));if(!o[t.id]){o[t.id]=1,i=!0;return}o[t.id]>r&&(o[t.id]=r,i=!0)}),i?o:a})},[G]);const Ta=async()=>{try{const{data:a,error:i}=await h.from("clientes").select("id, nome").order("nome",{ascending:!0});if(i)throw i;Ba(a||[])}catch(a){Te(a,"Erro ao carregar clientes")}};c.useEffect(()=>{Q()},[B]);const Ma=async()=>{try{const{data:a,error:i}=await h.from("fazendas").select("id, nome").order("nome",{ascending:!0});if(i)throw i;Me(a||[])}catch(a){Te(a,"Erro ao carregar fazendas")}},Be=async(a,i,o,t,r,m)=>{try{const{error:u}=await h.from("historico_embrioes").insert([{embriao_id:a,status_anterior:i,status_novo:o,tipo_operacao:t,fazenda_id:r||null,observacoes:m||null,data_mudanca:new Date().toISOString()}])}catch{}},Q=async()=>{try{V(!0);const{data:a,error:i}=await h.from("embrioes").select("*").in("status_atual",["FRESCO","CONGELADO"]).is("cliente_id",null).order("created_at",{ascending:!1});if(i)throw i;if(!a||a.length===0){ce([]),le([]),V(!1);return}const o=[...new Set(a.filter(s=>s.lote_fiv_acasalamento_id).map(s=>s.lote_fiv_acasalamento_id))],t=[...new Set(a.filter(s=>s.lote_fiv_id).map(s=>s.lote_fiv_id))],r=[...new Set(a.filter(s=>s.fazenda_destino_id).map(s=>s.fazenda_destino_id))];if(o.length===0){ce(a),le([]),V(!1);return}const[m,u]=await Promise.all([h.from("lote_fiv_acasalamentos").select("id, aspiracao_doadora_id, dose_semen_id").in("id",o),t.length>0?h.from("lotes_fiv").select("id, pacote_aspiracao_id, data_fecundacao").in("id",t):Promise.resolve({data:null,error:null})]);if(m.error)throw m.error;const g=m.data||[],x=u.data||[],D=[...new Set(g.map(s=>s.aspiracao_doadora_id))],P=[...new Set(g.map(s=>s.dose_semen_id))],b=[...new Set(x.map(s=>s.pacote_aspiracao_id).filter(Boolean))],X=new Map,T=new Map;x.forEach(s=>{s.pacote_aspiracao_id&&X.set(s.id,s.pacote_aspiracao_id),s.data_fecundacao&&T.set(s.id,s.data_fecundacao)});const[W,ee,n]=await Promise.all([D.length>0?h.from("aspiracoes_doadoras").select("id, doadora_id, pacote_aspiracao_id").in("id",D):Promise.resolve({data:null,error:null}),P.length>0?h.from("doses_semen").select("id, touro_id, touro:touros(id, nome, registro, raca)").in("id",P):Promise.resolve({data:null,error:null}),b.length>0?h.from("pacotes_aspiracao").select("id, data_aspiracao, fazenda_id, fazenda_destino_id, horario_inicio, veterinario_responsavel, total_oocitos").in("id",b):Promise.resolve({data:null,error:null})]);if(W.error)throw W.error;if(ee.error)throw ee.error;const A=W.data||[],M=ee.data||[],k=n.data||[],je=[...new Set(A.map(s=>s.doadora_id))],L=new Set(r);k.forEach(s=>{s.fazenda_id&&L.add(s.fazenda_id),s.fazenda_destino_id&&L.add(s.fazenda_destino_id)});const[ve,$e,Ka]=await Promise.all([je.length>0?h.from("doadoras").select("id, registro").in("id",je):Promise.resolve({data:null,error:null}),L.size>0?h.from("fazendas").select("id, nome").in("id",Array.from(L)):Promise.resolve({data:null,error:null}),b.length>0?h.from("pacotes_aspiracao_fazendas_destino").select("pacote_aspiracao_id, fazenda_destino_id").in("pacote_aspiracao_id",b):Promise.resolve({data:null,error:null})]);if(ve.error)throw ve.error;const Za=ve.data||[],Qa=$e.data||[],Wa=Ka.data||[],ye=new Map(Qa.map(s=>[s.id,s.nome])),Ce=new Map;Wa.forEach(s=>{const _=Ce.get(s.pacote_aspiracao_id)||[];_.includes(s.fazenda_destino_id)||(_.push(s.fazenda_destino_id),ye.has(s.fazenda_destino_id)||L.add(s.fazenda_destino_id)),Ce.set(s.pacote_aspiracao_id,_)}),k.forEach(s=>{if(s.fazenda_destino_id){const _=Ce.get(s.id)||[];_.includes(s.fazenda_destino_id)||_.push(s.fazenda_destino_id),Ce.set(s.id,_)}});const Xe=new Map;A.forEach(s=>{s.pacote_aspiracao_id&&Xe.set(s.pacote_aspiracao_id,(Xe.get(s.pacote_aspiracao_id)||0)+1)});const Ge=new Map;k.forEach(s=>{Ge.set(s.id,{id:s.id,data_aspiracao:s.data_aspiracao,fazenda_nome:ye.get(s.fazenda_id),quantidade_doadoras:Xe.get(s.id)||0,horario_inicio:s.horario_inicio,veterinario_responsavel:s.veterinario_responsavel,total_oocitos:s.total_oocitos})});const es=new Map(A.map(s=>[s.id,s])),as=new Map(Za.map(s=>[s.id,s])),ss=new Map(M.map(s=>[s.id,s])),is=new Map(g.map(s=>[s.id,s])),ca=a.map(s=>{const _=s.lote_fiv_acasalamento_id?is.get(s.lote_fiv_acasalamento_id):void 0,ae=_?es.get(_.aspiracao_doadora_id):void 0,j=ae?as.get(ae.doadora_id):void 0,C=_?ss.get(_.dose_semen_id):void 0,Se=s.lote_fiv_id?X.get(s.lote_fiv_id):void 0,se=Se?Ge.get(Se):void 0,Ne=(C==null?void 0:C.touro)??null;return{...s,doadora_registro:j==null?void 0:j.registro,touro_nome:(Ne==null?void 0:Ne.nome)||"Touro desconhecido",fazenda_destino_nome:s.fazenda_destino_id?ye.get(s.fazenda_destino_id):void 0,data_aspiracao:se==null?void 0:se.data_aspiracao,pacote_aspiracao_id:Se}});ce(ca);const Ve=new Map;ca.forEach(s=>{if(!s.lote_fiv_id||!s.created_at)return;const _=s.created_at.split("T")[0],ae=`${s.lote_fiv_id}-${_}`;let j=Ve.get(ae);if(!j){const C=X.get(s.lote_fiv_id),Se=C?Ge.get(C):void 0,se=C?Ce.get(C)||[]:[],Ne=se.map(Je=>ye.get(Je)).filter(Je=>!!Je),rs=T.get(s.lote_fiv_id);j={id:ae,lote_fiv_id:s.lote_fiv_id,data_despacho:_,data_fecundacao:rs,fazendas_destino_ids:se,fazendas_destino_nomes:Ne,pacote_info:Se||{id:C||"",data_aspiracao:_,quantidade_doadoras:0},embrioes:[],total:0,frescos:0,congelados:0,sem_classificacao:0,classificados:{BE:0,BN:0,BX:0,BL:0,BI:0}},Ve.set(ae,j)}if(j.embrioes.push(s),j.total++,s.status_atual==="FRESCO"&&j.frescos++,s.status_atual==="CONGELADO"&&j.congelados++,!s.classificacao)j.sem_classificacao++;else{const C=s.classificacao.toUpperCase();C==="BE"?j.classificados.BE++:C==="BN"?j.classificados.BN++:C==="BX"?j.classificados.BX++:C==="BL"?j.classificados.BL++:C==="BI"&&j.classificados.BI++}});let Pe=Array.from(Ve.values());B&&(Pe=Pe.filter(s=>s.fazendas_destino_ids.includes(B)));const ts=[...new Set(Pe.map(s=>s.lote_fiv_id))],{data:Ue}=await h.from("lotes_fiv").select("id, disponivel_para_transferencia").in("id",ts),os=new Map((Ue==null?void 0:Ue.map(s=>[s.id,s.disponivel_para_transferencia===!0]))||[]),la=Pe.map(s=>({...s,todos_classificados:s.total>0&&s.sem_classificacao===0,disponivel_para_transferencia:os.get(s.lote_fiv_id)||!1}));la.sort((s,_)=>_.data_despacho.localeCompare(s.data_despacho)),le(la)}catch(a){Te(a,"Erro ao carregar dados")}finally{V(!1)}},ka=a=>{const i=new Set(Le);i.has(a)?i.delete(a):i.add(a),Na(i)},La=a=>{const i=new Set(d);i.has(a)?i.delete(a):i.add(a),E(i),O(i.size>0)},Ra=a=>{const i=new Set(d);a.every(t=>i.has(t.id))?a.forEach(t=>i.delete(t.id)):a.forEach(t=>i.add(t.id)),E(i),O(i.size>0)},qa=a=>qe[a]??1,na=(a,i)=>{oa(o=>({...o,[a]:i}))},Ha=async a=>{var o;if(!ra(a).todosClassificados){f({title:"Classificação pendente",description:"Classifique todos os embriões do pacote antes de despachar para o campo.",variant:"destructive"});return}try{w(!0);const t=new Date().toISOString().split("T")[0],r=a.embrioes.filter(u=>{const g=v(u);return g&&g!==(u.classificacao||"").trim()});if(r.length>0){const g=(o=(await Promise.all(r.map(x=>h.from("embrioes").update({classificacao:v(x),data_classificacao:t}).eq("id",x.id)))).find(x=>x.error))==null?void 0:o.error;if(g)throw g;for(const x of r)await Be(x.id,x.status_atual,x.status_atual,"CLASSIFICACAO",null,`Classificação: ${v(x)}`)}const{error:m}=await h.from("lotes_fiv").update({disponivel_para_transferencia:!0}).eq("id",a.lote_fiv_id);if(m)throw m;f({title:"Pacote despachado",description:"O pacote agora está disponível para transferência de embriões."}),He(u=>{const g={...u};return r.forEach(x=>{delete g[x.id]}),g}),Q()}catch(t){f({title:"Erro ao despachar pacote",description:t instanceof Error?t.message:"Erro desconhecido",variant:"destructive"})}finally{w(!1)}},$a=async()=>{if(Y)try{w(!0);const{data:a,error:i}=await h.from("lotes_fiv").select("pacote_aspiracao_id").eq("id",Y.lote_fiv_id).single();if(i||!a||!a.pacote_aspiracao_id)throw new Error("Pacote de aspiração não encontrado para este lote FIV");const o=a.pacote_aspiracao_id,{error:t}=await h.from("pacotes_aspiracao_fazendas_destino").delete().eq("pacote_aspiracao_id",o);if(pe.length>0){const r=pe.map(u=>({pacote_aspiracao_id:o,fazenda_destino_id:u})),{error:m}=await h.from("pacotes_aspiracao_fazendas_destino").insert(r);if(m)throw m}f({title:"Fazendas destino atualizadas",description:"As fazendas destino do pacote foram atualizadas com sucesso."}),Ee(!1),Re(null),xe([]),Q()}catch(a){f({title:"Erro ao atualizar fazendas destino",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{w(!1)}},Xa=async a=>{const i=U;if(!i||!K.classificacao){f({title:"Erro de validação",description:"Classificação é obrigatória",variant:"destructive"});return}He(o=>({...o,[i.id]:K.classificacao})),f({title:"Classificação pendente",description:'A classificação foi salva localmente. Use "Despachar para o campo" para salvar tudo.'}),y(!1),ue(null),$({classificacao:""}),E(new Set),O(!1)},Ga=async()=>{if(d.size===0||!K.classificacao){f({title:"Erro de validação",description:"Selecione pelo menos um embrião e uma classificação",variant:"destructive"});return}const a=Array.from(d);He(i=>{const o={...i};return a.forEach(t=>{o[t]=K.classificacao}),o}),f({title:"Classificações pendentes",description:'As classificações foram salvas localmente. Use "Despachar para o campo" para salvar tudo.'}),y(!1),$({classificacao:""}),E(new Set),O(!1)},Va=async()=>{if(d.size===0||!F.localizacao_atual.trim()){f({title:"Erro de validação",description:"Selecione pelo menos um embrião e informe a localização",variant:"destructive"});return}const a=Array.from(d),i=S.filter(t=>a.includes(t.id)&&!v(t));if(i.length>0){f({title:"Erro de validação",description:`Não é possível congelar embriões sem classificação. ${i.length} embrião(ões) selecionado(s) não está(ão) classificado(s). Por favor, classifique os embriões antes de congelá-los.`,variant:"destructive"});return}const o=S.filter(t=>a.includes(t.id)&&t.status_atual!=="FRESCO");if(o.length>0){f({title:"Erro de validação",description:`Apenas embriões frescos podem ser congelados. ${o.length} embrião(ões) selecionado(s) não está(ão) com status FRESCO.`,variant:"destructive"});return}try{w(!0);const t=a.map(r=>h.from("embrioes").update({status_atual:"CONGELADO",data_congelamento:F.data_congelamento,localizacao_atual:F.localizacao_atual}).eq("id",r));await Promise.all(t);for(const r of a){const m=S.find(u=>u.id===r);m&&await Be(m.id,m.status_atual,"CONGELADO","CONGELAMENTO",null,`Localização: ${F.localizacao_atual}`)}f({title:"Embriões congelados",description:`${a.length} embrião(ões) congelados com sucesso`}),me(!1),De({data_congelamento:new Date().toISOString().split("T")[0],localizacao_atual:""}),E(new Set),O(!1),Q()}catch(t){f({title:"Erro ao congelar embriões",description:t instanceof Error?t.message:"Erro desconhecido",variant:"destructive"})}finally{w(!1)}},Ua=async()=>{if(d.size===0){f({title:"Erro de validação",description:"Selecione pelo menos um embrião",variant:"destructive"});return}try{w(!0);const a=Array.from(d),i=a.map(o=>h.from("embrioes").update({status_atual:"DESCARTADO",data_descarte:Z.data_descarte}).eq("id",o));await Promise.all(i);for(const o of a){const t=S.find(r=>r.id===o);t&&await Be(t.id,t.status_atual,"DESCARTADO","DESCARTE",null,Z.observacoes||null)}f({title:"Embriões descartados",description:`${a.length} embrião(ões) descartados com sucesso`}),he(!1),_e({data_descarte:new Date().toISOString().split("T")[0],observacoes:""}),E(new Set),O(!1),Q()}catch(a){f({title:"Erro ao descartar embriões",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{w(!1)}},Ja=async()=>{if(d.size===0||!ge.cliente_id){f({title:"Erro de validação",description:"Selecione pelo menos um embrião congelado e um cliente",variant:"destructive"});return}const a=Array.from(d),i=S.filter(o=>a.includes(o.id)&&o.status_atual==="CONGELADO");if(i.length===0){f({title:"Erro de validação",description:"Apenas embriões congelados podem ser direcionados para clientes",variant:"destructive"});return}try{w(!0);const o=i.map(m=>m.id),t=o.map(m=>h.from("embrioes").update({cliente_id:ge.cliente_id}).eq("id",m));await Promise.all(t);const r=sa.find(m=>m.id===ge.cliente_id);for(const m of o){const u=S.find(g=>g.id===m);u&&await Be(u.id,u.status_atual,u.status_atual,"DESTINACAO",null,`Direcionado para cliente: ${(r==null?void 0:r.nome)||ge.cliente_id}`)}f({title:"Embriões direcionados",description:`${i.length} embrião(ões) direcionado(s) para ${(r==null?void 0:r.nome)||"o cliente"} com sucesso`}),fe(!1),ze({cliente_id:""}),E(new Set),O(!1),Q()}catch(o){f({title:"Erro ao direcionar embriões",description:o instanceof Error?o.message:"Erro desconhecido",variant:"destructive"})}finally{w(!1)}},Ya=async a=>{try{ta(!0);const{data:i,error:o}=await h.from("historico_embrioes").select("*").eq("embriao_id",a).order("data_mudanca",{ascending:!1});if(o)throw o;Aa(i||[])}catch(i){Te(i,"Erro ao carregar histórico")}finally{ta(!1)}};return ke?e.jsx(da,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(ps,{title:"Estoque de Embriões",description:"Gerenciar pacotes de embriões para transferência, congelamento ou descarte"}),e.jsxs(Ke,{children:[e.jsx(ma,{children:e.jsx(fa,{children:"Pacotes de Embriões"})}),e.jsxs(Ze,{children:[e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsx(z,{htmlFor:"fazenda_destino",children:"Filtrar por Fazenda Destino"}),e.jsxs(Ae,{value:B||"all",onValueChange:a=>be(a==="all"?"":a),children:[e.jsx(Ie,{className:"w-full md:w-[300px]",children:e.jsx(Oe,{placeholder:"Todas as fazendas"})}),e.jsxs(Fe,{children:[e.jsx(N,{value:"all",children:"Todas as fazendas"}),de.map(a=>e.jsx(N,{value:a.id,children:a.nome},a.id))]})]})]}),G.length===0?e.jsx(xs,{title:"Nenhum pacote de embriões encontrado",description:"Selecione outra fazenda destino ou verifique se há pacotes disponíveis.",action:B?e.jsx(l,{variant:"outline",onClick:()=>be(""),children:"Limpar filtro"}):void 0}):e.jsx("div",{className:"space-y-4",children:G.map(a=>{const i=Le.has(a.id),o=a.embrioes.filter(D=>d.has(D.id)).length,t=ra(a),r=Ds(a.data_fecundacao),m=r===8,u=r===7,g=r!==null&&r>8;let x="border-l-green-500";return m&&(x="border-l-orange-500"),g&&(x="border-l-red-500"),e.jsxs(Ke,{className:`border-l-4 ${x}`,children:[e.jsx(ma,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>ka(a.id),className:"p-0 h-auto",children:i?e.jsx(fs,{className:"w-5 h-5 text-slate-600"}):e.jsx(hs,{className:"w-5 h-5 text-slate-600"})}),r!==null&&a.frescos>0&&e.jsxs(e.Fragment,{children:[u&&e.jsx(H,{className:"bg-green-100 text-green-800 border-green-300",children:"D7 - Ideal"}),m&&e.jsxs(H,{className:"bg-orange-100 text-orange-800 border-orange-300 animate-pulse",children:[e.jsx(xa,{className:"w-3 h-3 mr-1"}),"D8 - Último dia!"]}),g&&e.jsxs(H,{className:"bg-red-100 text-red-800 border-red-300",children:[e.jsx(xa,{className:"w-3 h-3 mr-1"}),"D",r," - Vencido"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fa,{className:"text-lg",children:[a.pacote_info.fazenda_nome||"Fazenda não identificada"," →"," ",a.fazendas_destino_nomes&&a.fazendas_destino_nomes.length>0?e.jsx("span",{className:"inline-flex flex-wrap gap-1 items-center",children:a.fazendas_destino_nomes.map((D,P)=>e.jsx(H,{variant:"outline",className:"text-xs",children:D},P))}):e.jsx("span",{className:"text-slate-400",children:"Sem destino"})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{Re(a),xe([...a.fazendas_destino_ids]),Ee(!0)},className:"h-8 w-8 p-0",title:"Editar fazendas destino",children:e.jsx(bs,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"mt-2 ml-7 space-y-1 text-sm text-slate-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Data Despacho:"})," ",a.data_despacho?Ye(a.data_despacho):"-"]}),a.pacote_info.horario_inicio&&e.jsxs("p",{children:[e.jsx("strong",{children:"Horário:"})," ",a.pacote_info.horario_inicio]}),a.pacote_info.veterinario_responsavel&&e.jsxs("p",{children:[e.jsx("strong",{children:"Veterinário:"})," ",a.pacote_info.veterinario_responsavel]})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.total}),e.jsx("div",{className:"text-sm text-slate-600",children:"embriões"}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[a.frescos," frescos, ",a.congelados," congelados"]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[t.semClassificacao," sem classificação"]}),t.classificados.BE>0||t.classificados.BN>0||t.classificados.BX>0||t.classificados.BL>0||t.classificados.BI>0?e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["BE: ",t.classificados.BE," | BN: ",t.classificados.BN," | BX: ",t.classificados.BX," | BL: ",t.classificados.BL," | BI: ",t.classificados.BI]}):null]}),e.jsx("div",{className:"flex flex-col items-end gap-2 min-w-[280px]",children:t.todosClassificados?e.jsxs(e.Fragment,{children:[e.jsxs(H,{variant:"outline",className:"bg-green-50 text-green-700 border-green-300",children:["✓ Todos classificados (",t.total,"/",t.total,")"]}),a.disponivel_para_transferencia?e.jsx(H,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-300",children:"Disponível para Transferência"}):e.jsx(l,{size:"sm",onClick:()=>Ha(a),className:"bg-green-600 hover:bg-green-700 text-white w-full",children:"Despachar para o campo"})]}):t.total>0?e.jsxs(H,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-300",children:["Pendente: ",t.total-t.semClassificacao,"/",t.total," classificados"]}):null})]})]})}),i&&e.jsx(Ze,{children:(()=>{const D=[...a.embrioes].sort((n,A)=>{const M=n.identificacao||"",k=A.identificacao||"";if(M&&k)return M.localeCompare(k);if(M&&!k)return-1;if(!M&&k)return 1;const je=n.doadora_registro||"",L=A.doadora_registro||"";if(je!==L)return je.localeCompare(L);const ve=n.created_at||"",$e=A.created_at||"";return ve.localeCompare($e)}),P=Math.max(1,Math.ceil(D.length/we)),b=Math.min(qa(a.id),P),X=(b-1)*we,T=D.slice(X,X+we),W=T.every(n=>d.has(n.id)),ee=T.some(n=>d.has(n.id));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>Ra(T),children:[W?e.jsx(ja,{className:"w-4 h-4 mr-2"}):e.jsx(va,{className:"w-4 h-4 mr-2"}),W?"Desmarcar Página":"Selecionar Página"]}),e.jsxs("span",{className:"text-sm text-slate-600",children:[ee&&`${T.filter(n=>d.has(n.id)).length} selecionado(s) na página`,!ee&&o>0&&`${o} selecionado(s) no pacote`]})]}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Página ",b," de ",P]})]}),e.jsxs(cs,{children:[e.jsx(ls,{children:e.jsxs(ha,{children:[e.jsx(R,{className:"w-12"}),e.jsx(R,{className:"text-center w-28",children:"Código"}),e.jsx(R,{children:"Doadora"}),e.jsx(R,{children:"Touro"}),e.jsx(R,{children:"Classificação"}),e.jsx(R,{children:"Status"}),e.jsx(R,{children:"Localização"}),e.jsx(R,{className:"text-right",children:"Ações"})]})}),e.jsx(ds,{children:T.map((n,A)=>{const M=d.has(n.id);return e.jsxs(ha,{children:[e.jsx(q,{children:e.jsx(l,{variant:"ghost",size:"sm",className:"p-0 h-auto",onClick:()=>La(n.id),children:M?e.jsx(ja,{className:"w-4 h-4 text-green-600"}):e.jsx(va,{className:"w-4 h-4 text-slate-400"})})}),e.jsx(q,{className:"text-center font-medium font-mono text-xs",children:n.identificacao||`#${X+A+1}`}),e.jsx(q,{children:n.doadora_registro||"-"}),e.jsx(q,{children:n.touro_nome||"-"}),e.jsx(q,{children:v(n)?e.jsx(H,{variant:"outline",children:v(n)}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(q,{children:e.jsx(ua,{status:n.status_atual})}),e.jsx(q,{children:n.localizacao_atual||"-"}),e.jsx(q,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[!v(n)&&n.status_atual==="FRESCO"&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{ue(n),$({classificacao:""}),y(!0)},title:"Classificar",children:e.jsx(Qe,{className:"w-4 h-4 text-purple-600"})}),v(n)&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{ue(n),$({classificacao:v(n)}),y(!0)},title:"Editar Classificação",children:e.jsx(Qe,{className:"w-4 h-4 text-purple-600"})}),n.status_atual==="FRESCO"&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{if(!v(n)){f({title:"Classificação obrigatória",description:"É necessário classificar o embrião antes de congelá-lo. Por favor, classifique o embrião primeiro.",variant:"destructive"});return}me(!0),E(new Set([n.id]))},title:v(n)?"Congelar":"Classifique antes de congelar",disabled:!v(n),children:e.jsx(_a,{className:v(n)?"w-4 h-4 text-blue-600":"w-4 h-4 text-slate-400"})}),n.status_atual==="CONGELADO"&&!n.cliente_id&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{fe(!0),E(new Set([n.id])),ze({cliente_id:""})},title:"Direcionar para Cliente",children:e.jsx(Ca,{className:"w-4 h-4 text-green-600"})}),(n.status_atual==="FRESCO"||n.status_atual==="CONGELADO")&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{ya(n),_e({data_descarte:new Date().toISOString().split("T")[0],observacoes:""}),he(!0)},title:"Descartar",children:e.jsx(ga,{className:"w-4 h-4 text-red-600"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:async()=>{Pa(n),aa(!0),await Ya(n.id)},title:"Ver Histórico",children:e.jsx(Es,{className:"w-4 h-4 text-slate-600"})})]})})]},n.id)})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:[D.length," embriões no pacote"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>na(a.id,Math.max(1,b-1)),disabled:b===1,children:"Anterior"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>na(a.id,Math.min(P,b+1)),disabled:b===P,children:"Próxima"})]})]})]})})()})]},a.id)})}),ba&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 border border-slate-200 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"w-5 h-5 text-slate-600"}),e.jsxs("span",{className:"font-medium text-slate-900",children:[d.size," embrião(ões) selecionado(s)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{$({classificacao:""}),y(!0)},children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Classificar"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{const a=Array.from(d).filter(o=>{const t=S.find(r=>r.id===o);return!t||!v(t)});if(a.length>0){f({title:"Classificação obrigatória",description:`Não é possível congelar embriões sem classificação. ${a.length} embrião(ões) selecionado(s) não está(ão) classificado(s). Por favor, classifique os embriões antes de congelá-los.`,variant:"destructive"});return}const i=Array.from(d).filter(o=>{const t=S.find(r=>r.id===o);return!t||t.status_atual!=="FRESCO"});if(i.length>0){f({title:"Erro de validação",description:`Apenas embriões frescos podem ser congelados. ${i.length} embrião(ões) selecionado(s) não está(ão) com status FRESCO.`,variant:"destructive"});return}De({data_congelamento:new Date().toISOString().split("T")[0],localizacao_atual:""}),me(!0)},children:[e.jsx(_a,{className:"w-4 h-4 mr-2"}),"Congelar"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{ze({cliente_id:""}),fe(!0)},disabled:!Array.from(d).some(a=>{const i=S.find(o=>o.id===a);return(i==null?void 0:i.status_atual)==="CONGELADO"}),title:"Apenas embriões congelados podem ser direcionados para clientes",children:[e.jsx(Ca,{className:"w-4 h-4 mr-2"}),"Direcionar para Cliente"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{_e({data_descarte:new Date().toISOString().split("T")[0],observacoes:""}),he(!0)},children:[e.jsx(ga,{className:"w-4 h-4 mr-2"}),"Descartar"]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{E(new Set),O(!1)},children:"Cancelar"})]})]})]})]}),e.jsx(ie,{open:ea&&!!U,onOpenChange:a=>{a||(y(!1),ue(null))},children:e.jsxs(te,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsx(re,{children:"Classificar Embrião"}),e.jsxs(ne,{children:["Classificar embrião ",(U==null?void 0:U.identificacao)||"selecionado"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"classificacao",children:"Classificação *"}),e.jsxs(Ae,{value:K.classificacao,onValueChange:a=>$({classificacao:a}),children:[e.jsx(Ie,{children:e.jsx(Oe,{placeholder:"Selecione a classificação"})}),e.jsxs(Fe,{children:[e.jsx(N,{value:"BE",children:"BE (Blastocisto Excelente)"}),e.jsx(N,{value:"BN",children:"BN (Blastocisto Normal)"}),e.jsx(N,{value:"BX",children:"BX (Blastocisto Regular)"}),e.jsx(N,{value:"BL",children:"BL (Blastocisto Limitado)"}),e.jsx(N,{value:"BI",children:"BI (Blastocisto Irregular)"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(l,{onClick:()=>Xa(),className:"flex-1 bg-purple-600 hover:bg-purple-700",disabled:p,children:p?"Salvando...":"Salvar Classificação"}),e.jsx(l,{variant:"outline",onClick:()=>{y(!1),ue(null)},disabled:p,children:"Cancelar"})]})]})]})}),e.jsx(ie,{open:ea&&!U&&d.size>0,onOpenChange:a=>{a||y(!1)},children:e.jsxs(te,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsxs(re,{children:["Classificar ",d.size," Embrião(ões)"]}),e.jsx(ne,{children:"Classificar todos os embriões selecionados com a mesma classificação"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"classificacao",children:"Classificação *"}),e.jsxs(Ae,{value:K.classificacao,onValueChange:a=>$({classificacao:a}),children:[e.jsx(Ie,{children:e.jsx(Oe,{placeholder:"Selecione a classificação"})}),e.jsxs(Fe,{children:[e.jsx(N,{value:"BE",children:"BE (Blastocisto Excelente)"}),e.jsx(N,{value:"BN",children:"BN (Blastocisto Normal)"}),e.jsx(N,{value:"BX",children:"BX (Blastocisto Regular)"}),e.jsx(N,{value:"BL",children:"BL (Blastocisto Limitado)"}),e.jsx(N,{value:"BI",children:"BI (Blastocisto Irregular)"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(l,{onClick:Ga,className:"flex-1 bg-purple-600 hover:bg-purple-700",disabled:p,children:p?"Salvando...":`Classificar ${d.size} Embrião(ões)`}),e.jsx(l,{variant:"outline",onClick:()=>{y(!1)},disabled:p,children:"Cancelar"})]})]})]})}),e.jsx(ie,{open:Ea,onOpenChange:me,children:e.jsxs(te,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsxs(re,{children:["Congelar ",d.size," Embrião(ões)"]}),e.jsx(ne,{children:"Registrar congelamento dos embriões selecionados"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"data_congelamento",children:"Data de Congelamento *"}),e.jsx(pa,{id:"data_congelamento",value:F.data_congelamento,onChange:a=>De({...F,data_congelamento:a||""}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"localizacao_atual",children:"Localização (Botijão) *"}),e.jsx(us,{id:"localizacao_atual",value:F.localizacao_atual,onChange:a=>De({...F,localizacao_atual:a.target.value}),placeholder:"Ex: Botijão 1, Canister A",required:!0})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(l,{onClick:Va,className:"flex-1 bg-blue-600 hover:bg-blue-700",disabled:p,children:p?"Congelando...":`Congelar ${d.size} Embrião(ões)`}),e.jsx(l,{variant:"outline",onClick:()=>me(!1),disabled:p,children:"Cancelar"})]})]})]})}),e.jsx(ie,{open:Da,onOpenChange:he,children:e.jsxs(te,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsxs(re,{children:["Descartar ",d.size," Embrião(ões)"]}),e.jsx(ne,{children:"Descartar os embriões selecionados"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"data_descarte",children:"Data de Descarte *"}),e.jsx(pa,{id:"data_descarte",value:Z.data_descarte,onChange:a=>_e({...Z,data_descarte:a||""}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"observacoes",children:"Observações / Motivo"}),e.jsx(gs,{id:"observacoes",value:Z.observacoes,onChange:a=>_e({...Z,observacoes:a.target.value}),placeholder:"Informe o motivo do descarte (opcional)",rows:4})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(l,{onClick:Ua,className:"flex-1 bg-red-600 hover:bg-red-700",disabled:p,children:p?"Descartando...":`Descartar ${d.size} Embrião(ões)`}),e.jsx(l,{variant:"outline",onClick:()=>he(!1),disabled:p,children:"Cancelar"})]})]})]})}),e.jsx(ie,{open:wa,onOpenChange:fe,children:e.jsxs(te,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsxs(re,{children:["Direcionar ",d.size," Embrião(ões) Congelado(s) para Cliente"]}),e.jsx(ne,{children:"Direcionar embriões congelados selecionados para o estoque de um cliente"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"cliente_id",children:"Cliente *"}),e.jsxs(Ae,{value:ge.cliente_id,onValueChange:a=>ze({cliente_id:a}),children:[e.jsx(Ie,{children:e.jsx(Oe,{placeholder:"Selecione o cliente"})}),e.jsx(Fe,{children:sa.map(a=>e.jsx(N,{value:a.id,children:a.nome},a.id))})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(l,{onClick:Ja,className:"flex-1 bg-green-600 hover:bg-green-700",disabled:p,children:p?"Direcionando...":`Direcionar ${d.size} Embrião(ões)`}),e.jsx(l,{variant:"outline",onClick:()=>fe(!1),disabled:p,children:"Cancelar"})]})]})]})}),e.jsx(js,{open:za,onOpenChange:aa,children:e.jsxs(vs,{className:"w-full sm:max-w-2xl",children:[e.jsxs(Cs,{children:[e.jsx(Ss,{children:"Histórico do Embrião"}),e.jsxs(Ns,{children:["Histórico completo de eventos do embrião"," ",(J==null?void 0:J.identificacao)||(J==null?void 0:J.id.slice(0,8))]})]}),e.jsx("div",{className:"mt-6",children:Ia?e.jsx(da,{}):ia.length===0?e.jsx("p",{className:"text-slate-500 text-center py-8",children:"Nenhum histórico encontrado"}):e.jsx("div",{className:"space-y-4",children:ia.map(a=>{const i={CLASSIFICACAO:"Classificação",DESTINACAO:"Destinação",CONGELAMENTO:"Congelamento",DESCARTE:"Descarte",TRANSFERENCIA:"Transferência"};return e.jsx(Ke,{children:e.jsx(Ze,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:i[a.tipo_operacao]||a.tipo_operacao}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:a.data_mudanca?Ye(a.data_mudanca):"-"}),a.observacoes&&e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:a.observacoes})]}),e.jsx("div",{className:"text-right",children:e.jsx(ua,{status:a.status_novo||""})})]})})},a.id)})})})]})}),e.jsx(ie,{open:Oa,onOpenChange:Ee,children:e.jsxs(te,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsx(re,{children:"Editar Fazendas Destino"}),e.jsx(ne,{children:"Selecione as fazendas destino para este pacote de embriões."})]}),Y&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Pacote"}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[Y.pacote_info.fazenda_nome||"Fazenda não identificada"," →",Y.data_despacho?` ${Ye(Y.data_despacho)}`:""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Fazendas Destino"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto border rounded-md p-3",children:de.map(a=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-slate-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:pe.includes(a.id),onChange:i=>{i.target.checked?xe([...pe,a.id]):xe(pe.filter(o=>o!==a.id))},className:"rounded border-slate-300"}),e.jsx("span",{className:"text-sm",children:a.nome})]},a.id))}),de.length===0&&e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Nenhuma fazenda disponível"})]})]}),e.jsxs(ms,{children:[e.jsx(l,{variant:"outline",onClick:()=>{Ee(!1),Re(null),xe([])},disabled:p,children:"Cancelar"}),e.jsx(l,{onClick:$a,disabled:p,children:p?"Salvando...":"Salvar"})]})]})})]})}export{ni as default};
