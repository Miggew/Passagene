import{r as p,s as G,a as A,j as e,g as I,h as y}from"./index-CWtHucPz.js";import{u as q,C as $,a as M,b as U,c as J}from"./use-toast-C_ednEV-.js";import{T as K,a as Q,b as k,c as _,d as Y,e as x}from"./table-2v-HqcxP.js";import{D as W,a as X,b as Z,c as D,d as ee,e as ae}from"./dialog-DG0TUp-m.js";import{S as E,a as z,b as P,c as V,d as R}from"./select-BUr2m4f3.js";import{I as u}from"./input-bF23Jkur.js";import{L as m}from"./label-CDN-yMr6.js";import{T as F}from"./textarea-EUsZECCO.js";import{P as se}from"./PageHeader-DqMTzrbX.js";import{E as oe}from"./EmptyState-B00kV8BS.js";import{B as re}from"./badge-DewFfdNp.js";import{C as ie}from"./CamposDinamicosPorRaca-CpzLIksU.js";import{d as le,b as ne}from"./hooks-BHMrHO5Y.js";import{u as te}from"./useListFilter-EgHurVux.js";import"./index-Dast7Jda.js";import{P as ce}from"./plus-CgYPqLq7.js";import{S as de}from"./search-B6nVOFfl.js";import{E as me}from"./eye-DbaOMCVJ.js";import"./index-RvRMy3My.js";import"./x-BtWTyRSy.js";import"./index-H2w26JuE.js";import"./check-D_BDiPDp.js";const B=["Holandesa","Jersey","Gir","Girolando","Nelore","Angus","Brahman","Hereford","Simmental","Tabapuã","Sindi","Caracu","Canchim","Senepol","Brangus","Gir Leiteiro","Guzerá"],ue=(o,l)=>{var a,r,t;return((a=o.nome)==null?void 0:a.toLowerCase().includes(l))||((r=o.registro)==null?void 0:r.toLowerCase().includes(l))||((t=o.raca)==null?void 0:t.toLowerCase().includes(l))||!1},he={raca:(o,l)=>o.raca===l};function ge(){const{data:o=[],isLoading:l,error:a,refetch:r}=le();ne();const{filtered:t,searchTerm:g,setSearchTerm:i,filterValues:h,setFilterValue:n,clearFilters:s,hasActiveFilters:j}=te({data:o,searchFn:ue,extraFilters:he}),f=h.raca||"";return{loading:l,error:a,touros:o,filteredTouros:t,searchTerm:g,setSearchTerm:i,filtroRaca:f,setFiltroRaca:v=>n("raca",v),clearFilters:s,hasActiveFilters:j,loadTouros:async()=>{await r()},refetch:()=>r()}}const w={registro:"",nome:"",raca:"",data_nascimento:"",proprietario:"",fazenda_nome:"",pai_registro:"",pai_nome:"",mae_registro:"",mae_nome:"",genealogia_texto:"",link_catalogo:"",foto_url:"",link_video:"",observacoes:""},L={dados_geneticos:{},dados_producao:{},dados_conformacao:{},medidas_fisicas:{},dados_saude_reproducao:{},caseinas:{},outros_dados:{}};function pe({onSuccess:o}){const{toast:l}=q(),[a,r]=p.useState(!1),[t,g]=p.useState(!1),[i,h]=p.useState(w),[n,s]=p.useState(L),j=p.useCallback(()=>{h(w),s(L)},[]),f=p.useCallback((v,c,d)=>{s(N=>({...N,[d]:{...N[d],[v]:c===""?void 0:c}}))},[]),b=p.useCallback(()=>({...n.dados_geneticos,...n.dados_producao,...n.dados_conformacao,...n.medidas_fisicas,...n.dados_saude_reproducao,...n.caseinas,...n.outros_dados}),[n]),C=p.useCallback(async v=>{if(v.preventDefault(),!i.registro.trim()){l({title:"Erro de validacao",description:"Registro e obrigatorio",variant:"destructive"});return}if(!i.nome.trim()){l({title:"Erro de validacao",description:"Nome e obrigatorio",variant:"destructive"});return}if(!i.raca){l({title:"Erro de validacao",description:"Raca e obrigatoria",variant:"destructive"});return}try{g(!0);const c=H=>{const S={};return Object.entries(H).forEach(([O,T])=>{T!=null&&T!==""&&(S[O]=T)}),Object.keys(S).length>0?S:{}},d={registro:i.registro.trim(),nome:i.nome.trim(),raca:i.raca,data_nascimento:i.data_nascimento||null,proprietario:i.proprietario.trim()||null,fazenda_nome:i.fazenda_nome.trim()||null,pai_registro:i.pai_registro.trim()||null,pai_nome:i.pai_nome.trim()||null,mae_registro:i.mae_registro.trim()||null,mae_nome:i.mae_nome.trim()||null,genealogia_texto:i.genealogia_texto.trim()||null,link_catalogo:i.link_catalogo.trim()||null,foto_url:i.foto_url.trim()||null,link_video:i.link_video.trim()||null,observacoes:i.observacoes.trim()||null,disponivel:!0,dados_geneticos:c(n.dados_geneticos),dados_producao:c(n.dados_producao),dados_conformacao:c(n.dados_conformacao),medidas_fisicas:c(n.medidas_fisicas),dados_saude_reproducao:c(n.dados_saude_reproducao),caseinas:c(n.caseinas),outros_dados:c(n.outros_dados)},{error:N}=await G.from("touros").insert([d]);if(N)throw N;l({title:"Touro cadastrado",description:"Touro cadastrado com sucesso no catalogo"}),r(!1),j(),o()}catch(c){let d="Erro desconhecido";c&&typeof c=="object"&&"message"in c?d=c.message:typeof c=="string"&&(d=c),d.includes("RLS")||d.includes("policy")?d="RLS esta bloqueando escrita. Configure politicas anon no Supabase.":d.includes("duplicate")||d.includes("unique")?d="Ja existe um touro com este registro no catalogo.":(d.includes("null value")||d.includes("NOT NULL"))&&(d="Um ou mais campos obrigatorios nao foram preenchidos. Verifique o formulario."),l({title:"Erro ao cadastrar touro",description:d,variant:"destructive"})}finally{g(!1)}},[i,n,l,j,o]);return{formData:i,setFormData:h,dadosDinamicos:n,showDialog:a,setShowDialog:r,submitting:t,resetForm:j,handleCampoDinamicoChange:f,handleSubmit:C,getValoresDinamicos:b}}function qe(){const o=A(),{loading:l,filteredTouros:a,searchTerm:r,setSearchTerm:t,filtroRaca:g,setFiltroRaca:i,loadTouros:h}=ge(),{formData:n,setFormData:s,showDialog:j,setShowDialog:f,submitting:b,resetForm:C,handleCampoDinamicoChange:v,handleSubmit:c,getValoresDinamicos:d}=pe({onSuccess:h});return p.useEffect(()=>{h()},[h]),l?e.jsx(I,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Catalogo de Touros",description:"Gerenciar catalogo de touros para FIV",actions:e.jsx(_e,{showDialog:j,setShowDialog:f,formData:n,setFormData:s,submitting:b,resetForm:C,handleCampoDinamicoChange:v,handleSubmit:c,getValoresDinamicos:d})}),e.jsxs($,{children:[e.jsx(M,{children:e.jsx(U,{children:"Lista de Touros"})}),e.jsxs(J,{children:[e.jsx(xe,{searchTerm:r,setSearchTerm:t,filtroRaca:g,setFiltroRaca:i}),e.jsx(je,{touros:a,navigate:o})]})]})]})}function xe({searchTerm:o,setSearchTerm:l,filtroRaca:a,setFiltroRaca:r}){return e.jsx("div",{className:"space-y-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Buscar Touro"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(u,{placeholder:"Buscar por nome, registro ou raca...",value:o,onChange:t=>l(t.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Filtrar por Raca"}),e.jsxs(E,{value:a||"all",onValueChange:t=>r(t==="all"?"":t),children:[e.jsx(z,{children:e.jsx(P,{placeholder:"Todas as racas"})}),e.jsxs(V,{children:[e.jsx(R,{value:"all",children:"Todas as racas"}),B.map(t=>e.jsx(R,{value:t,children:t},t))]})]})]})]})})}function je({touros:o,navigate:l}){return e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs(k,{children:[e.jsx(_,{children:"Registro"}),e.jsx(_,{children:"Nome"}),e.jsx(_,{children:"Raca"}),e.jsx(_,{children:"NM$"}),e.jsx(_,{children:"TPI"}),e.jsx(_,{children:"PTAT"}),e.jsx(_,{className:"text-right",children:"Acoes"})]})}),e.jsx(Y,{children:o.length===0?e.jsx(k,{children:e.jsx(x,{colSpan:7,className:"text-center text-slate-500",children:e.jsx(oe,{title:"Nenhum touro cadastrado",description:"Cadastre o primeiro touro para comecar."})})}):o.map(a=>e.jsx(ve,{touro:a,navigate:l},a.id))})]})}function ve({touro:o,navigate:l}){return e.jsxs(k,{children:[e.jsx(x,{className:"font-medium",children:o.registro}),e.jsx(x,{children:o.nome}),e.jsx(x,{children:o.raca?e.jsx(re,{variant:"outline",children:o.raca}):"-"}),e.jsx(x,{children:o.nm_dolares!==null&&o.nm_dolares!==void 0?`+${o.nm_dolares}`:"-"}),e.jsx(x,{children:o.tpi!==null&&o.tpi!==void 0?`+${o.tpi}`:"-"}),e.jsx(x,{children:o.ptat!==null&&o.ptat!==void 0?`+${o.ptat}`:"-"}),e.jsx(x,{className:"text-right",children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>l(`/touros/${o.id}`),children:e.jsx(me,{className:"w-4 h-4"})})})]})}function _e({showDialog:o,setShowDialog:l,formData:a,setFormData:r,submitting:t,resetForm:g,handleCampoDinamicoChange:i,handleSubmit:h,getValoresDinamicos:n}){return e.jsxs(W,{open:o,onOpenChange:s=>{l(s),s||g()},children:[e.jsx(X,{asChild:!0,children:e.jsxs(y,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Novo Touro"]})}),e.jsxs(Z,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(ee,{children:"Cadastrar Novo Touro"}),e.jsx(ae,{children:"Adicione um touro ao catalogo. Os clientes poderao ter doses deste touro."})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"registro",children:"Registro *"}),e.jsx(u,{id:"registro",value:a.registro,onChange:s=>r({...a,registro:s.target.value}),placeholder:"Ex: 250HO14579",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"nome",children:"Nome *"}),e.jsx(u,{id:"nome",value:a.nome,onChange:s=>r({...a,nome:s.target.value}),placeholder:"Ex: HANCOCK",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"raca",children:"Raca"}),e.jsxs(E,{value:a.raca,onValueChange:s=>r({...a,raca:s}),children:[e.jsx(z,{children:e.jsx(P,{placeholder:"Selecione a raca"})}),e.jsx(V,{children:B.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"data_nascimento",children:"Data de Nascimento"}),e.jsx(u,{id:"data_nascimento",type:"date",value:a.data_nascimento,onChange:s=>r({...a,data_nascimento:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"proprietario",children:"Proprietario"}),e.jsx(u,{id:"proprietario",value:a.proprietario,onChange:s=>r({...a,proprietario:s.target.value}),placeholder:"Nome do proprietario"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"fazenda_nome",children:"Fazenda"}),e.jsx(u,{id:"fazenda_nome",value:a.fazenda_nome,onChange:s=>r({...a,fazenda_nome:s.target.value}),placeholder:"Nome da fazenda"})]})]}),a.raca&&e.jsx("div",{className:"border-t pt-4",children:e.jsx(ie,{raca:a.raca,valores:n(),onChange:i})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Pedigree"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pai_registro",children:"Registro do Pai"}),e.jsx(u,{id:"pai_registro",value:a.pai_registro,onChange:s=>r({...a,pai_registro:s.target.value}),placeholder:"Registro do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pai_nome",children:"Nome do Pai"}),e.jsx(u,{id:"pai_nome",value:a.pai_nome,onChange:s=>r({...a,pai_nome:s.target.value}),placeholder:"Nome do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"mae_registro",children:"Registro da Mae"}),e.jsx(u,{id:"mae_registro",value:a.mae_registro,onChange:s=>r({...a,mae_registro:s.target.value}),placeholder:"Registro da mae"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"mae_nome",children:"Nome da Mae"}),e.jsx(u,{id:"mae_nome",value:a.mae_nome,onChange:s=>r({...a,mae_nome:s.target.value}),placeholder:"Nome da mae"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(m,{htmlFor:"genealogia_texto",children:"Genealogia Completa (Texto)"}),e.jsx(F,{id:"genealogia_texto",value:a.genealogia_texto,onChange:s=>r({...a,genealogia_texto:s.target.value}),placeholder:"Genealogia completa em formato texto",rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"link_catalogo",children:"Link do Catalogo"}),e.jsx(u,{id:"link_catalogo",type:"url",value:a.link_catalogo,onChange:s=>r({...a,link_catalogo:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"foto_url",children:"URL da Foto"}),e.jsx(u,{id:"foto_url",type:"url",value:a.foto_url,onChange:s=>r({...a,foto_url:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"link_video",children:"Link do Video (YouTube, etc.)"}),e.jsx(u,{id:"link_video",type:"url",value:a.link_video,onChange:s=>r({...a,link_video:s.target.value}),placeholder:"https://..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"observacoes",children:"Observacoes"}),e.jsx(F,{id:"observacoes",value:a.observacoes,onChange:s=>r({...a,observacoes:s.target.value}),placeholder:"Observacoes adicionais sobre o touro",rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(y,{type:"submit",className:"flex-1 bg-green-600 hover:bg-green-700",disabled:t,children:t?"Salvando...":"Cadastrar Touro"}),e.jsx(y,{type:"button",variant:"outline",onClick:()=>{l(!1),g()},disabled:t,children:"Cancelar"})]})]})]})]})}export{qe as default};
