import{r,a as R,s as v,j as e,i as H,g as M,U as C,B as k}from"./index-BPMeM9-O.js";import{C as p,d as j,a as I,b as P}from"./card-8azKTSNJ.js";import{I as U}from"./input-tqcTRdPv.js";import{S as V,a as D,b as G,c as W,d as w}from"./select-La4nrp5K.js";import{T as X,a as $,b,c as i,d as q,e as d}from"./table-l_s8S0JA.js";import{P as A}from"./PageHeader-DQ4rM2jO.js";import{E as J}from"./EmptyState-yqSFIU3C.js";import{h as K}from"./error-handler-B0L1mfY3.js";import{M as O}from"./map-pin-B27L4YNJ.js";import{F as Q}from"./filter-DouKIrIu.js";import{S as Y}from"./search-SyV5imYB.js";import{X as Z}from"./x-BxiwAMrM.js";import"./index-C5PY5DOm.js";import"./check-Bdb-Yd05.js";import"./use-toast-BGNwDi9e.js";function je(){const[c,S]=r.useState([]),[T,L]=r.useState([]),[F,f]=r.useState(!0),[a,g]=r.useState(""),[l,N]=r.useState("todos"),y=R();r.useEffect(()=>{z()},[]);const z=async()=>{try{f(!0);const{data:s,error:m}=await v.from("clientes").select("*").order("nome");if(m)throw m;L(s||[]);const{data:n,error:o}=await v.from("fazendas").select("*").order("nome",{ascending:!0});if(o)throw o;const x=new Map((s||[]).map(t=>[t.id,t.nome])),h=n==null?void 0:n.map(t=>({...t,cliente_nome:x.get(t.cliente_id)}));S(h||[])}catch(s){K(s,"Erro ao carregar dados")}finally{f(!1)}},u=c.filter(s=>{var o,x,h,t;const m=!a||((o=s.nome)==null?void 0:o.toLowerCase().includes(a.toLowerCase()))||((x=s.cliente_nome)==null?void 0:x.toLowerCase().includes(a.toLowerCase()))||((h=s.responsavel)==null?void 0:h.toLowerCase().includes(a.toLowerCase()))||((t=s.localizacao)==null?void 0:t.toLowerCase().includes(a.toLowerCase())),n=l==="todos"||s.cliente_id===l;return m&&n}),E=c.length,_=new Set(c.map(s=>s.cliente_id)).size,B=c.filter(s=>s.responsavel).length;return F?e.jsx(H,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{title:"Fazendas",description:"Gerenciar fazendas do sistema"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(p,{children:e.jsx(j,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de Fazendas"}),e.jsx("p",{className:"text-2xl font-bold",children:E})]})]})})}),e.jsx(p,{children:e.jsx(j,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clientes"}),e.jsx("p",{className:"text-2xl font-bold",children:_})]})]})})}),e.jsx(p,{children:e.jsx(j,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Com Responsável"}),e.jsx("p",{className:"text-2xl font-bold",children:B})]})]})})})]}),e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Q,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[250px]",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(U,{placeholder:"Buscar por nome, cliente, responsável...",value:a,onChange:s=>g(s.target.value),className:"pl-9 h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-emerald-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(C,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Cliente"})]}),e.jsx("div",{className:"w-[200px]",children:e.jsxs(V,{value:l,onValueChange:N,children:[e.jsx(D,{className:"h-9",children:e.jsx(G,{placeholder:"Cliente"})}),e.jsxs(W,{children:[e.jsx(w,{value:"todos",children:"Todos os clientes"}),T.map(s=>e.jsx(w,{value:s.id,children:s.nome},s.id))]})]})})]}),(a||l!=="todos")&&e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{g(""),N("todos")},className:"h-9 ml-auto",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})]})}),e.jsxs(p,{children:[e.jsx(I,{children:e.jsxs(P,{children:["Fazendas (",u.length,")"]})}),e.jsx(j,{children:u.length===0?e.jsx(J,{title:"Nenhuma fazenda encontrada",description:a||l!=="todos"?"Tente ajustar os filtros de busca":"Cadastre uma fazenda para começar."}):e.jsxs(X,{children:[e.jsx($,{children:e.jsxs(b,{children:[e.jsx(i,{children:"Nome"}),e.jsx(i,{children:"Cliente"}),e.jsx(i,{children:"Responsável"}),e.jsx(i,{children:"Contato"}),e.jsx(i,{children:"Localização"})]})}),e.jsx(q,{children:u.map(s=>e.jsxs(b,{className:"cursor-pointer hover:bg-muted",onClick:()=>y(`/fazendas/${s.id}`),children:[e.jsx(d,{className:"font-medium text-primary",children:s.nome}),e.jsx(d,{children:s.cliente_nome||"-"}),e.jsx(d,{children:s.responsavel||"-"}),e.jsx(d,{children:s.contato_responsavel||"-"}),e.jsx(d,{children:s.localizacao||"-"})]},s.id))})]})})]})]})}export{je as default};
