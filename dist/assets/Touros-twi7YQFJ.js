import{r as u,s as z,f as A,j as e,a as I,B as S}from"./index-DM5u2d-F.js";import{C as $,a as M,b as U,d as J}from"./card-B_EQ6x91.js";import{T as K,a as Y,b as R,c as N,d as Q,e as _}from"./table-CEKyj1ed.js";import{D as W,a as X,b as Z,c as D,d as ee,e as ae}from"./dialog-2y4jBKyr.js";import{S as P,a as B,b as H,c as O,d as w}from"./select-B_NoJ61H.js";import{I as x}from"./input-CtUEWea1.js";import{L as m}from"./label-Bhhf9ayq.js";import{T as E}from"./textarea-Kj1o8r55.js";import{P as se}from"./PageHeader-JgO8x5IE.js";import{E as oe}from"./EmptyState-ChaxWsz8.js";import{B as re}from"./badge-D_AVhbx8.js";import{C as ie}from"./CamposDinamicosPorRaca-BWVT-Ht_.js";import{u as V}from"./use-toast-BOUGyrIz.js";import{P as le}from"./plus-DJrruxx9.js";import{S as te}from"./search-QDhw42Qv.js";import{E as ne}from"./eye-8DczHlUQ.js";import"./index-CWb7Yp_3.js";import"./index-sCsFC1oc.js";import"./x-DsJYRTDR.js";import"./index-ClZPXJQX.js";import"./index-BEVMOrkK.js";import"./check-Y5eEMkO8.js";const G=["Holandesa","Jersey","Gir","Girolando","Nelore","Angus","Brahman","Hereford","Simmental","Tabapuã","Sindi","Caracu","Canchim","Senepol","Brangus","Gir Leiteiro","Guzerá"];function ce(){const{toast:o}=V(),[c,s]=u.useState(!0),[i,d]=u.useState([]),[j,r]=u.useState([]),[p,l]=u.useState(""),[a,f]=u.useState(""),C=u.useCallback(()=>{let h=[...i];if(p.trim()){const g=p.toLowerCase();h=h.filter(t=>{var n,v,T;return((n=t.nome)==null?void 0:n.toLowerCase().includes(g))||((v=t.registro)==null?void 0:v.toLowerCase().includes(g))||((T=t.raca)==null?void 0:T.toLowerCase().includes(g))})}a&&(h=h.filter(g=>g.raca===a)),r(h)},[i,p,a]);u.useEffect(()=>{C()},[C]);const b=u.useCallback(async()=>{try{s(!0);const{data:h,error:g}=await z.from("touros").select("*").order("nome",{ascending:!0});if(g)throw g;d(h||[]),r(h||[])}catch(h){o({title:"Erro ao carregar touros",description:h instanceof Error?h.message:"Erro desconhecido",variant:"destructive"})}finally{s(!1)}},[o]);return{loading:c,touros:i,filteredTouros:j,searchTerm:p,setSearchTerm:l,filtroRaca:a,setFiltroRaca:f,loadTouros:b}}const L={registro:"",nome:"",raca:"",data_nascimento:"",proprietario:"",fazenda_nome:"",pai_registro:"",pai_nome:"",mae_registro:"",mae_nome:"",genealogia_texto:"",link_catalogo:"",foto_url:"",link_video:"",observacoes:""},F={dados_geneticos:{},dados_producao:{},dados_conformacao:{},medidas_fisicas:{},dados_saude_reproducao:{},caseinas:{},outros_dados:{}};function de({onSuccess:o}){const{toast:c}=V(),[s,i]=u.useState(!1),[d,j]=u.useState(!1),[r,p]=u.useState(L),[l,a]=u.useState(F),f=u.useCallback(()=>{p(L),a(F)},[]),C=u.useCallback((g,t,n)=>{a(v=>({...v,[n]:{...v[n],[g]:t===""?void 0:t}}))},[]),b=u.useCallback(()=>({...l.dados_geneticos,...l.dados_producao,...l.dados_conformacao,...l.medidas_fisicas,...l.dados_saude_reproducao,...l.caseinas,...l.outros_dados}),[l]),h=u.useCallback(async g=>{if(g.preventDefault(),!r.registro.trim()){c({title:"Erro de validacao",description:"Registro e obrigatorio",variant:"destructive"});return}if(!r.nome.trim()){c({title:"Erro de validacao",description:"Nome e obrigatorio",variant:"destructive"});return}if(!r.raca){c({title:"Erro de validacao",description:"Raca e obrigatoria",variant:"destructive"});return}try{j(!0);const t=T=>{const k={};return Object.entries(T).forEach(([q,y])=>{y!=null&&y!==""&&(k[q]=y)}),Object.keys(k).length>0?k:{}},n={registro:r.registro.trim(),nome:r.nome.trim(),raca:r.raca,data_nascimento:r.data_nascimento||null,proprietario:r.proprietario.trim()||null,fazenda_nome:r.fazenda_nome.trim()||null,pai_registro:r.pai_registro.trim()||null,pai_nome:r.pai_nome.trim()||null,mae_registro:r.mae_registro.trim()||null,mae_nome:r.mae_nome.trim()||null,genealogia_texto:r.genealogia_texto.trim()||null,link_catalogo:r.link_catalogo.trim()||null,foto_url:r.foto_url.trim()||null,link_video:r.link_video.trim()||null,observacoes:r.observacoes.trim()||null,disponivel:!0,dados_geneticos:t(l.dados_geneticos),dados_producao:t(l.dados_producao),dados_conformacao:t(l.dados_conformacao),medidas_fisicas:t(l.medidas_fisicas),dados_saude_reproducao:t(l.dados_saude_reproducao),caseinas:t(l.caseinas),outros_dados:t(l.outros_dados)},{error:v}=await z.from("touros").insert([n]);if(v)throw v;c({title:"Touro cadastrado",description:"Touro cadastrado com sucesso no catalogo"}),i(!1),f(),o()}catch(t){let n="Erro desconhecido";t&&typeof t=="object"&&"message"in t?n=t.message:typeof t=="string"&&(n=t),n.includes("RLS")||n.includes("policy")?n="RLS esta bloqueando escrita. Configure politicas anon no Supabase.":n.includes("duplicate")||n.includes("unique")?n="Ja existe um touro com este registro no catalogo.":(n.includes("null value")||n.includes("NOT NULL"))&&(n="Um ou mais campos obrigatorios nao foram preenchidos. Verifique o formulario."),c({title:"Erro ao cadastrar touro",description:n,variant:"destructive"})}finally{j(!1)}},[r,l,c,f,o]);return{formData:r,setFormData:p,dadosDinamicos:l,showDialog:s,setShowDialog:i,submitting:d,resetForm:f,handleCampoDinamicoChange:C,handleSubmit:h,getValoresDinamicos:b}}function Oe(){const o=A(),{loading:c,filteredTouros:s,searchTerm:i,setSearchTerm:d,filtroRaca:j,setFiltroRaca:r,loadTouros:p}=ce(),{formData:l,setFormData:a,showDialog:f,setShowDialog:C,submitting:b,resetForm:h,handleCampoDinamicoChange:g,handleSubmit:t,getValoresDinamicos:n}=de({onSuccess:p});return u.useEffect(()=>{p()},[p]),c?e.jsx(I,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Catalogo de Touros",description:"Gerenciar catalogo de touros para FIV",actions:e.jsx(ge,{showDialog:f,setShowDialog:C,formData:l,setFormData:a,submitting:b,resetForm:h,handleCampoDinamicoChange:g,handleSubmit:t,getValoresDinamicos:n})}),e.jsxs($,{children:[e.jsx(M,{children:e.jsx(U,{children:"Lista de Touros"})}),e.jsxs(J,{children:[e.jsx(me,{searchTerm:i,setSearchTerm:d,filtroRaca:j,setFiltroRaca:r}),e.jsx(ue,{touros:s,navigate:o})]})]})]})}function me({searchTerm:o,setSearchTerm:c,filtroRaca:s,setFiltroRaca:i}){return e.jsx("div",{className:"space-y-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Buscar Touro"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(x,{placeholder:"Buscar por nome, registro ou raca...",value:o,onChange:d=>c(d.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Filtrar por Raca"}),e.jsxs(P,{value:s||"all",onValueChange:d=>i(d==="all"?"":d),children:[e.jsx(B,{children:e.jsx(H,{placeholder:"Todas as racas"})}),e.jsxs(O,{children:[e.jsx(w,{value:"all",children:"Todas as racas"}),G.map(d=>e.jsx(w,{value:d,children:d},d))]})]})]})]})})}function ue({touros:o,navigate:c}){return e.jsxs(K,{children:[e.jsx(Y,{children:e.jsxs(R,{children:[e.jsx(N,{children:"Registro"}),e.jsx(N,{children:"Nome"}),e.jsx(N,{children:"Raca"}),e.jsx(N,{children:"NM$"}),e.jsx(N,{children:"TPI"}),e.jsx(N,{children:"PTAT"}),e.jsx(N,{className:"text-right",children:"Acoes"})]})}),e.jsx(Q,{children:o.length===0?e.jsx(R,{children:e.jsx(_,{colSpan:7,className:"text-center text-slate-500",children:e.jsx(oe,{title:"Nenhum touro cadastrado",description:"Cadastre o primeiro touro para comecar."})})}):o.map(s=>e.jsx(he,{touro:s,navigate:c},s.id))})]})}function he({touro:o,navigate:c}){return e.jsxs(R,{children:[e.jsx(_,{className:"font-medium",children:o.registro}),e.jsx(_,{children:o.nome}),e.jsx(_,{children:o.raca?e.jsx(re,{variant:"outline",children:o.raca}):"-"}),e.jsx(_,{children:o.nm_dolares!==null&&o.nm_dolares!==void 0?`+${o.nm_dolares}`:"-"}),e.jsx(_,{children:o.tpi!==null&&o.tpi!==void 0?`+${o.tpi}`:"-"}),e.jsx(_,{children:o.ptat!==null&&o.ptat!==void 0?`+${o.ptat}`:"-"}),e.jsx(_,{className:"text-right",children:e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>c(`/touros/${o.id}`),children:e.jsx(ne,{className:"w-4 h-4"})})})]})}function ge({showDialog:o,setShowDialog:c,formData:s,setFormData:i,submitting:d,resetForm:j,handleCampoDinamicoChange:r,handleSubmit:p,getValoresDinamicos:l}){return e.jsxs(W,{open:o,onOpenChange:a=>{c(a),a||j()},children:[e.jsx(X,{asChild:!0,children:e.jsxs(S,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Novo Touro"]})}),e.jsxs(Z,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(ee,{children:"Cadastrar Novo Touro"}),e.jsx(ae,{children:"Adicione um touro ao catalogo. Os clientes poderao ter doses deste touro."})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"registro",children:"Registro *"}),e.jsx(x,{id:"registro",value:s.registro,onChange:a=>i({...s,registro:a.target.value}),placeholder:"Ex: 250HO14579",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"nome",children:"Nome *"}),e.jsx(x,{id:"nome",value:s.nome,onChange:a=>i({...s,nome:a.target.value}),placeholder:"Ex: HANCOCK",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"raca",children:"Raca"}),e.jsxs(P,{value:s.raca,onValueChange:a=>i({...s,raca:a}),children:[e.jsx(B,{children:e.jsx(H,{placeholder:"Selecione a raca"})}),e.jsx(O,{children:G.map(a=>e.jsx(w,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"data_nascimento",children:"Data de Nascimento"}),e.jsx(x,{id:"data_nascimento",type:"date",value:s.data_nascimento,onChange:a=>i({...s,data_nascimento:a.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"proprietario",children:"Proprietario"}),e.jsx(x,{id:"proprietario",value:s.proprietario,onChange:a=>i({...s,proprietario:a.target.value}),placeholder:"Nome do proprietario"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"fazenda_nome",children:"Fazenda"}),e.jsx(x,{id:"fazenda_nome",value:s.fazenda_nome,onChange:a=>i({...s,fazenda_nome:a.target.value}),placeholder:"Nome da fazenda"})]})]}),s.raca&&e.jsx("div",{className:"border-t pt-4",children:e.jsx(ie,{raca:s.raca,valores:l(),onChange:r})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Pedigree"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pai_registro",children:"Registro do Pai"}),e.jsx(x,{id:"pai_registro",value:s.pai_registro,onChange:a=>i({...s,pai_registro:a.target.value}),placeholder:"Registro do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pai_nome",children:"Nome do Pai"}),e.jsx(x,{id:"pai_nome",value:s.pai_nome,onChange:a=>i({...s,pai_nome:a.target.value}),placeholder:"Nome do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"mae_registro",children:"Registro da Mae"}),e.jsx(x,{id:"mae_registro",value:s.mae_registro,onChange:a=>i({...s,mae_registro:a.target.value}),placeholder:"Registro da mae"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"mae_nome",children:"Nome da Mae"}),e.jsx(x,{id:"mae_nome",value:s.mae_nome,onChange:a=>i({...s,mae_nome:a.target.value}),placeholder:"Nome da mae"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(m,{htmlFor:"genealogia_texto",children:"Genealogia Completa (Texto)"}),e.jsx(E,{id:"genealogia_texto",value:s.genealogia_texto,onChange:a=>i({...s,genealogia_texto:a.target.value}),placeholder:"Genealogia completa em formato texto",rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"link_catalogo",children:"Link do Catalogo"}),e.jsx(x,{id:"link_catalogo",type:"url",value:s.link_catalogo,onChange:a=>i({...s,link_catalogo:a.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"foto_url",children:"URL da Foto"}),e.jsx(x,{id:"foto_url",type:"url",value:s.foto_url,onChange:a=>i({...s,foto_url:a.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"link_video",children:"Link do Video (YouTube, etc.)"}),e.jsx(x,{id:"link_video",type:"url",value:s.link_video,onChange:a=>i({...s,link_video:a.target.value}),placeholder:"https://..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"observacoes",children:"Observacoes"}),e.jsx(E,{id:"observacoes",value:s.observacoes,onChange:a=>i({...s,observacoes:a.target.value}),placeholder:"Observacoes adicionais sobre o touro",rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(S,{type:"submit",className:"flex-1 bg-green-600 hover:bg-green-700",disabled:d,children:d?"Salvando...":"Cadastrar Touro"}),e.jsx(S,{type:"button",variant:"outline",onClick:()=>{c(!1),j()},disabled:d,children:"Cancelar"})]})]})]})]})}export{Oe as default};
