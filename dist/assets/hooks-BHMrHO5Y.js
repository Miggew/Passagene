var ge=e=>{throw TypeError(e)};var te=(e,t,s)=>t.has(e)||ge("Cannot "+s);var a=(e,t,s)=>(te(e,t,"read from private field"),s?s.call(e):t.get(e)),m=(e,t,s)=>t.has(e)?ge("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),d=(e,t,s,r)=>(te(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),p=(e,t,s)=>(te(e,t,"access private method"),s);import{M as Fe,N as _e,O as S,Q as se,V as L,W as ae,X as re,Y as Re,Z as Qe,_ as Me,$ as ze,a0 as be,a1 as Se,r as I,a2 as Ae,a3 as we,s as x}from"./index-CWtHucPz.js";var b,n,k,R,A,q,O,F,V,H,N,D,P,Q,U,o,K,ie,ne,oe,ce,ue,he,le,Ie,Te,De=(Te=class extends Fe{constructor(t,s){super();m(this,o);m(this,b);m(this,n);m(this,k);m(this,R);m(this,A);m(this,q);m(this,O);m(this,F);m(this,V);m(this,H);m(this,N);m(this,D);m(this,P);m(this,Q);m(this,U,new Set);this.options=s,d(this,b,t),d(this,F,null),d(this,O,_e()),this.options.experimental_prefetchInRender||a(this,O).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(a(this,n).addObserver(this),ve(a(this,n),this.options)?p(this,o,K).call(this):this.updateResult(),p(this,o,ce).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return de(a(this,n),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return de(a(this,n),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,o,ue).call(this),p(this,o,he).call(this),a(this,n).removeObserver(this)}setOptions(t){const s=this.options,r=a(this,n);if(this.options=a(this,b).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof S(this.options.enabled,a(this,n))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");p(this,o,le).call(this),a(this,n).setOptions(this.options),s._defaulted&&!se(this.options,s)&&a(this,b).getQueryCache().notify({type:"observerOptionsUpdated",query:a(this,n),observer:this});const u=this.hasListeners();u&&Ee(a(this,n),r,this.options,s)&&p(this,o,K).call(this),this.updateResult(),u&&(a(this,n)!==r||S(this.options.enabled,a(this,n))!==S(s.enabled,a(this,n))||L(this.options.staleTime,a(this,n))!==L(s.staleTime,a(this,n)))&&p(this,o,ie).call(this);const i=p(this,o,ne).call(this);u&&(a(this,n)!==r||S(this.options.enabled,a(this,n))!==S(s.enabled,a(this,n))||i!==a(this,Q))&&p(this,o,oe).call(this,i)}getOptimisticResult(t){const s=a(this,b).getQueryCache().build(a(this,b),t),r=this.createResult(s,t);return xe(this,r)&&(d(this,R,r),d(this,q,this.options),d(this,A,a(this,n).state)),r}getCurrentResult(){return a(this,R)}trackResult(t,s){return new Proxy(t,{get:(r,u)=>(this.trackProp(u),s==null||s(u),Reflect.get(r,u))})}trackProp(t){a(this,U).add(t)}getCurrentQuery(){return a(this,n)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=a(this,b).defaultQueryOptions(t),r=a(this,b).getQueryCache().build(a(this,b),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(t){return p(this,o,K).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),a(this,R)))}createResult(t,s){var me;const r=a(this,n),u=this.options,i=a(this,R),c=a(this,A),v=a(this,q),g=t!==r?t.state:a(this,k),{state:y}=t;let l={...y},z=!1,h;if(s._optimisticResults){const C=this.hasListeners(),Z=!C&&ve(t,s),B=C&&Ee(t,r,s,u);(Z||B)&&(l={...l,...ze(y.data,t.options)}),s._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:_,errorUpdatedAt:T,status:E}=l;h=l.data;let W=!1;if(s.placeholderData!==void 0&&h===void 0&&E==="pending"){let C;i!=null&&i.isPlaceholderData&&s.placeholderData===(v==null?void 0:v.placeholderData)?(C=i.data,W=!0):C=typeof s.placeholderData=="function"?s.placeholderData((me=a(this,N))==null?void 0:me.state.data,a(this,N)):s.placeholderData,C!==void 0&&(E="success",h=be(i==null?void 0:i.data,C,s),z=!0)}if(s.select&&h!==void 0&&!W)if(i&&h===(c==null?void 0:c.data)&&s.select===a(this,V))h=a(this,H);else try{d(this,V,s.select),h=s.select(h),h=be(i==null?void 0:i.data,h,s),d(this,H,h),d(this,F,null)}catch(C){d(this,F,C)}a(this,F)&&(_=a(this,F),h=a(this,H),T=Date.now(),E="error");const $=l.fetchStatus==="fetching",J=E==="pending",ee=E==="error",pe=J&&$,ye=h!==void 0,w={status:E,fetchStatus:l.fetchStatus,isPending:J,isSuccess:E==="success",isError:ee,isInitialLoading:pe,isLoading:pe,data:h,dataUpdatedAt:l.dataUpdatedAt,error:_,errorUpdatedAt:T,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>g.dataUpdateCount||l.errorUpdateCount>g.errorUpdateCount,isFetching:$,isRefetching:$&&!J,isLoadingError:ee&&!ye,isPaused:l.fetchStatus==="paused",isPlaceholderData:z,isRefetchError:ee&&ye,isStale:fe(t,s),refetch:this.refetch,promise:a(this,O),isEnabled:S(s.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const C=G=>{w.status==="error"?G.reject(w.error):w.data!==void 0&&G.resolve(w.data)},Z=()=>{const G=d(this,O,w.promise=_e());C(G)},B=a(this,O);switch(B.status){case"pending":t.queryHash===r.queryHash&&C(B);break;case"fulfilled":(w.status==="error"||w.data!==B.value)&&Z();break;case"rejected":(w.status!=="error"||w.error!==B.reason)&&Z();break}}return w}updateResult(){const t=a(this,R),s=this.createResult(a(this,n),this.options);if(d(this,A,a(this,n).state),d(this,q,this.options),a(this,A).data!==void 0&&d(this,N,a(this,n)),se(s,t))return;d(this,R,s);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:u}=this.options,i=typeof u=="function"?u():u;if(i==="all"||!i&&!a(this,U).size)return!0;const c=new Set(i??a(this,U));return this.options.throwOnError&&c.add("error"),Object.keys(a(this,R)).some(v=>{const f=v;return a(this,R)[f]!==t[f]&&c.has(f)})};p(this,o,Ie).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,o,ce).call(this)}},b=new WeakMap,n=new WeakMap,k=new WeakMap,R=new WeakMap,A=new WeakMap,q=new WeakMap,O=new WeakMap,F=new WeakMap,V=new WeakMap,H=new WeakMap,N=new WeakMap,D=new WeakMap,P=new WeakMap,Q=new WeakMap,U=new WeakMap,o=new WeakSet,K=function(t){p(this,o,le).call(this);let s=a(this,n).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(ae)),s},ie=function(){p(this,o,ue).call(this);const t=L(this.options.staleTime,a(this,n));if(re||a(this,R).isStale||!Re(t))return;const r=Qe(a(this,R).dataUpdatedAt,t)+1;d(this,D,setTimeout(()=>{a(this,R).isStale||this.updateResult()},r))},ne=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(a(this,n)):this.options.refetchInterval)??!1},oe=function(t){p(this,o,he).call(this),d(this,Q,t),!(re||S(this.options.enabled,a(this,n))===!1||!Re(a(this,Q))||a(this,Q)===0)&&d(this,P,setInterval(()=>{(this.options.refetchIntervalInBackground||Me.isFocused())&&p(this,o,K).call(this)},a(this,Q)))},ce=function(){p(this,o,ie).call(this),p(this,o,oe).call(this,p(this,o,ne).call(this))},ue=function(){a(this,D)&&(clearTimeout(a(this,D)),d(this,D,void 0))},he=function(){a(this,P)&&(clearInterval(a(this,P)),d(this,P,void 0))},le=function(){const t=a(this,b).getQueryCache().build(a(this,b),this.options);if(t===a(this,n))return;const s=a(this,n);d(this,n,t),d(this,k,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},Ie=function(t){Se.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(a(this,R))}),a(this,b).getQueryCache().notify({query:a(this,n),type:"observerResultsUpdated"})})},Te);function Pe(e,t){return S(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function ve(e,t){return Pe(e,t)||e.state.data!==void 0&&de(e,t,t.refetchOnMount)}function de(e,t,s){if(S(t.enabled,e)!==!1&&L(t.staleTime,e)!=="static"){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&fe(e,t)}return!1}function Ee(e,t,s,r){return(e!==t||S(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&fe(e,s)}function fe(e,t){return S(t.enabled,e)!==!1&&e.isStaleByTime(L(t.staleTime,e))}function xe(e,t){return!se(e.getCurrentResult(),t)}var Oe=I.createContext(!1),Be=()=>I.useContext(Oe);Oe.Provider;function qe(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var He=I.createContext(qe()),Ne=()=>I.useContext(He),Ue=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Ke=e=>{I.useEffect(()=>{e.clearReset()},[e])},Le=({result:e,errorResetBoundary:t,throwOnError:s,query:r,suspense:u})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(u&&e.data===void 0||Ae(s,[e.error,r])),ke=e=>{if(e.suspense){const t=r=>r==="static"?r:Math.max(r??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...r)=>t(s(...r)):t(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Ve=(e,t)=>e.isLoading&&e.isFetching&&!t,Ye=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Ce=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function je(e,t,s){var l,z,h,_,T;const r=Be(),u=Ne(),i=we(),c=i.defaultQueryOptions(e);(z=(l=i.getDefaultOptions().queries)==null?void 0:l._experimental_beforeQuery)==null||z.call(l,c),c._optimisticResults=r?"isRestoring":"optimistic",ke(c),Ue(c,u),Ke(u);const v=!i.getQueryCache().get(c.queryHash),[f]=I.useState(()=>new t(i,c)),g=f.getOptimisticResult(c),y=!r&&e.subscribed!==!1;if(I.useSyncExternalStore(I.useCallback(E=>{const W=y?f.subscribe(Se.batchCalls(E)):ae;return f.updateResult(),W},[f,y]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),I.useEffect(()=>{f.setOptions(c)},[c,f]),Ye(c,g))throw Ce(c,f,u);if(Le({result:g,errorResetBoundary:u,throwOnError:c.throwOnError,query:i.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw g.error;if((_=(h=i.getDefaultOptions().queries)==null?void 0:h._experimental_afterQuery)==null||_.call(h,c,g),c.experimental_prefetchInRender&&!re&&Ve(g,r)){const E=v?Ce(c,f,u):(T=i.getQueryCache().get(c.queryHash))==null?void 0:T.promise;E==null||E.catch(ae).finally(()=>{f.updateResult()})}return c.notifyOnChangeProps?g:f.trackResult(g)}function Y(e,t){return je(e,De)}async function Xe(){const{data:e,error:t}=await x.from("fazendas").select("id, nome, cliente_id").order("nome",{ascending:!0});if(t)throw t;return e||[]}async function We(){const{data:e,error:t}=await x.from("touros").select("*").order("nome",{ascending:!0});if(t)throw t;return e||[]}async function Ze(e){const{data:t,error:s}=await x.from("doadoras").select(`
      *,
      aspiracoes_doadoras(
        total_oocitos,
        data_aspiracao
      )
    `).eq("fazenda_id",e).order("created_at",{ascending:!1});if(s)throw s;return(t||[]).map(r=>{const u=r.aspiracoes_doadoras||[],i=u.length>0?u.sort((f,g)=>new Date(g.data_aspiracao).getTime()-new Date(f.data_aspiracao).getTime())[0]:null,{aspiracoes_doadoras:c,...v}=r;return{...v,ultima_aspiracao_total_oocitos:i==null?void 0:i.total_oocitos,ultima_aspiracao_data:i==null?void 0:i.data_aspiracao}})}async function Ge(e){const{data:t,error:s}=await x.from("vw_receptoras_fazenda_atual").select("receptora_id, fazenda_nome_atual").eq("fazenda_id_atual",e);if(s)throw s;const r=(t==null?void 0:t.map(y=>y.receptora_id))||[];if(r.length===0)return[];const{data:u,error:i}=await x.from("receptoras").select("*").in("id",r).order("identificacao",{ascending:!0});if(i)throw i;const c=new Map((t==null?void 0:t.map(y=>[y.receptora_id,y.fazenda_nome_atual]))||[]),v=(u||[]).map(y=>({...y,fazenda_nome_atual:c.get(y.id),status_calculado:y.status_reprodutivo||"VAZIA"})),f=["PRENHE","PRENHE_RETOQUE","PRENHE_FEMEA","PRENHE_MACHO","PRENHE_SEM_SEXO","PRENHE_2_SEXOS"],g=v.filter(y=>f.includes(y.status_calculado)||y.status_calculado.includes("PRENHE"));if(g.length>0){const y=g.map(h=>h.id),{data:l,error:z}=await x.from("diagnosticos_gestacao").select("receptora_id, numero_gestacoes").in("receptora_id",y).in("resultado",["PRENHE","PRENHE_FEMEA","PRENHE_MACHO","PRENHE_SEM_SEXO","PRENHE_2_SEXOS"]).not("numero_gestacoes","is",null);if(!z&&l){const h=new Map;l.forEach(_=>{if(_.numero_gestacoes&&_.numero_gestacoes>1){const T=h.get(_.receptora_id)||0;_.numero_gestacoes>T&&h.set(_.receptora_id,_.numero_gestacoes)}}),v.forEach(_=>{const T=h.get(_.id);T&&T>1&&(_.numero_gestacoes=T)})}}return v}async function $e(){const{data:e,error:t}=await x.from("clientes").select("id, nome").order("nome",{ascending:!0});if(t)throw t;return e||[]}const j={STATIC:10*60*1e3,DYNAMIC:5*60*1e3},X={STATIC:5*60*1e3,DYNAMIC:2*60*1e3},M={fazendas:["fazendas"],fazenda:e=>["fazendas",e],fazendasByCliente:e=>["fazendas","cliente",e],touros:["touros"],touro:e=>["touros",e],doadorasByFazenda:e=>["doadoras","fazenda",e],doadora:e=>["doadoras",e],receptorasViewByFazenda:e=>["receptoras-view","fazenda",e],receptorasByIds:e=>["receptoras","ids",e.join(",")],receptorasComStatusByFazenda:e=>["receptoras","fazenda",e,"comStatus"],dosesByCliente:e=>["doses","cliente",e],clientes:["clientes"],cliente:e=>["clientes",e]};function st(){return Y({queryKey:M.fazendas,queryFn:Xe,staleTime:X.STATIC,gcTime:j.STATIC})}function at(){return Y({queryKey:M.touros,queryFn:We,staleTime:X.STATIC,gcTime:j.STATIC})}function rt(e){return Y({queryKey:M.doadorasByFazenda(e||""),queryFn:()=>Ze(e),enabled:!!e,staleTime:X.DYNAMIC,gcTime:j.DYNAMIC})}function it(e){return Y({queryKey:M.receptorasComStatusByFazenda(e||""),queryFn:()=>Ge(e),enabled:!!e,staleTime:X.DYNAMIC,gcTime:j.DYNAMIC})}function nt(){return Y({queryKey:M.clientes,queryFn:$e,staleTime:X.STATIC,gcTime:j.STATIC})}function ot(){const e=we();return{invalidateFazendas:()=>e.invalidateQueries({queryKey:["fazendas"]}),invalidateTouros:()=>e.invalidateQueries({queryKey:["touros"]}),invalidateDoadoras:t=>{t?e.invalidateQueries({queryKey:M.doadorasByFazenda(t)}):e.invalidateQueries({queryKey:["doadoras"]})},invalidateReceptoras:t=>{t?e.invalidateQueries({queryKey:M.receptorasViewByFazenda(t)}):e.invalidateQueries({queryKey:["receptoras"]})},invalidateClientes:()=>e.invalidateQueries({queryKey:["clientes"]}),invalidateDoses:t=>{t?e.invalidateQueries({queryKey:M.dosesByCliente(t)}):e.invalidateQueries({queryKey:["doses"]})},invalidateAll:()=>e.invalidateQueries()}}export{it as a,ot as b,rt as c,at as d,nt as e,st as u};
