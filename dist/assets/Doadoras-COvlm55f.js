import{j as a,g as M,B as w,r as d,a as A,s as X,h as Z}from"./index-TMaXuGT-.js";import{C as B,a as H,b as P,d as I}from"./card-DMaHdbj2.js";import{T as G,a as O,b as y,c as u,d as $,e as x}from"./table-BcP2BpwR.js";import{D as K,a as Q,b as W,c as Y,d as aa,e as ea}from"./dialog-9Ry6kCpW.js";import{S as V,a as q,b as U,c as J,d as _}from"./select-mKWZhFeY.js";import{I as R}from"./input-CS01soKQ.js";import{L as T}from"./label-CDZKlFri.js";import{P as sa}from"./PageHeader-B9IxJGm-.js";import{E as ra}from"./EmptyState-BdHwPhgd.js";import{S as ta}from"./search-FTckgCkA.js";import{X as ia}from"./x-_4GU21wu.js";import{D as oa,H as la,P as na,G as ca,S as N}from"./DoadoraHistoricoAspiracoes-D-uMfWrE.js";import{f as da}from"./dateUtils-eJ5e6apA.js";import{B as ma}from"./badge-CUxYsHH9.js";import{u as ha,c as ua}from"./hooks-CRpet8tk.js";import{u as xa}from"./useListFilter-CzHcCnRG.js";import"./index-DzzTZhuj.js";import{u as fa}from"./use-toast-BfiUt0Jw.js";import{P as pa}from"./plus-BwrqBzf6.js";import"./index-CbBZSCMq.js";import"./index-CleRECL4.js";import"./check-BrBvYO5V.js";function ja({fazendas:s,selectedFazendaId:e,onFazendaChange:i,title:r="Selecione a Fazenda",placeholder:t="Selecione uma fazenda",required:o=!1}){return a.jsxs(B,{children:[a.jsx(H,{children:a.jsxs(P,{children:[r,o&&" *"]})}),a.jsx(I,{children:a.jsxs(V,{value:e,onValueChange:i,children:[a.jsx(q,{className:"w-full",children:a.jsx(U,{placeholder:t})}),a.jsx(J,{children:s.map(n=>a.jsx(_,{value:n.id,children:n.nome},n.id))})]})})]})}function L({className:s,...e}){return a.jsx("div",{className:M("animate-pulse rounded-md bg-muted",s),...e})}function ga({columns:s,rows:e=5,headers:i,showHeader:r=!0}){return a.jsxs(G,{children:[r&&a.jsx(O,{children:a.jsx(y,{children:i?i.map((t,o)=>a.jsx(u,{children:t},o)):Array.from({length:s}).map((t,o)=>a.jsx(u,{children:a.jsx(L,{className:"h-4 w-20"})},o))})}),a.jsx($,{children:Array.from({length:e}).map((t,o)=>a.jsx(y,{children:Array.from({length:s}).map((n,c)=>a.jsx(x,{children:a.jsx(L,{className:`h-4 ${c===0?"w-24":c===s-1?"w-16":"w-32"}`})},c))},o))})]})}function va({value:s,onChange:e,placeholder:i="Buscar...",label:r,id:t="search-input",className:o="",showClearButton:n=!0}){return a.jsxs("div",{className:`space-y-2 ${o}`,children:[r&&a.jsx(T,{htmlFor:t,children:r}),a.jsxs("div",{className:"relative",children:[a.jsx(ta,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),a.jsx(R,{id:t,placeholder:i,value:s,onChange:c=>e(c.target.value),className:"pl-10 pr-10"}),n&&s&&a.jsx(w,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0 hover:bg-muted",onClick:()=>e(""),children:a.jsx(ia,{className:"w-4 h-4 text-muted-foreground"})})]})]})}const Ca=(s,e)=>{var i,r,t;return((i=s.nome)==null?void 0:i.toLowerCase().includes(e))||((r=s.registro)==null?void 0:r.toLowerCase().includes(e))||((t=s.raca)==null?void 0:t.toLowerCase().includes(e))||!1};function Na(){const[s,e]=d.useState(""),[i,r]=d.useState(null),{data:t=[],isLoading:o,refetch:n}=ha(),{data:c=[],isLoading:l,refetch:f}=ua(s||void 0),{filtered:g,searchTerm:v,setSearchTerm:p,clearFilters:D,hasActiveFilters:S}=xa({data:c,searchFn:Ca});return{loading:o||(s?l:!1),fazendas:t,doadoras:c,filteredDoadoras:g,selectedFazendaId:s,setSelectedFazendaId:e,searchTerm:v,setSearchTerm:p,clearFilters:D,hasActiveFilters:S,historicoDoadoraId:i,setHistoricoDoadoraId:r,loadFazendas:async()=>{await n()},loadDoadoras:async()=>{s&&await f()}}}const wa=["Holandesa","Jersey","Gir","Girolando"],k={registro:"",raca:"",racaCustom:""};function Da({selectedFazendaId:s,onSuccess:e}){const i=A(),{toast:r}=fa(),[t,o]=d.useState(!1),[n,c]=d.useState(!1),[l,f]=d.useState(k),[g,v]=d.useState(""),p=d.useCallback(()=>{f(k),v("")},[]),D=d.useCallback(m=>{v(m),f(m==="Outra"?j=>({...j,raca:"",racaCustom:""}):j=>({...j,raca:m,racaCustom:""}))},[]),S=d.useCallback(m=>{o(m),m||p()},[p]),F=d.useCallback(async m=>{if(m.preventDefault(),!s){r({title:"Erro de validacao",description:"Selecione a fazenda primeiro",variant:"destructive"});return}if(!l.registro.trim()){r({title:"Erro de validacao",description:"Registro e obrigatorio",variant:"destructive"});return}const j=g==="Outra"?l.racaCustom.trim():l.raca.trim();if(!j){r({title:"Erro de validacao",description:"Raca e obrigatoria",variant:"destructive"});return}try{c(!0);const C={fazenda_id:s,registro:l.registro.trim(),raca:j},{data:h,error:b}=await X.from("doadoras").insert([C]).select().single();if(b)throw b;r({title:"Doadora criada",description:"Doadora criada com sucesso"}),o(!1),p(),e(),h!=null&&h.id&&i(`/doadoras/${h.id}`)}catch(C){const h=C instanceof Error?C.message:"Erro desconhecido";r({title:"Erro ao criar doadora",description:h.includes("RLS")||h.includes("policy")?"RLS esta bloqueando escrita. Configure politicas anon no Supabase.":h,variant:"destructive"})}finally{c(!1)}},[l,g,s,r,p,e,i]);return{formData:l,setFormData:f,racaSelecionada:g,setRacaSelecionada:v,showDialog:t,setShowDialog:o,submitting:n,resetForm:p,handleSubmit:F,handleDialogClose:S,handleRacaChange:D}}function Qa(){var b,E;const s=A(),{loading:e,fazendas:i,filteredDoadoras:r,selectedFazendaId:t,setSelectedFazendaId:o,searchTerm:n,setSearchTerm:c,historicoDoadoraId:l,setHistoricoDoadoraId:f,loadFazendas:g,loadDoadoras:v}=Na(),{formData:p,setFormData:D,racaSelecionada:S,showDialog:F,submitting:m,handleSubmit:j,handleDialogClose:C,handleRacaChange:h}=Da({selectedFazendaId:t,onSuccess:v});return d.useEffect(()=>{g()},[g]),e&&i.length===0?a.jsx(Z,{}):a.jsxs("div",{className:"space-y-6",children:[a.jsx(sa,{title:"Doadoras",description:"Gerenciar doadoras do sistema"}),a.jsx(ja,{fazendas:i,selectedFazendaId:t,onFazendaChange:o,placeholder:"Selecione uma fazenda para visualizar doadoras"}),t?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex-1 max-w-md",children:a.jsx(va,{value:n,onChange:c,placeholder:"Buscar por nome ou registro..."})}),a.jsx(Sa,{showDialog:F,handleDialogClose:C,formData:p,setFormData:D,racaSelecionada:S,handleRacaChange:h,submitting:m,handleSubmit:j})]}),a.jsxs(B,{children:[a.jsx(H,{children:a.jsx(P,{children:"Lista de Doadoras"})}),a.jsx(I,{children:e?a.jsx(ga,{columns:8,rows:6,headers:["Registro","Nome","Ultima Aspiracao","Oocitos","Estado","Raca","Classificacao","Acoes"]}):a.jsx(ba,{doadoras:r,searchTerm:n,navigate:s,setHistoricoDoadoraId:f})})]}),l&&a.jsx(oa,{doadoraId:l,doadoraNome:((b=r.find(z=>z.id===l))==null?void 0:b.nome)||((E=r.find(z=>z.id===l))==null?void 0:E.registro),open:!!l,onClose:()=>f(null)})]}):a.jsx(ra,{title:"Selecione uma fazenda",description:"Escolha uma fazenda para visualizar e gerenciar doadoras."})]})}function Sa({showDialog:s,handleDialogClose:e,formData:i,setFormData:r,racaSelecionada:t,handleRacaChange:o,submitting:n,handleSubmit:c}){return a.jsxs(K,{open:s,onOpenChange:e,children:[a.jsx(Q,{asChild:!0,children:a.jsxs(w,{children:[a.jsx(pa,{className:"w-4 h-4 mr-2"}),"Nova Doadora"]})}),a.jsxs(W,{className:"max-w-md",children:[a.jsxs(Y,{children:[a.jsx(aa,{children:"Criar Nova Doadora"}),a.jsx(ea,{children:"Preencha os campos basicos. As informacoes detalhadas podem ser preenchidas apos a criacao."})]}),a.jsxs("form",{onSubmit:c,className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(T,{htmlFor:"registro",children:"Registro *"}),a.jsx(R,{id:"registro",value:i.registro,onChange:l=>r({...i,registro:l.target.value}),placeholder:"Registro da doadora",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(T,{htmlFor:"raca",children:"Raca *"}),a.jsxs(V,{value:t,onValueChange:o,children:[a.jsx(q,{children:a.jsx(U,{placeholder:"Selecione a raca"})}),a.jsxs(J,{children:[wa.map(l=>a.jsx(_,{value:l,children:l},l)),a.jsx(_,{value:"Outra",children:"Outra"})]})]}),t==="Outra"&&a.jsx(R,{id:"raca_custom",value:i.racaCustom,onChange:l=>r({...i,racaCustom:l.target.value,raca:l.target.value}),placeholder:"Digite a raca",className:"mt-2",required:!0})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx(w,{type:"submit",className:"flex-1",disabled:n,children:n?"Salvando...":"Criar Doadora"}),a.jsx(w,{type:"button",variant:"outline",onClick:()=>e(!1),disabled:n,children:"Cancelar"})]})]})]})]})}function ba({doadoras:s,searchTerm:e,navigate:i,setHistoricoDoadoraId:r}){return a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(G,{children:[a.jsx(O,{children:a.jsxs(y,{children:[a.jsx(u,{children:"Registro"}),a.jsx(u,{children:"Nome"}),a.jsx(u,{children:"Ultima Aspiracao"}),a.jsx(u,{children:"Oocitos"}),a.jsx(u,{children:"Estado"}),a.jsx(u,{children:"Raca (Campos Especiais)"}),a.jsx(u,{children:"Classificacao"}),a.jsx(u,{className:"text-right",children:"Acoes"})]})}),a.jsx($,{children:s.length===0?a.jsx(y,{children:a.jsx(x,{colSpan:8,className:"text-center text-muted-foreground",children:e?"Nenhuma doadora encontrada":"Nenhuma doadora cadastrada nesta fazenda"})}):s.map(t=>a.jsx(ya,{doadora:t,navigate:i,setHistoricoDoadoraId:r},t.id))})]})})}const ya=d.memo(function({doadora:e,navigate:i,setHistoricoDoadoraId:r}){const t=Fa(e);return a.jsxs(y,{className:"cursor-pointer hover:bg-muted",onClick:()=>i(`/doadoras/${e.id}`),children:[a.jsx(x,{className:"font-medium",children:e.registro}),a.jsx(x,{children:e.nome||"-"}),a.jsx(x,{children:e.ultima_aspiracao_data?da(e.ultima_aspiracao_data):"-"}),a.jsx(x,{children:e.ultima_aspiracao_total_oocitos??"-"}),a.jsx(x,{children:a.jsx(ma,{variant:e.disponivel_aspiracao?"default":"secondary",children:e.disponivel_aspiracao?"Disponivel":"Indisponivel"})}),a.jsx(x,{children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{children:e.raca||"-"}),t&&a.jsx("span",{className:"text-xs text-muted-foreground",children:t})]})}),a.jsx(x,{children:za(e.classificacao_genetica)}),a.jsx(x,{className:"text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx(w,{variant:"ghost",size:"sm",onClick:o=>{o.stopPropagation(),r(e.id)},title:"Ver historico de aspiracoes",children:a.jsx(la,{className:"w-4 h-4"})}),a.jsx(w,{variant:"ghost",size:"sm",onClick:o=>{o.stopPropagation(),i(`/doadoras/${e.id}`)},title:"Editar doadora",children:a.jsx(na,{className:"w-4 h-4"})})]})})]})});function Fa(s){if(s.raca==="Gir"){const e=[];return s.gpta&&e.push(`GPTA: ${s.gpta}`),s.controle_leiteiro&&e.push(`Controle Leiteiro: ${s.controle_leiteiro}`),s.beta_caseina&&e.push(`Beta Caseina: ${s.beta_caseina}`),s.link_abcz&&e.push("Link ABCZ"),e.length>0?e.join(", "):null}return null}function za(s){if(!s)return"-";switch(s){case"1_estrela":return a.jsx("div",{className:"flex items-center gap-1",children:a.jsx(N,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})});case"2_estrelas":return a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(N,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),a.jsx(N,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]});case"3_estrelas":return a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(N,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),a.jsx(N,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),a.jsx(N,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]});case"diamante":return a.jsx("div",{className:"flex items-center gap-1",children:a.jsx(ca,{className:"w-4 h-4 fill-blue-500 text-blue-500"})});default:return"-"}}export{Qa as default};
