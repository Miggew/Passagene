import{r,a as B,s as v,j as e,h as R,f as H,U as M,B as I}from"./index-6OJhfjKP.js";import{C as p,d as j,a as P,b as k}from"./card-D-gf0lmS.js";import{I as U}from"./input-_UHZ9n1P.js";import{S as V,a as D,b as G,c as W,d as N}from"./select-B7v4ZPbC.js";import{T as $,a as q,b as w,c as i,d as A,e as c}from"./table-B_Z-CztY.js";import{P as J}from"./PageHeader-P7sO2uqv.js";import{E as K}from"./EmptyState-CEfkJzHC.js";import{h as O}from"./error-handler-CXUXfXq4.js";import{M as Q}from"./map-pin-CuMBtep0.js";import{S as X}from"./search-DHWddfjN.js";import"./index-CtR1jODk.js";import"./check-CgmfRmMI.js";import"./use-toast-DasFaehQ.js";function me(){const[d,S]=r.useState([]),[b,T]=r.useState([]),[L,f]=r.useState(!0),[a,g]=r.useState(""),[l,C]=r.useState("todos"),z=B();r.useEffect(()=>{E()},[]);const E=async()=>{try{f(!0);const{data:s,error:m}=await v.from("clientes").select("*").order("nome");if(m)throw m;T(s||[]);const{data:o,error:n}=await v.from("fazendas").select("*").order("nome",{ascending:!0});if(n)throw n;const x=new Map((s||[]).map(t=>[t.id,t.nome])),h=o==null?void 0:o.map(t=>({...t,cliente_nome:x.get(t.cliente_id)}));S(h||[])}catch(s){O(s,"Erro ao carregar dados")}finally{f(!1)}},u=d.filter(s=>{var n,x,h,t;const m=!a||((n=s.nome)==null?void 0:n.toLowerCase().includes(a.toLowerCase()))||((x=s.cliente_nome)==null?void 0:x.toLowerCase().includes(a.toLowerCase()))||((h=s.responsavel)==null?void 0:h.toLowerCase().includes(a.toLowerCase()))||((t=s.localizacao)==null?void 0:t.toLowerCase().includes(a.toLowerCase())),o=l==="todos"||s.cliente_id===l;return m&&o}),F=d.length,y=new Set(d.map(s=>s.cliente_id)).size,_=d.filter(s=>s.responsavel).length;return L?e.jsx(R,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Fazendas",description:"Gerenciar fazendas do sistema"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(p,{children:e.jsx(j,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de Fazendas"}),e.jsx("p",{className:"text-2xl font-bold",children:F})]})]})})}),e.jsx(p,{children:e.jsx(j,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clientes"}),e.jsx("p",{className:"text-2xl font-bold",children:y})]})]})})}),e.jsx(p,{children:e.jsx(j,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Com Responsável"}),e.jsx("p",{className:"text-2xl font-bold",children:_})]})]})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-xs",children:[e.jsx(X,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(U,{placeholder:"Buscar por nome, cliente, responsável...",value:a,onChange:s=>g(s.target.value),className:"pl-8"})]}),e.jsxs(V,{value:l,onValueChange:C,children:[e.jsx(D,{className:"w-[200px]",children:e.jsx(G,{placeholder:"Cliente"})}),e.jsxs(W,{children:[e.jsx(N,{value:"todos",children:"Todos os clientes"}),b.map(s=>e.jsx(N,{value:s.id,children:s.nome},s.id))]})]}),(a||l!=="todos")&&e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>{g(""),C("todos")},children:"Limpar filtros"})]}),e.jsxs(p,{children:[e.jsx(P,{children:e.jsxs(k,{children:["Fazendas (",u.length,")"]})}),e.jsx(j,{children:u.length===0?e.jsx(K,{title:"Nenhuma fazenda encontrada",description:a||l!=="todos"?"Tente ajustar os filtros de busca":"Cadastre uma fazenda para começar."}):e.jsxs($,{children:[e.jsx(q,{children:e.jsxs(w,{children:[e.jsx(i,{children:"Nome"}),e.jsx(i,{children:"Cliente"}),e.jsx(i,{children:"Responsável"}),e.jsx(i,{children:"Contato"}),e.jsx(i,{children:"Localização"})]})}),e.jsx(A,{children:u.map(s=>e.jsxs(w,{className:"cursor-pointer hover:bg-muted",onClick:()=>z(`/fazendas/${s.id}`),children:[e.jsx(c,{className:"font-medium text-primary",children:s.nome}),e.jsx(c,{children:s.cliente_nome||"-"}),e.jsx(c,{children:s.responsavel||"-"}),e.jsx(c,{children:s.contato_responsavel||"-"}),e.jsx(c,{children:s.localizacao||"-"})]},s.id))})]})})]})]})}export{me as default};
