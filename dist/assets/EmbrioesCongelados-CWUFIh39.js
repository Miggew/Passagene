import{c as de,r as d,s as K,j as e,i as me,B as I,l as Q,U as xe,D as he}from"./index-BPMeM9-O.js";import{C as b,d as D,a as W,b as Y}from"./card-8azKTSNJ.js";import{T as je,a as ue,b as Z,c as j,d as fe,e as u}from"./table-l_s8S0JA.js";import{D as pe,b as ge,c as Ne,d as ve,e as Ce}from"./dialog-CLDnxY7R.js";import{S as E,a as L,b as R,c as k,d as f}from"./select-La4nrp5K.js";import{I as we}from"./input-tqcTRdPv.js";import{B as F}from"./badge-CeJDYfYs.js";import{P as be}from"./PageHeader-DQ4rM2jO.js";import{E as De}from"./EmptyState-yqSFIU3C.js";import{u as Se}from"./use-toast-BGNwDi9e.js";import{F as Te}from"./filter-DouKIrIu.js";import{S as _e}from"./search-SyV5imYB.js";import{X as ye}from"./x-BxiwAMrM.js";import{E as Ee}from"./eye-CZithoXn.js";import"./index-C5PY5DOm.js";import"./check-Bdb-Yd05.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=de("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function Xe(){const{toast:O}=Se(),[ee,z]=d.useState(!0),[g,se]=d.useState([]),[ae,te]=d.useState([]),[m,B]=d.useState(""),[N,M]=d.useState("todos"),[p,V]=d.useState("todos"),[v,H]=d.useState("todos"),[C,U]=d.useState("todos"),[A,G]=d.useState(null);d.useEffect(()=>{ce()},[]);const ce=async()=>{try{z(!0);const{data:s,error:c}=await K.from("clientes").select("id, nome").order("nome");if(c)throw c;te(s||[]);const{data:t,error:a}=await K.from("embrioes").select(`
          *,
          cliente:clientes(id, nome),
          lote_fiv:lotes_fiv(id, data_abertura),
          acasalamento:lote_fiv_acasalamentos(
            id,
            dose_semen:doses_semen(
              id,
              touro:touros(id, nome, registro, raca)
            ),
            aspiracao:aspiracoes_doadoras(
              id,
              data_aspiracao,
              horario_aspiracao,
              doadora:doadoras(id, registro, nome, raca)
            )
          )
        `).eq("status_atual","CONGELADO").order("data_congelamento",{ascending:!1});if(a)throw a;se(t||[])}catch(s){O({title:"Erro ao carregar dados",description:s instanceof Error?s.message:"Erro desconhecido",variant:"destructive"})}finally{z(!1)}},{racas:le,classificacoes:oe,touros:re}=d.useMemo(()=>{const s=new Set,c=new Set,t=new Map;return g.forEach(a=>{var n,i;a.classificacao&&c.add(a.classificacao);const o=a.acasalamento,r=(n=o==null?void 0:o.aspiracao)==null?void 0:n.doadora,l=(i=o==null?void 0:o.dose_semen)==null?void 0:i.touro;r!=null&&r.raca&&s.add(r.raca),l!=null&&l.raca&&s.add(l.raca),l!=null&&l.id&&t.set(l.id,l.nome||l.registro||l.id)}),{racas:Array.from(s).sort(),classificacoes:Array.from(c).sort(),touros:Array.from(t.entries()).sort((a,o)=>a[1].localeCompare(o[1]))}},[g]),x=d.useMemo(()=>g.filter(s=>{var h,T,_,y,q,P,$,X,J;const c=s.acasalamento,t=(h=c==null?void 0:c.aspiracao)==null?void 0:h.doadora,a=(T=c==null?void 0:c.dose_semen)==null?void 0:T.touro,o=!m||((_=s.identificacao)==null?void 0:_.toLowerCase().includes(m.toLowerCase()))||((y=s.localizacao_atual)==null?void 0:y.toLowerCase().includes(m.toLowerCase()))||((P=(q=s.cliente)==null?void 0:q.nome)==null?void 0:P.toLowerCase().includes(m.toLowerCase()))||(($=t==null?void 0:t.registro)==null?void 0:$.toLowerCase().includes(m.toLowerCase()))||((X=t==null?void 0:t.nome)==null?void 0:X.toLowerCase().includes(m.toLowerCase()))||((J=a==null?void 0:a.nome)==null?void 0:J.toLowerCase().includes(m.toLowerCase())),r=N==="todos"||s.cliente_id===N,l=p==="todos"||(t==null?void 0:t.raca)===p||(a==null?void 0:a.raca)===p,n=v==="todos"||s.classificacao===v,i=C==="todos"||(a==null?void 0:a.id)===C;return o&&r&&l&&n&&i}),[g,m,N,p,v,C]),w=d.useMemo(()=>{const s=new Map,c=new Map;return x.forEach(t=>{var r;const a=((r=t.cliente)==null?void 0:r.nome)||"Sem cliente";s.set(a,(s.get(a)||0)+1);const o=t.classificacao||"Sem classificação";c.set(o,(c.get(o)||0)+1)}),{total:x.length,totalGeral:g.length,porCliente:Array.from(s.entries()).sort((t,a)=>a[1]-t[1]),porClassificacao:Array.from(c.entries()).sort((t,a)=>a[1]-t[1])}},[x,g]),S=s=>s?new Date(s).toLocaleDateString("pt-BR"):"-",ne=()=>{const s=["Identificação","Cliente","Classificação","Doadora","Touro","Raça","Data Cong.","Localização"],c=x.map(l=>{var T,_,y;const n=l.acasalamento,i=(T=n==null?void 0:n.aspiracao)==null?void 0:T.doadora,h=(_=n==null?void 0:n.dose_semen)==null?void 0:_.touro;return[l.identificacao||"",((y=l.cliente)==null?void 0:y.nome)||"",l.classificacao||"",(i==null?void 0:i.registro)||(i==null?void 0:i.nome)||"",(h==null?void 0:h.nome)||"",(i==null?void 0:i.raca)||(h==null?void 0:h.raca)||"",S(l.data_congelamento),l.localizacao_atual||""]}),t=[s,...c].map(l=>l.map(n=>`"${n}"`).join(",")).join(`
`),a=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),r=document.createElement("a");r.href=o,r.download=`embrioes-congelados-${new Date().toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(o),O({title:"Exportação concluída",description:`${x.length} embriões exportados`})},ie=({embriao:s})=>{var n;const c=s.acasalamento,t=c==null?void 0:c.dose_semen,a=t==null?void 0:t.touro,o=c==null?void 0:c.aspiracao,r=o==null?void 0:o.doadora,l=s.lote_fiv;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Identificação"}),e.jsx("p",{className:"font-medium",children:s.identificacao||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Cliente"}),e.jsx("p",{className:"font-medium",children:((n=s.cliente)==null?void 0:n.nome)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Classificação"}),e.jsx("p",{className:"font-medium",children:s.classificacao?e.jsx(F,{variant:"secondary",children:s.classificacao}):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx("p",{className:"font-medium",children:e.jsxs(F,{className:"bg-cyan-100 text-cyan-800",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),"CONGELADO"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Data de Congelamento"}),e.jsx("p",{className:"font-medium",children:S(s.data_congelamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Localização"}),e.jsx("p",{className:"font-medium",children:s.localizacao_atual||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tipo"}),e.jsx("p",{className:"font-medium",children:s.tipo_embriao||"-"})]}),e.jsx("div",{className:"col-span-2 border-t pt-4 mt-2",children:e.jsx("p",{className:"text-muted-foreground font-medium mb-2",children:"Origem"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Doadora"}),e.jsxs("p",{className:"font-medium",children:[(r==null?void 0:r.registro)||(r==null?void 0:r.nome)||"-",(r==null?void 0:r.raca)&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",r.raca,")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Touro"}),e.jsxs("p",{className:"font-medium",children:[(a==null?void 0:a.nome)||"-",(a==null?void 0:a.registro)&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",a.registro,")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Raça do Touro"}),e.jsx("p",{className:"font-medium",children:(a==null?void 0:a.raca)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Data D0 (Lote FIV)"}),e.jsx("p",{className:"font-medium",children:S(l==null?void 0:l.data_abertura)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Data de Aspiração"}),e.jsx("p",{className:"font-medium",children:S(o==null?void 0:o.data_aspiracao)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Hora de Aspiração"}),e.jsx("p",{className:"font-medium",children:(o==null?void 0:o.horario_aspiracao)||"-"})]}),s.observacoes&&e.jsxs("div",{className:"col-span-2 border-t pt-4 mt-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Observações"}),e.jsx("p",{className:"font-medium",children:s.observacoes})]})]})};return ee?e.jsx(me,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(be,{title:"Embriões Congelados",description:"Estoque geral de embriões congelados",actions:e.jsxs(I,{variant:"outline",onClick:ne,disabled:x.length===0,children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(b,{children:e.jsx(D,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-cyan-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Congelados"}),e.jsx("p",{className:"text-2xl font-bold",children:w.totalGeral})]})]})})}),e.jsx(b,{children:e.jsxs(D,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Filtrados"}),e.jsx("p",{className:"text-2xl font-bold",children:w.total})]})}),e.jsx(b,{children:e.jsxs(D,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clientes"}),e.jsx("p",{className:"text-2xl font-bold",children:w.porCliente.length})]})}),e.jsx(b,{children:e.jsxs(D,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Classificações"}),e.jsx("p",{className:"text-2xl font-bold",children:w.porClassificacao.length})]})})]}),w.porClassificacao.length>0&&e.jsxs(b,{children:[e.jsx(W,{className:"pb-2",children:e.jsx(Y,{className:"text-base",children:"Por Classificação"})}),e.jsx(D,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:w.porClassificacao.map(([s,c])=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted rounded-lg",children:[e.jsx(F,{variant:"secondary",children:s}),e.jsx("span",{className:"font-semibold text-sm",children:c})]},s))})})]}),e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(we,{placeholder:"Buscar embrião...",value:m,onChange:s=>B(s.target.value),className:"pl-9 h-9"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-emerald-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(xe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Cliente"})]}),e.jsx("div",{className:"w-[180px]",children:e.jsxs(E,{value:N,onValueChange:M,children:[e.jsx(L,{className:"h-9",children:e.jsx(R,{placeholder:"Cliente"})}),e.jsxs(k,{children:[e.jsx(f,{value:"todos",children:"Todos Clientes"}),ae.map(s=>e.jsx(f,{value:s.id,children:s.nome},s.id))]})]})})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-blue-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Genética"})]}),e.jsx("div",{className:"w-[150px]",children:e.jsxs(E,{value:p,onValueChange:V,children:[e.jsx(L,{className:"h-9",children:e.jsx(R,{placeholder:"Raça"})}),e.jsxs(k,{children:[e.jsx(f,{value:"todos",children:"Todas Raças"}),le.map(s=>e.jsx(f,{value:s,children:s},s))]})]})}),e.jsx("div",{className:"w-[150px]",children:e.jsxs(E,{value:v,onValueChange:H,children:[e.jsx(L,{className:"h-9",children:e.jsx(R,{placeholder:"Classificação"})}),e.jsxs(k,{children:[e.jsx(f,{value:"todos",children:"Todas"}),oe.map(s=>e.jsx(f,{value:s,children:s},s))]})]})}),e.jsx("div",{className:"w-[180px]",children:e.jsxs(E,{value:C,onValueChange:U,children:[e.jsx(L,{className:"h-9",children:e.jsx(R,{placeholder:"Touro"})}),e.jsxs(k,{children:[e.jsx(f,{value:"todos",children:"Todos Touros"}),re.map(([s,c])=>e.jsx(f,{value:s,children:c},s))]})]})})]}),(m||N!=="todos"||p!=="todos"||v!=="todos"||C!=="todos")&&e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>{B(""),M("todos"),V("todos"),H("todos"),U("todos")},className:"h-9 ml-auto",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})]})}),e.jsxs(b,{children:[e.jsx(W,{children:e.jsxs(Y,{children:["Embriões Congelados (",x.length,")"]})}),e.jsx(D,{children:x.length===0?e.jsx(De,{title:"Nenhum embrião encontrado",description:m||N!=="todos"||p!=="todos"||v!=="todos"||C!=="todos"?"Tente ajustar os filtros":"Nenhum embrião congelado no estoque"}):e.jsxs(je,{children:[e.jsx(ue,{children:e.jsxs(Z,{children:[e.jsx(j,{children:"Identificação"}),e.jsx(j,{children:"Cliente"}),e.jsx(j,{children:"Classificação"}),e.jsx(j,{children:"Doadora"}),e.jsx(j,{children:"Touro"}),e.jsx(j,{children:"Raça"}),e.jsx(j,{children:"Data Cong."}),e.jsx(j,{children:"Localização"}),e.jsx(j,{className:"text-right",children:"Ações"})]})}),e.jsx(fe,{children:x.map(s=>{var r,l,n;const c=s.acasalamento,t=(r=c==null?void 0:c.aspiracao)==null?void 0:r.doadora,a=(l=c==null?void 0:c.dose_semen)==null?void 0:l.touro,o=(t==null?void 0:t.raca)||(a==null?void 0:a.raca);return e.jsxs(Z,{children:[e.jsx(u,{className:"font-medium font-mono text-sm",children:s.identificacao||"-"}),e.jsx(u,{children:((n=s.cliente)==null?void 0:n.nome)||"-"}),e.jsx(u,{children:s.classificacao?e.jsx(F,{variant:"secondary",children:s.classificacao}):"-"}),e.jsx(u,{children:(t==null?void 0:t.registro)||(t==null?void 0:t.nome)||"-"}),e.jsxs(u,{children:[(a==null?void 0:a.nome)||"-",(a==null?void 0:a.registro)&&e.jsxs("span",{className:"text-muted-foreground text-xs ml-1",children:["(",a.registro,")"]})]}),e.jsx(u,{children:o||"-"}),e.jsx(u,{children:S(s.data_congelamento)}),e.jsx(u,{children:s.localizacao_atual||"-"}),e.jsx(u,{className:"text-right",children:e.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>G(s),children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Detalhar"]})})]},s.id)})})]})})]}),e.jsx(pe,{open:!!A,onOpenChange:s=>!s&&G(null),children:e.jsxs(ge,{className:"max-w-2xl",children:[e.jsxs(Ne,{children:[e.jsx(ve,{children:"Detalhes do Embrião"}),e.jsx(Ce,{children:"Informações completas do embrião congelado"})]}),A&&e.jsx(ie,{embriao:A})]})})]})}export{Xe as default};
