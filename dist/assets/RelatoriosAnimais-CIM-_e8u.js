import{c as pe,b as ue,ac as xe,r as n,s as b,j as e,ao as fe,aH as he,B as z,X as ge}from"./index-B-7HRnm0.js";import{I as je}from"./input-D2h8r4MO.js";import{S as ve}from"./StatusBadge-B48hPBgT.js";import{S as k,a as A,b as F,c as R,d as u}from"./select-B0M3FCy4.js";import{T as be,c as _e}from"./tabs-ChsREKvA.js";import{u as ye}from"./useClienteFilter-Df1PgEKu.js";import{P as Ne}from"./PageHeader-CT7CFo0W.js";import{e as we}from"./exportPdf-0A6g_7-d.js";import{f as J}from"./dateUtils-eJ5e6apA.js";import{D as Ce}from"./DatePickerBR-XHkKTcYs.js";import{S as K}from"./search-DcAWDjHO.js";import{A as Se,a as De,b as ze}from"./arrow-up-HPg26f2D.js";import{F as ke}from"./file-text-ElQw19Mr.js";import{H as Ae}from"./history-CVgiEWSN.js";import{E as Fe}from"./eye-C2rdP5in.js";import"./badge-BCHVCiM7.js";import"./index-B4eR1KA_.js";import"./check-C6h7QFZL.js";import"./index-C7yzDtsu.js";import"./pt-BR-DS62bWKG.js";import"./differenceInCalendarDays-CrzntjZV.js";import"./chevron-right-DntnbvYp.js";import"./popover-i4alam_g.js";import"./calendar-D8momPux.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=pe("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),S=20,Q=14;function ta(){const T=ue(),[W,Y]=xe(),{clienteIdFilter:g}=ye(),[o,Z]=n.useState(W.get("tipo")||"receptoras"),[B,ee]=n.useState([]),[h,I]=n.useState("all"),[y,E]=n.useState("all"),[N,L]=n.useState(""),[w,M]=n.useState("all"),[C,P]=n.useState("all"),[c,D]=n.useState("none"),[j,O]=n.useState(""),[q,V]=n.useState([]),[$,ae]=n.useState([]),[re,te]=n.useState([]),[f,_]=n.useState(1),[se,H]=n.useState(!0);n.useEffect(()=>{oe(),ie()},[g]),n.useEffect(()=>{U(),_(1)},[o,h,y,w,C,g]);const oe=async()=>{let a=b.from("fazendas").select("*").order("nome");g&&(a=a.eq("cliente_id",g));const{data:r}=await a;ee(r??[])},ie=async()=>{const{data:a}=await b.from("doadoras").select("raca").not("raca","is",null),r=[...new Set(a==null?void 0:a.map(t=>t.raca).filter(Boolean))];te(r.sort())},U=async()=>{H(!0);try{let a=[];if(g){const{data:r}=await b.from("fazendas").select("id").eq("cliente_id",g);a=(r==null?void 0:r.map(t=>t.id))??[]}o==="receptoras"?await ne(a):await de(a)}catch(a){console.error("Erro ao carregar dados:",a)}finally{H(!1)}},ne=async a=>{let r=b.from("receptoras").select("id, identificacao, nome, status_reprodutivo, is_cio_livre, data_provavel_parto").order("identificacao");y!=="all"&&(r=r.eq("status_reprodutivo",y));const{data:t}=await r;if(!t||t.length===0){V([]);return}const d=t.map(s=>s.id),{data:l}=await b.from("vw_receptoras_fazenda_atual").select("receptora_id, fazenda_id_atual, fazenda_nome_atual").in("receptora_id",d),m=new Map((l||[]).map(s=>[s.receptora_id,{id:s.fazenda_id_atual,nome:s.fazenda_nome_atual}]));let i=t.map(s=>{const p=m.get(s.id);return{id:s.id,identificacao:s.identificacao,nome:s.nome,status_reprodutivo:s.status_reprodutivo,fazenda_atual_id:p==null?void 0:p.id,fazenda_nome:(p==null?void 0:p.nome)??"Sem fazenda",is_cio_livre:s.is_cio_livre,data_provavel_parto:s.data_provavel_parto}});g&&a.length>0&&(i=i.filter(s=>s.fazenda_atual_id&&a.includes(s.fazenda_atual_id))),h!=="all"&&(i=i.filter(s=>s.fazenda_atual_id===h)),V(i)},de=async a=>{let r=b.from("doadoras").select(`
        id,
        registro,
        nome,
        raca,
        fazenda_id,
        fazendas(nome),
        disponivel_aspiracao,
        classificacao_genetica
      `).order("registro");g&&a.length>0&&(r=r.in("fazenda_id",a)),h!=="all"&&(r=r.eq("fazenda_id",h)),w!=="all"&&(r=r.eq("raca",w)),C!=="all"&&(r=r.eq("disponivel_aspiracao",C==="sim"));const{data:t}=await r,d=(t==null?void 0:t.map(i=>i.id))??[],{data:l}=await b.from("aspiracoes_doadoras").select("doadora_id, total_oocitos, data_aspiracao").in("doadora_id",d),m=new Map;l==null||l.forEach(i=>{const s=m.get(i.doadora_id)??{count:0,totalOocitos:0,ultimaData:void 0},p=i.data_aspiracao,X=s.ultimaData&&s.ultimaData>p?s.ultimaData:p;m.set(i.doadora_id,{count:s.count+1,totalOocitos:s.totalOocitos+(i.total_oocitos??0),ultimaData:X})}),ae((t==null?void 0:t.map(i=>{var p;const s=m.get(i.id);return{id:i.id,registro:i.registro,nome:i.nome,raca:i.raca,fazenda_id:i.fazenda_id,fazenda_nome:((p=i.fazendas)==null?void 0:p.nome)??"N/A",disponivel_aspiracao:i.disponivel_aspiracao,classificacao_genetica:i.classificacao_genetica,total_aspiracoes:(s==null?void 0:s.count)??0,media_oocitos:s?Math.round(s.totalOocitos/s.count):0,ultima_aspiracao_data:s==null?void 0:s.ultimaData}}))??[])},x=n.useMemo(()=>{let a=o==="receptoras"?q:$;if(N.trim()){const r=N.toLowerCase();o==="receptoras"?a=a.filter(t=>{var d,l,m;return((d=t.identificacao)==null?void 0:d.toLowerCase().includes(r))||((l=t.nome)==null?void 0:l.toLowerCase().includes(r))||((m=t.fazenda_nome)==null?void 0:m.toLowerCase().includes(r))}):a=a.filter(t=>{var d,l,m;return((d=t.registro)==null?void 0:d.toLowerCase().includes(r))||((l=t.nome)==null?void 0:l.toLowerCase().includes(r))||((m=t.fazenda_nome)==null?void 0:m.toLowerCase().includes(r))})}if(o==="doadoras"&&j){const[r,t,d]=j.split("-").map(Number),l=new Date(r,t-1,d-Q);a=a.filter(m=>{if(!m.ultima_aspiracao_data)return!0;const[i,s,p]=m.ultima_aspiracao_data.split("-").map(Number);return new Date(i,s-1,p)<=l})}return o==="doadoras"&&c!=="none"&&(a=[...a].sort((r,t)=>{const d=r.ultima_aspiracao_data?new Date(r.ultima_aspiracao_data).getTime():0,l=t.ultima_aspiracao_data?new Date(t.ultima_aspiracao_data).getTime():0;return!r.ultima_aspiracao_data&&!t.ultima_aspiracao_data?0:r.ultima_aspiracao_data?t.ultima_aspiracao_data?c==="asc"?d-l:l-d:-1:1})),a},[o,q,$,N,c,j]),v=Math.ceil(x.length/S),le=n.useMemo(()=>{const a=(f-1)*S;return x.slice(a,a+S)},[x,f]),ce=()=>{I("all"),E("all"),M("all"),P("all"),L(""),D("none"),O(""),_(1)},G=a=>{Z(a),Y({tipo:a}),_(1),E("all"),M("all"),P("all")},me=()=>{var r;if(x.length===0)return;const a=h!=="all"?(r=B.find(t=>t.id===h))==null?void 0:r.nome:void 0;we(o,x,{fazenda:a})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(Ne,{title:"Animais",description:"Consulta de receptoras e doadoras"}),e.jsxs(be,{value:o,onValueChange:G,children:[e.jsx("div",{className:"rounded-xl border border-border bg-card p-1.5",children:e.jsx("div",{className:"flex gap-1",children:[{value:"receptoras",label:"Receptoras",icon:fe},{value:"doadoras",label:"Doadoras",icon:he}].map(({value:a,label:r,icon:t})=>e.jsxs("button",{onClick:()=>G(a),className:`
                  relative flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg
                  text-sm font-medium transition-all duration-200
                  ${o===a?"bg-muted/80 text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-muted/40"}
                `,children:[o===a&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-12 h-0.5 bg-primary rounded-full"}),e.jsx("div",{className:`
                  flex items-center justify-center w-7 h-7 rounded-md transition-colors
                  ${o===a?"bg-primary/15":"bg-muted/50"}
                `,children:e.jsx(t,{className:`w-4 h-4 ${o===a?"text-primary":"text-muted-foreground"}`})}),e.jsx("span",{children:r}),o===a&&x.length>0&&e.jsx("span",{className:"inline-flex items-center justify-center min-w-5 h-5 px-1.5 text-[10px] font-bold bg-primary/15 text-primary rounded-full",children:x.length})]},a))})}),e.jsx("div",{className:"mt-4 rounded-xl border border-border bg-card overflow-hidden",children:e.jsxs("div",{className:"flex flex-wrap items-stretch",children:[e.jsx("div",{className:"flex items-center px-4 py-3 border-r border-border bg-gradient-to-b from-primary/5 to-transparent",children:e.jsxs("div",{className:"relative min-w-[200px] max-w-[280px]",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary/60"}),e.jsx(je,{placeholder:o==="receptoras"?"Buscar identificação, nome...":"Buscar registro, nome...",value:N,onChange:a=>L(a.target.value),className:"pl-9 h-9 bg-background/80 border-primary/20 focus:border-primary/40"})]})}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-r border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40"}),e.jsx("span",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wider",children:"Filtros"})]}),e.jsxs(k,{value:h,onValueChange:I,children:[e.jsx(A,{className:"w-[160px] h-9 bg-background",children:e.jsx(F,{placeholder:"Fazenda"})}),e.jsxs(R,{children:[e.jsx(u,{value:"all",children:"Todas fazendas"}),B.map(a=>e.jsx(u,{value:a.id,children:a.nome},a.id))]})]}),o==="receptoras"&&e.jsxs(k,{value:y,onValueChange:E,children:[e.jsx(A,{className:"w-[150px] h-9 bg-background",children:e.jsx(F,{placeholder:"Status"})}),e.jsxs(R,{children:[e.jsx(u,{value:"all",children:"Todos status"}),e.jsx(u,{value:"DISPONIVEL",children:"Disponível"}),e.jsx(u,{value:"EM_PROTOCOLO",children:"Em Protocolo"}),e.jsx(u,{value:"PRENHE",children:"Prenhe"}),e.jsx(u,{value:"DESCARTE",children:"Descarte"}),e.jsx(u,{value:"VENDIDA",children:"Vendida"})]})]}),o==="doadoras"&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{value:w,onValueChange:M,children:[e.jsx(A,{className:"w-[140px] h-9 bg-background",children:e.jsx(F,{placeholder:"Raça"})}),e.jsxs(R,{children:[e.jsx(u,{value:"all",children:"Todas raças"}),re.map(a=>e.jsx(u,{value:a,children:a},a))]})]}),e.jsxs(k,{value:C,onValueChange:P,children:[e.jsx(A,{className:"w-[140px] h-9 bg-background",children:e.jsx(F,{placeholder:"Disponível"})}),e.jsxs(R,{children:[e.jsx(u,{value:"all",children:"Todas"}),e.jsx(u,{value:"sim",children:"Disponível"}),e.jsx(u,{value:"nao",children:"Indisponível"})]})]})]})]}),o==="doadoras"&&e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-r border-border bg-gradient-to-b from-primary/5 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40"}),e.jsx(Re,{className:"w-3.5 h-3.5 text-primary/60"}),e.jsx("span",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wider",children:"Aptas em"})]}),e.jsx(Ce,{value:j,onChange:O,placeholder:"Selecionar data",className:"h-9 w-[140px] bg-background"}),j&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(asp. até ",(()=>{const[a,r,t]=j.split("-").map(Number),d=new Date(a,r-1,t-Q);return J(d.toISOString())})(),")"]})]}),o==="doadoras"&&e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-r border-border bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-amber-500/40"}),e.jsx("span",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wider",children:"Ordenar"})]}),e.jsxs(z,{variant:c!=="none"?"default":"outline",size:"sm",className:"h-8 px-2.5",onClick:()=>{D(c==="none"?"desc":c==="desc"?"asc":"none")},title:c==="none"?"Ordenar por data":c==="desc"?"Mais recentes primeiro":"Mais antigas primeiro",children:[c==="none"&&e.jsx(Se,{className:"w-3.5 h-3.5 mr-1.5"}),c==="desc"&&e.jsx(De,{className:"w-3.5 h-3.5 mr-1.5"}),c==="asc"&&e.jsx(ze,{className:"w-3.5 h-3.5 mr-1.5"}),e.jsxs("span",{className:"text-xs",children:[c==="none"&&"Última Asp.",c==="desc"&&"Recentes",c==="asc"&&"Antigas"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 ml-auto bg-gradient-to-b from-muted/50 to-transparent",children:[(N||h!=="all"||y!=="all"||w!=="all"||C!=="all"||c!=="none"||j)&&e.jsxs(z,{variant:"outline",size:"sm",onClick:ce,className:"h-9 border-dashed border-muted-foreground/30 text-muted-foreground hover:text-foreground hover:border-muted-foreground/50",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"Limpar"]}),e.jsxs(z,{size:"sm",onClick:()=>U(),className:"h-9 bg-primary hover:bg-primary-dark shadow-sm shadow-primary/25",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Buscar"]}),x.length>0&&e.jsxs(z,{variant:"outline",size:"sm",onClick:me,className:"h-9 border-primary/30 text-primary hover:bg-primary/10 hover:border-primary/50",children:[e.jsx(ke,{className:"w-4 h-4 mr-1"}),"PDF"]})]})]})}),e.jsx(_e,{value:o,className:"mt-4",children:se?e.jsx("div",{className:"rounded-xl border border-border bg-card p-12 text-center text-muted-foreground",children:"Carregando..."}):x.length===0?e.jsx("div",{className:"rounded-xl border border-border bg-card p-12 text-center text-muted-foreground",children:"Nenhum registro encontrado"}):e.jsxs("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-muted/80 via-muted/60 to-muted/80 border-b border-border",children:e.jsxs("div",{className:`grid gap-0 text-[10px] font-semibold text-muted-foreground uppercase tracking-wider ${o==="receptoras"?"grid-cols-[1.5fr_1fr_1.5fr_1fr_0.8fr_0.6fr]":"grid-cols-[1fr_0.8fr_1fr_0.8fr_0.8fr_0.6fr_0.6fr_0.5fr]"}`,children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 rounded-full bg-primary/40"}),o==="receptoras"?"Identificação":"Registro"]}),e.jsx("div",{className:"px-3 py-3",children:"Nome"}),e.jsx("div",{className:"px-3 py-3",children:"Fazenda"}),o==="receptoras"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-3 text-center",children:"Status"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Ciclando"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-3",children:"Raça"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Última Asp."}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Aspirações"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Média"})]}),e.jsx("div",{className:"px-2 py-3"})]})}),e.jsx("div",{className:"divide-y divide-border/50",children:le.map((a,r)=>e.jsxs("div",{onClick:()=>T(o==="receptoras"?`/receptoras/${a.id}/historico`:`/doadoras/${a.id}`),className:`
                      group grid gap-0 items-center cursor-pointer transition-all duration-150
                      hover:bg-gradient-to-r hover:from-primary/5 hover:via-transparent hover:to-transparent
                      ${r%2===0?"bg-transparent":"bg-muted/20"}
                      ${o==="receptoras"?"grid-cols-[1.5fr_1fr_1.5fr_1fr_0.8fr_0.6fr]":"grid-cols-[1fr_0.8fr_1fr_0.8fr_0.8fr_0.6fr_0.6fr_0.5fr]"}
                    `,children:[e.jsxs("div",{className:"px-4 py-3.5 flex items-center gap-3",children:[e.jsx("div",{className:"w-0.5 h-8 rounded-full bg-transparent group-hover:bg-primary transition-colors"}),e.jsx("span",{className:"font-medium text-sm truncate group-hover:text-primary transition-colors",children:o==="receptoras"?a.identificacao:a.registro})]}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:a.nome||"-"}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:a.fazenda_nome}),o==="receptoras"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:e.jsx(ve,{status:a.status_reprodutivo||""})}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:a.is_cio_livre?e.jsx("span",{className:"inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-semibold bg-primary/10 text-primary rounded-md group-hover:bg-primary/20 transition-colors",children:"CL"}):e.jsx("span",{className:"inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-medium bg-muted text-muted-foreground rounded-md",children:"N"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:a.raca||"-"}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-center text-muted-foreground",children:a.ultima_aspiracao_data?J(a.ultima_aspiracao_data):"-"}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-semibold bg-muted text-foreground rounded-md",children:a.total_aspiracoes})}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-semibold bg-primary/10 text-primary rounded-md group-hover:bg-primary/20 transition-colors",children:a.media_oocitos})})]}),e.jsx("div",{className:"px-2 py-3.5 flex justify-center",children:e.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center bg-transparent group-hover:bg-primary/10 transition-colors",children:o==="receptoras"?e.jsx(Ae,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors"}):e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors"})})})]},a.id))}),v>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-muted/30 via-transparent to-muted/30 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[(f-1)*S+1,"-",Math.min(f*S,x.length)]})," ","de"," ",e.jsx("span",{className:"font-medium text-foreground",children:x.length})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>_(a=>Math.max(1,a-1)),disabled:f===1,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-0.5 mx-2",children:Array.from({length:Math.min(5,v)},(a,r)=>{let t;return v<=5||f<=3?t=r+1:f>=v-2?t=v-4+r:t=f-2+r,e.jsx("button",{onClick:()=>_(t),className:`
                              w-8 h-8 text-xs font-medium rounded-md transition-all
                              ${f===t?"bg-primary/15 text-primary shadow-sm":"text-muted-foreground hover:bg-muted hover:text-foreground"}
                            `,children:t},t)})}),e.jsx("button",{onClick:()=>_(a=>Math.min(v,a+1)),disabled:f===v,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Próximo"})]})]})]})})]})]})}export{ta as default};
