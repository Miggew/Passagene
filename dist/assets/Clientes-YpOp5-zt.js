import{r as m,s as p,j as e,h as _,L as g,B as f,U as y,f as B}from"./index-6OJhfjKP.js";import{C as x,d as h,a as F,b as P}from"./card-D-gf0lmS.js";import{I as D}from"./input-_UHZ9n1P.js";import{T as H,a as M,b as N,c as r,d as R,e as n}from"./table-B_Z-CztY.js";import{P as k}from"./PageHeader-P7sO2uqv.js";import{E as I}from"./EmptyState-CEfkJzHC.js";import{h as U}from"./error-handler-CXUXfXq4.js";import{P as A}from"./plus-Dnfaq_2C.js";import{M as G}from"./map-pin-CuMBtep0.js";import{S as V}from"./search-DHWddfjN.js";import{E as W}from"./eye-BPc5Q01W.js";import"./use-toast-DasFaehQ.js";function te(){const[d,C]=m.useState([]),[w,v]=m.useState(!0),[l,u]=m.useState("");m.useEffect(()=>{z()},[]);const z=async()=>{try{const{data:s,error:a}=await p.from("clientes").select("*").order("nome",{ascending:!0});if(a)throw a;const{data:c,error:o}=await p.from("fazendas").select("cliente_id");if(o)throw o;const t=new Map;(c||[]).forEach(i=>{const S=t.get(i.cliente_id)||0;t.set(i.cliente_id,S+1)});const L=(s||[]).map(i=>({...i,fazendas_count:t.get(i.id)||0}));C(L)}catch(s){U(s,"Erro ao carregar clientes")}finally{v(!1)}},j=d.filter(s=>{var c,o,t;if(!l)return!0;const a=l.toLowerCase();return((c=s.nome)==null?void 0:c.toLowerCase().includes(a))||((o=s.telefone)==null?void 0:o.toLowerCase().includes(a))||((t=s.endereco)==null?void 0:t.toLowerCase().includes(a))}),b=d.length,T=d.reduce((s,a)=>s+(a.fazendas_count||0),0),E=d.filter(s=>(s.fazendas_count||0)>0).length;return w?e.jsx(_,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{title:"Clientes",description:"Gerenciar clientes do sistema",actions:e.jsx(g,{to:"/clientes/novo",children:e.jsxs(f,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Novo Cliente"]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de Clientes"}),e.jsx("p",{className:"text-2xl font-bold",children:b})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Com Fazendas"}),e.jsx("p",{className:"text-2xl font-bold",children:E})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Fazendas"}),e.jsx("p",{className:"text-2xl font-bold",children:T})]})]})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-xs",children:[e.jsx(V,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Buscar por nome, telefone ou endereço...",value:l,onChange:s=>u(s.target.value),className:"pl-8"})]}),l&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>u(""),children:"Limpar filtro"})]}),e.jsxs(x,{children:[e.jsx(F,{children:e.jsxs(P,{children:["Clientes (",j.length,")"]})}),e.jsx(h,{children:j.length===0?e.jsx(I,{title:"Nenhum cliente encontrado",description:l?"Tente ajustar os filtros de busca":"Cadastre o primeiro cliente para começar."}):e.jsxs(H,{children:[e.jsx(M,{children:e.jsxs(N,{children:[e.jsx(r,{children:"Nome"}),e.jsx(r,{children:"Telefone"}),e.jsx(r,{children:"Endereço"}),e.jsx(r,{children:"Fazendas"}),e.jsx(r,{children:"Cadastrado em"}),e.jsx(r,{className:"text-right",children:"Ações"})]})}),e.jsx(R,{children:j.map(s=>e.jsxs(N,{children:[e.jsx(n,{className:"font-medium",children:s.nome}),e.jsx(n,{children:s.telefone||"-"}),e.jsx(n,{children:s.endereco||"-"}),e.jsx(n,{children:s.fazendas_count?e.jsx("span",{className:"text-primary font-medium",children:s.fazendas_count}):e.jsx("span",{className:"text-muted-foreground",children:"0"})}),e.jsx(n,{children:s.created_at?new Date(s.created_at).toLocaleDateString("pt-BR"):"-"}),e.jsx(n,{className:"text-right",children:e.jsx(g,{to:`/clientes/${s.id}`,children:e.jsxs(f,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),"Ver"]})})})]},s.id))})]})})]})]})}export{te as default};
