import{f as Y,r as d,s as w,j as e,a as Q,B as v}from"./index-DmNymSE5.js";import{C as W,a as X,b as Z,d as ee}from"./card-SrkIpKk5.js";import{T as ae,a as se,b,c as u,d as oe,e as m}from"./table-BEqiB4gi.js";import{D as re,a as ie,b as te,c as le,d as ne,e as de}from"./dialog-j4QKUGZf.js";import{S as L,a as z,b as P,c as B,d as y}from"./select-yD1hylSL.js";import{I as n}from"./input-CUsCheD8.js";import{L as i}from"./label-u6KawL_e.js";import{T as H}from"./textarea-BuM8ilf-.js";import{P as ce}from"./PageHeader-C6hPTib0.js";import{E as me}from"./EmptyState-8CewmVht.js";import{u as ue}from"./use-toast-8Wh80yTN.js";import{B as he}from"./badge-BB9l9AxT.js";import{C as ge}from"./CamposDinamicosPorRaca-QbshGB_a.js";import{P as pe}from"./plus-BZvL1qCK.js";import{S as xe}from"./search-52vUzEUy.js";import{E as je}from"./eye-VBUrU1-Z.js";import"./index-BMCBZPUE.js";import"./index-C79PyqkA.js";import"./x-BKw_NAIH.js";import"./index-BoubMqWY.js";import"./index-BMurdLVa.js";import"./check-D6LfuFSM.js";const O=["Holandesa","Jersey","Gir","Girolando","Nelore","Angus","Brahman","Hereford","Simmental","Tabapuã","Sindi","Caracu","Canchim","Senepol","Brangus","Gir Leiteiro","Guzerá"];function Ve(){const G=Y(),[T,V]=d.useState([]),[S,F]=d.useState([]),[p,q]=d.useState(""),[x,A]=d.useState(""),[I,k]=d.useState(!0),[$,f]=d.useState(!1),[N,D]=d.useState(!1),{toast:h}=ue(),[s,t]=d.useState({registro:"",nome:"",raca:"",data_nascimento:"",proprietario:"",fazenda_nome:"",pai_registro:"",pai_nome:"",mae_registro:"",mae_nome:"",genealogia_texto:"",link_catalogo:"",foto_url:"",link_video:"",observacoes:""}),[l,E]=d.useState({dados_geneticos:{},dados_producao:{},dados_conformacao:{},medidas_fisicas:{},dados_saude_reproducao:{},caseinas:{},outros_dados:{}});d.useEffect(()=>{R()},[]),d.useEffect(()=>{M()},[p,x,T]);const M=()=>{let a=[...T];if(p.trim()){const o=p.toLowerCase();a=a.filter(r=>{var c,j,g;return((c=r.nome)==null?void 0:c.toLowerCase().includes(o))||((j=r.registro)==null?void 0:j.toLowerCase().includes(o))||((g=r.raca)==null?void 0:g.toLowerCase().includes(o))})}x&&(a=a.filter(o=>o.raca===x)),F(a)},R=async()=>{try{k(!0);const{data:a,error:o}=await w.from("touros").select("*").order("nome",{ascending:!0});if(o)throw o;V(a||[]),F(a||[])}catch(a){h({title:"Erro ao carregar touros",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{k(!1)}},C=()=>{t({registro:"",nome:"",raca:"",data_nascimento:"",proprietario:"",fazenda_nome:"",pai_registro:"",pai_nome:"",mae_registro:"",mae_nome:"",genealogia_texto:"",link_catalogo:"",foto_url:"",link_video:"",observacoes:""}),E({dados_geneticos:{},dados_producao:{},dados_conformacao:{},medidas_fisicas:{},dados_saude_reproducao:{},caseinas:{},outros_dados:{}})},U=(a,o,r)=>{E(c=>({...c,[r]:{...c[r],[a]:o===""?void 0:o}}))},J=async a=>{if(a.preventDefault(),!s.registro.trim()){h({title:"Erro de validação",description:"Registro é obrigatório",variant:"destructive"});return}if(!s.nome.trim()){h({title:"Erro de validação",description:"Nome é obrigatório",variant:"destructive"});return}if(!s.raca){h({title:"Erro de validação",description:"Raça é obrigatória",variant:"destructive"});return}try{D(!0);const o=j=>{const g={};return Object.entries(j).forEach(([K,_])=>{_!=null&&_!==""&&(g[K]=_)}),Object.keys(g).length>0?g:{}},r={registro:s.registro.trim(),nome:s.nome.trim(),raca:s.raca,data_nascimento:s.data_nascimento||null,proprietario:s.proprietario.trim()||null,fazenda_nome:s.fazenda_nome.trim()||null,pai_registro:s.pai_registro.trim()||null,pai_nome:s.pai_nome.trim()||null,mae_registro:s.mae_registro.trim()||null,mae_nome:s.mae_nome.trim()||null,genealogia_texto:s.genealogia_texto.trim()||null,link_catalogo:s.link_catalogo.trim()||null,foto_url:s.foto_url.trim()||null,link_video:s.link_video.trim()||null,observacoes:s.observacoes.trim()||null,disponivel:!0,dados_geneticos:o(l.dados_geneticos),dados_producao:o(l.dados_producao),dados_conformacao:o(l.dados_conformacao),medidas_fisicas:o(l.medidas_fisicas),dados_saude_reproducao:o(l.dados_saude_reproducao),caseinas:o(l.caseinas),outros_dados:o(l.outros_dados)},{error:c}=await w.from("touros").insert([r]);if(c)throw c;h({title:"Touro cadastrado",description:"Touro cadastrado com sucesso no catálogo"}),f(!1),C(),R()}catch(o){let r="Erro desconhecido";o!=null&&o.message?r=o.message:typeof o=="string"&&(r=o),r.includes("RLS")||r.includes("policy")?r="RLS está bloqueando escrita. Configure políticas anon no Supabase.":r.includes("duplicate")||r.includes("unique")?r="Já existe um touro com este registro no catálogo.":(r.includes("null value")||r.includes("NOT NULL"))&&(r="Um ou mais campos obrigatórios não foram preenchidos. Verifique o formulário."),h({title:"Erro ao cadastrar touro",description:r,variant:"destructive"})}finally{D(!1)}};return I?e.jsx(Q,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{title:"Catálogo de Touros",description:"Gerenciar catálogo de touros para FIV",actions:e.jsxs(re,{open:$,onOpenChange:a=>{f(a),a||C()},children:[e.jsx(ie,{asChild:!0,children:e.jsxs(v,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Novo Touro"]})}),e.jsxs(te,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(le,{children:[e.jsx(ne,{children:"Cadastrar Novo Touro"}),e.jsx(de,{children:"Adicione um touro ao catálogo. Os clientes poderão ter doses deste touro."})]}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"registro",children:"Registro *"}),e.jsx(n,{id:"registro",value:s.registro,onChange:a=>t({...s,registro:a.target.value}),placeholder:"Ex: 250HO14579",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"nome",children:"Nome *"}),e.jsx(n,{id:"nome",value:s.nome,onChange:a=>t({...s,nome:a.target.value}),placeholder:"Ex: HANCOCK",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"raca",children:"Raça"}),e.jsxs(L,{value:s.raca,onValueChange:a=>t({...s,raca:a}),children:[e.jsx(z,{children:e.jsx(P,{placeholder:"Selecione a raça"})}),e.jsx(B,{children:O.map(a=>e.jsx(y,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"data_nascimento",children:"Data de Nascimento"}),e.jsx(n,{id:"data_nascimento",type:"date",value:s.data_nascimento,onChange:a=>t({...s,data_nascimento:a.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"proprietario",children:"Proprietário"}),e.jsx(n,{id:"proprietario",value:s.proprietario,onChange:a=>t({...s,proprietario:a.target.value}),placeholder:"Nome do proprietário"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"fazenda_nome",children:"Fazenda"}),e.jsx(n,{id:"fazenda_nome",value:s.fazenda_nome,onChange:a=>t({...s,fazenda_nome:a.target.value}),placeholder:"Nome da fazenda"})]})]}),s.raca&&e.jsx("div",{className:"border-t pt-4",children:e.jsx(ge,{raca:s.raca,valores:{...l.dados_geneticos,...l.dados_producao,...l.dados_conformacao,...l.medidas_fisicas,...l.dados_saude_reproducao,...l.caseinas,...l.outros_dados},onChange:U})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Pedigree"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pai_registro",children:"Registro do Pai"}),e.jsx(n,{id:"pai_registro",value:s.pai_registro,onChange:a=>t({...s,pai_registro:a.target.value}),placeholder:"Registro do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pai_nome",children:"Nome do Pai"}),e.jsx(n,{id:"pai_nome",value:s.pai_nome,onChange:a=>t({...s,pai_nome:a.target.value}),placeholder:"Nome do pai"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"mae_registro",children:"Registro da Mãe"}),e.jsx(n,{id:"mae_registro",value:s.mae_registro,onChange:a=>t({...s,mae_registro:a.target.value}),placeholder:"Registro da mãe"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"mae_nome",children:"Nome da Mãe"}),e.jsx(n,{id:"mae_nome",value:s.mae_nome,onChange:a=>t({...s,mae_nome:a.target.value}),placeholder:"Nome da mãe"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(i,{htmlFor:"genealogia_texto",children:"Genealogia Completa (Texto)"}),e.jsx(H,{id:"genealogia_texto",value:s.genealogia_texto,onChange:a=>t({...s,genealogia_texto:a.target.value}),placeholder:"Genealogia completa em formato texto",rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"link_catalogo",children:"Link do Catálogo"}),e.jsx(n,{id:"link_catalogo",type:"url",value:s.link_catalogo,onChange:a=>t({...s,link_catalogo:a.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"foto_url",children:"URL da Foto"}),e.jsx(n,{id:"foto_url",type:"url",value:s.foto_url,onChange:a=>t({...s,foto_url:a.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"link_video",children:"Link do Vídeo (YouTube, etc.)"}),e.jsx(n,{id:"link_video",type:"url",value:s.link_video,onChange:a=>t({...s,link_video:a.target.value}),placeholder:"https://..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"observacoes",children:"Observações"}),e.jsx(H,{id:"observacoes",value:s.observacoes,onChange:a=>t({...s,observacoes:a.target.value}),placeholder:"Observações adicionais sobre o touro",rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(v,{type:"submit",className:"flex-1 bg-green-600 hover:bg-green-700",disabled:N,children:N?"Salvando...":"Cadastrar Touro"}),e.jsx(v,{type:"button",variant:"outline",onClick:()=>{f(!1),C()},disabled:N,children:"Cancelar"})]})]})]})]})}),e.jsxs(W,{children:[e.jsx(X,{children:e.jsx(Z,{children:"Lista de Touros"})}),e.jsxs(ee,{children:[e.jsx("div",{className:"space-y-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Buscar Touro"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(n,{placeholder:"Buscar por nome, registro ou raça...",value:p,onChange:a=>q(a.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Filtrar por Raça"}),e.jsxs(L,{value:x||"all",onValueChange:a=>A(a==="all"?"":a),children:[e.jsx(z,{children:e.jsx(P,{placeholder:"Todas as raças"})}),e.jsxs(B,{children:[e.jsx(y,{value:"all",children:"Todas as raças"}),O.map(a=>e.jsx(y,{value:a,children:a},a))]})]})]})]})}),e.jsxs(ae,{children:[e.jsx(se,{children:e.jsxs(b,{children:[e.jsx(u,{children:"Registro"}),e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Raça"}),e.jsx(u,{children:"NM$"}),e.jsx(u,{children:"TPI"}),e.jsx(u,{children:"PTAT"}),e.jsx(u,{className:"text-right",children:"Ações"})]})}),e.jsx(oe,{children:S.length===0?e.jsx(b,{children:e.jsx(m,{colSpan:7,className:"text-center text-slate-500",children:e.jsx(me,{title:"Nenhum touro cadastrado",description:"Cadastre o primeiro touro para começar."})})}):S.map(a=>e.jsxs(b,{children:[e.jsx(m,{className:"font-medium",children:a.registro}),e.jsx(m,{children:a.nome}),e.jsx(m,{children:a.raca?e.jsx(he,{variant:"outline",children:a.raca}):"-"}),e.jsx(m,{children:a.nm_dolares!==null&&a.nm_dolares!==void 0?`+${a.nm_dolares}`:"-"}),e.jsx(m,{children:a.tpi!==null&&a.tpi!==void 0?`+${a.tpi}`:"-"}),e.jsx(m,{children:a.ptat!==null&&a.ptat!==void 0?`+${a.ptat}`:"-"}),e.jsx(m,{className:"text-right",children:e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>G(`/touros/${a.id}`),children:e.jsx(je,{className:"w-4 h-4"})})})]},a.id))})]})]})]})]})}export{Ve as default};
