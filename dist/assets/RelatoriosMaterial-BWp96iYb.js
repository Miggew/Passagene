import{ac as ue,r as c,s as j,j as e,S as pe,aI as fe,B as S,X as he}from"./index-B-7HRnm0.js";import{C as ge,a as je,b as _e,d as be}from"./card-DdhhEbXV.js";import{I as ve}from"./input-D2h8r4MO.js";import{B as Ne}from"./badge-BCHVCiM7.js";import{S as E,a as k,b as P,c as F,d as u}from"./select-B0M3FCy4.js";import{T as ye,a as Ce,b as X,c as Se}from"./tabs-ChsREKvA.js";import{u as we}from"./useClienteFilter-Df1PgEKu.js";import{P as Te}from"./PageHeader-CT7CFo0W.js";import{e as qe}from"./exportPdf-0A6g_7-d.js";import{S as Me}from"./search-DcAWDjHO.js";import{F as Ee}from"./file-text-ElQw19Mr.js";import{f as ke,p as Pe}from"./pt-BR-DS62bWKG.js";import"./index-B4eR1KA_.js";import"./check-C6h7QFZL.js";import"./index-C7yzDtsu.js";import"./differenceInCalendarDays-CrzntjZV.js";const w=20;function Je(){const[J,U]=ue(),{clienteIdFilter:i}=we(),[l,W]=c.useState(J.get("tipo")||"embrioes"),[Y,A]=c.useState([]),[_,I]=c.useState("all"),[b,D]=c.useState("all"),[T,L]=c.useState("all"),[q,Q]=c.useState(""),[M,$]=c.useState("all"),[R,Z]=c.useState([]),[G,B]=c.useState([]),[ee,se]=c.useState([]),[p,v]=c.useState(1),[ae,V]=c.useState(!0);c.useEffect(()=>{te(),re()},[i]),c.useEffect(()=>{oe(),v(1)},[l,_,b,T,M,i]);const te=async()=>{if(i){const{data:a}=await j.from("clientes").select("*").eq("id",i);A(a??[]);return}const{data:s}=await j.from("clientes").select("*").order("nome");A(s??[])},re=async()=>{const{data:s}=await j.from("touros").select("id, nome").order("nome");se(s??[])},oe=async()=>{V(!0);try{l==="embrioes"?await ie():await le()}catch(s){console.error("Erro ao carregar dados:",s)}finally{V(!1)}},ie=async()=>{let s=j.from("embrioes").select(`
        id,
        cliente_id,
        classificacao,
        tipo_embriao,
        data_congelamento,
        cliente:clientes(id, nome),
        acasalamento:lote_fiv_acasalamentos(
          id,
          dose_semen:doses_semen(
            touro:touros(id, nome)
          ),
          aspiracao:aspiracoes_doadoras(
            doadora:doadoras(id, registro, nome)
          )
        )
      `).eq("status_atual","CONGELADO").order("data_congelamento",{ascending:!1});i?s=s.eq("cliente_id",i):_!=="all"&&(s=s.eq("cliente_id",_));const{data:a}=await s,t=new Map;a==null||a.forEach(r=>{var o,C;const n=r.acasalamento,d=(o=n==null?void 0:n.aspiracao)==null?void 0:o.doadora,f=(C=n==null?void 0:n.dose_semen)==null?void 0:C.touro,g=r.cliente,N=`${r.cliente_id}-${(d==null?void 0:d.id)||"sem"}-${(f==null?void 0:f.id)||"sem"}-${r.classificacao||"sem"}`,y=t.get(N);y?y.quantidade++:t.set(N,{id:r.id,cliente_id:r.cliente_id||"",cliente_nome:(g==null?void 0:g.nome)??"N/A",doadora_registro:d==null?void 0:d.registro,doadora_nome:d==null?void 0:d.nome,touro_nome:f==null?void 0:f.nome,qualidade:r.classificacao?parseInt(r.classificacao):void 0,estadio:r.tipo_embriao,data_congelamento:r.data_congelamento,quantidade:1})});let x=Array.from(t.values());b!=="all"&&(x=x.filter(r=>{var n;return(n=r.touro_nome)==null?void 0:n.toLowerCase().includes(b.toLowerCase())})),M!=="all"&&(x=x.filter(r=>r.qualidade===parseInt(M))),Z(x)},le=async()=>{var N,y;let s=j.from("doses_semen").select("*").gt("quantidade",0).order("created_at",{ascending:!1});i?s=s.eq("cliente_id",i):_!=="all"&&(s=s.eq("cliente_id",_)),b!=="all"&&(s=s.eq("touro_id",b)),T!=="all"&&(s=s.eq("tipo_semen",T));const{data:a,error:t}=await s;if(t){console.error("Erro ao carregar doses:",t),B([]);return}if(!a||a.length===0){B([]);return}const x=[...new Set(a.map(o=>o.cliente_id).filter(Boolean))],r=[...new Set(a.map(o=>o.touro_id).filter(Boolean))],[n,d]=await Promise.all([x.length>0?j.from("clientes").select("id, nome").in("id",x):Promise.resolve({data:[]}),r.length>0?j.from("touros").select("id, nome, registro").in("id",r):Promise.resolve({data:[]})]),f=new Map,g=new Map;(N=n.data)==null||N.forEach(o=>f.set(o.id,o.nome)),(y=d.data)==null||y.forEach(o=>g.set(o.id,{nome:o.nome,registro:o.registro})),B(a.map(o=>{var C,K;return{id:o.id,cliente_id:o.cliente_id,cliente_nome:f.get(o.cliente_id)??"N/A",touro_nome:((C=g.get(o.touro_id))==null?void 0:C.nome)??"N/A",touro_registro:(K=g.get(o.touro_id))==null?void 0:K.registro,tipo_semen:o.tipo_semen,quantidade_disponivel:o.quantidade??0,partida:o.partida,data_aquisicao:o.data_aquisicao}}))},m=c.useMemo(()=>{let s=l==="embrioes"?R:G;if(q.trim()){const a=q.toLowerCase();l==="embrioes"?s=s.filter(t=>{var x,r,n,d;return((x=t.doadora_registro)==null?void 0:x.toLowerCase().includes(a))||((r=t.doadora_nome)==null?void 0:r.toLowerCase().includes(a))||((n=t.touro_nome)==null?void 0:n.toLowerCase().includes(a))||((d=t.cliente_nome)==null?void 0:d.toLowerCase().includes(a))}):s=s.filter(t=>{var x,r,n,d;return((x=t.touro_nome)==null?void 0:x.toLowerCase().includes(a))||((r=t.touro_registro)==null?void 0:r.toLowerCase().includes(a))||((n=t.cliente_nome)==null?void 0:n.toLowerCase().includes(a))||((d=t.partida)==null?void 0:d.toLowerCase().includes(a))})}return s},[l,R,G,q]),z=c.useMemo(()=>l==="embrioes"?{registros:m.length,quantidade:m.reduce((s,a)=>s+(a.quantidade||0),0)}:{registros:m.length,quantidade:m.reduce((s,a)=>s+(a.quantidade_disponivel||0),0)},[l,m]),h=Math.ceil(m.length/w),O=c.useMemo(()=>{const s=(p-1)*w;return m.slice(s,s+w)},[m,p]),ne=()=>{I("all"),D("all"),L("all"),$("all"),Q(""),v(1)},de=s=>{W(s),U({tipo:s}),v(1),L("all"),$("all")},H=s=>{if(!s)return"-";try{return ke(new Date(s+"T12:00:00"),"dd/MM/yyyy",{locale:Pe})}catch{return s}},ce=s=>{if(!s)return"-";const a={1:"bg-primary/15 text-primary",2:"bg-amber-500/15 text-amber-600 dark:text-amber-400",3:"bg-red-500/15 text-red-600 dark:text-red-400"};return e.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 text-xs font-medium rounded ${a[s]||"bg-muted text-foreground"}`,children:s})},me=s=>{const t={convencional:{label:"Conv.",color:"bg-muted text-foreground"},sexado_femea:{label:"Sexado F",color:"bg-pink-500/15 text-pink-600 dark:text-pink-400"},sexado_macho:{label:"Sexado M",color:"bg-blue-500/15 text-blue-600 dark:text-blue-400"}}[s]||{label:s,color:"bg-muted text-foreground"};return e.jsx(Ne,{className:t.color,children:t.label})},xe=()=>{if(m.length===0)return;qe({embrioes:"embrioes",semen:"dosesSemen"}[l],m,{})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(Te,{title:"Material Genético",description:"Estoque de embriões congelados e doses de sêmen"}),e.jsxs(ye,{value:l,onValueChange:de,children:[e.jsxs(Ce,{className:"grid w-full grid-cols-2 max-w-md",children:[e.jsxs(X,{value:"embrioes",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Embriões Congelados"]}),e.jsxs(X,{value:"semen",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Doses de Sêmen"]})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card p-4 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-[280px]",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ve,{placeholder:l==="embrioes"?"Buscar por doadora ou touro...":"Buscar por touro ou partida...",value:q,onChange:s=>Q(s.target.value),className:"pl-9 h-9"})]}),e.jsx("div",{className:"h-6 w-px bg-border hidden sm:block"}),!i&&e.jsxs(E,{value:_,onValueChange:I,children:[e.jsx(k,{className:"w-[180px] h-9",children:e.jsx(P,{placeholder:"Cliente"})}),e.jsxs(F,{children:[e.jsx(u,{value:"all",children:"Todos os clientes"}),Y.map(s=>e.jsx(u,{value:s.id,children:s.nome},s.id))]})]}),e.jsxs(E,{value:b,onValueChange:D,children:[e.jsx(k,{className:"w-[180px] h-9",children:e.jsx(P,{placeholder:"Touro"})}),e.jsxs(F,{children:[e.jsx(u,{value:"all",children:"Todos os touros"}),ee.map(s=>e.jsx(u,{value:s.id,children:s.nome},s.id))]})]}),l==="embrioes"&&e.jsxs(E,{value:M,onValueChange:$,children:[e.jsx(k,{className:"w-[130px] h-9",children:e.jsx(P,{placeholder:"Qualidade"})}),e.jsxs(F,{children:[e.jsx(u,{value:"all",children:"Todas"}),e.jsx(u,{value:"1",children:"Grau 1"}),e.jsx(u,{value:"2",children:"Grau 2"}),e.jsx(u,{value:"3",children:"Grau 3"})]})]}),l==="semen"&&e.jsxs(E,{value:T,onValueChange:L,children:[e.jsx(k,{className:"w-[150px] h-9",children:e.jsx(P,{placeholder:"Tipo"})}),e.jsxs(F,{children:[e.jsx(u,{value:"all",children:"Todos"}),e.jsx(u,{value:"convencional",children:"Convencional"}),e.jsx(u,{value:"sexado_femea",children:"Sexado Fêmea"}),e.jsx(u,{value:"sexado_macho",children:"Sexado Macho"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:ne,className:"h-9",children:e.jsx(he,{className:"w-4 h-4"})}),m.length>0&&e.jsxs(S,{variant:"outline",size:"sm",onClick:xe,className:"h-9 border-primary/30 text-primary hover:bg-primary/10 hover:border-primary/50",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"PDF"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 pt-3 border-t border-border",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{className:"text-foreground",children:z.registros})," registros"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{className:"text-primary",children:z.quantidade})," ",l==="embrioes"?"embriões":"doses"," no total"]})]})]}),e.jsx(Se,{value:l,className:"mt-4",children:e.jsxs(ge,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs(_e,{className:"text-base",children:[l==="embrioes"&&`Embriões Congelados (${m.length})`,l==="semen"&&`Doses de Sêmen (${m.length})`]})}),e.jsx(be,{className:"pt-0",children:ae?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando..."}):m.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum registro encontrado"}):e.jsxs(e.Fragment,{children:[l==="embrioes"&&e.jsxs("div",{className:"rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-[1.5fr_1.2fr_1.2fr_0.7fr_0.7fr_1fr_0.7fr] gap-0 bg-muted text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:[!i&&e.jsx("div",{className:"px-4 py-3",children:"Cliente"}),e.jsx("div",{className:`px-3 py-3 ${i?"px-4":""}`,children:"Doadora"}),e.jsx("div",{className:"px-3 py-3",children:"Touro"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Qual."}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Estádio"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Congelamento"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Qtd"})]}),O.map(s=>e.jsxs("div",{className:`grid gap-0 items-center border-t border-border hover:bg-muted/30 ${i?"grid-cols-[1.2fr_1.2fr_0.7fr_0.7fr_1fr_0.7fr]":"grid-cols-[1.5fr_1.2fr_1.2fr_0.7fr_0.7fr_1fr_0.7fr]"}`,children:[!i&&e.jsx("div",{className:"px-4 py-3 text-sm truncate",children:s.cliente_nome}),e.jsxs("div",{className:`py-3 ${i?"px-4":"px-3"}`,children:[e.jsx("div",{className:"text-sm font-medium",children:s.doadora_registro||"-"}),s.doadora_nome&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.doadora_nome})]}),e.jsx("div",{className:"px-3 py-3 text-sm truncate",children:s.touro_nome||"-"}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:ce(s.qualidade)}),e.jsx("div",{className:"px-3 py-3 text-center text-sm",children:s.estadio||"-"}),e.jsx("div",{className:"px-3 py-3 text-center text-sm",children:H(s.data_congelamento)}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-8 h-7 px-2 text-sm font-semibold bg-primary/15 text-primary rounded-lg",children:s.quantidade})})]},s.id))]}),l==="semen"&&e.jsxs("div",{className:"rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:`grid gap-0 bg-muted text-xs font-semibold text-muted-foreground uppercase tracking-wide ${i?"grid-cols-[1.5fr_1fr_1fr_1fr_0.8fr]":"grid-cols-[1.5fr_1.5fr_1fr_1fr_1fr_0.8fr]"}`,children:[!i&&e.jsx("div",{className:"px-4 py-3",children:"Cliente"}),e.jsx("div",{className:`px-3 py-3 ${i?"px-4":""}`,children:"Touro"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Tipo"}),e.jsx("div",{className:"px-3 py-3",children:"Partida"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Aquisição"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Qtd"})]}),O.map(s=>e.jsxs("div",{className:`grid gap-0 items-center border-t border-border hover:bg-muted/30 ${i?"grid-cols-[1.5fr_1fr_1fr_1fr_0.8fr]":"grid-cols-[1.5fr_1.5fr_1fr_1fr_1fr_0.8fr]"}`,children:[!i&&e.jsx("div",{className:"px-4 py-3 text-sm truncate",children:s.cliente_nome}),e.jsxs("div",{className:`py-3 ${i?"px-4":"px-3"}`,children:[e.jsx("div",{className:"text-sm font-medium",children:s.touro_nome}),s.touro_registro&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.touro_registro})]}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:me(s.tipo_semen)}),e.jsx("div",{className:"px-3 py-3 text-sm",children:s.partida||"-"}),e.jsx("div",{className:"px-3 py-3 text-center text-sm",children:H(s.data_aquisicao)}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-8 h-7 px-2 text-sm font-semibold bg-primary/15 text-primary rounded-lg",children:s.quantidade_disponivel})})]},s.id))]}),h>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Mostrando ",(p-1)*w+1," a ",Math.min(p*w,m.length)," de ",m.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>v(s=>Math.max(1,s-1)),disabled:p===1,children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,h)},(s,a)=>{let t;return h<=5||p<=3?t=a+1:p>=h-2?t=h-4+a:t=p-2+a,e.jsx(S,{variant:p===t?"default":"outline",size:"sm",className:`w-9 h-9 p-0 ${p===t?"bg-primary hover:bg-primary-dark":""}`,onClick:()=>v(t),children:t},t)})}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>v(s=>Math.min(h,s+1)),disabled:p===h,children:"Próximo"})]})]})]})})]})})]})]})}export{Je as default};
