import{a as Oa,r as o,s as j,j as e,h as Ee,B as u}from"./index-6OJhfjKP.js";import{C as q,d as $,a as ne,b as de}from"./card-D-gf0lmS.js";import{T as Pa,a as Ra,b as Oe,c as S,d as Va,e as z}from"./table-B_Z-CztY.js";import{D as Pe,b as Re,c as Ve,d as Be,e as He}from"./dialog-CFjhGf-B.js";import{A as Le,a as qe,b as $e,c as Me,d as Ue,e as Ge,f as Je,g as Ze}from"./alert-dialog-C4TLnUZs.js";import{B as M}from"./badge-ChTtRB_d.js";import{I as p}from"./input-_UHZ9n1P.js";import{L as y}from"./label-BTrzYRkl.js";import{S as U,a as G,b as J,c as Z,d as T}from"./select-B7v4ZPbC.js";import{P as Ba,a as Ha,b as La}from"./popover-CUxnE3Xp.js";import{C as qa,a as $a,b as Ma,c as Ua,d as Xe,e as Ga,f as Ja}from"./command-B2YX0Sd5.js";import{T as Za,a as Xa,b as Ke,c as Ye}from"./tabs-DFK_xrkO.js";import{P as Ka}from"./PageHeader-P7sO2uqv.js";import{E as Ya}from"./EmptyState-CEfkJzHC.js";import{u as Qa}from"./use-toast-DasFaehQ.js";import{f as Qe}from"./dateUtils-eJ5e6apA.js";import{D as ce}from"./DatePickerBR-CEQaSWUC.js";import{C as Wa,F as We}from"./filter-cmdSYwTm.js";import{X as es}from"./x-kO07YPaG.js";import{P as ea}from"./plus-Dnfaq_2C.js";import{U as aa}from"./user-plus-CcifB0Ou.js";import{T as as}from"./trash-2-C555fPdQ.js";import{S as ss}from"./save-CusHMB-Y.js";import{S as rs}from"./search-DHWddfjN.js";import{E as ts}from"./eye-BPc5Q01W.js";import{T as os}from"./triangle-alert-pkIeF1ja.js";import"./index-CtR1jODk.js";import"./check-CgmfRmMI.js";import"./index-ea8B15na.js";import"./chevron-right-BdMx8zjt.js";const X="passagene_aspiracao_rascunho",is=24;function Rs(){const le=Oa(),{toast:h}=Qa(),[sa,me]=o.useState("nova-sessao"),[A,ra]=o.useState([]),[ta,xe]=o.useState(!0),[f,P]=o.useState("form"),[pe,he]=o.useState(!1),[oa,R]=o.useState(!1),[ia,K]=o.useState(!1),[ue,fe]=o.useState(null),[t,C]=o.useState({fazenda_id:"",data_aspiracao:new Date().toISOString().split("T")[0],horario_inicio:"",veterinario_responsavel:"",tecnico_responsavel:""}),[v,V]=o.useState([]),[d,k]=o.useState([]),[B,ge]=o.useState([]),[na,ve]=o.useState(!1),Y=o.useRef(0),[da,je]=o.useState([]),[ca,Q]=o.useState(!1),[la,Ne]=o.useState(!1),[W,_e]=o.useState(""),[ma,ee]=o.useState(!1),[xa,ae]=o.useState(!1),[I,be]=o.useState(""),[m,E]=o.useState({registro:"",nome:"",raca:"",racaCustom:""}),pa=["Nelore","Gir","Girolando","Holandesa","Jersey","Senepol","Angus","Brahman"],[O,ha]=o.useState([]),[se,ua]=o.useState([]),[De,ye]=o.useState(!1),[H,fa]=o.useState(!1),[L,ga]=o.useState(""),[N,Ce]=o.useState(""),[_,we]=o.useState(""),Se=W.trim(),va=Se.length>=2,ze=da.filter(a=>!v.includes(a.id)),re=o.useMemo(()=>d.reduce((a,s)=>a+(s.total_oocitos||0),0),[d]),te=v.length>0&&d.length>0,ja=f==="doadoras"||d.length>0;o.useEffect(()=>{Da()},[]),o.useEffect(()=>{Ae()&&R(!0)},[]),o.useEffect(()=>{if(f==="doadoras"||d.length>0){const a=setTimeout(()=>{Na()},1e3);return()=>clearTimeout(a)}},[t,v,d,f]),o.useEffect(()=>{const a=Se;if(!a){je([]),Q(!1);return}const s=++Y.current;Q(!0),j.from("fazendas").select("id, nome").ilike("nome",`%${a}%`).order("nome",{ascending:!0}).limit(50).then(({data:r})=>{s===Y.current&&je(r||[])}).finally(()=>{s===Y.current&&Q(!1)})},[W]),o.useEffect(()=>{t.fazenda_id&&f==="doadoras"&&Fe()},[t.fazenda_id,f]);const Ae=()=>{try{const a=localStorage.getItem(X);if(!a)return null;const s=JSON.parse(a);return(Date.now()-s.timestamp)/(1e3*60*60)>is?(localStorage.removeItem(X),null):s}catch{return null}},Na=()=>{const a={formData:t,fazendas_destino_ids:v,doadoras:d,timestamp:Date.now()};localStorage.setItem(X,JSON.stringify(a))},ke=()=>{localStorage.removeItem(X)},_a=()=>{const a=Ae();a&&(C(a.formData),V(a.fazendas_destino_ids),k(a.doadoras),P("doadoras")),R(!1)},ba=()=>{ke(),R(!1)},Da=async()=>{try{xe(!0);const{data:a,error:s}=await j.from("fazendas").select("id, nome").order("nome",{ascending:!0});if(s)throw s;ra(a||[])}catch(a){h({title:"Erro ao carregar fazendas",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{xe(!1)}},Fe=async()=>{if(t.fazenda_id)try{ve(!0);const{data:a,error:s}=await j.from("doadoras").select("*").eq("fazenda_id",t.fazenda_id).order("registro",{ascending:!0});if(s)throw s;const r=d.map(c=>c.doadora_id),l=(a||[]).filter(c=>!r.includes(c.id));ge(l)}catch(a){h({title:"Erro ao carregar doadoras",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{ve(!1)}},ya=()=>{if(!t.veterinario_responsavel.trim()){h({title:"Veterinário é obrigatório",variant:"destructive"});return}if(!t.tecnico_responsavel.trim()){h({title:"Técnico é obrigatório",variant:"destructive"});return}if(!t.fazenda_id){h({title:"Fazenda é obrigatória",variant:"destructive"});return}if(!t.data_aspiracao){h({title:"Data é obrigatória",variant:"destructive"});return}P("doadoras")},Ca=()=>{P("form")},Te=o.useCallback(()=>d.length===0?t.horario_inicio||"":d[d.length-1].hora_final||"",[d,t.horario_inicio]),wa=()=>{if(!I){h({title:"Selecione uma doadora",variant:"destructive"});return}const a=B.find(r=>r.id===I);if(!a)return;const s={doadora_id:a.id,registro:a.registro,nome:a.nome||void 0,raca:a.raca||void 0,horario_aspiracao:Te(),hora_final:"",atresicos:0,degenerados:0,expandidos:0,desnudos:0,viaveis:0,total_oocitos:0,recomendacao_touro:"",observacoes:""};k(r=>[...r,s]),ge(r=>r.filter(l=>l.id!==I)),be(""),ee(!1)},Sa=()=>{if(!m.registro.trim()){h({title:"Registro é obrigatório",variant:"destructive"});return}const a=m.raca==="Outra"?m.racaCustom:m.raca,s={doadora_id:`new_${Date.now()}`,registro:m.registro.trim(),nome:m.nome.trim()||void 0,raca:a||void 0,isNew:!0,horario_aspiracao:Te(),hora_final:"",atresicos:0,degenerados:0,expandidos:0,desnudos:0,viaveis:0,total_oocitos:0,recomendacao_touro:"",observacoes:""};k(r=>[...r,s]),E({registro:"",nome:"",raca:"",racaCustom:""}),ae(!1)},za=a=>{const s=d[a];k(r=>r.filter((l,c)=>c!==a)),s.isNew||A.length>0&&B.find(l=>l.id===s.doadora_id)||Fe()},b=o.useCallback((a,s,r)=>{k(l=>{const c=l.map((g,w)=>{if(w!==a)return g;const D={...g,[s]:r};if(["atresicos","degenerados","expandidos","desnudos","viaveis"].includes(s)){const i=x=>x===s?typeof r=="number"?r:parseInt(String(r))||0:g[x]||0;D.total_oocitos=i("atresicos")+i("degenerados")+i("expandidos")+i("desnudos")+i("viaveis")}return D});return s==="hora_final"&&a<c.length-1&&(c[a+1]={...c[a+1],horario_aspiracao:r}),c})},[]),Aa=async()=>{if(te)try{he(!0);const a=d.filter(n=>n.isNew),s=new Map;for(const n of a){const{data:i,error:x}=await j.from("doadoras").insert({fazenda_id:t.fazenda_id,registro:n.registro,nome:n.nome||null,raca:n.raca||null}).select().single();if(x)throw x;s.set(n.doadora_id,i.id)}const{data:r,error:l}=await j.from("pacotes_aspiracao").insert({fazenda_id:t.fazenda_id,fazenda_destino_id:v[0],data_aspiracao:t.data_aspiracao,horario_inicio:t.horario_inicio||null,veterinario_responsavel:t.veterinario_responsavel.trim(),tecnico_responsavel:t.tecnico_responsavel.trim(),total_oocitos:re,status:"FINALIZADO"}).select().single();if(l)throw l;const c=v.map(n=>({pacote_aspiracao_id:r.id,fazenda_destino_id:n})),{error:g}=await j.from("pacotes_aspiracao_fazendas_destino").insert(c);if(g)throw g;const w=d.map(n=>{const i=n.isNew?s.get(n.doadora_id):n.doadora_id;return{pacote_aspiracao_id:r.id,doadora_id:i,fazenda_id:t.fazenda_id,data_aspiracao:t.data_aspiracao,horario_aspiracao:n.horario_aspiracao||null,hora_final:n.hora_final||null,atresicos:n.atresicos||0,degenerados:n.degenerados||0,expandidos:n.expandidos||0,desnudos:n.desnudos||0,viaveis:n.viaveis||0,total_oocitos:n.total_oocitos||0,veterinario_responsavel:t.veterinario_responsavel.trim(),tecnico_responsavel:t.tecnico_responsavel.trim(),recomendacao_touro:n.recomendacao_touro||null,observacoes:n.observacoes||null}}),{error:D}=await j.from("aspiracoes_doadoras").insert(w);if(D)throw D;ke(),ka(),h({title:"Aspiração finalizada",description:`${d.length} doadora(s) com ${re} oócitos registrados`})}catch(a){h({title:"Erro ao finalizar aspiração",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{he(!1)}},ka=()=>{C({fazenda_id:"",data_aspiracao:new Date().toISOString().split("T")[0],horario_inicio:"",veterinario_responsavel:"",tecnico_responsavel:""}),V([]),k([]),P("form")},Fa=a=>{ja&&a!=="nova-sessao"?(fe(a),K(!0)):me(a)},Ta=()=>{K(!1),ue&&(me(ue),fe(null))},Ia=o.useCallback(async()=>{try{ye(!0);const{data:a,error:s}=await j.from("pacotes_aspiracao").select("*").order("data_aspiracao",{ascending:!1}).order("created_at",{ascending:!1});if(s)throw s;const r=new Map(A.map(i=>[i.id,i.nome])),l=(a==null?void 0:a.map(i=>i.id))||[],{data:c}=await j.from("aspiracoes_doadoras").select("pacote_aspiracao_id").in("pacote_aspiracao_id",l),g=new Map;c==null||c.forEach(i=>{i.pacote_aspiracao_id&&g.set(i.pacote_aspiracao_id,(g.get(i.pacote_aspiracao_id)||0)+1)});const{data:w}=await j.from("pacotes_aspiracao_fazendas_destino").select("pacote_aspiracao_id, fazenda_destino_id").in("pacote_aspiracao_id",l),D=new Map;w==null||w.forEach(i=>{const x=D.get(i.pacote_aspiracao_id)||[],F=r.get(i.fazenda_destino_id);F&&!x.includes(F)&&x.push(F),D.set(i.pacote_aspiracao_id,x)});const n=(a||[]).map(i=>{let x=D.get(i.id);if(!x||x.length===0)if(i.fazenda_destino_id){const F=r.get(i.fazenda_destino_id);x=F?[F]:[]}else x=[];return{...i,fazenda_nome:r.get(i.fazenda_id),fazendas_destino_nomes:x,quantidade_doadoras:g.get(i.id)||0}});ha(n),fa(!0)}catch(a){h({title:"Erro ao carregar dados",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{ye(!1)}},[A,h]),oe=o.useCallback(()=>{if(O.length===0)return;let a=[...O];N&&_&&(a=a.filter(s=>{const r=s.data_aspiracao.split("T")[0];return r>=N&&r<=_})),L&&(a=a.filter(s=>s.fazenda_id===L)),ua(a)},[O,N,_,L]),Ea=()=>{if(!N||!_){h({title:"Campos obrigatórios",description:"Preencha a data inicial e a data final",variant:"destructive"});return}if(N>_){h({title:"Data inválida",description:"A data inicial deve ser anterior ou igual à data final",variant:"destructive"});return}H?oe():Ia()},ie=a=>{const s=new Date,r=new Date(s);r.setDate(s.getDate()-a),Ce(r.toISOString().split("T")[0]),we(s.toISOString().split("T")[0])};o.useEffect(()=>{O.length>0&&N&&_&&H&&oe()},[O,N,_,H,oe]);const Ie=a=>{var s;return((s=A.find(r=>r.id===a))==null?void 0:s.nome)||""};return ta?e.jsx(Ee,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ka,{title:"Aspirações",description:"Gerenciar aspirações foliculares"}),e.jsxs(Za,{value:sa,onValueChange:Fa,className:"w-full",children:[e.jsxs(Xa,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(Ke,{value:"nova-sessao",className:"gap-2",children:[e.jsx(qa,{className:"h-4 w-4"}),"Nova Sessão"]}),e.jsxs(Ke,{value:"historico",className:"gap-2",children:[e.jsx(Wa,{className:"h-4 w-4"}),"Histórico"]})]}),e.jsxs(Ye,{value:"nova-sessao",className:"mt-4 space-y-4",children:[e.jsx(q,{children:e.jsxs($,{className:"pt-4 pb-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-[150px] max-w-[180px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Veterinário *"}),e.jsx(p,{placeholder:"Nome do veterinário",value:t.veterinario_responsavel,onChange:a=>C({...t,veterinario_responsavel:a.target.value}),className:"h-9",disabled:f==="doadoras"})]}),e.jsxs("div",{className:"flex-1 min-w-[150px] max-w-[180px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Técnico *"}),e.jsx(p,{placeholder:"Nome do técnico",value:t.tecnico_responsavel,onChange:a=>C({...t,tecnico_responsavel:a.target.value}),className:"h-9",disabled:f==="doadoras"})]}),e.jsxs("div",{className:"flex-1 min-w-[150px] max-w-[180px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Fazenda Origem *"}),e.jsxs(U,{value:t.fazenda_id,onValueChange:a=>C({...t,fazenda_id:a}),disabled:f==="doadoras",children:[e.jsx(G,{className:"h-9",children:e.jsx(J,{placeholder:"Selecione"})}),e.jsx(Z,{children:A.map(a=>e.jsx(T,{value:a.id,children:a.nome},a.id))})]})]}),e.jsxs("div",{className:"flex-1 min-w-[130px] max-w-[150px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Data *"}),e.jsx(ce,{value:t.data_aspiracao,onChange:a=>C({...t,data_aspiracao:a||""}),className:"h-9",disabled:f==="doadoras"})]}),e.jsxs("div",{className:"flex-1 min-w-[100px] max-w-[110px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Hora"}),e.jsx(p,{type:"time",value:t.horario_inicio,onChange:a=>C({...t,horario_inicio:a.target.value}),className:"h-9",disabled:f==="doadoras"})]}),f==="form"?e.jsx(u,{onClick:ya,disabled:!t.veterinario_responsavel||!t.tecnico_responsavel||!t.fazenda_id||!t.data_aspiracao,className:"h-9 bg-primary hover:bg-primary-dark",children:"Continuar"}):e.jsx(u,{variant:"outline",onClick:Ca,className:"h-9",children:"Voltar"})]}),f==="form"&&!t.veterinario_responsavel&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Preencha todos os campos obrigatórios para continuar"})]})}),f==="doadoras"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border border-border bg-gradient-to-r from-primary/5 to-transparent p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-card rounded-lg p-3 border border-border",children:[e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide block mb-0.5",children:"Fazenda Origem"}),e.jsx("span",{className:"font-semibold text-sm text-foreground",children:Ie(t.fazenda_id)})]}),e.jsxs("div",{className:"bg-card rounded-lg p-3 border border-border",children:[e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide block mb-0.5",children:"Data"}),e.jsx("span",{className:"font-semibold text-sm text-foreground",children:Qe(t.data_aspiracao)})]}),e.jsxs("div",{className:"bg-card rounded-lg p-3 border border-border",children:[e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide block mb-0.5",children:"Veterinário"}),e.jsx("span",{className:"font-medium text-sm text-foreground truncate block",children:t.veterinario_responsavel})]}),e.jsxs("div",{className:"bg-card rounded-lg p-3 border border-border",children:[e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide block mb-0.5",children:"Técnico"}),e.jsx("span",{className:"font-medium text-sm text-foreground truncate block",children:t.tecnico_responsavel})]})]}),e.jsx("div",{className:"flex items-center justify-center sm:justify-end",children:e.jsxs("div",{className:"bg-primary text-primary-foreground rounded-xl px-5 py-3 text-center min-w-[100px]",children:[e.jsx("span",{className:"text-2xl font-bold block",children:re}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide opacity-90",children:"oócitos"})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide mr-1",children:"Destino:"}),v.map(a=>e.jsxs(M,{variant:"secondary",className:"h-7 pl-3 pr-1.5 gap-1.5 bg-card border border-border hover:border-primary/50 transition-colors",children:[e.jsx("span",{className:"font-medium",children:Ie(a)}),e.jsx("button",{type:"button",onClick:()=>V(s=>s.filter(r=>r!==a)),className:"hover:bg-destructive/10 hover:text-destructive rounded-full p-0.5 transition-colors",children:e.jsx(es,{className:"w-3 h-3"})})]},a)),e.jsxs(Ba,{open:la,onOpenChange:Ne,children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",className:`h-7 text-xs border-dashed ${v.length===0?"border-primary text-primary bg-primary/10 hover:bg-primary/20":"border-border hover:border-primary hover:text-primary"}`,children:[e.jsx(ea,{className:"w-3.5 h-3.5 mr-1"}),v.length===0?"Adicionar Destino *":"Adicionar"]})}),e.jsx(La,{className:"w-[300px] p-0",align:"start",children:e.jsxs($a,{shouldFilter:!1,children:[e.jsx(Ma,{placeholder:"Buscar fazenda...",value:W,onValueChange:_e}),e.jsx(Ua,{children:va?ca?e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Buscando..."}):ze.length===0?e.jsx(Xe,{children:"Nenhuma encontrada"}):e.jsx(Ga,{children:ze.map(a=>e.jsx(Ja,{value:`${a.nome} ${a.id}`,onSelect:()=>{V(s=>[...s,a.id]),_e(""),Ne(!1)},children:a.nome},a.id))}):e.jsx(Xe,{children:"Digite pelo menos 2 letras"})})]})})]})]})})]}),e.jsxs(q,{children:[e.jsx(ne,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(de,{className:"text-base",children:["Doadoras (",d.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>ee(!0),children:[e.jsx(ea,{className:"w-4 h-4 mr-1"}),"Adicionar"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>ae(!0),children:[e.jsx(aa,{className:"w-4 h-4 mr-1"}),"Nova"]})]})]})}),e.jsxs($,{className:"pt-0",children:[d.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'Nenhuma doadora adicionada. Clique em "Adicionar" ou "Nova" para começar.'}):e.jsxs("div",{className:"rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-[minmax(140px,1fr)_80px_80px_repeat(5,40px)_45px_1fr_1fr_32px] gap-0 bg-muted text-[10px] font-semibold text-muted-foreground uppercase tracking-wide",children:[e.jsx("div",{className:"px-3 py-2",children:"Doadora"}),e.jsx("div",{className:"px-2 py-2 text-center",children:"Início"}),e.jsx("div",{className:"px-2 py-2 text-center",children:"Fim"}),e.jsx("div",{className:"px-1 py-2 text-center",children:"Atr"}),e.jsx("div",{className:"px-1 py-2 text-center",children:"Deg"}),e.jsx("div",{className:"px-1 py-2 text-center",children:"Exp"}),e.jsx("div",{className:"px-1 py-2 text-center",children:"Des"}),e.jsx("div",{className:"px-1 py-2 text-center text-primary",children:"Viáv"}),e.jsx("div",{className:"px-1 py-2 text-center text-primary font-bold",children:"Total"}),e.jsx("div",{className:"px-2 py-2",children:"Touro"}),e.jsx("div",{className:"px-2 py-2",children:"Obs"}),e.jsx("div",{})]}),d.map((a,s)=>e.jsxs("div",{className:"group grid grid-cols-[minmax(140px,1fr)_80px_80px_repeat(5,40px)_45px_1fr_1fr_32px] gap-0 items-center border-t border-border hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",children:[e.jsx("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primary text-[10px] font-bold shrink-0",children:s+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:a.nome||a.registro}),a.raca&&e.jsx("span",{className:"text-[9px] text-muted-foreground bg-muted px-1 rounded shrink-0",children:a.raca}),a.isNew&&e.jsx("span",{className:"text-[9px] text-primary bg-primary/10 px-1 rounded shrink-0",children:"N"})]}),a.nome&&e.jsx("span",{className:"text-[10px] text-muted-foreground block truncate",children:a.registro})]})]}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(p,{type:"time",value:a.horario_aspiracao||"",onChange:r=>b(s,"horario_aspiracao",r.target.value),className:"h-7 text-xs text-center px-1 w-full",disabled:s===0})}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(p,{type:"time",value:a.hora_final||"",onChange:r=>b(s,"hora_final",r.target.value),className:"h-7 text-xs text-center px-1 w-full"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(p,{type:"number",min:"0",value:a.atresicos||"",onChange:r=>b(s,"atresicos",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full",placeholder:"0"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(p,{type:"number",min:"0",value:a.degenerados||"",onChange:r=>b(s,"degenerados",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full",placeholder:"0"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(p,{type:"number",min:"0",value:a.expandidos||"",onChange:r=>b(s,"expandidos",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full",placeholder:"0"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(p,{type:"number",min:"0",value:a.desnudos||"",onChange:r=>b(s,"desnudos",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full",placeholder:"0"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(p,{type:"number",min:"0",value:a.viaveis||"",onChange:r=>b(s,"viaveis",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full ring-1 ring-primary/20",placeholder:"0"})}),e.jsx("div",{className:"px-1 py-1 text-center",children:e.jsx("span",{className:"text-sm font-bold text-primary",children:a.total_oocitos||0})}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(p,{value:a.recomendacao_touro||"",onChange:r=>b(s,"recomendacao_touro",r.target.value),className:"h-7 text-xs px-2 w-full",placeholder:"Touro"})}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(p,{value:a.observacoes||"",onChange:r=>b(s,"observacoes",r.target.value),className:"h-7 text-xs px-2 w-full",placeholder:"Obs"})}),e.jsx("div",{className:"px-1 py-1 flex justify-center",children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>za(s),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-destructive hover:bg-destructive/10",children:e.jsx(as,{className:"w-3.5 h-3.5"})})})]},a.doadora_id))]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs(u,{onClick:Aa,disabled:!te||pe,className:"bg-primary hover:bg-primary-dark",children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),pe?"Finalizando...":"Finalizar Aspiração"]})}),!te&&e.jsx("p",{className:"text-xs text-destructive text-right mt-2",children:v.length===0&&d.length===0?"Adicione fazenda destino e pelo menos uma doadora":v.length===0?"Adicione pelo menos uma fazenda destino":"Adicione pelo menos uma doadora"})]})]})]})]}),e.jsxs(Ye,{value:"historico",className:"space-y-6 mt-6",children:[e.jsxs(q,{children:[e.jsx(ne,{className:"pb-4",children:e.jsxs(de,{className:"text-lg flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5"}),"Filtros"]})}),e.jsxs($,{children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Fazenda"}),e.jsxs(U,{value:L||"all",onValueChange:a=>ga(a==="all"?"":a),children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Todas"})}),e.jsxs(Z,{children:[e.jsx(T,{value:"all",children:"Todas"}),A.map(a=>e.jsx(T,{value:a.id,children:a.nome},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Data Inicial *"}),e.jsx(ce,{value:N,onChange:Ce})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Data Final *"}),e.jsx(ce,{value:_,onChange:we})]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 flex-1",children:[e.jsx(y,{className:"w-full text-sm font-medium",children:"Atalhos:"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>ie(7),children:"7 dias"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>ie(30),children:"30 dias"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>ie(90),children:"90 dias"})]}),e.jsxs(u,{onClick:Ea,disabled:!N||!_||De,className:"bg-primary hover:bg-primary-dark",children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"Buscar"]})]})]})]}),e.jsxs(q,{children:[e.jsx(ne,{children:e.jsxs(de,{className:"text-lg",children:["Aspirações (",se.length,")"]})}),e.jsx($,{children:H?De?e.jsx(Ee,{}):se.length===0?e.jsx(Ya,{title:"Nenhuma aspiração encontrada",description:"Ajuste os filtros ou tente outro período."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Pa,{children:[e.jsx(Ra,{children:e.jsxs(Oe,{children:[e.jsx(S,{children:"Data"}),e.jsx(S,{children:"Fazenda"}),e.jsx(S,{children:"Destino"}),e.jsx(S,{children:"Doadoras"}),e.jsx(S,{children:"Oócitos"}),e.jsx(S,{children:"Status"}),e.jsx(S,{className:"text-right",children:"Ações"})]})}),e.jsx(Va,{children:se.map(a=>{var s,r,l;return e.jsxs(Oe,{className:"cursor-pointer hover:bg-muted",onClick:()=>le(`/aspiracoes/${a.id}`),children:[e.jsx(z,{children:Qe(a.data_aspiracao)}),e.jsx(z,{className:"font-medium",children:a.fazenda_nome||"-"}),e.jsx(z,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(s=a.fazendas_destino_nomes)==null?void 0:s.slice(0,2).map((c,g)=>e.jsx(M,{variant:"outline",className:"text-xs",children:c},g)),(((r=a.fazendas_destino_nomes)==null?void 0:r.length)||0)>2&&e.jsxs(M,{variant:"outline",className:"text-xs",children:["+",(((l=a.fazendas_destino_nomes)==null?void 0:l.length)||0)-2]})]})}),e.jsx(z,{children:a.quantidade_doadoras||0}),e.jsx(z,{className:"font-medium",children:a.total_oocitos||0}),e.jsx(z,{children:e.jsx(M,{variant:a.status==="FINALIZADO"?"default":"secondary",children:a.status==="FINALIZADO"?"Finalizado":"Em Andamento"})}),e.jsx(z,{className:"text-right",onClick:c=>c.stopPropagation(),children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>le(`/aspiracoes/${a.id}`),children:e.jsx(ts,{className:"w-4 h-4"})})})]},a.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(We,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Aplique filtros para visualizar"})]})})]})]})]}),e.jsx(Le,{open:oa,onOpenChange:R,children:e.jsxs(qe,{children:[e.jsxs($e,{children:[e.jsxs(Me,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-5 w-5 text-primary"}),"Aspiração não finalizada encontrada"]}),e.jsx(Ue,{children:"Você tem uma aspiração em andamento que não foi finalizada. Deseja continuar de onde parou?"})]}),e.jsxs(Ge,{children:[e.jsx(Je,{onClick:ba,children:"Descartar"}),e.jsx(Ze,{onClick:_a,children:"Restaurar"})]})]})}),e.jsx(Le,{open:ia,onOpenChange:K,children:e.jsxs(qe,{children:[e.jsxs($e,{children:[e.jsx(Me,{children:"Aspiração em andamento"}),e.jsxs(Ue,{children:["Você tem ",d.length," doadora(s) adicionada(s) que não foram salvas. Os dados ficarão salvos localmente e você poderá continuar depois."]})]}),e.jsxs(Ge,{children:[e.jsx(Je,{children:"Continuar Editando"}),e.jsx(Ze,{onClick:Ta,children:"Sair"})]})]})}),e.jsx(Pe,{open:ma,onOpenChange:ee,children:e.jsxs(Re,{children:[e.jsxs(Ve,{children:[e.jsx(Be,{children:"Adicionar Doadora"}),e.jsx(He,{children:"Selecione uma doadora da fazenda"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Doadora *"}),e.jsxs(U,{value:I,onValueChange:be,children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Selecione uma doadora"})}),e.jsx(Z,{children:na?e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Carregando..."}):B.length===0?e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Nenhuma doadora disponível"}):B.map(a=>e.jsxs(T,{value:a.id,children:[a.registro," ",a.nome?`- ${a.nome}`:""]},a.id))})]})]}),e.jsx(u,{onClick:wa,className:"w-full",disabled:!I,children:"Adicionar"})]})]})}),e.jsx(Pe,{open:xa,onOpenChange:ae,children:e.jsxs(Re,{children:[e.jsxs(Ve,{children:[e.jsx(Be,{children:"Cadastrar Nova Doadora"}),e.jsx(He,{children:"Preencha os dados da nova doadora"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Registro *"}),e.jsx(p,{value:m.registro,onChange:a=>E({...m,registro:a.target.value}),placeholder:"Número do registro"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Nome"}),e.jsx(p,{value:m.nome,onChange:a=>E({...m,nome:a.target.value}),placeholder:"Nome da doadora (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Raça"}),e.jsxs(U,{value:m.raca,onValueChange:a=>E({...m,raca:a}),children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Selecione a raça"})}),e.jsxs(Z,{children:[pa.map(a=>e.jsx(T,{value:a,children:a},a)),e.jsx(T,{value:"Outra",children:"Outra"})]})]})]}),m.raca==="Outra"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Raça Customizada *"}),e.jsx(p,{value:m.racaCustom,onChange:a=>E({...m,racaCustom:a.target.value}),placeholder:"Digite a raça"})]}),e.jsxs(u,{onClick:Sa,className:"w-full",disabled:!m.registro,children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),"Criar e Adicionar"]})]})]})})]})}export{Rs as default};
