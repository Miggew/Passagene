import{a as ne,a7 as de,r as n,s as b,j as e,C as le,ao as ce,B as R}from"./index-BPMeM9-O.js";import{I as me}from"./input-tqcTRdPv.js";import{B as k}from"./badge-CeJDYfYs.js";import{S,a as C,b as z,c as E,d}from"./select-La4nrp5K.js";import{T as xe,c as ue}from"./tabs-siaSXH49.js";import{u as pe}from"./useClienteFilter-CwSUSM41.js";import{P as fe}from"./PageHeader-DQ4rM2jO.js";import{e as he}from"./exportPdf--R_Q0DDd.js";import{S as H}from"./search-SyV5imYB.js";import{X as ge}from"./x-BxiwAMrM.js";import{F as be}from"./file-text-CtxiCcm9.js";import{H as je}from"./history-TsBvJqZq.js";import{E as ve}from"./eye-CZithoXn.js";import"./index-C5PY5DOm.js";import"./check-Bdb-Yd05.js";import"./index-DWxJzuQO.js";import"./pt-BR-CyDikW87.js";const w=20,_e={DISPONIVEL:{label:"Disponível",color:"bg-primary/15 text-primary"},EM_PROTOCOLO:{label:"Em Protocolo",color:"bg-blue-500/15 text-blue-600 dark:text-blue-400"},PRENHE:{label:"Prenhe",color:"bg-amber-500/15 text-amber-600 dark:text-amber-400"},DESCARTE:{label:"Descarte",color:"bg-red-500/15 text-red-600 dark:text-red-400"},VENDIDA:{label:"Vendida",color:"bg-gray-500/15 text-gray-600 dark:text-gray-400"}};function Me(){const T=ne(),[U,G]=de(),{clienteIdFilter:h}=pe(),[o,X]=n.useState(U.get("tipo")||"receptoras"),[A,J]=n.useState([]),[u,L]=n.useState("all"),[v,D]=n.useState("all"),[_,O]=n.useState(""),[y,P]=n.useState("all"),[N,F]=n.useState("all"),[I,M]=n.useState([]),[V,K]=n.useState([]),[Q,W]=n.useState([]),[x,j]=n.useState(1),[Y,B]=n.useState(!0);n.useEffect(()=>{Z(),ee()},[h]),n.useEffect(()=>{q(),j(1)},[o,u,v,y,N,h]);const Z=async()=>{let a=b.from("fazendas").select("*").order("nome");h&&(a=a.eq("cliente_id",h));const{data:r}=await a;J(r??[])},ee=async()=>{const{data:a}=await b.from("doadoras").select("raca").not("raca","is",null),r=[...new Set(a==null?void 0:a.map(t=>t.raca).filter(Boolean))];W(r.sort())},q=async()=>{B(!0);try{let a=[];if(h){const{data:r}=await b.from("fazendas").select("id").eq("cliente_id",h);a=(r==null?void 0:r.map(t=>t.id))??[]}o==="receptoras"?await ae(a):await re(a)}catch(a){console.error("Erro ao carregar dados:",a)}finally{B(!1)}},ae=async a=>{let r=b.from("receptoras").select("id, identificacao, nome, status_reprodutivo, is_cio_livre, data_provavel_parto").order("identificacao");v!=="all"&&(r=r.eq("status_reprodutivo",v));const{data:t}=await r;if(!t||t.length===0){M([]);return}const p=t.map(s=>s.id),{data:c}=await b.from("vw_receptoras_fazenda_atual").select("receptora_id, fazenda_id_atual, fazenda_nome_atual").in("receptora_id",p),m=new Map((c||[]).map(s=>[s.receptora_id,{id:s.fazenda_id_atual,nome:s.fazenda_nome_atual}]));let i=t.map(s=>{const f=m.get(s.id);return{id:s.id,identificacao:s.identificacao,nome:s.nome,status_reprodutivo:s.status_reprodutivo,fazenda_atual_id:f==null?void 0:f.id,fazenda_nome:(f==null?void 0:f.nome)??"Sem fazenda",is_cio_livre:s.is_cio_livre,data_provavel_parto:s.data_provavel_parto}});h&&a.length>0&&(i=i.filter(s=>s.fazenda_atual_id&&a.includes(s.fazenda_atual_id))),u!=="all"&&(i=i.filter(s=>s.fazenda_atual_id===u)),M(i)},re=async a=>{let r=b.from("doadoras").select(`
        id,
        registro,
        nome,
        raca,
        fazenda_id,
        fazendas(nome),
        disponivel_aspiracao,
        classificacao_genetica
      `).order("registro");h&&a.length>0&&(r=r.in("fazenda_id",a)),u!=="all"&&(r=r.eq("fazenda_id",u)),y!=="all"&&(r=r.eq("raca",y)),N!=="all"&&(r=r.eq("disponivel_aspiracao",N==="sim"));const{data:t}=await r,p=(t==null?void 0:t.map(i=>i.id))??[],{data:c}=await b.from("aspiracoes_doadoras").select("doadora_id, total_oocitos").in("doadora_id",p),m=new Map;c==null||c.forEach(i=>{const s=m.get(i.doadora_id)??{count:0,totalOocitos:0};m.set(i.doadora_id,{count:s.count+1,totalOocitos:s.totalOocitos+(i.total_oocitos??0)})}),K((t==null?void 0:t.map(i=>{var f;const s=m.get(i.id);return{id:i.id,registro:i.registro,nome:i.nome,raca:i.raca,fazenda_id:i.fazenda_id,fazenda_nome:((f=i.fazendas)==null?void 0:f.nome)??"N/A",disponivel_aspiracao:i.disponivel_aspiracao,classificacao_genetica:i.classificacao_genetica,total_aspiracoes:(s==null?void 0:s.count)??0,media_oocitos:s?Math.round(s.totalOocitos/s.count):0}}))??[])},l=n.useMemo(()=>{let a=o==="receptoras"?I:V;if(_.trim()){const r=_.toLowerCase();o==="receptoras"?a=a.filter(t=>{var p,c,m;return((p=t.identificacao)==null?void 0:p.toLowerCase().includes(r))||((c=t.nome)==null?void 0:c.toLowerCase().includes(r))||((m=t.fazenda_nome)==null?void 0:m.toLowerCase().includes(r))}):a=a.filter(t=>{var p,c,m;return((p=t.registro)==null?void 0:p.toLowerCase().includes(r))||((c=t.nome)==null?void 0:c.toLowerCase().includes(r))||((m=t.fazenda_nome)==null?void 0:m.toLowerCase().includes(r))})}return a},[o,I,V,_]),g=Math.ceil(l.length/w),te=n.useMemo(()=>{const a=(x-1)*w;return l.slice(a,a+w)},[l,x]),se=()=>{L("all"),D("all"),P("all"),F("all"),O(""),j(1)},$=a=>{X(a),G({tipo:a}),j(1),D("all"),P("all"),F("all")},oe=a=>{if(!a)return e.jsx(k,{variant:"outline",children:"-"});const r=_e[a];return r?e.jsx(k,{className:r.color,children:r.label}):e.jsx(k,{variant:"outline",children:a})},ie=()=>{var r;if(l.length===0)return;const a=u!=="all"?(r=A.find(t=>t.id===u))==null?void 0:r.nome:void 0;he(o,l,{fazenda:a})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(fe,{title:"Animais",description:"Consulta de receptoras e doadoras"}),e.jsxs(xe,{value:o,onValueChange:$,children:[e.jsx("div",{className:"rounded-xl border border-border bg-card p-1.5",children:e.jsx("div",{className:"flex gap-1",children:[{value:"receptoras",label:"Receptoras",icon:le},{value:"doadoras",label:"Doadoras",icon:ce}].map(({value:a,label:r,icon:t})=>e.jsxs("button",{onClick:()=>$(a),className:`
                  relative flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg
                  text-sm font-medium transition-all duration-200
                  ${o===a?"bg-muted/80 text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-muted/40"}
                `,children:[o===a&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-12 h-0.5 bg-primary rounded-full"}),e.jsx("div",{className:`
                  flex items-center justify-center w-7 h-7 rounded-md transition-colors
                  ${o===a?"bg-primary/15":"bg-muted/50"}
                `,children:e.jsx(t,{className:`w-4 h-4 ${o===a?"text-primary":"text-muted-foreground"}`})}),e.jsx("span",{children:r}),o===a&&l.length>0&&e.jsx("span",{className:"inline-flex items-center justify-center min-w-5 h-5 px-1.5 text-[10px] font-bold bg-primary/15 text-primary rounded-full",children:l.length})]},a))})}),e.jsx("div",{className:"mt-4 rounded-xl border border-border bg-card overflow-hidden",children:e.jsxs("div",{className:"flex flex-wrap items-stretch",children:[e.jsx("div",{className:"flex items-center px-4 py-3 border-r border-border bg-gradient-to-b from-primary/5 to-transparent",children:e.jsxs("div",{className:"relative min-w-[200px] max-w-[280px]",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary/60"}),e.jsx(me,{placeholder:o==="receptoras"?"Buscar identificação, nome...":"Buscar registro, nome...",value:_,onChange:a=>O(a.target.value),className:"pl-9 h-9 bg-background/80 border-primary/20 focus:border-primary/40"})]})}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-r border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40"}),e.jsx("span",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wider",children:"Filtros"})]}),e.jsxs(S,{value:u,onValueChange:L,children:[e.jsx(C,{className:"w-[160px] h-9 bg-background",children:e.jsx(z,{placeholder:"Fazenda"})}),e.jsxs(E,{children:[e.jsx(d,{value:"all",children:"Todas fazendas"}),A.map(a=>e.jsx(d,{value:a.id,children:a.nome},a.id))]})]}),o==="receptoras"&&e.jsxs(S,{value:v,onValueChange:D,children:[e.jsx(C,{className:"w-[150px] h-9 bg-background",children:e.jsx(z,{placeholder:"Status"})}),e.jsxs(E,{children:[e.jsx(d,{value:"all",children:"Todos status"}),e.jsx(d,{value:"DISPONIVEL",children:"Disponível"}),e.jsx(d,{value:"EM_PROTOCOLO",children:"Em Protocolo"}),e.jsx(d,{value:"PRENHE",children:"Prenhe"}),e.jsx(d,{value:"DESCARTE",children:"Descarte"}),e.jsx(d,{value:"VENDIDA",children:"Vendida"})]})]}),o==="doadoras"&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{value:y,onValueChange:P,children:[e.jsx(C,{className:"w-[140px] h-9 bg-background",children:e.jsx(z,{placeholder:"Raça"})}),e.jsxs(E,{children:[e.jsx(d,{value:"all",children:"Todas raças"}),Q.map(a=>e.jsx(d,{value:a,children:a},a))]})]}),e.jsxs(S,{value:N,onValueChange:F,children:[e.jsx(C,{className:"w-[140px] h-9 bg-background",children:e.jsx(z,{placeholder:"Disponível"})}),e.jsxs(E,{children:[e.jsx(d,{value:"all",children:"Todas"}),e.jsx(d,{value:"sim",children:"Disponível"}),e.jsx(d,{value:"nao",children:"Indisponível"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 ml-auto bg-gradient-to-b from-muted/50 to-transparent",children:[(_||u!=="all"||v!=="all"||y!=="all"||N!=="all")&&e.jsxs(R,{variant:"outline",size:"sm",onClick:se,className:"h-9 border-dashed border-muted-foreground/30 text-muted-foreground hover:text-foreground hover:border-muted-foreground/50",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"Limpar"]}),e.jsxs(R,{size:"sm",onClick:()=>q(),className:"h-9 bg-primary hover:bg-primary-dark shadow-sm shadow-primary/25",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"Buscar"]}),l.length>0&&e.jsxs(R,{variant:"outline",size:"sm",onClick:ie,className:"h-9 border-primary/30 text-primary hover:bg-primary/10 hover:border-primary/50",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"PDF"]})]})]})}),e.jsx(ue,{value:o,className:"mt-4",children:Y?e.jsx("div",{className:"rounded-xl border border-border bg-card p-12 text-center text-muted-foreground",children:"Carregando..."}):l.length===0?e.jsx("div",{className:"rounded-xl border border-border bg-card p-12 text-center text-muted-foreground",children:"Nenhum registro encontrado"}):e.jsxs("div",{className:"rounded-xl border border-border bg-card overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-muted/80 via-muted/60 to-muted/80 border-b border-border",children:e.jsxs("div",{className:`grid gap-0 text-[10px] font-semibold text-muted-foreground uppercase tracking-wider ${o==="receptoras"?"grid-cols-[1.5fr_1fr_1.5fr_1fr_0.8fr_0.6fr]":"grid-cols-[1.2fr_1fr_1.2fr_1fr_0.8fr_0.8fr_0.6fr]"}`,children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 rounded-full bg-primary/40"}),o==="receptoras"?"Identificação":"Registro"]}),e.jsx("div",{className:"px-3 py-3",children:"Nome"}),e.jsx("div",{className:"px-3 py-3",children:"Fazenda"}),o==="receptoras"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-3 text-center",children:"Status"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Ciclando"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-3",children:"Raça"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Aspirações"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Média"})]}),e.jsx("div",{className:"px-2 py-3"})]})}),e.jsx("div",{className:"divide-y divide-border/50",children:te.map((a,r)=>e.jsxs("div",{onClick:()=>T(o==="receptoras"?`/receptoras/${a.id}/historico`:`/doadoras/${a.id}`),className:`
                      group grid gap-0 items-center cursor-pointer transition-all duration-150
                      hover:bg-gradient-to-r hover:from-primary/5 hover:via-transparent hover:to-transparent
                      ${r%2===0?"bg-transparent":"bg-muted/20"}
                      ${o==="receptoras"?"grid-cols-[1.5fr_1fr_1.5fr_1fr_0.8fr_0.6fr]":"grid-cols-[1.2fr_1fr_1.2fr_1fr_0.8fr_0.8fr_0.6fr]"}
                    `,children:[e.jsxs("div",{className:"px-4 py-3.5 flex items-center gap-3",children:[e.jsx("div",{className:"w-0.5 h-8 rounded-full bg-transparent group-hover:bg-primary transition-colors"}),e.jsx("span",{className:"font-medium text-sm truncate group-hover:text-primary transition-colors",children:o==="receptoras"?a.identificacao:a.registro})]}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:a.nome||"-"}),e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:a.fazenda_nome}),o==="receptoras"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:oe(a.status_reprodutivo)}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:a.is_cio_livre?e.jsx("span",{className:"inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-semibold bg-primary/10 text-primary rounded-md group-hover:bg-primary/20 transition-colors",children:"CL"}):e.jsx("span",{className:"inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-medium bg-muted text-muted-foreground rounded-md",children:"N"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-3.5 text-sm text-muted-foreground truncate",children:a.raca||"-"}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-semibold bg-muted text-foreground rounded-md",children:a.total_aspiracoes})}),e.jsx("div",{className:"px-3 py-3.5 flex justify-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-7 h-7 px-2 text-xs font-semibold bg-primary/10 text-primary rounded-md group-hover:bg-primary/20 transition-colors",children:a.media_oocitos})})]}),e.jsx("div",{className:"px-2 py-3.5 flex justify-center",children:e.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center bg-transparent group-hover:bg-primary/10 transition-colors",children:o==="receptoras"?e.jsx(je,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors"}):e.jsx(ve,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors"})})})]},a.id))}),g>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-muted/30 via-transparent to-muted/30 border-t border-border",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[(x-1)*w+1,"-",Math.min(x*w,l.length)]})," ","de"," ",e.jsx("span",{className:"font-medium text-foreground",children:l.length})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>j(a=>Math.max(1,a-1)),disabled:x===1,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-0.5 mx-2",children:Array.from({length:Math.min(5,g)},(a,r)=>{let t;return g<=5||x<=3?t=r+1:x>=g-2?t=g-4+r:t=x-2+r,e.jsx("button",{onClick:()=>j(t),className:`
                              w-8 h-8 text-xs font-medium rounded-md transition-all
                              ${x===t?"bg-primary/15 text-primary shadow-sm":"text-muted-foreground hover:bg-muted hover:text-foreground"}
                            `,children:t},t)})}),e.jsx("button",{onClick:()=>j(a=>Math.min(g,a+1)),disabled:x===g,className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed hover:bg-muted text-muted-foreground hover:text-foreground",children:"Próximo"})]})]})]})})]})]})}export{Me as default};
