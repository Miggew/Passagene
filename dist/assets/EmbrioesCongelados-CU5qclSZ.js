import{c as de,r as d,s as G,j as e,g as xe,h as U,S as P}from"./index-CWtHucPz.js";import{u as me,C,c as v,a as $,b as J}from"./use-toast-C_ednEV-.js";import{T as he,a as je,b as K,c as j,d as pe,e as p}from"./table-2v-HqcxP.js";import{D as fe,b as ue,c as ge,d as Ne,e as Ce}from"./dialog-DG0TUp-m.js";import{S as L,a as b,b as R,c as k,d as f}from"./select-BUr2m4f3.js";import{I as ve}from"./input-bF23Jkur.js";import{B as A}from"./badge-DewFfdNp.js";import{P as we}from"./PageHeader-DqMTzrbX.js";import{E as Se}from"./EmptyState-B00kV8BS.js";import{S as De}from"./search-B6nVOFfl.js";import{E as Te}from"./eye-DbaOMCVJ.js";import"./index-RvRMy3My.js";import"./x-BtWTyRSy.js";import"./index-H2w26JuE.js";import"./check-D_BDiPDp.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=de("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function qe(){const{toast:O}=me(),[Q,z]=d.useState(!0),[u,W]=d.useState([]),[X,Y]=d.useState([]),[x,Z]=d.useState(""),[w,ee]=d.useState("todos"),[g,se]=d.useState("todos"),[S,ae]=d.useState("todos"),[D,te]=d.useState("todos"),[I,F]=d.useState(null);d.useEffect(()=>{ce()},[]);const ce=async()=>{try{z(!0);const{data:s,error:c}=await G.from("clientes").select("id, nome").order("nome");if(c)throw c;Y(s||[]);const{data:t,error:a}=await G.from("embrioes").select(`
          *,
          cliente:clientes(id, nome),
          lote_fiv:lotes_fiv(id, data_abertura),
          acasalamento:lote_fiv_acasalamentos(
            id,
            dose_semen:doses_semen(
              id,
              touro:touros(id, nome, registro, raca)
            ),
            aspiracao:aspiracoes_doadoras(
              id,
              data_aspiracao,
              horario_aspiracao,
              doadora:doadoras(id, registro, nome, raca)
            )
          )
        `).eq("status_atual","CONGELADO").order("data_congelamento",{ascending:!1});if(a)throw a;W(t||[])}catch(s){O({title:"Erro ao carregar dados",description:s instanceof Error?s.message:"Erro desconhecido",variant:"destructive"})}finally{z(!1)}},{racas:le,classificacoes:ie,touros:ne}=d.useMemo(()=>{const s=new Set,c=new Set,t=new Map;return u.forEach(a=>{var o,r;a.classificacao&&c.add(a.classificacao);const i=a.acasalamento,n=(o=i==null?void 0:i.aspiracao)==null?void 0:o.doadora,l=(r=i==null?void 0:i.dose_semen)==null?void 0:r.touro;n!=null&&n.raca&&s.add(n.raca),l!=null&&l.raca&&s.add(l.raca),l!=null&&l.id&&t.set(l.id,l.nome||l.registro||l.id)}),{racas:Array.from(s).sort(),classificacoes:Array.from(c).sort(),touros:Array.from(t.entries()).sort((a,i)=>a[1].localeCompare(i[1]))}},[u]),m=d.useMemo(()=>u.filter(s=>{var h,_,E,y,M,V,B,H,q;const c=s.acasalamento,t=(h=c==null?void 0:c.aspiracao)==null?void 0:h.doadora,a=(_=c==null?void 0:c.dose_semen)==null?void 0:_.touro,i=!x||((E=s.identificacao)==null?void 0:E.toLowerCase().includes(x.toLowerCase()))||((y=s.localizacao_atual)==null?void 0:y.toLowerCase().includes(x.toLowerCase()))||((V=(M=s.cliente)==null?void 0:M.nome)==null?void 0:V.toLowerCase().includes(x.toLowerCase()))||((B=t==null?void 0:t.registro)==null?void 0:B.toLowerCase().includes(x.toLowerCase()))||((H=t==null?void 0:t.nome)==null?void 0:H.toLowerCase().includes(x.toLowerCase()))||((q=a==null?void 0:a.nome)==null?void 0:q.toLowerCase().includes(x.toLowerCase())),n=w==="todos"||s.cliente_id===w,l=g==="todos"||(t==null?void 0:t.raca)===g||(a==null?void 0:a.raca)===g,o=S==="todos"||s.classificacao===S,r=D==="todos"||(a==null?void 0:a.id)===D;return i&&n&&l&&o&&r}),[u,x,w,g,S,D]),N=d.useMemo(()=>{const s=new Map,c=new Map;return m.forEach(t=>{var n;const a=((n=t.cliente)==null?void 0:n.nome)||"Sem cliente";s.set(a,(s.get(a)||0)+1);const i=t.classificacao||"Sem classificação";c.set(i,(c.get(i)||0)+1)}),{total:m.length,totalGeral:u.length,porCliente:Array.from(s.entries()).sort((t,a)=>a[1]-t[1]),porClassificacao:Array.from(c.entries()).sort((t,a)=>a[1]-t[1])}},[m,u]),T=s=>s?new Date(s).toLocaleDateString("pt-BR"):"-",oe=()=>{const s=["Identificação","Cliente","Classificação","Doadora","Touro","Raça","Data Cong.","Localização"],c=m.map(l=>{var _,E,y;const o=l.acasalamento,r=(_=o==null?void 0:o.aspiracao)==null?void 0:_.doadora,h=(E=o==null?void 0:o.dose_semen)==null?void 0:E.touro;return[l.identificacao||"",((y=l.cliente)==null?void 0:y.nome)||"",l.classificacao||"",(r==null?void 0:r.registro)||(r==null?void 0:r.nome)||"",(h==null?void 0:h.nome)||"",(r==null?void 0:r.raca)||(h==null?void 0:h.raca)||"",T(l.data_congelamento),l.localizacao_atual||""]}),t=[s,...c].map(l=>l.map(o=>`"${o}"`).join(",")).join(`
`),a=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),n=document.createElement("a");n.href=i,n.download=`embrioes-congelados-${new Date().toISOString().split("T")[0]}.csv`,n.click(),URL.revokeObjectURL(i),O({title:"Exportação concluída",description:`${m.length} embriões exportados`})},re=({embriao:s})=>{var o;const c=s.acasalamento,t=c==null?void 0:c.dose_semen,a=t==null?void 0:t.touro,i=c==null?void 0:c.aspiracao,n=i==null?void 0:i.doadora,l=s.lote_fiv;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Identificação"}),e.jsx("p",{className:"font-medium",children:s.identificacao||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Cliente"}),e.jsx("p",{className:"font-medium",children:((o=s.cliente)==null?void 0:o.nome)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Classificação"}),e.jsx("p",{className:"font-medium",children:s.classificacao?e.jsx(A,{variant:"secondary",children:s.classificacao}):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Status"}),e.jsx("p",{className:"font-medium",children:e.jsxs(A,{className:"bg-cyan-100 text-cyan-800",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"CONGELADO"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Data de Congelamento"}),e.jsx("p",{className:"font-medium",children:T(s.data_congelamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Localização"}),e.jsx("p",{className:"font-medium",children:s.localizacao_atual||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Tipo"}),e.jsx("p",{className:"font-medium",children:s.tipo_embriao||"-"})]}),e.jsx("div",{className:"col-span-2 border-t pt-4 mt-2",children:e.jsx("p",{className:"text-slate-500 font-medium mb-2",children:"Origem"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Doadora"}),e.jsxs("p",{className:"font-medium",children:[(n==null?void 0:n.registro)||(n==null?void 0:n.nome)||"-",(n==null?void 0:n.raca)&&e.jsxs("span",{className:"text-slate-500 ml-1",children:["(",n.raca,")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Touro"}),e.jsxs("p",{className:"font-medium",children:[(a==null?void 0:a.nome)||"-",(a==null?void 0:a.registro)&&e.jsxs("span",{className:"text-slate-500 ml-1",children:["(",a.registro,")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Raça do Touro"}),e.jsx("p",{className:"font-medium",children:(a==null?void 0:a.raca)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Data D0 (Lote FIV)"}),e.jsx("p",{className:"font-medium",children:T(l==null?void 0:l.data_abertura)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Data de Aspiração"}),e.jsx("p",{className:"font-medium",children:T(i==null?void 0:i.data_aspiracao)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Hora de Aspiração"}),e.jsx("p",{className:"font-medium",children:(i==null?void 0:i.horario_aspiracao)||"-"})]}),s.observacoes&&e.jsxs("div",{className:"col-span-2 border-t pt-4 mt-2",children:[e.jsx("p",{className:"text-slate-500",children:"Observações"}),e.jsx("p",{className:"font-medium",children:s.observacoes})]})]})};return Q?e.jsx(xe,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(we,{title:"Embriões Congelados",description:"Estoque geral de embriões congelados",actions:e.jsxs(U,{variant:"outline",onClick:oe,disabled:m.length===0,children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(C,{children:e.jsx(v,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-cyan-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Total Congelados"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalGeral})]})]})})}),e.jsx(C,{children:e.jsxs(v,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Filtrados"}),e.jsx("p",{className:"text-2xl font-bold",children:N.total})]})}),e.jsx(C,{children:e.jsxs(v,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Clientes"}),e.jsx("p",{className:"text-2xl font-bold",children:N.porCliente.length})]})}),e.jsx(C,{children:e.jsxs(v,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Classificações"}),e.jsx("p",{className:"text-2xl font-bold",children:N.porClassificacao.length})]})})]}),N.porClassificacao.length>0&&e.jsxs(C,{children:[e.jsx($,{className:"pb-2",children:e.jsx(J,{className:"text-base",children:"Por Classificação"})}),e.jsx(v,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:N.porClassificacao.map(([s,c])=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-100 rounded-lg",children:[e.jsx(A,{variant:"secondary",children:s}),e.jsx("span",{className:"font-semibold text-sm",children:c})]},s))})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-xs",children:[e.jsx(De,{className:"absolute left-2 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(ve,{placeholder:"Buscar...",value:x,onChange:s=>Z(s.target.value),className:"pl-8"})]}),e.jsxs(L,{value:w,onValueChange:ee,children:[e.jsx(b,{className:"w-[180px]",children:e.jsx(R,{placeholder:"Cliente"})}),e.jsxs(k,{children:[e.jsx(f,{value:"todos",children:"Todos Clientes"}),X.map(s=>e.jsx(f,{value:s.id,children:s.nome},s.id))]})]}),e.jsxs(L,{value:g,onValueChange:se,children:[e.jsx(b,{className:"w-[150px]",children:e.jsx(R,{placeholder:"Raça"})}),e.jsxs(k,{children:[e.jsx(f,{value:"todos",children:"Todas Raças"}),le.map(s=>e.jsx(f,{value:s,children:s},s))]})]}),e.jsxs(L,{value:S,onValueChange:ae,children:[e.jsx(b,{className:"w-[150px]",children:e.jsx(R,{placeholder:"Classificação"})}),e.jsxs(k,{children:[e.jsx(f,{value:"todos",children:"Todas"}),ie.map(s=>e.jsx(f,{value:s,children:s},s))]})]}),e.jsxs(L,{value:D,onValueChange:te,children:[e.jsx(b,{className:"w-[180px]",children:e.jsx(R,{placeholder:"Touro"})}),e.jsxs(k,{children:[e.jsx(f,{value:"todos",children:"Todos Touros"}),ne.map(([s,c])=>e.jsx(f,{value:s,children:c},s))]})]})]}),e.jsxs(C,{children:[e.jsx($,{children:e.jsxs(J,{children:["Embriões Congelados (",m.length,")"]})}),e.jsx(v,{children:m.length===0?e.jsx(Se,{title:"Nenhum embrião encontrado",description:x||w!=="todos"||g!=="todos"||S!=="todos"||D!=="todos"?"Tente ajustar os filtros":"Nenhum embrião congelado no estoque"}):e.jsxs(he,{children:[e.jsx(je,{children:e.jsxs(K,{children:[e.jsx(j,{children:"Identificação"}),e.jsx(j,{children:"Cliente"}),e.jsx(j,{children:"Classificação"}),e.jsx(j,{children:"Doadora"}),e.jsx(j,{children:"Touro"}),e.jsx(j,{children:"Raça"}),e.jsx(j,{children:"Data Cong."}),e.jsx(j,{children:"Localização"}),e.jsx(j,{className:"text-right",children:"Ações"})]})}),e.jsx(pe,{children:m.map(s=>{var n,l,o;const c=s.acasalamento,t=(n=c==null?void 0:c.aspiracao)==null?void 0:n.doadora,a=(l=c==null?void 0:c.dose_semen)==null?void 0:l.touro,i=(t==null?void 0:t.raca)||(a==null?void 0:a.raca);return e.jsxs(K,{children:[e.jsx(p,{className:"font-medium font-mono text-sm",children:s.identificacao||"-"}),e.jsx(p,{children:((o=s.cliente)==null?void 0:o.nome)||"-"}),e.jsx(p,{children:s.classificacao?e.jsx(A,{variant:"secondary",children:s.classificacao}):"-"}),e.jsx(p,{children:(t==null?void 0:t.registro)||(t==null?void 0:t.nome)||"-"}),e.jsxs(p,{children:[(a==null?void 0:a.nome)||"-",(a==null?void 0:a.registro)&&e.jsxs("span",{className:"text-slate-500 text-xs ml-1",children:["(",a.registro,")"]})]}),e.jsx(p,{children:i||"-"}),e.jsx(p,{children:T(s.data_congelamento)}),e.jsx(p,{children:s.localizacao_atual||"-"}),e.jsx(p,{className:"text-right",children:e.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>F(s),children:[e.jsx(Te,{className:"w-4 h-4 mr-1"}),"Detalhar"]})})]},s.id)})})]})})]}),e.jsx(fe,{open:!!I,onOpenChange:s=>!s&&F(null),children:e.jsxs(ue,{className:"max-w-2xl",children:[e.jsxs(ge,{children:[e.jsx(Ne,{children:"Detalhes do Embrião"}),e.jsx(Ce,{children:"Informações completas do embrião congelado"})]}),I&&e.jsx(re,{embriao:I})]})})]})}export{qe as default};
