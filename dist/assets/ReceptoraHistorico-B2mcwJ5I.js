import{c as Y,r as C,s as f,d as ne,j as e,B as P,g as ce,b as de,f as le}from"./index-B-7HRnm0.js";import{C as me,d as fe}from"./card-DdhhEbXV.js";import{E as ee}from"./EmptyState-gn01eel2.js";import{S as ae}from"./StatusBadge-B48hPBgT.js";import{C as H}from"./CountBadge-BBpPT0CT.js";import{u as te}from"./use-toast-DDUqdzpY.js";import{e as v,f as se}from"./dateUtils-eJ5e6apA.js";import{B as M}from"./badge-BCHVCiM7.js";import{T as oe}from"./tag-BZE-gXgS.js";import{B as Q}from"./baby-D2-VQuVM.js";import{A as ue}from"./activity-BuPU1g6A.js";import{C as xe}from"./calendar-D8momPux.js";import{M as pe}from"./map-pin-B7CeMiQc.js";import{U as ge}from"./user-plus-BAzWkuBB.js";import{C as he}from"./circle-alert-DaEslIuD.js";import{H as J}from"./history-CVgiEWSN.js";import{D as ve,a as _e,b as be,c as Ne,d as je,e as Ee}from"./dialog-CIXjHraQ.js";import{L as Ae}from"./label-vBcRjcSu.js";import{D as Ce}from"./DatePickerBR-XHkKTcYs.js";import{A as K}from"./arrow-left-D9wDrV6g.js";import{P as we}from"./plus-Cnek-_uY.js";import"./chevron-right-DntnbvYp.js";import"./popover-i4alam_g.js";import"./pt-BR-DS62bWKG.js";import"./differenceInCalendarDays-CrzntjZV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=Y("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=Y("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function Re(){const{toast:r}=te(),[p,d]=C.useState(!0),[s,n]=C.useState(null),[E,_]=C.useState([]),[A,w]=C.useState([]),[D,S]=C.useState({totalCiclos:0,totalGestacoes:0,ciclosDesdeUltimaGestacao:0}),x=C.useCallback(async g=>{const i=[],h=[],{data:G,error:O}=await f.from("receptoras").select("*").eq("id",g).single();if(O){if((O==null?void 0:O.code)==="PGRST116")return{receptoraData:null,items:[],itemsAdmin:[],stats:{totalCiclos:0,totalGestacoes:0,ciclosDesdeUltimaGestacao:0}};throw O}const{data:z}=await f.from("receptora_fazenda_historico").select("id, fazenda_id, data_inicio").eq("receptora_id",g).order("data_inicio",{ascending:!0});if(z&&z.length>0){const a=z[0],{data:t}=await f.from("fazendas").select("nome").eq("id",a.fazenda_id).single();h.push({data:v(a.data_inicio),tipo:"CADASTRO",resumo:`Cadastro na fazenda ${(t==null?void 0:t.nome)||"desconhecida"}`});for(let o=1;o<z.length;o++){const c=z[o],b=z[o-1],{data:l}=await f.from("fazendas").select("id, nome").in("id",[b.fazenda_id,c.fazenda_id].filter(Boolean)),N=new Map((l==null?void 0:l.map(m=>[m.id,m.nome]))||[]),u=N.get(b.fazenda_id)||"?",j=N.get(c.fazenda_id)||"?";h.push({data:v(c.data_inicio),tipo:"MUDANCA_FAZENDA",resumo:`${u} → ${j}`})}}const{data:L}=await f.from("protocolo_receptoras").select(`
        id,
        data_inclusao,
        status,
        motivo_inapta,
        protocolos_sincronizacao (
          id,
          data_inicio,
          passo2_data
        )
      `).eq("receptora_id",g).order("data_inclusao",{ascending:!1}),{data:T}=await f.from("diagnosticos_gestacao").select("*").eq("receptora_id",g).eq("tipo_diagnostico","DG").order("data_diagnostico",{ascending:!1}),{data:$}=await f.from("animais").select("id, data_nascimento, sexo").eq("receptora_id",g);if($&&$.length>0&&$.forEach(a=>{a.data_nascimento&&i.push({data:v(a.data_nascimento),tipo:"PARICAO",resumo:"Parição registrada",detalhes:`Animal ${a.id.substring(0,8)} • Sexo: ${a.sexo||"—"}`})}),L)for(const a of L){const t=Array.isArray(a.protocolos_sincronizacao)?a.protocolos_sincronizacao[0]:a.protocolos_sincronizacao;if(!t||!t.data_inicio)continue;const o=v(t.data_inicio);let c="1º Passo";if(t.passo2_data){const b=v(t.passo2_data);a.status==="APTA"?c="1º Passo • 2º Passo: APTA":a.status==="INAPTA"?(c="1º Passo • 2º Passo: DESCARTADA",a.motivo_inapta&&(c+=` (${a.motivo_inapta})`)):c="1º Passo • 2º Passo",i.push({data:b,tipo:"PROTOCOLO",resumo:c})}else i.push({data:o,tipo:"PROTOCOLO",resumo:c})}const{data:B}=await f.from("transferencias_embrioes").select(`
        id,
        embriao_id,
        data_te,
        status_te,
        embrioes (
          id,
          identificacao,
          classificacao,
          lote_fiv_acasalamento_id
        )
      `).eq("receptora_id",g).order("data_te",{ascending:!1}),q=new Set;B&&B.forEach(a=>{const t=Array.isArray(a.embrioes)?a.embrioes[0]:a.embrioes;t!=null&&t.lote_fiv_acasalamento_id&&q.add(t.lote_fiv_acasalamento_id)});const U=new Map;if(q.size>0){const a=Array.from(q).filter(Boolean);if(a.length>0){const{data:t,error:o}=await f.from("lote_fiv_acasalamentos").select("id, aspiracao_doadora_id, dose_semen_id").in("id",a);if(!o&&t){const c=t.map(u=>u.aspiracao_doadora_id).filter(Boolean),b=t.map(u=>u.dose_semen_id).filter(Boolean),l=new Map;if(c.length>0){const{data:u}=await f.from("aspiracoes_doadoras").select("id, doadora_id").in("id",c);if(u){const j=u.map(m=>m.doadora_id).filter(Boolean);if(j.length>0){const{data:m}=await f.from("doadoras").select("id, registro").in("id",j);if(m){const F=new Map(m.map(R=>[R.id,R.registro]));u.forEach(R=>{const I=F.get(R.doadora_id);I&&l.set(R.id,I)})}}}}const N=new Map;if(b.length>0){const{data:u}=await f.from("doses_semen").select("id, touro_id, touro:touros(id, nome, registro, raca)").in("id",b);u&&u.forEach(j=>{const m=j.touro;N.set(j.id,(m==null?void 0:m.nome)||"Touro desconhecido")})}t.forEach(u=>{const j=l.get(u.aspiracao_doadora_id)||"?",m=N.get(u.dose_semen_id)||"?";U.set(u.id,{doadora:j,touro:m})})}}}const V=new Map;if(B){const a=new Map;B.forEach(t=>{const o=t.data_te;a.has(o)||a.set(o,[]),a.get(o).push(t)}),a.forEach((t,o)=>{const c=t.filter(l=>l.status_te==="REALIZADA"),b=t.filter(l=>l.status_te==="DESCARTADA");if(c.length>0){const l=[],N=[];c.forEach(j=>{const m=Array.isArray(j.embrioes)?j.embrioes[0]:j.embrioes,F=(m==null?void 0:m.identificacao)||"Embrião";if(l.push(F),m!=null&&m.lote_fiv_acasalamento_id){const R=U.get(m.lote_fiv_acasalamento_id);if(R){const I=`${R.doadora} × ${R.touro}`;N.includes(I)||N.push(I)}}});let u=`${c.length} embrião(ões): ${l.join(", ")}`;N.length>0&&(u+=` | ${N.join("; ")}`),i.push({data:v(o),tipo:"TE",resumo:u}),V.set(o,N)}else b.length>0&&i.push({data:v(o),tipo:"TE",resumo:"Descartada para TE"})})}if(T)for(const a of T){let t=a.resultado==="PRENHE"?"PRENHE":a.resultado==="RETOQUE"?"PRENHE (RETOQUE)":"VAZIA";if(a.numero_gestacoes&&a.numero_gestacoes>0&&a.resultado!=="VAZIA"&&(t+=` (${a.numero_gestacoes} gestação${a.numero_gestacoes>1?"ões":""})`),(a.resultado==="PRENHE"||a.resultado==="RETOQUE")&&a.data_te){const o=V.get(a.data_te);o&&o.length>0&&(t+=` | ${o.join("; ")}`)}i.push({data:v(a.data_diagnostico),tipo:"DG",resumo:t})}const{data:Z}=await f.from("diagnosticos_gestacao").select("*").eq("receptora_id",g).eq("tipo_diagnostico","SEXAGEM").order("data_diagnostico",{ascending:!1});if(Z)for(const a of Z){let t="Sexagem: ",o=[];if(a.observacoes){const c=a.observacoes.match(/SEXAGENS:([^|]+)/);c&&(o=c[1].split(",").map(l=>l.trim()).filter(l=>l).map(l=>({FEMEA:"Fêmea",MACHO:"Macho",SEM_SEXO:"Sem Sexo",VAZIA:"Vazia"})[l]||l))}if(o.length===0&&a.sexagem){const c={FEMEA:"Fêmea",MACHO:"Macho"};o.push(c[a.sexagem]||a.sexagem)}o.length>0?(o.length===1?t+=o[0]:o.length===2?o[0]===o[1]?t+=`2 ${o[0]}s`:t+=`${o[0]} e ${o[1]}`:t+=o.join(", "),a.numero_gestacoes&&a.numero_gestacoes>1&&(t+=` (${a.numero_gestacoes} gestações)`)):a.resultado==="PRENHE"?t+="PRENHE":a.resultado==="VAZIA"?t+="VAZIA":t+="Resultado não disponível",i.push({data:v(a.data_diagnostico),tipo:"SEXAGEM",resumo:t})}const{data:X}=await f.from("receptoras_cio_livre").select("data_cio, observacoes, ativa").eq("receptora_id",g).order("data_cio",{ascending:!1});if(X&&(G==null?void 0:G.status_cio_livre)==="CONFIRMADA"){const a=X[0];a!=null&&a.data_cio&&i.push({data:v(a.data_cio),tipo:"CIO_LIVRE",resumo:"Cio livre"})}const k={totalCiclos:0,totalGestacoes:0,ciclosDesdeUltimaGestacao:0};if(L){k.totalCiclos=L.length;let a=null;if(T&&T.length>0){const o=[...T].sort((c,b)=>{const l=v(c.data_diagnostico);return v(b.data_diagnostico).localeCompare(l)}).find(c=>c.resultado==="PRENHE"||c.resultado==="RETOQUE");o&&(a=v(o.data_diagnostico))}if(a)for(const t of L){const o=Array.isArray(t.protocolos_sincronizacao)?t.protocolos_sincronizacao[0]:t.protocolos_sincronizacao;if(!o)continue;const c=o.passo2_data||o.data_inicio;if(!c)continue;v(c)>a&&k.ciclosDesdeUltimaGestacao++}else k.ciclosDesdeUltimaGestacao=k.totalCiclos}if(T){const a=new Set;T.forEach(t=>{if(t.resultado==="PRENHE"||t.resultado==="RETOQUE"){const o=t.data_te||t.data_diagnostico;a.add(o)}}),k.totalGestacoes=a.size}return i.sort((a,t)=>t.data.localeCompare(a.data)),h.sort((a,t)=>t.data.localeCompare(a.data)),{receptoraData:G,items:i,itemsAdmin:h,stats:k}},[]),y=C.useCallback(async g=>{try{d(!0);const i=await x(g);n(i.receptoraData),_(i.items),w(i.itemsAdmin),S(i.stats)}catch(i){r({title:"Erro ao carregar histórico",description:i instanceof Error?i.message:"Erro desconhecido",variant:"destructive"})}finally{d(!1)}},[x,r]);return{loading:p,receptora:s,historico:E,historicoAdmin:A,estatisticas:D,loadData:y,setReceptora:n}}function Se({receptora:r,onSuccess:p}){const{toast:d}=te(),[s,n]=C.useState(!1),[E,_]=C.useState(!1),[A,w]=C.useState({data_cio:new Date().toISOString().split("T")[0]});return{submitting:s,showCioLivreDialog:E,setShowCioLivreDialog:_,cioLivreForm:A,setCioLivreForm:w,handleRegistrarCioLivre:async()=>{var y,g;if(!r){d({title:"Receptora não carregada",description:"Abra novamente o histórico para registrar o cio livre.",variant:"destructive"});return}let x=r.fazenda_atual_id;if(!x){const{data:i,error:h}=await f.from("vw_receptoras_fazenda_atual").select("fazenda_id_atual").eq("receptora_id",r.id).limit(1);!h&&i&&i.length>0&&(x=((y=i[0])==null?void 0:y.fazenda_id_atual)||void 0)}if(!x){const{data:i,error:h}=await f.from("receptora_fazenda_historico").select("fazenda_id, data_inicio").eq("receptora_id",r.id).order("data_inicio",{ascending:!1}).limit(1);!h&&i&&i.length>0&&(x=((g=i[0])==null?void 0:g.fazenda_id)||void 0)}if(!x){d({title:"Fazenda não encontrada",description:"A receptora não possui fazenda atual vinculada.",variant:"destructive"});return}if(!A.data_cio){d({title:"Data do cio não informada",description:"Informe a data do cio livre.",variant:"destructive"});return}try{n(!0);const{error:i}=await f.from("receptoras").update({is_cio_livre:!0,status_cio_livre:"PENDENTE"}).eq("id",r.id);if(i)throw i;const{error:h}=await f.from("receptoras_cio_livre").insert([{receptora_id:r.id,fazenda_id:x,data_cio:A.data_cio,observacoes:null,ativa:!0}]);if(h)throw h;d({title:"Cio livre registrado",description:"Receptora liberada para TE. Confirmação automática após a transferência."}),_(!1),w({data_cio:new Date().toISOString().split("T")[0]}),await p()}catch(i){d({title:"Erro ao registrar cio livre",description:i instanceof Error?i.message:"Erro desconhecido",variant:"destructive"})}finally{n(!1)}},handleRejeitarCioLivre:async()=>{if(!(!r||!r.is_cio_livre)&&confirm("Rejeitar este cio livre? A receptora não ficará disponível para TE."))try{n(!0);const{error:x}=await f.from("receptoras").update({is_cio_livre:!1,status_cio_livre:"REJEITADA"}).eq("id",r.id);if(x)throw x;const{error:y}=await f.from("receptoras_cio_livre").update({ativa:!1}).eq("receptora_id",r.id).eq("ativa",!0);if(y)throw y;d({title:"Cio livre rejeitado",description:"O cio livre foi marcado como rejeitado."}),await p()}catch(x){d({title:"Erro ao rejeitar cio livre",description:x instanceof Error?x.message:"Erro desconhecido",variant:"destructive"})}finally{n(!1)}}}}const ie={CADASTRO:{icon:ge,className:"w-4 h-4 text-indigo-600 dark:text-indigo-400"},MUDANCA_FAZENDA:{icon:pe,className:"w-4 h-4 text-orange-600 dark:text-orange-400"},PROTOCOLO:{icon:xe,className:"w-4 h-4 text-blue-600 dark:text-blue-400"},TE:{icon:ne,className:"w-4 h-4 text-emerald-600 dark:text-emerald-400"},DG:{icon:ue,className:"w-4 h-4 text-purple-600 dark:text-purple-400"},SEXAGEM:{icon:Q,className:"w-4 h-4 text-pink-600 dark:text-pink-400"},PARICAO:{icon:Q,className:"w-4 h-4 text-teal-600 dark:text-teal-400"},CIO_LIVRE:{icon:oe,className:"w-4 h-4 text-amber-600 dark:text-amber-400"}},re={CADASTRO:{label:"Cadastro",className:"bg-indigo-500/10 text-indigo-600 dark:text-indigo-400 border-indigo-500/30"},MUDANCA_FAZENDA:{label:"Fazenda",className:"bg-orange-500/10 text-orange-600 dark:text-orange-400 border-orange-500/30"},PROTOCOLO:{label:"Protocolo",className:"bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/30"},TE:{label:"TE",className:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30"},DG:{label:"DG",className:"bg-purple-500/10 text-purple-600 dark:text-purple-400 border-purple-500/30"},SEXAGEM:{label:"Sexagem",className:"bg-pink-500/10 text-pink-600 dark:text-pink-400 border-pink-500/30"},PARICAO:{label:"Parição",className:"bg-teal-500/10 text-teal-600 dark:text-teal-400 border-teal-500/30"},CIO_LIVRE:{label:"Cio Livre",className:"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/30"}},W={CONFIRMADA:{label:"Confirmada",className:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30"},REJEITADA:{label:"Rejeitada",className:"bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/30"},SUBSTITUIDA:{label:"Substituída",className:"bg-slate-500/10 text-slate-600 dark:text-slate-400 border-slate-500/30"},PENDENTE:{label:"Pendente",className:"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/30"}},Te=r=>W[r||"PENDENTE"]||W.PENDENTE;function ze({receptora:r,submitting:p,onRejeitar:d}){const s=Te(r.status_cio_livre),n=r.status_cio_livre==="PENDENTE";return e.jsx("div",{className:"rounded-lg border border-amber-500/30 bg-amber-500/5 p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center justify-center w-7 h-7 rounded-md bg-amber-500/15",children:e.jsx(oe,{className:"w-3.5 h-3.5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Cio Livre"}),n&&e.jsxs("p",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),"Aguardando confirmação"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{variant:"outline",className:`${s.className} text-[10px] px-1.5 py-0`,children:s.label}),n&&e.jsxs(P,{type:"button",variant:"outline",size:"sm",onClick:d,disabled:p,className:"h-7 text-xs border-red-500/30 text-red-600 hover:bg-red-500/10",children:[e.jsx(De,{className:"w-3 h-3 mr-1"}),"Rejeitar"]})]})]})})}function ke({historicoAdmin:r}){if(r.length===0)return null;const p=s=>{const n=ie[s];if(!n)return null;const E=n.icon;return e.jsx(E,{className:"w-3 h-3"})},d=s=>{const n=re[s];return n?e.jsx(M,{variant:"outline",className:`${n.className} text-[10px] px-1.5 py-0`,children:n.label}):e.jsx(M,{variant:"outline",className:"text-[10px] px-1.5 py-0",children:s})};return e.jsxs("div",{className:"rounded-lg border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-muted/40 border-b border-border",children:[e.jsx(ye,{className:"w-3.5 h-3.5 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:"Histórico Administrativo"})]}),e.jsx("div",{className:"divide-y divide-border/50",children:r.map((s,n)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 hover:bg-muted/30 transition-colors",children:[e.jsx("div",{className:"flex items-center justify-center w-5 h-5 rounded bg-muted/50",children:p(s.tipo)}),d(s.tipo),e.jsx("span",{className:"flex-1 text-xs text-foreground truncate",children:s.resumo}),e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0",children:se(s.data)})]},n))})]})}function Pe({historico:r}){const p=s=>{const n=ie[s];if(!n)return null;const E=n.icon;return e.jsx(E,{className:"w-3 h-3"})},d=s=>{const n=re[s];return n?e.jsx(M,{variant:"outline",className:`${n.className} text-[10px] px-1.5 py-0`,children:n.label}):e.jsx(M,{variant:"outline",className:"text-[10px] px-1.5 py-0",children:s})};return r.length===0?e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(J,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Linha do Tempo"})]}),e.jsx(ee,{title:"Nenhum evento",description:"Eventos reprodutivos aparecerão aqui."})]}):e.jsxs("div",{className:"rounded-lg border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-muted/40 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Linha do Tempo"})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.length," eventos"]})]}),e.jsx("div",{className:"divide-y divide-border/50 max-h-[300px] overflow-y-auto",children:r.map((s,n)=>e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 hover:bg-muted/30 transition-colors",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground w-[70px] shrink-0",children:se(s.data)}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[e.jsx("div",{className:"flex items-center justify-center w-5 h-5 rounded bg-muted/50",children:p(s.tipo)}),d(s.tipo)]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs text-foreground truncate block",children:s.resumo}),s.detalhes&&e.jsx("span",{className:"text-[10px] text-muted-foreground truncate block",children:s.detalhes})]})]},n))})]})}function Oe({open:r,onOpenChange:p,receptora:d,cioLivreForm:s,setCioLivreForm:n,submitting:E,onSubmit:_}){const A=(d==null?void 0:d.status_reprodutivo)||"VAZIA",w=D=>{p(D),D&&n({data_cio:new Date().toISOString().split("T")[0]})};return e.jsx(ve,{open:r,onOpenChange:w,children:e.jsxs(_e,{className:"max-w-lg",children:[e.jsxs(be,{children:[e.jsx(Ne,{children:"Registrar Cio Livre"}),e.jsx(je,{children:"Registre a data do cio livre. A confirmação ocorrerá automaticamente após a TE."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-md border border-slate-200 bg-slate-50 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Receptora"}),e.jsxs("span",{className:"font-medium",children:[d==null?void 0:d.identificacao," ",d!=null&&d.nome?`- ${d.nome}`:""]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Status atual"}),e.jsx(ae,{status:A})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ae,{children:"Data do cio *"}),e.jsx(Ce,{value:s.data_cio,onChange:D=>n(S=>({...S,data_cio:D||""})),required:!0})]})]}),e.jsxs(Ee,{children:[e.jsx(P,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancelar"}),e.jsx(P,{type:"button",onClick:_,disabled:E,children:"Registrar Cio Livre"})]})]})})}function na(){const{id:r}=ce(),p=de(),{loading:d,receptora:s,historico:n,historicoAdmin:E,estatisticas:_,loadData:A}=Re(),{submitting:w,showCioLivreDialog:D,setShowCioLivreDialog:S,cioLivreForm:x,setCioLivreForm:y,handleRegistrarCioLivre:g,handleRejeitarCioLivre:i}=Se({receptora:s,onSuccess:async()=>{r&&await A(r)}});C.useEffect(()=>{r&&A(r)},[r,A]);const h=_.totalCiclos>0?Math.round(_.totalGestacoes/_.totalCiclos*100):0;return d?e.jsx(le,{}):s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>p(-1),children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Histórico da Receptora"})]}),!s.is_cio_livre&&e.jsxs(P,{size:"sm",onClick:()=>S(!0),className:"bg-primary hover:bg-primary/90",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),"Cio Livre"]})]}),e.jsx(me,{children:e.jsxs(fe,{className:"pt-4 pb-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Brinco"}),e.jsx("p",{className:"text-base font-semibold text-foreground",children:s.identificacao})]}),s.nome&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Nome"}),e.jsx("p",{className:"text-sm text-foreground",children:s.nome})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Status"}),e.jsx("div",{className:"mt-0.5",children:e.jsx(ae,{status:s.status_reprodutivo||"VAZIA"})})]}),s.raca&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Raça"}),e.jsx("p",{className:"text-sm text-foreground",children:s.raca})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Ciclos:"}),e.jsx(H,{value:_.totalCiclos,variant:"default"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Gestações:"}),e.jsx(H,{value:_.totalGestacoes,variant:"success"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Desde última:"}),e.jsx(H,{value:_.ciclosDesdeUltimaGestacao,variant:"warning"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Taxa:"}),e.jsx(H,{value:h,suffix:"%",variant:h>=50?"primary":"warning"})]})]})]}),s.is_cio_livre&&e.jsx("div",{className:"pt-3 border-t border-border",children:e.jsx(ze,{receptora:s,submitting:w,onRejeitar:i})})]})}),e.jsx(ke,{historicoAdmin:E}),e.jsx(Pe,{historico:n}),e.jsx(Oe,{open:D,onOpenChange:S,receptora:s,cioLivreForm:x,setCioLivreForm:y,submitting:w,onSubmit:g})]}):e.jsx(ee,{title:"Receptora não encontrada",description:"Não foi possível carregar os dados da receptora.",action:e.jsxs(P,{onClick:()=>p(-1),variant:"outline",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Voltar"]})})}export{na as default};
