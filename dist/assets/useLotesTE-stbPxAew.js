import{c as C,r as z,s as p}from"./index-6OJhfjKP.js";import{u as P}from"./use-toast-DasFaehQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=C("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=C("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=C("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),H={DG:27,SEXAGEM:54};function B(t){const d=new Date(t);return Math.floor((new Date().getTime()-d.getTime())/(1e3*60*60*24))}function R(t){const d=new Date(t),c=new Date(d);return c.setDate(c.getDate()+275),c.toISOString().split("T")[0]}function Z(){return new Date().toISOString().split("T")[0]}function $(t){return t.veterinario_responsavel.trim()!==""}function N({statusReceptoraFiltro:t}){const{toast:d}=P(),[c,_]=z.useState([]),[h,D]=z.useState(!1),T=z.useCallback(async()=>{try{D(!0);const{data:n,error:w}=await p.from("fazendas").select("*").order("nome",{ascending:!0});if(w)throw w;if(!n||n.length===0){_([]);return}const{data:S,error:i}=await p.from("vw_receptoras_fazenda_atual").select("receptora_id, fazenda_id_atual");if(i)throw i;const g=[...new Set((S||[]).map(a=>a.receptora_id).filter(Boolean))];if(g.length===0){_(n);return}const v=Array.isArray(t)?t:[t];let l=p.from("receptoras").select("id").in("id",g);v.length===1?l=l.eq("status_reprodutivo",v[0]):l=l.in("status_reprodutivo",v);const{data:f,error:y}=await l;if(y)throw y;const E=(f==null?void 0:f.map(a=>a.id))||[];if(E.length===0){_([]);return}const{data:M,error:u}=await p.from("transferencias_embrioes").select("receptora_id").in("receptora_id",E).eq("status_te","REALIZADA");if(u)throw console.error("Erro ao buscar TEs:",u),u;const b=new Set((M==null?void 0:M.map(a=>a.receptora_id))||[]);if(b.size===0){_([]);return}const I=new Map((S||[]).filter(a=>a.receptora_id&&a.fazenda_id_atual).map(a=>[a.receptora_id,a.fazenda_id_atual])),k=new Set;b.forEach(a=>{const m=I.get(a);m&&k.add(m)});const L=n.filter(a=>k.has(a.id));_(L)}catch(n){console.error("Erro ao carregar fazendas:",n),d({title:"Erro ao carregar fazendas",description:n instanceof Error?n.message:"Erro desconhecido",variant:"destructive"}),_([])}finally{D(!1)}},[t,d]);return{fazendas:c,loading:h,loadFazendas:T}}function X({statusReceptoraFiltro:t,transformLote:d}){const{toast:c}=P(),[_,h]=z.useState([]),[D,T]=z.useState(!1),n=z.useCallback(async(w,S)=>{try{T(!0);const{data:i,error:g}=await p.from("vw_receptoras_fazenda_atual").select("receptora_id").eq("fazenda_id_atual",w);if(g)throw console.error("Erro ao buscar view:",g),g;const v=(i==null?void 0:i.map(e=>e.receptora_id))||[];if(v.length===0){h([]);return}const l=Array.isArray(t)?t:[t];let f=p.from("receptoras").select("id, status_reprodutivo").in("id",v);l.length===1?f=f.eq("status_reprodutivo",l[0]):f=f.in("status_reprodutivo",l);const{data:y,error:E}=await f;if(E)throw console.error("Erro ao buscar receptoras:",E),E;const M=(y==null?void 0:y.map(e=>e.id))||[];if(M.length===0){h([]);return}const{data:u,error:b}=await p.from("transferencias_embrioes").select("id, receptora_id, data_te, embriao_id").in("receptora_id",M).eq("status_te","REALIZADA").order("data_te",{ascending:!1});if(b)throw console.error("Erro ao buscar TEs:",b),b;if(!u||u.length===0){h([]);return}const I=u.map(e=>e.embriao_id).filter(Boolean);let k=new Map,L=new Map;if(I.length>0){const{data:e}=await p.from("embrioes").select("id, lote_fiv_id").in("id",I);if(e){k=new Map(e.map(r=>[r.id,{lote_fiv_id:r.lote_fiv_id}]));const o=[...new Set(e.map(r=>r.lote_fiv_id).filter(Boolean))];if(o.length>0){const{data:r}=await p.from("lotes_fiv").select("id, data_abertura").in("id",o);r&&(L=new Map(r.map(s=>[s.id,{data_abertura:s.data_abertura}])))}}}const a=new Map,m=new Map,q=new Map;u.forEach(e=>{const o=`${w}-${e.data_te}`;m.has(e.data_te)||m.set(e.data_te,new Set),m.get(e.data_te).add(e.receptora_id);const r=k.get(e.embriao_id);if(r!=null&&r.lote_fiv_id){const s=L.get(r.lote_fiv_id);if(s!=null&&s.data_abertura){const A=q.get(o);(!A||s.data_abertura<A)&&q.set(o,s.data_abertura)}}a.has(o)||a.set(o,{id:o,fazenda_id:w,fazenda_nome:S||"",data_te:e.data_te,quantidade_receptoras:0,status:"ABERTO"})}),a.forEach((e,o)=>{var A;const r=((A=m.get(e.data_te))==null?void 0:A.size)||0;e.quantidade_receptoras=r;const s=q.get(o);s&&(e.data_abertura_lote=s,e.dias_gestacao=B(s))});const x=Array.from(a.values()).map(e=>d(e,void 0)).sort((e,o)=>new Date(o.data_te).getTime()-new Date(e.data_te).getTime());h(x)}catch(i){console.error("Erro ao carregar lotes:",i),c({title:"Erro ao carregar lotes",description:i instanceof Error?i.message:"Erro desconhecido",variant:"destructive"}),h([])}finally{T(!1)}},[t,d,c]);return{lotesTE:_,loading:D,loadLotesTE:n}}export{F as C,H as D,G as R,U as T,X as a,R as b,B as c,Z as g,N as u,$ as v};
