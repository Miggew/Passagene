import{c as Se,r as c,s as V,j as e,h as P,m as ba,w as Na,x as Da,y as Rs,z as Ps,C as Ye,q as Ue,l as k,P as ye,E as Is,G as ks,I as zs,J as As,K as Ts,p as Ea,f as ve,S as Qe,g as Os}from"./index-CWtHucPz.js";import{S as ta,a as oa,b as na,c as ra,d as ge,f as Fs,u as Bs,C as Ls,e as Gs}from"./select-BUr2m4f3.js";import{L as be}from"./label-CDN-yMr6.js";import{P as $s}from"./PageHeader-DqMTzrbX.js";import{E as Ks}from"./EmptyState-B00kV8BS.js";import{u as Ma,C as Us,a as qs,c as Hs}from"./use-toast-C_ednEV-.js";import{h as Vs}from"./error-handler-DHghZuf4.js";import{u as Xs,e as Ys}from"./hooks-BHMrHO5Y.js";import{d as Ws,t as Js,f as Zs}from"./dateUtils-eJ5e6apA.js";import{P as Qs,h as et,b as at,R as st,F as tt,u as ot,a as xa}from"./index-RvRMy3My.js";import{c as Sa,I as nt,R as rt}from"./index-B77RxHAU.js";import{a as ya,C as it}from"./chevron-right-CY2M1G_-.js";import{C as ea}from"./check-D_BDiPDp.js";import{B as Me}from"./badge-DewFfdNp.js";import{S as ct}from"./StatusBadge-B_pnPC6h.js";import{T as aa}from"./sheet--GdNEXsI.js";import{U as Ra}from"./user-Bdl_cooq.js";import{T as Pa}from"./trash-2-xz0xDiTy.js";import{C as lt,D as Ia}from"./DatePickerBR-D4MNcuwK.js";import{M as dt}from"./map-pin-g2EPKA_5.js";import{T as ga}from"./triangle-alert-Z4rSr_A9.js";import{P as ut}from"./package-BeW_U6E9.js";import{X as ft}from"./x-BtWTyRSy.js";import{D as Re,b as Pe,c as Ie,d as ke,e as ia,f as mt}from"./dialog-DG0TUp-m.js";import{I as pt}from"./input-bF23Jkur.js";import{T as ht}from"./textarea-EUsZECCO.js";import"./index-H2w26JuE.js";import"./statusLabels-IklKT8dE.js";import"./popover-hCBfJPXC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=Se("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=Se("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=Se("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=Se("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=Se("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=Se("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),ka="embrioes_filtros",Ca=20,_t=()=>{try{const a=localStorage.getItem(ka);return a?JSON.parse(a):{}}catch{return{}}},wt=a=>a?Ws(a,Js()):null;function Ct(){const a=c.useMemo(()=>_t(),[]),[t,s]=c.useState([]),[o,r]=c.useState([]),[i,l]=c.useState(!1),{data:d=[],refetch:v}=Xs(),{data:_=[],refetch:m}=Ys(),[u,g]=c.useState(a.selectedFazendaDestinoId??""),[j,C]=c.useState(a.paginasPacotes??{}),[D,$]=c.useState({});c.useEffect(()=>{const h={selectedFazendaDestinoId:u,paginasPacotes:j};localStorage.setItem(ka,JSON.stringify(h))},[u,j]),c.useEffect(()=>{C(h=>{let S=!1;const N={...h};return o.forEach(T=>{const B=Math.max(1,Math.ceil(T.embrioes.length/Ca));if(!N[T.id]){N[T.id]=1,S=!0;return}N[T.id]>B&&(N[T.id]=B,S=!0)}),S?N:h})},[o]);const K=c.useCallback(h=>(D[h.id]??h.classificacao??"").trim(),[D]),z=c.useCallback(h=>{const S={BE:0,BN:0,BX:0,BL:0,BI:0};let N=0;return h.embrioes.forEach(T=>{const B=K(T).toUpperCase();if(!B){N+=1;return}B==="BE"?S.BE+=1:B==="BN"?S.BN+=1:B==="BX"?S.BX+=1:B==="BL"?S.BL+=1:B==="BI"&&(S.BI+=1)}),{semClassificacao:N,classificados:S,total:h.total,todosClassificados:h.total>0&&N===0}},[K]),U=c.useCallback(async()=>{await v()},[v]),x=c.useCallback(async()=>{await m()},[m]),F=c.useCallback(async()=>{try{l(!0);const{data:h,error:S}=await V.from("embrioes").select("*").in("status_atual",["FRESCO","CONGELADO"]).is("cliente_id",null).order("created_at",{ascending:!1});if(S)throw S;if(!h||h.length===0){s([]),r([]),l(!1);return}const N=[...new Set(h.filter(n=>n.lote_fiv_acasalamento_id).map(n=>n.lote_fiv_acasalamento_id))],T=[...new Set(h.filter(n=>n.lote_fiv_id).map(n=>n.lote_fiv_id))],B=[...new Set(h.filter(n=>n.fazenda_destino_id).map(n=>n.fazenda_destino_id))];if(N.length===0){s(h),r([]),l(!1);return}const[W,me]=await Promise.all([V.from("lote_fiv_acasalamentos").select("id, aspiracao_doadora_id, dose_semen_id").in("id",N),T.length>0?V.from("lotes_fiv").select("id, pacote_aspiracao_id, data_fecundacao").in("id",T):Promise.resolve({data:null,error:null})]);if(W.error)throw W.error;const ee=W.data||[],ae=me.data||[],de=[...new Set(ee.map(n=>n.aspiracao_doadora_id))],pe=[...new Set(ee.map(n=>n.dose_semen_id))],J=[...new Set(ae.map(n=>n.pacote_aspiracao_id).filter(Boolean))],p=new Map,L=new Map;ae.forEach(n=>{n.pacote_aspiracao_id&&p.set(n.id,n.pacote_aspiracao_id),n.data_fecundacao&&L.set(n.id,n.data_fecundacao)});const[q,X,se]=await Promise.all([de.length>0?V.from("aspiracoes_doadoras").select("id, doadora_id, pacote_aspiracao_id").in("id",de):Promise.resolve({data:null,error:null}),pe.length>0?V.from("doses_semen").select("id, touro_id, touro:touros(id, nome, registro, raca)").in("id",pe):Promise.resolve({data:null,error:null}),J.length>0?V.from("pacotes_aspiracao").select("id, data_aspiracao, fazenda_id, fazenda_destino_id, horario_inicio, veterinario_responsavel, total_oocitos").in("id",J):Promise.resolve({data:null,error:null})]);if(q.error)throw q.error;if(X.error)throw X.error;const te=q.data||[],he=X.data||[],Z=se.data||[],oe=[...new Set(te.map(n=>n.doadora_id))],O=new Set(B);Z.forEach(n=>{n.fazenda_id&&O.add(n.fazenda_id),n.fazenda_destino_id&&O.add(n.fazenda_destino_id)});const[G,xe,le]=await Promise.all([oe.length>0?V.from("doadoras").select("id, registro").in("id",oe):Promise.resolve({data:null,error:null}),O.size>0?V.from("fazendas").select("id, nome").in("id",Array.from(O)):Promise.resolve({data:null,error:null}),J.length>0?V.from("pacotes_aspiracao_fazendas_destino").select("pacote_aspiracao_id, fazenda_destino_id").in("pacote_aspiracao_id",J):Promise.resolve({data:null,error:null})]);if(G.error)throw G.error;const ze=G.data||[],Ae=xe.data||[],_e=le.data||[],we=new Map(Ae.map(n=>[n.id,n.nome])),ue=new Map;_e.forEach(n=>{const R=ue.get(n.pacote_aspiracao_id)||[];R.includes(n.fazenda_destino_id)||R.push(n.fazenda_destino_id),ue.set(n.pacote_aspiracao_id,R)}),Z.forEach(n=>{if(n.fazenda_destino_id){const R=ue.get(n.id)||[];R.includes(n.fazenda_destino_id)||R.push(n.fazenda_destino_id),ue.set(n.id,R)}});const re=new Map;te.forEach(n=>{n.pacote_aspiracao_id&&re.set(n.pacote_aspiracao_id,(re.get(n.pacote_aspiracao_id)||0)+1)});const ie=new Map;Z.forEach(n=>{ie.set(n.id,{id:n.id,data_aspiracao:n.data_aspiracao,fazenda_nome:we.get(n.fazenda_id),quantidade_doadoras:re.get(n.id)||0,horario_inicio:n.horario_inicio,veterinario_responsavel:n.veterinario_responsavel,total_oocitos:n.total_oocitos})});const Te=new Map(te.map(n=>[n.id,n])),Oe=new Map(ze.map(n=>[n.id,n])),w=new Map(he.map(n=>[n.id,n])),b=new Map(ee.map(n=>[n.id,n])),M=h.map(n=>{var ne;const R=n.lote_fiv_acasalamento_id?b.get(n.lote_fiv_acasalamento_id):void 0,I=R?Te.get(R.aspiracao_doadora_id):void 0,Y=I?Oe.get(I.doadora_id):void 0,Ce=R?w.get(R.dose_semen_id):void 0,Ee=n.lote_fiv_id?p.get(n.lote_fiv_id):void 0,Fe=Ee?ie.get(Ee):void 0;return{...n,doadora_registro:Y==null?void 0:Y.registro,touro_nome:(ne=Ce==null?void 0:Ce.touro)==null?void 0:ne.nome,fazenda_destino_nome:n.fazenda_destino_id?we.get(n.fazenda_destino_id):void 0,data_aspiracao:Fe==null?void 0:Fe.data_aspiracao,pacote_aspiracao_id:Ee}}),y=new Map;M.forEach(n=>{var ha;if(!n.lote_fiv_id)return;const R=((ha=n.created_at)==null?void 0:ha.split("T")[0])||"",I=`${n.lote_fiv_id}_${R}`,Y=n.lote_fiv_id?p.get(n.lote_fiv_id):void 0,Ce=Y?ie.get(Y):void 0,Ee=Y?ue.get(Y)||[]:[],Fe=Ee.map(je=>we.get(je)||"N/A");y.has(I)||y.set(I,{id:I,lote_fiv_id:n.lote_fiv_id,data_despacho:R,data_fecundacao:n.lote_fiv_id?L.get(n.lote_fiv_id):void 0,fazendas_destino_ids:Ee,fazendas_destino_nomes:Fe,pacote_info:Ce||{id:Y||"",data_aspiracao:"",quantidade_doadoras:0},embrioes:[],total:0,frescos:0,congelados:0,sem_classificacao:0,classificados:{BE:0,BN:0,BX:0,BL:0,BI:0}});const ne=y.get(I);if(ne.embrioes.push(n),ne.total++,n.status_atual==="FRESCO"&&ne.frescos++,n.status_atual==="CONGELADO"&&ne.congelados++,!n.classificacao)ne.sem_classificacao++;else{const je=n.classificacao.toUpperCase();je==="BE"?ne.classificados.BE++:je==="BN"?ne.classificados.BN++:je==="BX"?ne.classificados.BX++:je==="BL"?ne.classificados.BL++:je==="BI"&&ne.classificados.BI++}});const fe=(u?Array.from(y.values()).filter(n=>n.fazendas_destino_ids.includes(u)):Array.from(y.values())).sort((n,R)=>{const I=new Date(n.data_despacho).getTime();return new Date(R.data_despacho).getTime()-I});fe.forEach(n=>{n.todos_classificados=n.total>0&&n.sem_classificacao===0,n.disponivel_para_transferencia=n.todos_classificados&&n.frescos>0});const f=new Set(fe.map(n=>n.id)),A=M.filter(n=>{var Y;if(!n.lote_fiv_id)return!1;const R=((Y=n.created_at)==null?void 0:Y.split("T")[0])||"",I=`${n.lote_fiv_id}_${R}`;return f.has(I)});s(A),r(fe)}catch(h){Vs(h,"Erro ao carregar embriões")}finally{l(!1)}},[u]),E=c.useCallback(async()=>{await F()},[F]);return{embrioes:t,pacotes:o,fazendas:d,clientes:_,loading:i,selectedFazendaDestinoId:u,setSelectedFazendaDestinoId:g,paginasPacotes:j,setPaginasPacotes:C,pageSize:Ca,loadData:F,loadFazendas:U,loadClientes:x,reloadData:E,getClassificacaoAtual:K,getResumoPacote:z,classificacoesPendentes:D,setClassificacoesPendentes:$}}const Be=async(a,t,s,o,r,i)=>{try{await V.from("historico_embrioes").insert([{embriao_id:a,status_anterior:t,status_novo:s,tipo_operacao:o,fazenda_id:r||null,observacoes:i||null,data_mudanca:new Date().toISOString()}])}catch{}};function jt({embrioes:a,pacotes:t,classificacoesPendentes:s,setClassificacoesPendentes:o,onSuccess:r}){const{toast:i}=Ma(),l=new Date().toISOString().split("T")[0],[d,v]=c.useState(new Set),[_,m]=c.useState(!1),[u,g]=c.useState(!1),[j,C]=c.useState(!1),[D,$]=c.useState(!1),[K,z]=c.useState(!1),[U,x]=c.useState(!1),[F,E]=c.useState(!1),[h,S]=c.useState({data_congelamento:l,localizacao_atual:""}),[N,T]=c.useState({data_descarte:l,observacoes:""}),[B,W]=c.useState({cliente_id:""}),[me,ee]=c.useState(null),[ae,de]=c.useState(null),[pe,J]=c.useState(null),[p,L]=c.useState(null),[q,X]=c.useState([]),[se,te]=c.useState([]),[he,Z]=c.useState(!1),[oe,O]=c.useState(!1),G=c.useCallback(w=>{v(b=>{const M=new Set(b);return M.has(w)?M.delete(w):M.add(w),M})},[]),xe=c.useCallback(w=>{const b=t.find(H=>H.id===w);if(!b)return;const M=b.embrioes.filter(H=>H.status_atual==="FRESCO").map(H=>H.id),y=M.every(H=>d.has(H));v(H=>{const fe=new Set(H);return y?M.forEach(f=>fe.delete(f)):M.forEach(f=>fe.add(f)),fe})},[t,d]),le=c.useCallback(()=>{v(new Set),m(!1)},[]),ze=c.useCallback(w=>d.has(w),[d]),Ae=c.useCallback(async w=>{try{Z(!0);const{data:b,error:M}=await V.from("historico_embrioes").select("*, fazenda:fazendas(nome)").eq("embriao_id",w).order("data_mudanca",{ascending:!1});if(M)throw M;te(b||[])}catch(b){i({title:"Erro ao carregar histórico",description:b instanceof Error?b.message:"Erro desconhecido",variant:"destructive"})}finally{Z(!1)}},[i]),_e=c.useCallback(async()=>{if(d.size===0){i({title:"Nenhum embrião selecionado",description:"Selecione pelo menos um embrião para congelar.",variant:"destructive"});return}if(!h.localizacao_atual.trim()){i({title:"Localização obrigatória",description:"Informe a localização de armazenamento.",variant:"destructive"});return}try{O(!0);const w=Array.from(d),{error:b}=await V.from("embrioes").update({status_atual:"CONGELADO",data_congelamento:h.data_congelamento,localizacao_atual:h.localizacao_atual.trim()}).in("id",w);if(b)throw b;for(const M of w){const y=a.find(H=>H.id===M);await Be(M,(y==null?void 0:y.status_atual)||null,"CONGELADO","CONGELAMENTO",null,`Congelado em ${h.localizacao_atual.trim()}`)}i({title:"Embriões congelados",description:`${w.length} embrião(ões) congelado(s) com sucesso.`}),g(!1),le(),S({data_congelamento:l,localizacao_atual:""}),await r()}catch(w){i({title:"Erro ao congelar embriões",description:w instanceof Error?w.message:"Erro desconhecido",variant:"destructive"})}finally{O(!1)}},[d,h,a,l,i,le,r]),we=c.useCallback(async()=>{if(d.size===0){i({title:"Nenhum embrião selecionado",description:"Selecione pelo menos um embrião para descartar.",variant:"destructive"});return}try{O(!0);const w=Array.from(d),{error:b}=await V.from("embrioes").update({status_atual:"DESCARTADO",data_descarte:N.data_descarte,observacoes:N.observacoes.trim()||null}).in("id",w);if(b)throw b;for(const M of w){const y=a.find(H=>H.id===M);await Be(M,(y==null?void 0:y.status_atual)||null,"DESCARTADO","DESCARTE",null,N.observacoes.trim()||null)}i({title:"Embriões descartados",description:`${w.length} embrião(ões) descartado(s).`}),C(!1),le(),T({data_descarte:l,observacoes:""}),await r()}catch(w){i({title:"Erro ao descartar embriões",description:w instanceof Error?w.message:"Erro desconhecido",variant:"destructive"})}finally{O(!1)}},[d,N,a,l,i,le,r]),ue=c.useCallback(async w=>{if(d.size===0){i({title:"Nenhum embrião selecionado",description:"Selecione pelo menos um embrião.",variant:"destructive"});return}if(!B.cliente_id){i({title:"Cliente não selecionado",description:"Selecione o cliente de destino.",variant:"destructive"});return}try{O(!0);const b=Array.from(d),{error:M}=await V.from("embrioes").update({cliente_id:B.cliente_id}).in("id",b);if(M)throw M;const y=w.find(H=>H.id===B.cliente_id);for(const H of b)await Be(H,null,"DIRECIONADO","DESTINACAO",null,`Direcionado para cliente: ${(y==null?void 0:y.nome)||"N/A"}`);i({title:"Embriões direcionados",description:`${b.length} embrião(ões) direcionado(s) para ${(y==null?void 0:y.nome)||"cliente"}.`}),z(!1),le(),W({cliente_id:""}),await r()}catch(b){i({title:"Erro ao direcionar embriões",description:b instanceof Error?b.message:"Erro desconhecido",variant:"destructive"})}finally{O(!1)}},[d,B,i,le,r]),re=c.useCallback(async()=>{const w=Object.entries(s);if(w.length===0){i({title:"Nenhuma classificação pendente",description:"Não há classificações para salvar."});return}try{O(!0);for(const[b,M]of w){const{error:y}=await V.from("embrioes").update({classificacao:M.toUpperCase()}).eq("id",b);if(y)throw y;await Be(b,null,M.toUpperCase(),"CLASSIFICACAO",null,`Classificado como ${M.toUpperCase()}`)}i({title:"Classificações salvas",description:`${w.length} embrião(ões) classificado(s).`}),o({}),await r()}catch(b){i({title:"Erro ao salvar classificações",description:b instanceof Error?b.message:"Erro desconhecido",variant:"destructive"})}finally{O(!1)}},[s,o,i,r]),ie=c.useCallback(async()=>{$(!1),ee(null)},[]),Te=c.useCallback(async()=>{if(ae)try{O(!0);const{error:w}=await V.from("embrioes").update({status_atual:"DESCARTADO",data_descarte:N.data_descarte,observacoes:N.observacoes.trim()||null}).eq("id",ae.id);if(w)throw w;await Be(ae.id,ae.status_atual,"DESCARTADO","DESCARTE",null,N.observacoes.trim()||null),i({title:"Embrião descartado",description:"Embrião descartado com sucesso."}),C(!1),de(null),T({data_descarte:l,observacoes:""}),await r()}catch(w){i({title:"Erro ao descartar embrião",description:w instanceof Error?w.message:"Erro desconhecido",variant:"destructive"})}finally{O(!1)}},[ae,N,l,i,r]),Oe=c.useCallback(async()=>{if(p)try{if(O(!0),await V.from("pacotes_aspiracao_fazendas_destino").delete().eq("pacote_aspiracao_id",p.pacote_info.id),q.length>0){const w=q.map(M=>({pacote_aspiracao_id:p.pacote_info.id,fazenda_destino_id:M})),{error:b}=await V.from("pacotes_aspiracao_fazendas_destino").insert(w);if(b)throw b}i({title:"Fazendas destino atualizadas",description:"As fazendas destino foram atualizadas com sucesso."}),E(!1),L(null),X([]),await r()}catch(w){i({title:"Erro ao salvar fazendas destino",description:w instanceof Error?w.message:"Erro desconhecido",variant:"destructive"})}finally{O(!1)}},[p,q,i,r]);return{embrioesSelecionados:d,setEmbrioesSelecionados:v,showAcoesEmMassa:_,setShowAcoesEmMassa:m,showCongelarDialog:u,setShowCongelarDialog:g,showDescartarDialog:j,setShowDescartarDialog:C,showClassificarDialog:D,setShowClassificarDialog:$,showDirecionarClienteDialog:K,setShowDirecionarClienteDialog:z,showHistoricoDialog:U,setShowHistoricoDialog:x,showEditarFazendasDestinoDialog:F,setShowEditarFazendasDestinoDialog:E,congelarData:h,setCongelarData:S,descartarData:N,setDescartarData:T,direcionarClienteData:B,setDirecionarClienteData:W,classificarEmbriao:me,setClassificarEmbriao:ee,descartarEmbriao:ae,setDescartarEmbriao:de,historicoEmbriao:pe,setHistoricoEmbriao:J,pacoteEditandoFazendas:p,setPacoteEditandoFazendas:L,fazendasDestinoSelecionadas:q,setFazendasDestinoSelecionadas:X,historico:se,loadingHistorico:he,submitting:oe,handleCongelarEmMassa:_e,handleDescartarEmMassa:we,handleDirecionarClienteEmMassa:ue,handleSalvarClassificacoesPendentes:re,handleClassificarEmbriao:ie,handleDescartarEmbriao:Te,loadHistorico:Ae,handleSalvarFazendasDestino:Oe,toggleEmbriaoSelecionado:G,selecionarTodosPacote:xe,limparSelecao:le,isEmbriaoSelecionado:ze}}function za({value:a,onChange:t,onSubmit:s,onCancel:o,submitting:r,buttonLabel:i}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Classificação *"}),e.jsxs(ta,{value:a,onValueChange:t,children:[e.jsx(oa,{children:e.jsx(na,{placeholder:"Selecione"})}),e.jsxs(ra,{children:[e.jsx(ge,{value:"BE",children:"BE (Blastocisto Excelente)"}),e.jsx(ge,{value:"BN",children:"BN (Blastocisto Normal)"}),e.jsx(ge,{value:"BX",children:"BX (Blastocisto Regular)"}),e.jsx(ge,{value:"BL",children:"BL (Blastocisto Limitado)"}),e.jsx(ge,{value:"BI",children:"BI (Blastocisto Irregular)"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(P,{onClick:s,className:"flex-1 bg-purple-600 hover:bg-purple-700",disabled:r,children:r?"Salvando...":i}),e.jsx(P,{variant:"outline",onClick:o,disabled:r,children:"Cancelar"})]})]})}var sa=["Enter"," "],bt=["ArrowDown","PageUp","Home"],Aa=["ArrowUp","PageDown","End"],Nt=[...bt,...Aa],Dt={ltr:[...sa,"ArrowRight"],rtl:[...sa,"ArrowLeft"]},Et={ltr:["ArrowLeft"],rtl:["ArrowRight"]},qe="Menu",[$e,Mt,St]=Fs(qe),[Ne,Ta]=ba(qe,[St,Na,Sa]),We=Na(),Oa=Sa(),[yt,De]=Ne(qe),[Rt,He]=Ne(qe),Fa=a=>{const{__scopeMenu:t,open:s=!1,children:o,dir:r,onOpenChange:i,modal:l=!0}=a,d=We(t),[v,_]=c.useState(null),m=c.useRef(!1),u=Da(i),g=Bs(r);return c.useEffect(()=>{const j=()=>{m.current=!0,document.addEventListener("pointerdown",C,{capture:!0,once:!0}),document.addEventListener("pointermove",C,{capture:!0,once:!0})},C=()=>m.current=!1;return document.addEventListener("keydown",j,{capture:!0}),()=>{document.removeEventListener("keydown",j,{capture:!0}),document.removeEventListener("pointerdown",C,{capture:!0}),document.removeEventListener("pointermove",C,{capture:!0})}},[]),e.jsx(Rs,{...d,children:e.jsx(yt,{scope:t,open:s,onOpenChange:u,content:v,onContentChange:_,children:e.jsx(Rt,{scope:t,onClose:c.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:m,dir:g,modal:l,children:o})})})};Fa.displayName=qe;var Pt="MenuAnchor",ca=c.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a,r=We(s);return e.jsx(Ps,{...r,...o,ref:t})});ca.displayName=Pt;var la="MenuPortal",[It,Ba]=Ne(la,{forceMount:void 0}),La=a=>{const{__scopeMenu:t,forceMount:s,children:o,container:r}=a,i=De(la,t);return e.jsx(It,{scope:t,forceMount:s,children:e.jsx(Ye,{present:s||i.open,children:e.jsx(Qs,{asChild:!0,container:r,children:o})})})};La.displayName=la;var ce="MenuContent",[kt,da]=Ne(ce),Ga=c.forwardRef((a,t)=>{const s=Ba(ce,a.__scopeMenu),{forceMount:o=s.forceMount,...r}=a,i=De(ce,a.__scopeMenu),l=He(ce,a.__scopeMenu);return e.jsx($e.Provider,{scope:a.__scopeMenu,children:e.jsx(Ye,{present:o||i.open,children:e.jsx($e.Slot,{scope:a.__scopeMenu,children:l.modal?e.jsx(zt,{...r,ref:t}):e.jsx(At,{...r,ref:t})})})})}),zt=c.forwardRef((a,t)=>{const s=De(ce,a.__scopeMenu),o=c.useRef(null),r=Ue(t,o);return c.useEffect(()=>{const i=o.current;if(i)return et(i)},[]),e.jsx(ua,{...a,ref:r,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:k(a.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),At=c.forwardRef((a,t)=>{const s=De(ce,a.__scopeMenu);return e.jsx(ua,{...a,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>s.onOpenChange(!1)})}),Tt=ks("MenuContent.ScrollLock"),ua=c.forwardRef((a,t)=>{const{__scopeMenu:s,loop:o=!1,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:l,disableOutsidePointerEvents:d,onEntryFocus:v,onEscapeKeyDown:_,onPointerDownOutside:m,onFocusOutside:u,onInteractOutside:g,onDismiss:j,disableOutsideScroll:C,...D}=a,$=De(ce,s),K=He(ce,s),z=We(s),U=Oa(s),x=Mt(s),[F,E]=c.useState(null),h=c.useRef(null),S=Ue(t,h,$.onContentChange),N=c.useRef(0),T=c.useRef(""),B=c.useRef(0),W=c.useRef(null),me=c.useRef("right"),ee=c.useRef(0),ae=C?st:c.Fragment,de=C?{as:Tt,allowPinchZoom:!0}:void 0,pe=p=>{var oe,O;const L=T.current+p,q=x().filter(G=>!G.disabled),X=document.activeElement,se=(oe=q.find(G=>G.ref.current===X))==null?void 0:oe.textValue,te=q.map(G=>G.textValue),he=Xt(te,L,se),Z=(O=q.find(G=>G.textValue===he))==null?void 0:O.ref.current;(function G(xe){T.current=xe,window.clearTimeout(N.current),xe!==""&&(N.current=window.setTimeout(()=>G(""),1e3))})(L),Z&&setTimeout(()=>Z.focus())};c.useEffect(()=>()=>window.clearTimeout(N.current),[]),at();const J=c.useCallback(p=>{var q,X;return me.current===((q=W.current)==null?void 0:q.side)&&Wt(p,(X=W.current)==null?void 0:X.area)},[]);return e.jsx(kt,{scope:s,searchRef:T,onItemEnter:c.useCallback(p=>{J(p)&&p.preventDefault()},[J]),onItemLeave:c.useCallback(p=>{var L;J(p)||((L=h.current)==null||L.focus(),E(null))},[J]),onTriggerLeave:c.useCallback(p=>{J(p)&&p.preventDefault()},[J]),pointerGraceTimerRef:B,onPointerGraceIntentChange:c.useCallback(p=>{W.current=p},[]),children:e.jsx(ae,{...de,children:e.jsx(tt,{asChild:!0,trapped:r,onMountAutoFocus:k(i,p=>{var L;p.preventDefault(),(L=h.current)==null||L.focus({preventScroll:!0})}),onUnmountAutoFocus:l,children:e.jsx(zs,{asChild:!0,disableOutsidePointerEvents:d,onEscapeKeyDown:_,onPointerDownOutside:m,onFocusOutside:u,onInteractOutside:g,onDismiss:j,children:e.jsx(rt,{asChild:!0,...U,dir:K.dir,orientation:"vertical",loop:o,currentTabStopId:F,onCurrentTabStopIdChange:E,onEntryFocus:k(v,p=>{K.isUsingKeyboardRef.current||p.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(As,{role:"menu","aria-orientation":"vertical","data-state":ts($.open),"data-radix-menu-content":"",dir:K.dir,...z,...D,ref:S,style:{outline:"none",...D.style},onKeyDown:k(D.onKeyDown,p=>{const q=p.target.closest("[data-radix-menu-content]")===p.currentTarget,X=p.ctrlKey||p.altKey||p.metaKey,se=p.key.length===1;q&&(p.key==="Tab"&&p.preventDefault(),!X&&se&&pe(p.key));const te=h.current;if(p.target!==te||!Nt.includes(p.key))return;p.preventDefault();const Z=x().filter(oe=>!oe.disabled).map(oe=>oe.ref.current);Aa.includes(p.key)&&Z.reverse(),Ht(Z)}),onBlur:k(a.onBlur,p=>{p.currentTarget.contains(p.target)||(window.clearTimeout(N.current),T.current="")}),onPointerMove:k(a.onPointerMove,Ke(p=>{const L=p.target,q=ee.current!==p.clientX;if(p.currentTarget.contains(L)&&q){const X=p.clientX>ee.current?"right":"left";me.current=X,ee.current=p.clientX}}))})})})})})})});Ga.displayName=ce;var Ot="MenuGroup",fa=c.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a;return e.jsx(ye.div,{role:"group",...o,ref:t})});fa.displayName=Ot;var Ft="MenuLabel",$a=c.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a;return e.jsx(ye.div,{...o,ref:t})});$a.displayName=Ft;var Ve="MenuItem",ja="menu.itemSelect",Je=c.forwardRef((a,t)=>{const{disabled:s=!1,onSelect:o,...r}=a,i=c.useRef(null),l=He(Ve,a.__scopeMenu),d=da(Ve,a.__scopeMenu),v=Ue(t,i),_=c.useRef(!1),m=()=>{const u=i.current;if(!s&&u){const g=new CustomEvent(ja,{bubbles:!0,cancelable:!0});u.addEventListener(ja,j=>o==null?void 0:o(j),{once:!0}),Is(u,g),g.defaultPrevented?_.current=!1:l.onClose()}};return e.jsx(Ka,{...r,ref:v,disabled:s,onClick:k(a.onClick,m),onPointerDown:u=>{var g;(g=a.onPointerDown)==null||g.call(a,u),_.current=!0},onPointerUp:k(a.onPointerUp,u=>{var g;_.current||(g=u.currentTarget)==null||g.click()}),onKeyDown:k(a.onKeyDown,u=>{const g=d.searchRef.current!=="";s||g&&u.key===" "||sa.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});Je.displayName=Ve;var Ka=c.forwardRef((a,t)=>{const{__scopeMenu:s,disabled:o=!1,textValue:r,...i}=a,l=da(Ve,s),d=Oa(s),v=c.useRef(null),_=Ue(t,v),[m,u]=c.useState(!1),[g,j]=c.useState("");return c.useEffect(()=>{const C=v.current;C&&j((C.textContent??"").trim())},[i.children]),e.jsx($e.ItemSlot,{scope:s,disabled:o,textValue:r??g,children:e.jsx(nt,{asChild:!0,...d,focusable:!o,children:e.jsx(ye.div,{role:"menuitem","data-highlighted":m?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...i,ref:_,onPointerMove:k(a.onPointerMove,Ke(C=>{o?l.onItemLeave(C):(l.onItemEnter(C),C.defaultPrevented||C.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:k(a.onPointerLeave,Ke(C=>l.onItemLeave(C))),onFocus:k(a.onFocus,()=>u(!0)),onBlur:k(a.onBlur,()=>u(!1))})})})}),Bt="MenuCheckboxItem",Ua=c.forwardRef((a,t)=>{const{checked:s=!1,onCheckedChange:o,...r}=a;return e.jsx(Ya,{scope:a.__scopeMenu,checked:s,children:e.jsx(Je,{role:"menuitemcheckbox","aria-checked":Xe(s)?"mixed":s,...r,ref:t,"data-state":pa(s),onSelect:k(r.onSelect,()=>o==null?void 0:o(Xe(s)?!0:!s),{checkForDefaultPrevented:!1})})})});Ua.displayName=Bt;var qa="MenuRadioGroup",[Lt,Gt]=Ne(qa,{value:void 0,onValueChange:()=>{}}),Ha=c.forwardRef((a,t)=>{const{value:s,onValueChange:o,...r}=a,i=Da(o);return e.jsx(Lt,{scope:a.__scopeMenu,value:s,onValueChange:i,children:e.jsx(fa,{...r,ref:t})})});Ha.displayName=qa;var Va="MenuRadioItem",Xa=c.forwardRef((a,t)=>{const{value:s,...o}=a,r=Gt(Va,a.__scopeMenu),i=s===r.value;return e.jsx(Ya,{scope:a.__scopeMenu,checked:i,children:e.jsx(Je,{role:"menuitemradio","aria-checked":i,...o,ref:t,"data-state":pa(i),onSelect:k(o.onSelect,()=>{var l;return(l=r.onValueChange)==null?void 0:l.call(r,s)},{checkForDefaultPrevented:!1})})})});Xa.displayName=Va;var ma="MenuItemIndicator",[Ya,$t]=Ne(ma,{checked:!1}),Wa=c.forwardRef((a,t)=>{const{__scopeMenu:s,forceMount:o,...r}=a,i=$t(ma,s);return e.jsx(Ye,{present:o||Xe(i.checked)||i.checked===!0,children:e.jsx(ye.span,{...r,ref:t,"data-state":pa(i.checked)})})});Wa.displayName=ma;var Kt="MenuSeparator",Ja=c.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a;return e.jsx(ye.div,{role:"separator","aria-orientation":"horizontal",...o,ref:t})});Ja.displayName=Kt;var Ut="MenuArrow",Za=c.forwardRef((a,t)=>{const{__scopeMenu:s,...o}=a,r=We(s);return e.jsx(Ts,{...r,...o,ref:t})});Za.displayName=Ut;var qt="MenuSub",[Dn,Qa]=Ne(qt),Le="MenuSubTrigger",es=c.forwardRef((a,t)=>{const s=De(Le,a.__scopeMenu),o=He(Le,a.__scopeMenu),r=Qa(Le,a.__scopeMenu),i=da(Le,a.__scopeMenu),l=c.useRef(null),{pointerGraceTimerRef:d,onPointerGraceIntentChange:v}=i,_={__scopeMenu:a.__scopeMenu},m=c.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return c.useEffect(()=>m,[m]),c.useEffect(()=>{const u=d.current;return()=>{window.clearTimeout(u),v(null)}},[d,v]),e.jsx(ca,{asChild:!0,..._,children:e.jsx(Ka,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":r.contentId,"data-state":ts(s.open),...a,ref:Ea(t,r.onTriggerChange),onClick:u=>{var g;(g=a.onClick)==null||g.call(a,u),!(a.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),s.open||s.onOpenChange(!0))},onPointerMove:k(a.onPointerMove,Ke(u=>{i.onItemEnter(u),!u.defaultPrevented&&!a.disabled&&!s.open&&!l.current&&(i.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{s.onOpenChange(!0),m()},100))})),onPointerLeave:k(a.onPointerLeave,Ke(u=>{var j,C;m();const g=(j=s.content)==null?void 0:j.getBoundingClientRect();if(g){const D=(C=s.content)==null?void 0:C.dataset.side,$=D==="right",K=$?-5:5,z=g[$?"left":"right"],U=g[$?"right":"left"];i.onPointerGraceIntentChange({area:[{x:u.clientX+K,y:u.clientY},{x:z,y:g.top},{x:U,y:g.top},{x:U,y:g.bottom},{x:z,y:g.bottom}],side:D}),window.clearTimeout(d.current),d.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(u),u.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:k(a.onKeyDown,u=>{var j;const g=i.searchRef.current!=="";a.disabled||g&&u.key===" "||Dt[o.dir].includes(u.key)&&(s.onOpenChange(!0),(j=s.content)==null||j.focus(),u.preventDefault())})})})});es.displayName=Le;var as="MenuSubContent",ss=c.forwardRef((a,t)=>{const s=Ba(ce,a.__scopeMenu),{forceMount:o=s.forceMount,...r}=a,i=De(ce,a.__scopeMenu),l=He(ce,a.__scopeMenu),d=Qa(as,a.__scopeMenu),v=c.useRef(null),_=Ue(t,v);return e.jsx($e.Provider,{scope:a.__scopeMenu,children:e.jsx(Ye,{present:o||i.open,children:e.jsx($e.Slot,{scope:a.__scopeMenu,children:e.jsx(ua,{id:d.contentId,"aria-labelledby":d.triggerId,...r,ref:_,align:"start",side:l.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:m=>{var u;l.isUsingKeyboardRef.current&&((u=v.current)==null||u.focus()),m.preventDefault()},onCloseAutoFocus:m=>m.preventDefault(),onFocusOutside:k(a.onFocusOutside,m=>{m.target!==d.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:k(a.onEscapeKeyDown,m=>{l.onClose(),m.preventDefault()}),onKeyDown:k(a.onKeyDown,m=>{var j;const u=m.currentTarget.contains(m.target),g=Et[l.dir].includes(m.key);u&&g&&(i.onOpenChange(!1),(j=d.trigger)==null||j.focus(),m.preventDefault())})})})})})});ss.displayName=as;function ts(a){return a?"open":"closed"}function Xe(a){return a==="indeterminate"}function pa(a){return Xe(a)?"indeterminate":a?"checked":"unchecked"}function Ht(a){const t=document.activeElement;for(const s of a)if(s===t||(s.focus(),document.activeElement!==t))return}function Vt(a,t){return a.map((s,o)=>a[(t+o)%a.length])}function Xt(a,t,s){const r=t.length>1&&Array.from(t).every(_=>_===t[0])?t[0]:t,i=s?a.indexOf(s):-1;let l=Vt(a,Math.max(i,0));r.length===1&&(l=l.filter(_=>_!==s));const v=l.find(_=>_.toLowerCase().startsWith(r.toLowerCase()));return v!==s?v:void 0}function Yt(a,t){const{x:s,y:o}=a;let r=!1;for(let i=0,l=t.length-1;i<t.length;l=i++){const d=t[i],v=t[l],_=d.x,m=d.y,u=v.x,g=v.y;m>o!=g>o&&s<(u-_)*(o-m)/(g-m)+_&&(r=!r)}return r}function Wt(a,t){if(!t)return!1;const s={x:a.clientX,y:a.clientY};return Yt(s,t)}function Ke(a){return t=>t.pointerType==="mouse"?a(t):void 0}var Jt=Fa,Zt=ca,Qt=La,eo=Ga,ao=fa,so=$a,to=Je,oo=Ua,no=Ha,ro=Xa,io=Wa,co=Ja,lo=Za,uo=es,fo=ss,Ze="DropdownMenu",[mo,En]=ba(Ze,[Ta]),Q=Ta(),[po,os]=mo(Ze),ns=a=>{const{__scopeDropdownMenu:t,children:s,dir:o,open:r,defaultOpen:i,onOpenChange:l,modal:d=!0}=a,v=Q(t),_=c.useRef(null),[m,u]=ot({prop:r,defaultProp:i??!1,onChange:l,caller:Ze});return e.jsx(po,{scope:t,triggerId:xa(),triggerRef:_,contentId:xa(),open:m,onOpenChange:u,onOpenToggle:c.useCallback(()=>u(g=>!g),[u]),modal:d,children:e.jsx(Jt,{...v,open:m,onOpenChange:u,dir:o,modal:d,children:s})})};ns.displayName=Ze;var rs="DropdownMenuTrigger",is=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,disabled:o=!1,...r}=a,i=os(rs,s),l=Q(s);return e.jsx(Zt,{asChild:!0,...l,children:e.jsx(ye.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":o?"":void 0,disabled:o,...r,ref:Ea(t,i.triggerRef),onPointerDown:k(a.onPointerDown,d=>{!o&&d.button===0&&d.ctrlKey===!1&&(i.onOpenToggle(),i.open||d.preventDefault())}),onKeyDown:k(a.onKeyDown,d=>{o||(["Enter"," "].includes(d.key)&&i.onOpenToggle(),d.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(d.key)&&d.preventDefault())})})})});is.displayName=rs;var ho="DropdownMenuPortal",cs=a=>{const{__scopeDropdownMenu:t,...s}=a,o=Q(t);return e.jsx(Qt,{...o,...s})};cs.displayName=ho;var ls="DropdownMenuContent",ds=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=os(ls,s),i=Q(s),l=c.useRef(!1);return e.jsx(eo,{id:r.contentId,"aria-labelledby":r.triggerId,...i,...o,ref:t,onCloseAutoFocus:k(a.onCloseAutoFocus,d=>{var v;l.current||(v=r.triggerRef.current)==null||v.focus(),l.current=!1,d.preventDefault()}),onInteractOutside:k(a.onInteractOutside,d=>{const v=d.detail.originalEvent,_=v.button===0&&v.ctrlKey===!0,m=v.button===2||_;(!r.modal||m)&&(l.current=!0)}),style:{...a.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});ds.displayName=ls;var xo="DropdownMenuGroup",go=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(ao,{...r,...o,ref:t})});go.displayName=xo;var vo="DropdownMenuLabel",us=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(so,{...r,...o,ref:t})});us.displayName=vo;var _o="DropdownMenuItem",fs=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(to,{...r,...o,ref:t})});fs.displayName=_o;var wo="DropdownMenuCheckboxItem",ms=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(oo,{...r,...o,ref:t})});ms.displayName=wo;var Co="DropdownMenuRadioGroup",jo=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(no,{...r,...o,ref:t})});jo.displayName=Co;var bo="DropdownMenuRadioItem",ps=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(ro,{...r,...o,ref:t})});ps.displayName=bo;var No="DropdownMenuItemIndicator",hs=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(io,{...r,...o,ref:t})});hs.displayName=No;var Do="DropdownMenuSeparator",xs=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(co,{...r,...o,ref:t})});xs.displayName=Do;var Eo="DropdownMenuArrow",Mo=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(lo,{...r,...o,ref:t})});Mo.displayName=Eo;var So="DropdownMenuSubTrigger",gs=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(uo,{...r,...o,ref:t})});gs.displayName=So;var yo="DropdownMenuSubContent",vs=c.forwardRef((a,t)=>{const{__scopeDropdownMenu:s,...o}=a,r=Q(s);return e.jsx(fo,{...r,...o,ref:t,style:{...a.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});vs.displayName=yo;var Ro=ns,Po=is,Io=cs,_s=ds,ws=us,Cs=fs,js=ms,bs=ps,Ns=hs,Ds=xs,Es=gs,Ms=vs;const ko=Ro,zo=Po,Ao=c.forwardRef(({className:a,inset:t,children:s,...o},r)=>e.jsxs(Es,{ref:r,className:ve("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",a),...o,children:[s,e.jsx(ya,{className:"ml-auto h-4 w-4"})]}));Ao.displayName=Es.displayName;const To=c.forwardRef(({className:a,...t},s)=>e.jsx(Ms,{ref:s,className:ve("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));To.displayName=Ms.displayName;const Ss=c.forwardRef(({className:a,sideOffset:t=4,...s},o)=>e.jsx(Io,{children:e.jsx(_s,{ref:o,sideOffset:t,className:ve("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})}));Ss.displayName=_s.displayName;const Ge=c.forwardRef(({className:a,inset:t,...s},o)=>e.jsx(Cs,{ref:o,className:ve("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",a),...s}));Ge.displayName=Cs.displayName;const Oo=c.forwardRef(({className:a,children:t,checked:s,...o},r)=>e.jsxs(js,{ref:r,className:ve("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ns,{children:e.jsx(ea,{className:"h-4 w-4"})})}),t]}));Oo.displayName=js.displayName;const Fo=c.forwardRef(({className:a,children:t,...s},o)=>e.jsxs(bs,{ref:o,className:ve("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ns,{children:e.jsx(xt,{className:"h-2 w-2 fill-current"})})}),t]}));Fo.displayName=bs.displayName;const Bo=c.forwardRef(({className:a,inset:t,...s},o)=>e.jsx(ws,{ref:o,className:ve("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",a),...s}));Bo.displayName=ws.displayName;const ys=c.forwardRef(({className:a,...t},s)=>e.jsx(Ds,{ref:s,className:ve("-mx-1 my-1 h-px bg-muted",a),...t}));ys.displayName=Ds.displayName;function Lo({pacote:a,embrioesSelecionados:t,paginaAtual:s,pageSize:o,totalSelecionados:r,getClassificacaoAtual:i,onToggleSelecionarEmbriao:l,onSelecionarTodosDaPagina:d,onSetPagina:v,onClassificar:_,onCongelar:m,onDirecionar:u,onDescartar:g}){const j=[...a.embrioes].sort((x,F)=>{const E=x.identificacao||"",h=F.identificacao||"";return E&&h?E.localeCompare(h):E&&!h?-1:!E&&h?1:(x.created_at||"").localeCompare(F.created_at||"")}),C=Math.max(1,Math.ceil(j.length/o)),D=Math.min(s,C),$=(D-1)*o,K=j.slice($,$+o),z=K.every(x=>t.has(x.id)),U=K.some(x=>t.has(x.id));return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 pb-2 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>d(K),className:"h-8 px-2",children:[z?e.jsx(va,{className:"w-4 h-4 text-green-600"}):e.jsx(_a,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"ml-2 text-xs",children:z?"Desmarcar":"Selecionar página"})]}),(U||r>0)&&e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded",children:[K.filter(x=>t.has(x.id)).length," selecionados"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsxs("span",{children:[j.length," embriões"]}),e.jsx("span",{className:"mx-1",children:"•"}),e.jsxs("span",{children:["Pág. ",D,"/",C]})]})]}),e.jsx("div",{className:"grid gap-2",children:K.map((x,F)=>{const E=t.has(x.id),h=i(x),S=x.status_atual==="FRESCO",N=x.status_atual==="CONGELADO";return e.jsxs("div",{className:`
                group relative flex flex-col sm:flex-row sm:items-center gap-3 p-3 rounded-lg border transition-all
                ${E?"bg-green-50 border-green-200 shadow-sm":"bg-white border-slate-200 hover:border-slate-300 hover:shadow-sm"}
              `,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:()=>l(x.id),className:"flex-shrink-0 p-1 rounded hover:bg-slate-100",children:E?e.jsx(va,{className:"w-5 h-5 text-green-600"}):e.jsx(_a,{className:"w-5 h-5 text-slate-300 group-hover:text-slate-400"})}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[x.identificacao?e.jsx("span",{className:"font-mono text-sm font-medium text-slate-800 truncate",children:x.identificacao}):e.jsx("span",{className:"text-sm text-amber-600 italic",title:"Embrião sem código de rastreabilidade",children:"Sem código"}),e.jsxs("span",{className:"text-xs text-slate-500 sm:hidden",children:[x.doadora_registro||"-"," × ",x.touro_nome||"-"]})]})]}),e.jsx("div",{className:"hidden sm:flex flex-1 items-center gap-4 min-w-0",children:e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-slate-600 truncate",title:x.doadora_registro||"-",children:x.doadora_registro||"-"}),e.jsx("span",{className:"text-slate-400",children:"×"}),e.jsx("span",{className:"text-slate-600 truncate",title:x.touro_nome||"-",children:x.touro_nome||"-"})]})})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap sm:flex-nowrap",children:[h?e.jsx(Me,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-200 text-xs",children:h}):e.jsx(Me,{variant:"outline",className:"text-slate-400 border-dashed text-xs",children:"Sem classificação"}),e.jsx(ct,{status:x.status_atual}),x.localizacao_atual&&e.jsx(Me,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200 text-xs hidden lg:inline-flex",children:x.localizacao_atual})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:ml-2",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>_(x),className:"h-8 w-8 p-0 text-purple-600 hover:text-purple-700 hover:bg-purple-50",title:"Classificar",children:e.jsx(aa,{className:"w-4 h-4"})}),S&&h&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>m(x),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Congelar",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsxs(ko,{children:[e.jsx(zo,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-slate-500 hover:text-slate-700",children:e.jsx(gt,{className:"w-4 h-4"})})}),e.jsxs(Ss,{align:"end",className:"w-48",children:[e.jsxs(Ge,{onClick:()=>_(x),children:[e.jsx(aa,{className:"w-4 h-4 mr-2 text-purple-600"}),"Classificar"]}),S&&e.jsxs(Ge,{onClick:()=>m(x),disabled:!h,className:h?"":"opacity-50",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2 text-blue-600"}),"Congelar",!h&&e.jsx("span",{className:"ml-auto text-xs text-slate-400",children:"Classificar primeiro"})]}),N&&!x.cliente_id&&e.jsxs(Ge,{onClick:()=>u(x),children:[e.jsx(Ra,{className:"w-4 h-4 mr-2 text-green-600"}),"Direcionar para cliente"]}),e.jsx(ys,{}),e.jsxs(Ge,{onClick:()=>g(x),className:"text-red-600 focus:text-red-600 focus:bg-red-50",children:[e.jsx(Pa,{className:"w-4 h-4 mr-2"}),"Descartar"]})]})]})]})]},x.id)})}),C>1&&e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:["Mostrando ",$+1,"-",Math.min($+o,j.length)," de ",j.length]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{variant:"outline",size:"sm",onClick:()=>v(Math.max(1,D-1)),disabled:D===1,className:"h-8 w-8 p-0",children:e.jsx(lt,{className:"w-4 h-4"})}),e.jsx("div",{className:"hidden sm:flex items-center gap-1",children:Array.from({length:Math.min(5,C)},(x,F)=>{let E;return C<=5||D<=3?E=F+1:D>=C-2?E=C-4+F:E=D-2+F,e.jsx(P,{variant:D===E?"default":"ghost",size:"sm",onClick:()=>v(E),className:"h-8 w-8 p-0 text-xs",children:E},E)})}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>v(Math.min(C,D+1)),disabled:D===C,className:"h-8 w-8 p-0",children:e.jsx(ya,{className:"w-4 h-4"})})]})]})]})}function Go({pacote:a,expandido:t,onToggleExpandir:s,onEditarFazendasDestino:o,onDespachar:r,resumoPacote:i,embrioesSelecionados:l,paginaAtual:d,pageSize:v,getClassificacaoAtual:_,onToggleSelecionarEmbriao:m,onSelecionarTodosDaPagina:u,onSetPagina:g,onClassificar:j,onCongelar:C,onDirecionar:D,onDescartar:$}){const K=a.embrioes.filter(S=>l.has(S.id)).length,z=wt(a.data_fecundacao),U=z===7,x=z===8,F=z!==null&&z>8;let E="from-green-500",h="bg-green-50";return x&&(E="from-orange-500",h="bg-orange-50"),F&&(E="from-red-500",h="bg-red-50"),e.jsxs(Us,{className:"overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:`h-1 bg-gradient-to-r ${E} to-transparent`}),e.jsx(qs,{className:"pb-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:s,className:"flex-shrink-0 p-1 rounded-md hover:bg-slate-100 transition-colors mt-0.5",children:t?e.jsx(Ls,{className:"w-5 h-5 text-slate-500"}):e.jsx(Gs,{className:"w-5 h-5 text-slate-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold text-slate-800",children:a.pacote_info.fazenda_nome||"Fazenda não identificada"}),e.jsx("span",{className:"text-slate-400",children:"→"}),a.fazendas_destino_nomes.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.fazendas_destino_nomes.map((S,N)=>e.jsxs(Me,{variant:"secondary",className:"text-xs font-normal",children:[e.jsx(dt,{className:"w-3 h-3 mr-1"}),S]},N)),e.jsx(P,{variant:"ghost",size:"sm",onClick:o,className:"h-6 w-6 p-0 text-slate-400 hover:text-slate-600",title:"Editar fazendas destino",children:e.jsx(vt,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Sem destino definido"}),e.jsx(P,{variant:"ghost",size:"sm",onClick:o,className:"h-6 px-2 text-xs text-blue-600 hover:text-blue-700",children:"Definir"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-xs text-slate-500",children:[a.data_despacho&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(it,{className:"w-3 h-3"}),"Despacho: ",Zs(a.data_despacho)]}),z!==null&&a.frescos>0&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full ${h}`,children:[U&&e.jsxs(e.Fragment,{children:[e.jsx(ea,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"D7 - Ideal"})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx(ga,{className:"w-3 h-3 text-orange-600 animate-pulse"}),e.jsx("span",{className:"text-orange-700 font-medium",children:"D8 - Último dia!"})]}),F&&e.jsxs(e.Fragment,{children:[e.jsx(ga,{className:"w-3 h-3 text-red-600"}),e.jsxs("span",{className:"text-red-700 font-medium",children:["D",z," - Vencido"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 lg:gap-6 pl-9 lg:pl-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.total}),e.jsx("div",{className:"text-xs text-slate-500",children:"embriões"})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"}),e.jsxs("span",{className:"text-slate-600",children:[a.frescos," frescos"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsxs("span",{className:"text-slate-600",children:[a.congelados," congelados"]})]}),i.semClassificacao>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-slate-300"}),e.jsxs("span",{className:"text-slate-500",children:[i.semClassificacao," sem classif."]})]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 min-w-[160px]",children:i.todosClassificados?e.jsxs(e.Fragment,{children:[e.jsxs(Me,{variant:"outline",className:"justify-center bg-green-50 text-green-700 border-green-200",children:[e.jsx(ea,{className:"w-3 h-3 mr-1"}),"Todos classificados"]}),a.disponivel_para_transferencia?e.jsxs(Me,{variant:"outline",className:"justify-center bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(wa,{className:"w-3 h-3 mr-1"}),"Pronto para transferência"]}):e.jsxs(P,{size:"sm",onClick:r,className:"bg-green-600 hover:bg-green-700 text-white h-8",children:[e.jsx(wa,{className:"w-4 h-4 mr-2"}),"Despachar"]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-600 px-1",children:[e.jsx("span",{children:"Classificação"}),e.jsxs("span",{className:"font-medium",children:[i.total-i.semClassificacao,"/",i.total]})]}),e.jsx("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-amber-500 rounded-full transition-all",style:{width:`${(i.total-i.semClassificacao)/i.total*100}%`}})})]})})]})]})}),t&&e.jsx(Hs,{className:"pt-4",children:e.jsx("div",{className:"border-t pt-4",children:e.jsx(Lo,{pacote:a,embrioesSelecionados:l,paginaAtual:d,pageSize:v,totalSelecionados:K,getClassificacaoAtual:_,onToggleSelecionarEmbriao:m,onSelecionarTodosDaPagina:u,onSetPagina:g,onClassificar:j,onCongelar:C,onDirecionar:D,onDescartar:$})})})]})}function $o({selectedCount:a,onClassificar:t,onCongelar:s,onDirecionar:o,onDescartar:r,onCancelar:i}){return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 animate-in slide-in-from-bottom-5 duration-300",children:e.jsx("div",{className:"bg-white border-t shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 text-green-700 px-3 py-1.5 rounded-full",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium text-sm",children:[a," selecionado(s)"]})]}),e.jsxs(P,{variant:"ghost",size:"sm",onClick:i,className:"text-slate-500 hover:text-slate-700 h-8",children:[e.jsx(ft,{className:"w-4 h-4 mr-1"}),"Limpar"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:t,className:"h-9 border-purple-200 text-purple-700 hover:bg-purple-50 hover:text-purple-800",children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),"Classificar"]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:s,className:"h-9 border-blue-200 text-blue-700 hover:bg-blue-50 hover:text-blue-800",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Congelar"]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:o,className:"h-9 border-green-200 text-green-700 hover:bg-green-50 hover:text-green-800",children:[e.jsx(Ra,{className:"w-4 h-4 mr-2"}),"Direcionar"]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:r,className:"h-9 border-red-200 text-red-700 hover:bg-red-50 hover:text-red-800",children:[e.jsx(Pa,{className:"w-4 h-4 mr-2"}),"Descartar"]})]})]})})})})}function Ko({open:a,onOpenChange:t,embriao:s,classificacao:o,onClassificacaoChange:r,onSubmit:i,submitting:l}){return e.jsx(Re,{open:a,onOpenChange:t,children:e.jsxs(Pe,{className:"max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"Classificar Embrião"}),e.jsx(ia,{children:(s==null?void 0:s.identificacao)||"Embrião selecionado"})]}),e.jsx(za,{value:o,onChange:r,onSubmit:i,onCancel:()=>t(!1),submitting:l,buttonLabel:"Salvar Classificação"})]})})}function Uo({open:a,onOpenChange:t,count:s,classificacao:o,onClassificacaoChange:r,onSubmit:i,submitting:l}){return e.jsx(Re,{open:a,onOpenChange:t,children:e.jsxs(Pe,{className:"max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(ke,{children:["Classificar ",s," Embrião(ões)"]}),e.jsx(ia,{children:"Mesma classificação para todos"})]}),e.jsx(za,{value:o,onChange:r,onSubmit:i,onCancel:()=>t(!1),submitting:l,buttonLabel:`Classificar ${s}`})]})})}function qo({open:a,onOpenChange:t,count:s,data:o,onDataChange:r,onSubmit:i,submitting:l}){return e.jsx(Re,{open:a,onOpenChange:t,children:e.jsxs(Pe,{className:"max-w-md",children:[e.jsx(Ie,{children:e.jsxs(ke,{children:["Congelar ",s," Embrião(ões)"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Data de Congelamento *"}),e.jsx(Ia,{value:o.data_congelamento,onChange:d=>r({...o,data_congelamento:d||""}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Localização (Botijão) *"}),e.jsx(pt,{value:o.localizacao_atual,onChange:d=>r({...o,localizacao_atual:d.target.value}),placeholder:"Ex: Botijão 1, Canister A"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(P,{onClick:i,className:"flex-1 bg-blue-600 hover:bg-blue-700",disabled:l,children:l?"Congelando...":"Congelar"}),e.jsx(P,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"})]})]})]})})}function Ho({open:a,onOpenChange:t,count:s,data:o,onDataChange:r,onSubmit:i,submitting:l}){return e.jsx(Re,{open:a,onOpenChange:t,children:e.jsxs(Pe,{className:"max-w-md",children:[e.jsx(Ie,{children:e.jsxs(ke,{children:["Descartar ",s," Embrião(ões)"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Data de Descarte *"}),e.jsx(Ia,{value:o.data_descarte,onChange:d=>r({...o,data_descarte:d||""}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Observações / Motivo"}),e.jsx(ht,{value:o.observacoes,onChange:d=>r({...o,observacoes:d.target.value}),placeholder:"Motivo do descarte (opcional)",rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(P,{onClick:i,className:"flex-1 bg-red-600 hover:bg-red-700",disabled:l,children:l?"Descartando...":"Descartar"}),e.jsx(P,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"})]})]})]})})}function Vo({open:a,onOpenChange:t,clientes:s,data:o,onDataChange:r,onSubmit:i,submitting:l}){return e.jsx(Re,{open:a,onOpenChange:t,children:e.jsxs(Pe,{className:"max-w-md",children:[e.jsx(Ie,{children:e.jsx(ke,{children:"Direcionar para Cliente"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{children:"Cliente *"}),e.jsxs(ta,{value:o.cliente_id,onValueChange:d=>r({cliente_id:d}),children:[e.jsx(oa,{children:e.jsx(na,{placeholder:"Selecione o cliente"})}),e.jsx(ra,{children:s.map(d=>e.jsx(ge,{value:d.id,children:d.nome},d.id))})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(P,{onClick:i,className:"flex-1 bg-green-600 hover:bg-green-700",disabled:l,children:l?"Direcionando...":"Direcionar"}),e.jsx(P,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"})]})]})]})})}function Xo({open:a,onOpenChange:t,pacote:s,fazendas:o,fazendasSelecionadas:r,onFazendasChange:i,onSubmit:l,submitting:d}){const v=(_,m)=>{i(m?[...r,_]:r.filter(u=>u!==_))};return e.jsx(Re,{open:a,onOpenChange:t,children:e.jsxs(Pe,{className:"max-w-md",children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"Editar Fazendas Destino"}),e.jsx(ia,{children:"Selecione as fazendas destino do pacote"})]}),s&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto border rounded-md p-3",children:o.map(_=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-slate-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:r.includes(_.id),onChange:m=>v(_.id,m.target.checked),className:"rounded border-slate-300"}),e.jsx("span",{className:"text-sm",children:_.nome})]},_.id))})}),e.jsxs(mt,{children:[e.jsx(P,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),e.jsx(P,{onClick:l,disabled:d,children:d?"Salvando...":"Salvar"})]})]})})}function Mn(){const{toast:a}=Ma(),{embrioes:t,pacotes:s,fazendas:o,clientes:r,loading:i,selectedFazendaDestinoId:l,setSelectedFazendaDestinoId:d,paginasPacotes:v,setPaginasPacotes:_,pageSize:m,loadData:u,loadFazendas:g,loadClientes:j,reloadData:C,getClassificacaoAtual:D,getResumoPacote:$,classificacoesPendentes:K,setClassificacoesPendentes:z}=Ct(),{embrioesSelecionados:U,setEmbrioesSelecionados:x,showAcoesEmMassa:F,setShowAcoesEmMassa:E,showCongelarDialog:h,setShowCongelarDialog:S,showDescartarDialog:N,setShowDescartarDialog:T,showClassificarDialog:B,setShowClassificarDialog:W,showDirecionarClienteDialog:me,setShowDirecionarClienteDialog:ee,showEditarFazendasDestinoDialog:ae,setShowEditarFazendasDestinoDialog:de,congelarData:pe,setCongelarData:J,descartarData:p,setDescartarData:L,direcionarClienteData:q,setDirecionarClienteData:X,classificarEmbriao:se,setClassificarEmbriao:te,pacoteEditandoFazendas:he,setPacoteEditandoFazendas:Z,fazendasDestinoSelecionadas:oe,setFazendasDestinoSelecionadas:O,submitting:G,handleCongelarEmMassa:xe,handleDescartarEmMassa:le,handleDirecionarClienteEmMassa:ze,handleSalvarFazendasDestino:Ae,limparSelecao:_e}=jt({embrioes:t,pacotes:s,classificacoesPendentes:K,setClassificacoesPendentes:z,onSuccess:C}),[we,ue]=c.useState(new Set),[re,ie]=c.useState({classificacao:""});c.useEffect(()=>{g(),j()},[g,j]),c.useEffect(()=>{u()},[l,u]);const Te=f=>{ue(A=>{const n=new Set(A);return n.has(f)?n.delete(f):n.add(f),n})},Oe=f=>{x(A=>{const n=new Set(A);return n.has(f)?n.delete(f):n.add(f),E(n.size>0),n})},w=f=>{x(A=>{const n=new Set(A);return f.every(I=>n.has(I.id))?f.forEach(I=>n.delete(I.id)):f.forEach(I=>n.add(I.id)),E(n.size>0),n})},b=f=>v[f]??1,M=(f,A)=>{_(n=>({...n,[f]:A}))},y=()=>{if(!se||!re.classificacao){a({title:"Erro de validação",description:"Classificação é obrigatória",variant:"destructive"});return}z(f=>({...f,[se.id]:re.classificacao})),a({title:"Classificação pendente",description:'Use "Despachar para o campo" para salvar.'}),W(!1),te(null),ie({classificacao:""}),_e()},H=()=>{if(U.size===0||!re.classificacao){a({title:"Erro de validação",description:"Selecione embriões e classificação",variant:"destructive"});return}const f=Array.from(U);z(A=>{const n={...A};return f.forEach(R=>{n[R]=re.classificacao}),n}),a({title:"Classificações pendentes",description:'Use "Despachar para o campo" para salvar.'}),W(!1),ie({classificacao:""}),_e()},fe=async f=>{if(!$(f).todosClassificados){a({title:"Classificação pendente",description:"Classifique todos os embriões antes de despachar.",variant:"destructive"});return}try{const n=new Date().toISOString().split("T")[0],R=f.embrioes.filter(I=>{const Y=D(I);return Y&&Y!==(I.classificacao||"").trim()});R.length>0&&await Promise.all(R.map(I=>V.from("embrioes").update({classificacao:D(I),data_classificacao:n}).eq("id",I.id))),await V.from("lotes_fiv").update({disponivel_para_transferencia:!0}).eq("id",f.lote_fiv_id),a({title:"Pacote despachado",description:"Disponível para transferência."}),z(I=>{const Y={...I};return R.forEach(Ce=>delete Y[Ce.id]),Y}),await C()}catch(n){a({title:"Erro ao despachar",description:n instanceof Error?n.message:"Erro desconhecido",variant:"destructive"})}};return i?e.jsx(Os,{}):e.jsxs("div",{className:`space-y-6 ${F?"pb-24":""}`,children:[e.jsx($s,{title:"Estoque de Embriões",description:"Gerenciar pacotes de embriões para transferência, congelamento ou descarte"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{htmlFor:"fazenda_destino",className:"text-sm font-medium whitespace-nowrap",children:"Fazenda Destino:"}),e.jsxs(ta,{value:l||"all",onValueChange:f=>d(f==="all"?"":f),children:[e.jsx(oa,{className:"w-[200px] sm:w-[280px]",children:e.jsx(na,{placeholder:"Todas as fazendas"})}),e.jsxs(ra,{children:[e.jsx(ge,{value:"all",children:"Todas as fazendas"}),o.map(f=>e.jsx(ge,{value:f.id,children:f.nome},f.id))]})]})]}),e.jsxs("div",{className:"text-sm text-slate-500",children:[s.length," pacote(s) encontrado(s)"]})]}),s.length===0?e.jsx(Ks,{title:"Nenhum pacote encontrado",description:"Selecione outra fazenda ou verifique se há pacotes disponíveis.",action:l?e.jsx(P,{variant:"outline",onClick:()=>d(""),children:"Limpar filtro"}):void 0}):e.jsx("div",{className:"space-y-4",children:s.map(f=>e.jsx(Go,{pacote:f,expandido:we.has(f.id),onToggleExpandir:()=>Te(f.id),onEditarFazendasDestino:()=>{Z(f),O([...f.fazendas_destino_ids]),de(!0)},onDespachar:()=>fe(f),resumoPacote:$(f),embrioesSelecionados:U,paginaAtual:b(f.id),pageSize:m,getClassificacaoAtual:D,onToggleSelecionarEmbriao:Oe,onSelecionarTodosDaPagina:w,onSetPagina:A=>M(f.id,A),onClassificar:A=>{te(A),ie({classificacao:D(A)||""}),W(!0)},onCongelar:A=>{if(!D(A)){a({title:"Classificação obrigatória",description:"Classifique o embrião primeiro.",variant:"destructive"});return}x(new Set([A.id])),S(!0)},onDirecionar:A=>{x(new Set([A.id])),X({cliente_id:""}),ee(!0)},onDescartar:A=>{x(new Set([A.id])),L({data_descarte:new Date().toISOString().split("T")[0],observacoes:""}),T(!0)}},f.id))}),F&&e.jsx($o,{selectedCount:U.size,onClassificar:()=>{ie({classificacao:""}),W(!0)},onCongelar:()=>{J({data_congelamento:new Date().toISOString().split("T")[0],localizacao_atual:""}),S(!0)},onDirecionar:()=>{X({cliente_id:""}),ee(!0)},onDescartar:()=>{L({data_descarte:new Date().toISOString().split("T")[0],observacoes:""}),T(!0)},onCancelar:_e}),e.jsx(Ko,{open:B&&!!se,onOpenChange:f=>{f||(W(!1),te(null))},embriao:se,classificacao:re.classificacao,onClassificacaoChange:f=>ie({classificacao:f}),onSubmit:y,submitting:G}),e.jsx(Uo,{open:B&&!se&&U.size>0,onOpenChange:f=>!f&&W(!1),count:U.size,classificacao:re.classificacao,onClassificacaoChange:f=>ie({classificacao:f}),onSubmit:H,submitting:G}),e.jsx(qo,{open:h,onOpenChange:S,count:U.size,data:pe,onDataChange:J,onSubmit:xe,submitting:G}),e.jsx(Ho,{open:N,onOpenChange:T,count:U.size,data:p,onDataChange:L,onSubmit:le,submitting:G}),e.jsx(Vo,{open:me,onOpenChange:ee,clientes:r,data:q,onDataChange:X,onSubmit:()=>ze(r),submitting:G}),e.jsx(Xo,{open:ae,onOpenChange:f=>{de(f),f||Z(null)},pacote:he,fazendas:o,fazendasSelecionadas:oe,onFazendasChange:O,onSubmit:Ae,submitting:G})]})}export{Mn as default};
