import{e as ce,f as de,r as d,s as N,j as e,a as me,B as x,L as O,H as xe,D as he}from"./index-DmNymSE5.js";import{C as _,a as w,b as S,d as b}from"./card-SrkIpKk5.js";import{T as R,a as q,b as h,c,d as B,e as n}from"./table-BEqiB4gi.js";import{D as G,a as je,b as M,c as Q,d as Z,e as J}from"./dialog-j4QKUGZf.js";import{I as g}from"./input-CUsCheD8.js";import{L as v}from"./label-u6KawL_e.js";import{T as ue,a as pe,b as $,c as k}from"./tabs-DU1S-P5P.js";import{P as ge}from"./PageHeader-C6hPTib0.js";import{E as ve}from"./EmptyState-8CewmVht.js";import{u as fe}from"./use-toast-8Wh80yTN.js";import{A as Ne}from"./arrow-left-4eR3Pk6r.js";import{S as K}from"./square-pen-D0yg8shX.js";import{S as Ce}from"./snowflake-BapSu9_S.js";import{P as De}from"./plus-BZvL1qCK.js";import{N as _e}from"./navigation-DGE_Fym9.js";import"./index-BMCBZPUE.js";import"./index-C79PyqkA.js";import"./x-BKw_NAIH.js";import"./index-DntbqoHW.js";import"./index-BoubMqWY.js";function Oe(){const{id:j}=ce(),I=de(),{toast:C}=fe(),[W,A]=d.useState(!0),[u,X]=d.useState(null),[z,Y]=d.useState([]),[E,ee]=d.useState([]),[y,se]=d.useState([]),[F,H]=d.useState(null),ae=({embriao:s})=>{const a=s.acasalamento,l=a==null?void 0:a.dose_semen,i=l==null?void 0:l.touro,r=a==null?void 0:a.aspiracao,o=r==null?void 0:r.doadora,f=s.lote_fiv;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"ID"}),e.jsx("p",{className:"font-medium",children:s.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Identificação"}),e.jsx("p",{className:"font-medium",children:s.identificacao||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Classificação"}),e.jsx("p",{className:"font-medium",children:s.classificacao||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Status"}),e.jsx("p",{className:"font-medium",children:s.status_atual||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Data de Congelamento"}),e.jsx("p",{className:"font-medium",children:s.data_congelamento?new Date(s.data_congelamento).toLocaleDateString("pt-BR"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Localização"}),e.jsx("p",{className:"font-medium",children:s.localizacao_atual||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Doadora"}),e.jsx("p",{className:"font-medium",children:(o==null?void 0:o.registro)||(o==null?void 0:o.nome)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Touro"}),e.jsxs("p",{className:"font-medium",children:[(i==null?void 0:i.nome)||"-",i!=null&&i.registro?` (${i.registro})`:""]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Raça do Touro"}),e.jsx("p",{className:"font-medium",children:(i==null?void 0:i.raca)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Data D0 (Lote FIV)"}),e.jsx("p",{className:"font-medium",children:f!=null&&f.data_abertura?new Date(f.data_abertura).toLocaleDateString("pt-BR"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Data de Aspiração (D-1)"}),e.jsx("p",{className:"font-medium",children:r!=null&&r.data_aspiracao?new Date(r.data_aspiracao).toLocaleDateString("pt-BR"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Hora de Aspiração"}),e.jsx("p",{className:"font-medium",children:(r==null?void 0:r.horario_aspiracao)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500",children:"Criado em"}),e.jsx("p",{className:"font-medium",children:s.created_at?new Date(s.created_at).toLocaleDateString("pt-BR"):"-"})]})]})},te=s=>{H(s)},[le,D]=d.useState(!1),[L,P]=d.useState(!1),[t,m]=d.useState({nome:"",sigla:"",localizacao:"",latitude:"",longitude:"",responsavel:"",contato_responsavel:""});d.useEffect(()=>{j&&U()},[j]);const U=async()=>{try{A(!0);const{data:s,error:a}=await N.from("clientes").select("*").eq("id",j).single();if(a)throw a;X(s);const{data:l,error:i}=await N.from("fazendas").select("*").eq("cliente_id",j).order("nome",{ascending:!0});if(i)throw i;Y(l||[]);const{data:r,error:o}=await N.from("doses_semen").select(`
          *,
          touro:touros(id, nome, registro, raca)
        `).eq("cliente_id",j).order("created_at",{ascending:!1});if(o)throw o;ee(r||[]);const{data:f,error:V}=await N.from("embrioes").select(`
          *,
          lote_fiv:lotes_fiv(id, data_abertura),
          acasalamento:lote_fiv_acasalamentos(
            id,
            dose_semen:doses_semen(
              id,
              touro:touros(id, nome, registro, raca)
            ),
            aspiracao:aspiracoes_doadoras(
              id,
              data_aspiracao,
              horario_aspiracao,
              doadora:doadoras(id, registro, nome)
            )
          )
        `).eq("cliente_id",j).eq("status_atual","CONGELADO").order("data_congelamento",{ascending:!1});if(V)throw V;se(f||[])}catch(s){C({title:"Erro ao carregar dados",description:s instanceof Error?s.message:"Erro desconhecido",variant:"destructive"})}finally{A(!1)}},ie=s=>{if(s.latitude&&s.longitude){const a=`geo:${s.latitude},${s.longitude}?q=${s.latitude},${s.longitude}`;window.location.href=a}else if(s.localizacao){const a=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.localizacao)}`;window.open(a,"_blank")}},ne=s=>s.latitude&&s.longitude||s.localizacao,[p,T]=d.useState(null),re=s=>{var a,l;m({nome:s.nome||"",sigla:s.sigla||"",localizacao:s.localizacao||"",latitude:((a=s.latitude)==null?void 0:a.toString())||"",longitude:((l=s.longitude)==null?void 0:l.toString())||"",responsavel:s.responsavel||"",contato_responsavel:s.contato_responsavel||""}),T(s),D(!0)},oe=async s=>{if(s.preventDefault(),!t.nome.trim()){C({title:"Erro de validação",description:"Nome da fazenda é obrigatório",variant:"destructive"});return}try{P(!0);const a={nome:t.nome,sigla:t.sigla.trim().toUpperCase()||null,localizacao:t.localizacao.trim()||null,latitude:t.latitude?parseFloat(t.latitude):null,longitude:t.longitude?parseFloat(t.longitude):null,responsavel:t.responsavel.trim()||null,contato_responsavel:t.contato_responsavel.trim()||null};if(p){const{error:l}=await N.from("fazendas").update(a).eq("id",p.id);if(l)throw l;C({title:"Fazenda atualizada",description:"Fazenda atualizada com sucesso"})}else{const{error:l}=await N.from("fazendas").insert([{...a,cliente_id:j}]);if(l)throw l;C({title:"Fazenda criada",description:"Fazenda criada com sucesso"})}D(!1),T(null),m({nome:"",sigla:"",localizacao:"",latitude:"",longitude:"",responsavel:"",contato_responsavel:""}),U()}catch(a){const l=a instanceof Error?a.message:"Erro desconhecido";C({title:p?"Erro ao atualizar fazenda":"Erro ao criar fazenda",description:l.includes("RLS")||l.includes("policy")?"RLS está bloqueando escrita. Configure políticas anon no Supabase.":l,variant:"destructive"})}finally{P(!1)}};return W?e.jsx(me,{}):u?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ge,{title:u.nome,description:"Detalhes do cliente",actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",size:"icon",onClick:()=>I("/clientes"),children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx(O,{to:`/clientes/${j}/editar`,children:e.jsxs(x,{variant:"outline",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Editar"]})})]})}),e.jsxs(_,{children:[e.jsx(w,{children:e.jsx(S,{children:"Informações do Cliente"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500",children:"Nome"}),e.jsx("p",{className:"text-base text-slate-900",children:u.nome})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500",children:"Telefone"}),e.jsx("p",{className:"text-base text-slate-900",children:u.telefone||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500",children:"Endereço"}),e.jsx("p",{className:"text-base text-slate-900",children:u.endereco||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500",children:"Cadastrado em"}),e.jsx("p",{className:"text-base text-slate-900",children:u.created_at?new Date(u.created_at).toLocaleDateString("pt-BR"):"-"})]})]})]}),e.jsxs(ue,{defaultValue:"fazendas",className:"w-full",children:[e.jsxs(pe,{children:[e.jsxs($,{value:"fazendas",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Fazendas (",z.length,")"]}),e.jsxs($,{value:"doses",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Doses de Sêmen (",E.length,")"]}),e.jsxs($,{value:"embrioes",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Embriões Congelados (",y.length,")"]})]}),e.jsx(k,{value:"fazendas",children:e.jsxs(_,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{children:"Fazendas do Cliente"}),e.jsxs(G,{open:le,onOpenChange:s=>{D(s),s||(T(null),m({nome:"",sigla:"",localizacao:"",latitude:"",longitude:"",responsavel:"",contato_responsavel:""}))},children:[e.jsx(je,{asChild:!0,children:e.jsxs(x,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Nova Fazenda"]})}),e.jsxs(M,{className:"max-w-md",children:[e.jsxs(Q,{children:[e.jsx(Z,{children:p?"Editar Fazenda":"Criar Nova Fazenda"}),e.jsx(J,{children:p?`Editando ${p.nome}`:`Criar fazenda para ${u.nome}`})]}),e.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"nome",children:"Nome da Fazenda *"}),e.jsx(g,{id:"nome",value:t.nome,onChange:s=>m({...t,nome:s.target.value}),placeholder:"Nome da fazenda",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"sigla",children:"Sigla (2-3 letras)"}),e.jsx(g,{id:"sigla",value:t.sigla,onChange:s=>{const a=s.target.value.toUpperCase().replace(/[^A-Z]/g,"").slice(0,3);m({...t,sigla:a})},placeholder:"Ex: SC, BV",maxLength:3,className:"w-24 uppercase"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usada para identificar embriões (ex: SC-2401-001)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"localizacao",children:"Localização"}),e.jsx(g,{id:"localizacao",value:t.localizacao,onChange:s=>m({...t,localizacao:s.target.value}),placeholder:"Cidade, Estado"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"latitude",children:"Latitude"}),e.jsx(g,{id:"latitude",type:"number",step:"any",value:t.latitude,onChange:s=>m({...t,latitude:s.target.value}),placeholder:"-23.550520"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"longitude",children:"Longitude"}),e.jsx(g,{id:"longitude",type:"number",step:"any",value:t.longitude,onChange:s=>m({...t,longitude:s.target.value}),placeholder:"-46.633308"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"responsavel",children:"Responsável"}),e.jsx(g,{id:"responsavel",value:t.responsavel,onChange:s=>m({...t,responsavel:s.target.value}),placeholder:"Nome do responsável"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"contato_responsavel",children:"Contato do Responsável"}),e.jsx(g,{id:"contato_responsavel",value:t.contato_responsavel,onChange:s=>m({...t,contato_responsavel:s.target.value}),placeholder:"Telefone ou email"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(x,{type:"submit",className:"flex-1 bg-green-600 hover:bg-green-700",disabled:L,children:L?"Salvando...":p?"Salvar":"Criar Fazenda"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>D(!1),disabled:L,children:"Cancelar"})]})]})]})]})]})}),e.jsx(b,{children:e.jsxs(R,{children:[e.jsx(q,{children:e.jsxs(h,{children:[e.jsx(c,{children:"Nome"}),e.jsx(c,{children:"Sigla"}),e.jsx(c,{children:"Localização"}),e.jsx(c,{children:"Responsável"}),e.jsx(c,{className:"text-right",children:"Ações"})]})}),e.jsx(B,{children:z.length===0?e.jsx(h,{children:e.jsx(n,{colSpan:5,className:"text-center text-slate-500",children:"Nenhuma fazenda cadastrada"})}):z.map(s=>e.jsxs(h,{children:[e.jsx(n,{className:"font-medium",children:e.jsx(O,{to:`/fazendas/${s.id}`,className:"text-green-600 hover:text-green-700 hover:underline",children:s.nome})}),e.jsx(n,{children:s.sigla||"-"}),e.jsx(n,{children:s.localizacao||"-"}),e.jsx(n,{children:s.responsavel||"-"}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>re(s),children:e.jsx(K,{className:"w-4 h-4"})}),ne(s)&&e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>ie(s),children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Navegar"]})]})})]},s.id))})]})})]})}),e.jsx(k,{value:"doses",children:e.jsxs(_,{children:[e.jsx(w,{children:e.jsx(S,{children:"Doses de Sêmen"})}),e.jsx(b,{children:e.jsxs(R,{children:[e.jsx(q,{children:e.jsxs(h,{children:[e.jsx(c,{children:"Nome (Touro)"}),e.jsx(c,{children:"Raça"}),e.jsx(c,{children:"Tipo"}),e.jsx(c,{children:"Quantidade"})]})}),e.jsx(B,{children:E.length===0?e.jsx(h,{children:e.jsx(n,{colSpan:4,className:"text-center text-slate-500",children:"Nenhuma dose de sêmen cadastrada"})}):E.map(s=>{const a=s.touro;return e.jsxs(h,{children:[e.jsxs(n,{className:"font-medium",children:[(a==null?void 0:a.nome)||"Touro desconhecido",(a==null?void 0:a.registro)&&e.jsxs("span",{className:"text-slate-500 ml-2",children:["(",a.registro,")"]})]}),e.jsx(n,{children:(a==null?void 0:a.raca)||s.raca||"-"}),e.jsx(n,{children:s.tipo_semen||"-"}),e.jsx(n,{children:s.quantidade??"-"})]},s.id)})})]})})]})}),e.jsxs(k,{value:"embrioes",children:[e.jsxs(_,{children:[e.jsx(w,{children:e.jsx(S,{children:"Embriões Congelados no Estoque"})}),e.jsx(b,{children:e.jsxs(R,{children:[e.jsx(q,{children:e.jsxs(h,{children:[e.jsx(c,{children:"Identificação"}),e.jsx(c,{children:"Classificação"}),e.jsx(c,{children:"Doadora"}),e.jsx(c,{children:"Touro"}),e.jsx(c,{children:"Data Congelamento"}),e.jsx(c,{children:"Localização"}),e.jsx(c,{className:"text-right",children:"Ações"})]})}),e.jsx(B,{children:y.length===0?e.jsx(h,{children:e.jsx(n,{colSpan:7,className:"text-center text-slate-500",children:"Nenhum embrião congelado no estoque"})}):y.map(s=>{const a=s.acasalamento,l=a==null?void 0:a.dose_semen,i=l==null?void 0:l.touro,r=a==null?void 0:a.aspiracao,o=r==null?void 0:r.doadora;return e.jsxs(h,{children:[e.jsx(n,{className:"font-medium",children:s.identificacao||"-"}),e.jsx(n,{children:s.classificacao?e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded bg-purple-100 text-purple-800",children:s.classificacao}):"-"}),e.jsx(n,{children:(o==null?void 0:o.registro)||(o==null?void 0:o.nome)||"-"}),e.jsxs(n,{children:[(i==null?void 0:i.nome)||"-",(i==null?void 0:i.registro)&&e.jsxs("span",{className:"text-slate-500 ml-2",children:["(",i.registro,")"]})]}),e.jsx(n,{children:s.data_congelamento?new Date(s.data_congelamento).toLocaleDateString("pt-BR"):"-"}),e.jsx(n,{children:s.localizacao_atual||"-"}),e.jsx(n,{className:"text-right",children:e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>te(s),children:"Detalhar"})})]},s.id)})})]})})]}),e.jsx(G,{open:!!F,onOpenChange:s=>!s&&H(null),children:e.jsxs(M,{className:"max-w-2xl",style:{opacity:1},children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"Detalhes do Embrião"}),e.jsx(J,{children:"Informações completas do embrião congelado direcionado ao cliente."})]}),F&&e.jsx(ae,{embriao:F})]})})]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsx(ve,{title:"Cliente não encontrado",description:"Volte para a lista e selecione outro cliente.",action:e.jsx(x,{onClick:()=>I("/clientes"),variant:"outline",children:"Voltar para Clientes"})})})}export{Oe as default};
