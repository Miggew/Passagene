import{a7 as xe,r as n,s as _,j as e,l as ue,ap as pe,B as b}from"./index-BPMeM9-O.js";import{C as fe,a as he,b as ge,d as je}from"./card-8azKTSNJ.js";import{I as _e}from"./input-tqcTRdPv.js";import{B as be}from"./badge-CeJDYfYs.js";import{S,a as q,b as T,c as w,d as x}from"./select-La4nrp5K.js";import{T as ve,a as Ne,b as H,c as ye}from"./tabs-siaSXH49.js";import{u as Ce}from"./useClienteFilter-CwSUSM41.js";import{P as Se}from"./PageHeader-DQ4rM2jO.js";import{e as qe}from"./exportPdf--R_Q0DDd.js";import{S as Te}from"./search-SyV5imYB.js";import{X as we}from"./x-BxiwAMrM.js";import{F as Me}from"./file-text-CtxiCcm9.js";import{f as ke,p as Ee}from"./pt-BR-CyDikW87.js";import"./index-C5PY5DOm.js";import"./check-Bdb-Yd05.js";import"./index-DWxJzuQO.js";const v=20;function Xe(){const[K,X]=xe(),{clienteIdFilter:i}=Ce(),[o,J]=n.useState(K.get("tipo")||"embrioes"),[U,F]=n.useState([]),[f,L]=n.useState("all"),[h,$]=n.useState("all"),[N,M]=n.useState("all"),[y,P]=n.useState(""),[C,k]=n.useState("all"),[A,W]=n.useState([]),[B,Y]=n.useState([]),[Z,ee]=n.useState([]),[u,g]=n.useState(1),[se,D]=n.useState(!0);n.useEffect(()=>{ae(),te()},[i]),n.useEffect(()=>{re(),g(1)},[o,f,h,N,C,i]);const ae=async()=>{if(i){const{data:t}=await _.from("clientes").select("*").eq("id",i);F(t??[]);return}const{data:s}=await _.from("clientes").select("*").order("nome");F(s??[])},te=async()=>{const{data:s}=await _.from("touros").select("id, nome").order("nome");ee(s??[])},re=async()=>{D(!0);try{o==="embrioes"?await ie():await oe()}catch(s){console.error("Erro ao carregar dados:",s)}finally{D(!1)}},ie=async()=>{let s=_.from("embrioes").select(`
        id,
        cliente_id,
        classificacao,
        tipo_embriao,
        data_congelamento,
        cliente:clientes(id, nome),
        acasalamento:lote_fiv_acasalamentos(
          id,
          dose_semen:doses_semen(
            touro:touros(id, nome)
          ),
          aspiracao:aspiracoes_doadoras(
            doadora:doadoras(id, registro, nome)
          )
        )
      `).eq("status_atual","CONGELADO").order("data_congelamento",{ascending:!1});i?s=s.eq("cliente_id",i):f!=="all"&&(s=s.eq("cliente_id",f));const{data:t}=await s,a=new Map;t==null||t.forEach(r=>{var R,O;const l=r.acasalamento,c=(R=l==null?void 0:l.aspiracao)==null?void 0:R.doadora,j=(O=l==null?void 0:l.dose_semen)==null?void 0:O.touro,E=r.cliente,V=`${r.cliente_id}-${(c==null?void 0:c.id)||"sem"}-${(j==null?void 0:j.id)||"sem"}-${r.classificacao||"sem"}`,z=a.get(V);z?z.quantidade++:a.set(V,{id:r.id,cliente_id:r.cliente_id||"",cliente_nome:(E==null?void 0:E.nome)??"N/A",doadora_registro:c==null?void 0:c.registro,doadora_nome:c==null?void 0:c.nome,touro_nome:j==null?void 0:j.nome,qualidade:r.classificacao?parseInt(r.classificacao):void 0,estadio:r.tipo_embriao,data_congelamento:r.data_congelamento,quantidade:1})});let m=Array.from(a.values());h!=="all"&&(m=m.filter(r=>{var l;return(l=r.touro_nome)==null?void 0:l.toLowerCase().includes(h.toLowerCase())})),C!=="all"&&(m=m.filter(r=>r.qualidade===parseInt(C))),W(m)},oe=async()=>{let s=_.from("doses_semen").select(`
        id,
        cliente_id,
        clientes(nome),
        touro_id,
        touros(nome, registro),
        tipo_semen,
        quantidade_disponivel,
        partida,
        data_aquisicao
      `).gt("quantidade_disponivel",0).order("created_at",{ascending:!1});i?s=s.eq("cliente_id",i):f!=="all"&&(s=s.eq("cliente_id",f)),h!=="all"&&(s=s.eq("touro_id",h)),N!=="all"&&(s=s.eq("tipo_semen",N));const{data:t}=await s;Y((t==null?void 0:t.map(a=>{var m,r,l;return{id:a.id,cliente_id:a.cliente_id,cliente_nome:((m=a.clientes)==null?void 0:m.nome)??"N/A",touro_nome:((r=a.touros)==null?void 0:r.nome)??"N/A",touro_registro:(l=a.touros)==null?void 0:l.registro,tipo_semen:a.tipo_semen,quantidade_disponivel:a.quantidade_disponivel,partida:a.partida,data_aquisicao:a.data_aquisicao}}))??[])},d=n.useMemo(()=>{let s=o==="embrioes"?A:B;if(y.trim()){const t=y.toLowerCase();o==="embrioes"?s=s.filter(a=>{var m,r,l,c;return((m=a.doadora_registro)==null?void 0:m.toLowerCase().includes(t))||((r=a.doadora_nome)==null?void 0:r.toLowerCase().includes(t))||((l=a.touro_nome)==null?void 0:l.toLowerCase().includes(t))||((c=a.cliente_nome)==null?void 0:c.toLowerCase().includes(t))}):s=s.filter(a=>{var m,r,l,c;return((m=a.touro_nome)==null?void 0:m.toLowerCase().includes(t))||((r=a.touro_registro)==null?void 0:r.toLowerCase().includes(t))||((l=a.cliente_nome)==null?void 0:l.toLowerCase().includes(t))||((c=a.partida)==null?void 0:c.toLowerCase().includes(t))})}return s},[o,A,B,y]),I=n.useMemo(()=>o==="embrioes"?{registros:d.length,quantidade:d.reduce((s,t)=>s+(t.quantidade||0),0)}:{registros:d.length,quantidade:d.reduce((s,t)=>s+(t.quantidade_disponivel||0),0)},[o,d]),p=Math.ceil(d.length/v),Q=n.useMemo(()=>{const s=(u-1)*v;return d.slice(s,s+v)},[d,u]),le=()=>{L("all"),$("all"),M("all"),k("all"),P(""),g(1)},ne=s=>{J(s),X({tipo:s}),g(1),M("all"),k("all")},G=s=>{if(!s)return"-";try{return ke(new Date(s+"T12:00:00"),"dd/MM/yyyy",{locale:Ee})}catch{return s}},de=s=>{if(!s)return"-";const t={1:"bg-primary/15 text-primary",2:"bg-amber-500/15 text-amber-600 dark:text-amber-400",3:"bg-red-500/15 text-red-600 dark:text-red-400"};return e.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 text-xs font-medium rounded ${t[s]||"bg-muted text-foreground"}`,children:s})},ce=s=>{const a={convencional:{label:"Conv.",color:"bg-muted text-foreground"},sexado_femea:{label:"Sexado F",color:"bg-pink-500/15 text-pink-600 dark:text-pink-400"},sexado_macho:{label:"Sexado M",color:"bg-blue-500/15 text-blue-600 dark:text-blue-400"}}[s]||{label:s,color:"bg-muted text-foreground"};return e.jsx(be,{className:a.color,children:a.label})},me=()=>{if(d.length===0)return;qe({embrioes:"embrioes",semen:"dosesSemen"}[o],d,{})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(Se,{title:"Material Genético",description:"Estoque de embriões congelados e doses de sêmen"}),e.jsxs(ve,{value:o,onValueChange:ne,children:[e.jsxs(Ne,{className:"grid w-full grid-cols-2 max-w-md",children:[e.jsxs(H,{value:"embrioes",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Embriões Congelados"]}),e.jsxs(H,{value:"semen",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Doses de Sêmen"]})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card p-4 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-[280px]",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_e,{placeholder:o==="embrioes"?"Buscar por doadora ou touro...":"Buscar por touro ou partida...",value:y,onChange:s=>P(s.target.value),className:"pl-9 h-9"})]}),e.jsx("div",{className:"h-6 w-px bg-border hidden sm:block"}),!i&&e.jsxs(S,{value:f,onValueChange:L,children:[e.jsx(q,{className:"w-[180px] h-9",children:e.jsx(T,{placeholder:"Cliente"})}),e.jsxs(w,{children:[e.jsx(x,{value:"all",children:"Todos os clientes"}),U.map(s=>e.jsx(x,{value:s.id,children:s.nome},s.id))]})]}),e.jsxs(S,{value:h,onValueChange:$,children:[e.jsx(q,{className:"w-[180px] h-9",children:e.jsx(T,{placeholder:"Touro"})}),e.jsxs(w,{children:[e.jsx(x,{value:"all",children:"Todos os touros"}),Z.map(s=>e.jsx(x,{value:s.id,children:s.nome},s.id))]})]}),o==="embrioes"&&e.jsxs(S,{value:C,onValueChange:k,children:[e.jsx(q,{className:"w-[130px] h-9",children:e.jsx(T,{placeholder:"Qualidade"})}),e.jsxs(w,{children:[e.jsx(x,{value:"all",children:"Todas"}),e.jsx(x,{value:"1",children:"Grau 1"}),e.jsx(x,{value:"2",children:"Grau 2"}),e.jsx(x,{value:"3",children:"Grau 3"})]})]}),o==="semen"&&e.jsxs(S,{value:N,onValueChange:M,children:[e.jsx(q,{className:"w-[150px] h-9",children:e.jsx(T,{placeholder:"Tipo"})}),e.jsxs(w,{children:[e.jsx(x,{value:"all",children:"Todos"}),e.jsx(x,{value:"convencional",children:"Convencional"}),e.jsx(x,{value:"sexado_femea",children:"Sexado Fêmea"}),e.jsx(x,{value:"sexado_macho",children:"Sexado Macho"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:le,className:"h-9",children:e.jsx(we,{className:"w-4 h-4"})}),d.length>0&&e.jsxs(b,{variant:"outline",size:"sm",onClick:me,className:"h-9 border-primary/30 text-primary hover:bg-primary/10 hover:border-primary/50",children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),"PDF"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 pt-3 border-t border-border",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{className:"text-foreground",children:I.registros})," registros"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{className:"text-primary",children:I.quantidade})," ",o==="embrioes"?"embriões":"doses"," no total"]})]})]}),e.jsx(ye,{value:o,className:"mt-4",children:e.jsxs(fe,{children:[e.jsx(he,{className:"pb-3",children:e.jsxs(ge,{className:"text-base",children:[o==="embrioes"&&`Embriões Congelados (${d.length})`,o==="semen"&&`Doses de Sêmen (${d.length})`]})}),e.jsx(je,{className:"pt-0",children:se?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando..."}):d.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum registro encontrado"}):e.jsxs(e.Fragment,{children:[o==="embrioes"&&e.jsxs("div",{className:"rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-[1.5fr_1.2fr_1.2fr_0.7fr_0.7fr_1fr_0.7fr] gap-0 bg-muted text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:[!i&&e.jsx("div",{className:"px-4 py-3",children:"Cliente"}),e.jsx("div",{className:`px-3 py-3 ${i?"px-4":""}`,children:"Doadora"}),e.jsx("div",{className:"px-3 py-3",children:"Touro"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Qual."}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Estádio"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Congelamento"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Qtd"})]}),Q.map(s=>e.jsxs("div",{className:`grid gap-0 items-center border-t border-border hover:bg-muted/30 ${i?"grid-cols-[1.2fr_1.2fr_0.7fr_0.7fr_1fr_0.7fr]":"grid-cols-[1.5fr_1.2fr_1.2fr_0.7fr_0.7fr_1fr_0.7fr]"}`,children:[!i&&e.jsx("div",{className:"px-4 py-3 text-sm truncate",children:s.cliente_nome}),e.jsxs("div",{className:`py-3 ${i?"px-4":"px-3"}`,children:[e.jsx("div",{className:"text-sm font-medium",children:s.doadora_registro||"-"}),s.doadora_nome&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.doadora_nome})]}),e.jsx("div",{className:"px-3 py-3 text-sm truncate",children:s.touro_nome||"-"}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:de(s.qualidade)}),e.jsx("div",{className:"px-3 py-3 text-center text-sm",children:s.estadio||"-"}),e.jsx("div",{className:"px-3 py-3 text-center text-sm",children:G(s.data_congelamento)}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-8 h-7 px-2 text-sm font-semibold bg-primary/15 text-primary rounded-lg",children:s.quantidade})})]},s.id))]}),o==="semen"&&e.jsxs("div",{className:"rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:`grid gap-0 bg-muted text-xs font-semibold text-muted-foreground uppercase tracking-wide ${i?"grid-cols-[1.5fr_1fr_1fr_1fr_0.8fr]":"grid-cols-[1.5fr_1.5fr_1fr_1fr_1fr_0.8fr]"}`,children:[!i&&e.jsx("div",{className:"px-4 py-3",children:"Cliente"}),e.jsx("div",{className:`px-3 py-3 ${i?"px-4":""}`,children:"Touro"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Tipo"}),e.jsx("div",{className:"px-3 py-3",children:"Partida"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Aquisição"}),e.jsx("div",{className:"px-3 py-3 text-center",children:"Qtd"})]}),Q.map(s=>e.jsxs("div",{className:`grid gap-0 items-center border-t border-border hover:bg-muted/30 ${i?"grid-cols-[1.5fr_1fr_1fr_1fr_0.8fr]":"grid-cols-[1.5fr_1.5fr_1fr_1fr_1fr_0.8fr]"}`,children:[!i&&e.jsx("div",{className:"px-4 py-3 text-sm truncate",children:s.cliente_nome}),e.jsxs("div",{className:`py-3 ${i?"px-4":"px-3"}`,children:[e.jsx("div",{className:"text-sm font-medium",children:s.touro_nome}),s.touro_registro&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.touro_registro})]}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:ce(s.tipo_semen)}),e.jsx("div",{className:"px-3 py-3 text-sm",children:s.partida||"-"}),e.jsx("div",{className:"px-3 py-3 text-center text-sm",children:G(s.data_aquisicao)}),e.jsx("div",{className:"px-3 py-3 flex justify-center",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-8 h-7 px-2 text-sm font-semibold bg-primary/15 text-primary rounded-lg",children:s.quantidade_disponivel})})]},s.id))]}),p>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Mostrando ",(u-1)*v+1," a ",Math.min(u*v,d.length)," de ",d.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>g(s=>Math.max(1,s-1)),disabled:u===1,children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,p)},(s,t)=>{let a;return p<=5||u<=3?a=t+1:u>=p-2?a=p-4+t:a=u-2+t,e.jsx(b,{variant:u===a?"default":"outline",size:"sm",className:`w-9 h-9 p-0 ${u===a?"bg-primary hover:bg-primary-dark":""}`,onClick:()=>g(a),children:a},a)})}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>g(s=>Math.min(p,s+1)),disabled:u===p,children:"Próximo"})]})]})]})})]})})]})]})}export{Xe as default};
