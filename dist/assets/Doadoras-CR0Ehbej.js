import{j as e,B as g,X as I,r as m,b as G,s as W,f as Y}from"./index-B-7HRnm0.js";import{C as O,a as $,b as M,d as U}from"./card-DdhhEbXV.js";import{T as q,a as V,b as R,c as f,d as J,e as j}from"./table-fky3lpGR.js";import{D as ee,f as ae,a as se,b as re,c as te,d as ie}from"./dialog-CIXjHraQ.js";import{S as X,a as Z,b as K,c as Q,d as T}from"./select-B0M3FCy4.js";import{I as k}from"./input-D2h8r4MO.js";import{L as B}from"./label-vBcRjcSu.js";import{P as oe}from"./PageHeader-CT7CFo0W.js";import{E as le}from"./EmptyState-gn01eel2.js";import{S as H}from"./skeleton-Ba6ODj6_.js";import{S as ne}from"./search-DcAWDjHO.js";import{D as ce,P as de}from"./DoadoraHistoricoAspiracoes-BJDboViY.js";import{f as me}from"./dateUtils-eJ5e6apA.js";import{B as he}from"./badge-BCHVCiM7.js";import{u as xe,c as ue}from"./hooks-D8DQgb83.js";import{u as pe}from"./useListFilter-BQgLoFnJ.js";import{u as fe}from"./use-toast-DDUqdzpY.js";import{F as je}from"./filter-WiIDhzCI.js";import{A as ge,a as ve,b as Ne}from"./arrow-up-HPg26f2D.js";import{P as we}from"./plus-Cnek-_uY.js";import{H as De}from"./history-CVgiEWSN.js";import{G as be}from"./gem-CW7dFMYc.js";import{S as _}from"./star-X44RvruR.js";import"./index-B4eR1KA_.js";import"./check-C6h7QFZL.js";import"./CountBadge-BBpPT0CT.js";import"./index-C6kCM6Yd.js";import"./useDebounce-DKd5f0iC.js";function Ce({fazendas:s,selectedFazendaId:a,onFazendaChange:r,title:t="Selecione a Fazenda",placeholder:i="Selecione uma fazenda",required:o=!1}){return e.jsxs(O,{children:[e.jsx($,{children:e.jsxs(M,{children:[t,o&&" *"]})}),e.jsx(U,{children:e.jsxs(X,{value:a,onValueChange:r,children:[e.jsx(Z,{className:"w-full",children:e.jsx(K,{placeholder:i})}),e.jsx(Q,{children:s.map(n=>e.jsx(T,{value:n.id,children:n.nome},n.id))})]})})]})}function Se({columns:s,rows:a=5,headers:r,showHeader:t=!0}){return e.jsxs(q,{children:[t&&e.jsx(V,{children:e.jsx(R,{children:r?r.map((i,o)=>e.jsx(f,{children:i},o)):Array.from({length:s}).map((i,o)=>e.jsx(f,{children:e.jsx(H,{className:"h-4 w-20"})},o))})}),e.jsx(J,{children:Array.from({length:a}).map((i,o)=>e.jsx(R,{children:Array.from({length:s}).map((n,d)=>e.jsx(j,{children:e.jsx(H,{className:`h-4 ${d===0?"w-24":d===s-1?"w-16":"w-32"}`})},d))},o))})]})}function ye({value:s,onChange:a,placeholder:r="Buscar...",label:t,id:i="search-input",className:o="",showClearButton:n=!0}){return e.jsxs("div",{className:`space-y-2 ${o}`,children:[t&&e.jsx(B,{htmlFor:i,children:t}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(k,{id:i,placeholder:r,value:s,onChange:d=>a(d.target.value),className:"pl-10 pr-10"}),n&&s&&e.jsx(g,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0 hover:bg-muted",onClick:()=>a(""),children:e.jsx(I,{className:"w-4 h-4 text-muted-foreground"})})]})]})}const _e=(s,a)=>{var r,t,i;return((r=s.nome)==null?void 0:r.toLowerCase().includes(a))||((t=s.registro)==null?void 0:t.toLowerCase().includes(a))||((i=s.raca)==null?void 0:i.toLowerCase().includes(a))||!1};function Fe(){const[s,a]=m.useState(""),[r,t]=m.useState("none"),[i,o]=m.useState(null),{data:n=[],isLoading:d,refetch:l}=xe(),{data:u=[],isLoading:v,refetch:N}=ue(s||void 0),{filtered:c,searchTerm:b,setSearchTerm:C,clearFilters:F,hasActiveFilters:h}=pe({data:u,searchFn:_e}),p=m.useMemo(()=>r==="none"?c:[...c].sort((S,D)=>{const A=S.ultima_aspiracao_data?new Date(S.ultima_aspiracao_data).getTime():0,y=D.ultima_aspiracao_data?new Date(D.ultima_aspiracao_data).getTime():0;return!S.ultima_aspiracao_data&&!D.ultima_aspiracao_data?0:S.ultima_aspiracao_data?D.ultima_aspiracao_data?r==="asc"?A-y:y-A:-1:1}),[c,r]);return{loading:d||(s?v:!1),fazendas:n,doadoras:u,filteredDoadoras:p,selectedFazendaId:s,setSelectedFazendaId:a,searchTerm:b,setSearchTerm:C,clearFilters:()=>{F(),t("none")},hasActiveFilters:h||r!=="none",sortByDate:r,setSortByDate:t,historicoDoadoraId:i,setHistoricoDoadoraId:o,loadFazendas:async()=>{await l()},loadDoadoras:async()=>{s&&await N()}}}const ze=["Holandesa","Jersey","Gir","Girolando"],P={registro:"",raca:"",racaCustom:""};function Ae({selectedFazendaId:s,onSuccess:a}){const r=G(),{toast:t}=fe(),[i,o]=m.useState(!1),[n,d]=m.useState(!1),[l,u]=m.useState(P),[v,N]=m.useState(""),c=m.useCallback(()=>{u(P),N("")},[]),b=m.useCallback(h=>{N(h),u(h==="Outra"?p=>({...p,raca:"",racaCustom:""}):p=>({...p,raca:h,racaCustom:""}))},[]),C=m.useCallback(h=>{o(h),h||c()},[c]),F=m.useCallback(async h=>{if(h.preventDefault(),!s){t({title:"Erro de validacao",description:"Selecione a fazenda primeiro",variant:"destructive"});return}if(!l.registro.trim()){t({title:"Erro de validacao",description:"Registro e obrigatorio",variant:"destructive"});return}const p=v==="Outra"?l.racaCustom.trim():l.raca.trim();if(!p){t({title:"Erro de validacao",description:"Raca e obrigatoria",variant:"destructive"});return}try{d(!0);const w={fazenda_id:s,registro:l.registro.trim(),raca:p},{data:x,error:z}=await W.from("doadoras").insert([w]).select().single();if(z)throw z;t({title:"Doadora criada",description:"Doadora criada com sucesso"}),o(!1),c(),a(),x!=null&&x.id&&r(`/doadoras/${x.id}`)}catch(w){const x=w instanceof Error?w.message:"Erro desconhecido";t({title:"Erro ao criar doadora",description:x.includes("RLS")||x.includes("policy")?"RLS esta bloqueando escrita. Configure politicas anon no Supabase.":x,variant:"destructive"})}finally{d(!1)}},[l,v,s,t,c,a,r]);return{formData:l,setFormData:u,racaSelecionada:v,setRacaSelecionada:N,showDialog:i,setShowDialog:o,submitting:n,resetForm:c,handleSubmit:F,handleDialogClose:C,handleRacaChange:b}}function da(){var D,A;const s=G(),{loading:a,fazendas:r,filteredDoadoras:t,selectedFazendaId:i,setSelectedFazendaId:o,searchTerm:n,setSearchTerm:d,sortByDate:l,setSortByDate:u,clearFilters:v,hasActiveFilters:N,historicoDoadoraId:c,setHistoricoDoadoraId:b,loadFazendas:C,loadDoadoras:F}=Fe(),{formData:h,setFormData:p,racaSelecionada:w,showDialog:x,submitting:z,handleSubmit:E,handleDialogClose:L,handleRacaChange:S}=Ae({selectedFazendaId:i,onSuccess:F});return m.useEffect(()=>{C()},[C]),a&&r.length===0?e.jsx(Y,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(oe,{title:"Doadoras",description:"Gerenciar doadoras do sistema"}),e.jsx(Ce,{fazendas:r,selectedFazendaId:i,onFazendaChange:o,placeholder:"Selecione uma fazenda para visualizar doadoras"}),i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(je,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Busca"})]}),e.jsx("div",{className:"flex-1 min-w-[220px]",children:e.jsx(ye,{value:n,onChange:d,placeholder:"Buscar por nome ou registro..."})})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-amber-500/40"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Última Aspiração"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(g,{variant:l==="desc"?"default":"outline",size:"sm",className:"h-8 px-2",onClick:()=>u(l==="desc"?"none":"desc"),title:"Mais recentes primeiro",children:[e.jsx(ve,{className:"w-3.5 h-3.5 mr-1"}),e.jsx("span",{className:"text-xs",children:"Recentes"})]}),e.jsxs(g,{variant:l==="asc"?"default":"outline",size:"sm",className:"h-8 px-2",onClick:()=>u(l==="asc"?"none":"asc"),title:"Mais antigas primeiro",children:[e.jsx(Ne,{className:"w-3.5 h-3.5 mr-1"}),e.jsx("span",{className:"text-xs",children:"Antigas"})]})]})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:v,className:"h-8",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Limpar"]})]})]}),e.jsx(Re,{showDialog:x,handleDialogClose:L,formData:h,setFormData:p,racaSelecionada:w,handleRacaChange:S,submitting:z,handleSubmit:E})]})}),e.jsxs(O,{children:[e.jsx($,{children:e.jsx(M,{children:"Lista de Doadoras"})}),e.jsx(U,{children:a?e.jsx(Se,{columns:8,rows:6,headers:["Registro","Nome","Ultima Aspiracao","Oocitos","Estado","Raca","Classificacao","Acoes"]}):e.jsx(Te,{doadoras:t,searchTerm:n,navigate:s,setHistoricoDoadoraId:b})})]}),c&&e.jsx(ce,{doadoraId:c,doadoraNome:((D=t.find(y=>y.id===c))==null?void 0:D.nome)||((A=t.find(y=>y.id===c))==null?void 0:A.registro),open:!!c,onClose:()=>b(null)})]}):e.jsx(le,{title:"Selecione uma fazenda",description:"Escolha uma fazenda para visualizar e gerenciar doadoras."})]})}function Re({showDialog:s,handleDialogClose:a,formData:r,setFormData:t,racaSelecionada:i,handleRacaChange:o,submitting:n,handleSubmit:d}){return e.jsxs(ee,{open:s,onOpenChange:a,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Nova Doadora"]})}),e.jsxs(se,{className:"max-w-md",children:[e.jsxs(re,{children:[e.jsx(te,{children:"Criar Nova Doadora"}),e.jsx(ie,{children:"Preencha os campos basicos. As informacoes detalhadas podem ser preenchidas apos a criacao."})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"registro",children:"Registro *"}),e.jsx(k,{id:"registro",value:r.registro,onChange:l=>t({...r,registro:l.target.value}),placeholder:"Registro da doadora",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"raca",children:"Raca *"}),e.jsxs(X,{value:i,onValueChange:o,children:[e.jsx(Z,{children:e.jsx(K,{placeholder:"Selecione a raca"})}),e.jsxs(Q,{children:[ze.map(l=>e.jsx(T,{value:l,children:l},l)),e.jsx(T,{value:"Outra",children:"Outra"})]})]}),i==="Outra"&&e.jsx(k,{id:"raca_custom",value:r.racaCustom,onChange:l=>t({...r,racaCustom:l.target.value,raca:l.target.value}),placeholder:"Digite a raca",className:"mt-2",required:!0})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(g,{type:"submit",className:"flex-1",disabled:n,children:n?"Salvando...":"Criar Doadora"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:n,children:"Cancelar"})]})]})]})]})}function Te({doadoras:s,searchTerm:a,navigate:r,setHistoricoDoadoraId:t}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(q,{children:[e.jsx(V,{children:e.jsxs(R,{children:[e.jsx(f,{children:"Registro"}),e.jsx(f,{children:"Nome"}),e.jsx(f,{children:"Ultima Aspiracao"}),e.jsx(f,{children:"Oocitos"}),e.jsx(f,{children:"Estado"}),e.jsx(f,{children:"Raca (Campos Especiais)"}),e.jsx(f,{children:"Classificacao"}),e.jsx(f,{className:"text-right",children:"Acoes"})]})}),e.jsx(J,{children:s.length===0?e.jsx(R,{children:e.jsx(j,{colSpan:8,className:"text-center text-muted-foreground",children:a?"Nenhuma doadora encontrada":"Nenhuma doadora cadastrada nesta fazenda"})}):s.map(i=>e.jsx(ke,{doadora:i,navigate:r,setHistoricoDoadoraId:t},i.id))})]})})}const ke=m.memo(function({doadora:a,navigate:r,setHistoricoDoadoraId:t}){const i=Be(a);return e.jsxs(R,{className:"cursor-pointer hover:bg-muted",onClick:()=>r(`/doadoras/${a.id}`),children:[e.jsx(j,{className:"font-medium",children:a.registro}),e.jsx(j,{children:a.nome||"-"}),e.jsx(j,{children:a.ultima_aspiracao_data?me(a.ultima_aspiracao_data):"-"}),e.jsx(j,{children:a.ultima_aspiracao_total_oocitos??"-"}),e.jsx(j,{children:e.jsx(he,{variant:"outline",className:a.disponivel_aspiracao?"bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/30":"bg-slate-500/10 text-slate-600 dark:text-slate-400 border-slate-500/30",children:a.disponivel_aspiracao?"Disponível":"Indisponível"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:a.raca||"-"}),i&&e.jsx("span",{className:"text-xs text-muted-foreground",children:i})]})}),e.jsx(j,{children:Ee(a.classificacao_genetica)}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:o=>{o.stopPropagation(),t(a.id)},children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Histórico"]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:o=>{o.stopPropagation(),r(`/doadoras/${a.id}`)},title:"Editar doadora",children:e.jsx(de,{className:"w-4 h-4"})})]})})]})});function Be(s){if(s.raca==="Gir"){const a=[];return s.gpta&&a.push(`GPTA: ${s.gpta}`),s.controle_leiteiro&&a.push(`Controle Leiteiro: ${s.controle_leiteiro}`),s.beta_caseina&&a.push(`Beta Caseina: ${s.beta_caseina}`),s.link_abcz&&a.push("Link ABCZ"),a.length>0?a.join(", "):null}return null}function Ee(s){if(!s)return"-";switch(s){case"1_estrela":return e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(_,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})});case"2_estrelas":return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx(_,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]});case"3_estrelas":return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx(_,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx(_,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]});case"diamante":return e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(be,{className:"w-4 h-4 fill-blue-500 text-blue-500"})});default:return"-"}}export{da as default};
