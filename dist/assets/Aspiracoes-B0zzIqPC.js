import{c as Y,a as aa,r as n,s as _,j as a,g as O,h as x}from"./index-CWtHucPz.js";import{u as ea,C as k,a as B,b as M,c as V}from"./use-toast-C_ednEV-.js";import{T as sa,a as ta,b as f,c as o,d as ia,e as r}from"./table-2v-HqcxP.js";import{B as v}from"./badge-DewFfdNp.js";import{L as N}from"./label-CDN-yMr6.js";import{S as ra,a as na,b as oa,c as ca,d as q}from"./select-BUr2m4f3.js";import{P as da}from"./PageHeader-DqMTzrbX.js";import{E as la}from"./EmptyState-B00kV8BS.js";import{f as ma}from"./dateUtils-eJ5e6apA.js";import{D as H}from"./DatePickerBR-D4MNcuwK.js";import{P as pa}from"./plus-CgYPqLq7.js";import{S as xa}from"./search-B6nVOFfl.js";import{E as ha}from"./eye-DbaOMCVJ.js";import"./index-RvRMy3My.js";import"./index-H2w26JuE.js";import"./check-D_BDiPDp.js";import"./chevron-right-CY2M1G_-.js";import"./popover-hCBfJPXC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=Y("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function Pa(){const z=aa(),{toast:j}=ea(),[h,R]=n.useState([]),[S,Z]=n.useState([]),[I,U]=n.useState([]),[A,E]=n.useState(!1),[$,T]=n.useState(!0),[D,G]=n.useState(!1),[F,J]=n.useState(""),[c,u]=n.useState(""),[d,g]=n.useState("");n.useEffect(()=>{K()},[]);const K=async()=>{try{T(!0);const{data:e,error:s}=await _.from("fazendas").select("id, nome").order("nome",{ascending:!0});if(s)throw s;U(e||[])}catch(e){j({title:"Erro ao carregar fazendas",description:e instanceof Error?e.message:"Erro desconhecido",variant:"destructive"})}finally{T(!1)}},Q=async()=>{try{E(!0);const{data:e,error:s}=await _.from("pacotes_aspiracao").select("*").order("data_aspiracao",{ascending:!1}).order("created_at",{ascending:!1});if(s)throw s;const i=new Map(I.map(t=>[t.id,t.nome])),m=(e==null?void 0:e.map(t=>t.id))||[],{data:y,error:L}=await _.from("aspiracoes_doadoras").select("pacote_aspiracao_id").in("pacote_aspiracao_id",m);if(L)throw L;const b=new Map;y==null||y.forEach(t=>{t.pacote_aspiracao_id&&b.set(t.pacote_aspiracao_id,(b.get(t.pacote_aspiracao_id)||0)+1)});const{data:w}=await _.from("pacotes_aspiracao_fazendas_destino").select("pacote_aspiracao_id, fazenda_destino_id").in("pacote_aspiracao_id",m),C=new Map;w==null||w.forEach(t=>{const l=C.get(t.pacote_aspiracao_id)||[],p=i.get(t.fazenda_destino_id);p&&!l.includes(p)&&l.push(p),C.set(t.pacote_aspiracao_id,l)});const X=(e||[]).map(t=>{let l=C.get(t.id);if(!l||l.length===0)if(t.fazenda_destino_id){const p=i.get(t.fazenda_destino_id);l=p?[p]:[]}else l=[];return{...t,fazenda_nome:i.get(t.fazenda_id),fazendas_destino_nomes:l,quantidade_doadoras:b.get(t.id)||0}});R(X),G(!0)}catch(e){j({title:"Erro ao carregar dados",description:e instanceof Error?e.message:"Erro desconhecido",variant:"destructive"})}finally{E(!1)}},W=()=>{if(!c||!d){j({title:"Campos obrigatórios",description:"Por favor, preencha a data inicial e a data final para realizar a busca",variant:"destructive"});return}if(c>d){j({title:"Data inválida",description:"A data inicial deve ser anterior ou igual à data final",variant:"destructive"});return}!D||h.length===0?Q():P()},P=()=>{if(h.length===0)return;let e=[...h];e=e.filter(s=>{const i=s.data_aspiracao.split("T")[0];return i>=c&&i<=d}),F&&(e=e.filter(s=>s.fazenda_id===F)),Z(e)};return n.useEffect(()=>{h.length>0&&c&&d&&D&&P()},[h]),$?a.jsx(O,{}):a.jsxs("div",{className:"space-y-6",children:[a.jsx(da,{title:"Aspirações",description:"Gerenciar aspirações",actions:a.jsxs(x,{onClick:()=>z("/aspiracoes/novo"),className:"bg-green-600 hover:bg-green-700",children:[a.jsx(pa,{className:"w-4 h-4 mr-2"}),"Nova Aspiração"]})}),a.jsxs(k,{children:[a.jsx(B,{children:a.jsx(M,{children:"Filtros"})}),a.jsxs(V,{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(N,{children:"Fazenda"}),a.jsxs(ra,{value:F||"all",onValueChange:e=>{J(e==="all"?"":e)},children:[a.jsx(na,{children:a.jsx(oa,{placeholder:"Todas as fazendas"})}),a.jsxs(ca,{children:[a.jsx(q,{value:"all",children:"Todas as fazendas"}),I.map(e=>a.jsx(q,{value:e.id,children:e.nome},e.id))]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(N,{children:"Data Inicial *"}),a.jsx(H,{value:c,onChange:u,max:d||""}),c&&d&&c>d&&a.jsx("p",{className:"text-sm text-red-500",children:"A data inicial deve ser anterior ou igual à data final"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(N,{children:"Data Final *"}),a.jsx(H,{value:d,onChange:g,min:c||""})]})]}),a.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[a.jsxs("div",{className:"flex flex-wrap gap-2 flex-1",children:[a.jsx(N,{className:"w-full text-sm font-medium text-slate-700",children:"Atalhos rápidos:"}),a.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-7);const i=s.toISOString().split("T")[0],m=e.toISOString().split("T")[0];u(i),g(m)},children:"Últimos 7 dias"}),a.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-30);const i=s.toISOString().split("T")[0],m=e.toISOString().split("T")[0];u(i),g(m)},children:"Últimos 30 dias"}),a.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-90);const i=s.toISOString().split("T")[0],m=e.toISOString().split("T")[0];u(i),g(m)},children:"Últimos 90 dias"})]}),a.jsxs(x,{type:"button",onClick:W,disabled:!c||!d||A,className:"bg-blue-600 hover:bg-blue-700",children:[a.jsx(xa,{className:"w-4 h-4 mr-2"}),"Buscar"]})]})]})]}),a.jsxs(k,{children:[a.jsx(B,{children:a.jsx(M,{children:"Lista de Aspirações"})}),a.jsx(V,{children:a.jsxs(sa,{children:[a.jsx(ta,{children:a.jsxs(f,{children:[a.jsx(o,{children:"Data"}),a.jsx(o,{children:"Fazenda"}),a.jsx(o,{children:"Fazenda Destino"}),a.jsx(o,{children:"Horário Início"}),a.jsx(o,{children:"Doadoras"}),a.jsx(o,{children:"Total Oócitos"}),a.jsx(o,{children:"Veterinário"}),a.jsx(o,{children:"Status"}),a.jsx(o,{children:"Usado em Lote FIV"}),a.jsx(o,{className:"text-right",children:"Ações"})]})}),a.jsx(ia,{children:!D&&S.length===0?a.jsx(f,{children:a.jsx(r,{colSpan:11,className:"text-center text-slate-500 py-12",children:a.jsxs("div",{className:"flex flex-col items-center gap-2",children:[a.jsx(fa,{className:"w-8 h-8 text-slate-400"}),a.jsx("p",{className:"text-lg font-medium",children:"Aplique filtros para visualizar as aspirações"}),a.jsx("p",{className:"text-sm",children:'Preencha a data inicial e data final, depois clique em "Buscar"'})]})})}):A?a.jsx(f,{children:a.jsx(r,{colSpan:11,className:"text-center text-slate-500 py-12",children:a.jsx(O,{})})}):S.length===0?a.jsx(f,{children:a.jsx(r,{colSpan:11,className:"text-center text-slate-500 py-12",children:a.jsx(la,{title:"Nenhuma aspiração encontrada",description:"Ajuste os filtros ou tente outro período."})})}):S.map(e=>a.jsxs(f,{className:"cursor-pointer hover:bg-slate-50",onClick:()=>z(`/aspiracoes/${e.id}`),children:[a.jsx(r,{children:ma(e.data_aspiracao)}),a.jsx(r,{className:"font-medium",children:e.fazenda_nome||"-"}),a.jsx(r,{children:a.jsx("div",{className:"flex flex-wrap gap-1",children:e.fazendas_destino_nomes&&e.fazendas_destino_nomes.length>0?e.fazendas_destino_nomes.map((s,i)=>a.jsx(v,{variant:"outline",className:"text-xs",children:s},i)):a.jsx("span",{className:"text-slate-400",children:"-"})})}),a.jsx(r,{children:e.horario_inicio||"-"}),a.jsx(r,{children:e.quantidade_doadoras||0}),a.jsx(r,{className:"font-medium",children:e.total_oocitos||0}),a.jsx(r,{children:e.veterinario_responsavel||"-"}),a.jsx(r,{children:a.jsx(v,{variant:e.status==="FINALIZADO"?"default":"secondary",children:e.status==="FINALIZADO"?"FINALIZADO":"EM ANDAMENTO"})}),a.jsx(r,{children:e.usado_em_lote_fiv?a.jsx(v,{variant:"destructive",children:"Usado"}):a.jsx(v,{variant:"outline",children:"Disponível"})}),a.jsx(r,{className:"text-right",onClick:s=>s.stopPropagation(),children:a.jsx(x,{variant:"ghost",size:"sm",onClick:()=>z(`/aspiracoes/${e.id}`),children:a.jsx(ha,{className:"w-4 h-4"})})})]},e.id))})]})})]})]})}export{Pa as default};
