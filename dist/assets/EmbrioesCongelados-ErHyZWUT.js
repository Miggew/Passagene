import{c as de,r as d,s as G,j as e,h as me,B as U,k as P}from"./index-6OJhfjKP.js";import{C,d as v,a as $,b as J}from"./card-D-gf0lmS.js";import{T as xe,a as he,b as K,c as j,d as je,e as u}from"./table-B_Z-CztY.js";import{D as ue,b as pe,c as fe,d as ge,e as Ne}from"./dialog-CFjhGf-B.js";import{S as L,a as b,b as R,c as k,d as p}from"./select-B7v4ZPbC.js";import{I as Ce}from"./input-_UHZ9n1P.js";import{B as A}from"./badge-ChTtRB_d.js";import{P as ve}from"./PageHeader-P7sO2uqv.js";import{E as we}from"./EmptyState-CEfkJzHC.js";import{u as De}from"./use-toast-DasFaehQ.js";import{S as Se}from"./search-DHWddfjN.js";import{E as Te}from"./eye-BPc5Q01W.js";import"./index-CtR1jODk.js";import"./x-kO07YPaG.js";import"./check-CgmfRmMI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=de("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function qe(){const{toast:O}=De(),[Q,z]=d.useState(!0),[f,W]=d.useState([]),[X,Y]=d.useState([]),[m,Z]=d.useState(""),[w,ee]=d.useState("todos"),[g,se]=d.useState("todos"),[D,ae]=d.useState("todos"),[S,te]=d.useState("todos"),[I,B]=d.useState(null);d.useEffect(()=>{ce()},[]);const ce=async()=>{try{z(!0);const{data:s,error:c}=await G.from("clientes").select("id, nome").order("nome");if(c)throw c;Y(s||[]);const{data:t,error:a}=await G.from("embrioes").select(`
          *,
          cliente:clientes(id, nome),
          lote_fiv:lotes_fiv(id, data_abertura),
          acasalamento:lote_fiv_acasalamentos(
            id,
            dose_semen:doses_semen(
              id,
              touro:touros(id, nome, registro, raca)
            ),
            aspiracao:aspiracoes_doadoras(
              id,
              data_aspiracao,
              horario_aspiracao,
              doadora:doadoras(id, registro, nome, raca)
            )
          )
        `).eq("status_atual","CONGELADO").order("data_congelamento",{ascending:!1});if(a)throw a;W(t||[])}catch(s){O({title:"Erro ao carregar dados",description:s instanceof Error?s.message:"Erro desconhecido",variant:"destructive"})}finally{z(!1)}},{racas:oe,classificacoes:re,touros:ne}=d.useMemo(()=>{const s=new Set,c=new Set,t=new Map;return f.forEach(a=>{var l,i;a.classificacao&&c.add(a.classificacao);const r=a.acasalamento,n=(l=r==null?void 0:r.aspiracao)==null?void 0:l.doadora,o=(i=r==null?void 0:r.dose_semen)==null?void 0:i.touro;n!=null&&n.raca&&s.add(n.raca),o!=null&&o.raca&&s.add(o.raca),o!=null&&o.id&&t.set(o.id,o.nome||o.registro||o.id)}),{racas:Array.from(s).sort(),classificacoes:Array.from(c).sort(),touros:Array.from(t.entries()).sort((a,r)=>a[1].localeCompare(r[1]))}},[f]),x=d.useMemo(()=>f.filter(s=>{var h,_,E,y,F,M,V,H,q;const c=s.acasalamento,t=(h=c==null?void 0:c.aspiracao)==null?void 0:h.doadora,a=(_=c==null?void 0:c.dose_semen)==null?void 0:_.touro,r=!m||((E=s.identificacao)==null?void 0:E.toLowerCase().includes(m.toLowerCase()))||((y=s.localizacao_atual)==null?void 0:y.toLowerCase().includes(m.toLowerCase()))||((M=(F=s.cliente)==null?void 0:F.nome)==null?void 0:M.toLowerCase().includes(m.toLowerCase()))||((V=t==null?void 0:t.registro)==null?void 0:V.toLowerCase().includes(m.toLowerCase()))||((H=t==null?void 0:t.nome)==null?void 0:H.toLowerCase().includes(m.toLowerCase()))||((q=a==null?void 0:a.nome)==null?void 0:q.toLowerCase().includes(m.toLowerCase())),n=w==="todos"||s.cliente_id===w,o=g==="todos"||(t==null?void 0:t.raca)===g||(a==null?void 0:a.raca)===g,l=D==="todos"||s.classificacao===D,i=S==="todos"||(a==null?void 0:a.id)===S;return r&&n&&o&&l&&i}),[f,m,w,g,D,S]),N=d.useMemo(()=>{const s=new Map,c=new Map;return x.forEach(t=>{var n;const a=((n=t.cliente)==null?void 0:n.nome)||"Sem cliente";s.set(a,(s.get(a)||0)+1);const r=t.classificacao||"Sem classificação";c.set(r,(c.get(r)||0)+1)}),{total:x.length,totalGeral:f.length,porCliente:Array.from(s.entries()).sort((t,a)=>a[1]-t[1]),porClassificacao:Array.from(c.entries()).sort((t,a)=>a[1]-t[1])}},[x,f]),T=s=>s?new Date(s).toLocaleDateString("pt-BR"):"-",le=()=>{const s=["Identificação","Cliente","Classificação","Doadora","Touro","Raça","Data Cong.","Localização"],c=x.map(o=>{var _,E,y;const l=o.acasalamento,i=(_=l==null?void 0:l.aspiracao)==null?void 0:_.doadora,h=(E=l==null?void 0:l.dose_semen)==null?void 0:E.touro;return[o.identificacao||"",((y=o.cliente)==null?void 0:y.nome)||"",o.classificacao||"",(i==null?void 0:i.registro)||(i==null?void 0:i.nome)||"",(h==null?void 0:h.nome)||"",(i==null?void 0:i.raca)||(h==null?void 0:h.raca)||"",T(o.data_congelamento),o.localizacao_atual||""]}),t=[s,...c].map(o=>o.map(l=>`"${l}"`).join(",")).join(`
`),a=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=`embrioes-congelados-${new Date().toISOString().split("T")[0]}.csv`,n.click(),URL.revokeObjectURL(r),O({title:"Exportação concluída",description:`${x.length} embriões exportados`})},ie=({embriao:s})=>{var l;const c=s.acasalamento,t=c==null?void 0:c.dose_semen,a=t==null?void 0:t.touro,r=c==null?void 0:c.aspiracao,n=r==null?void 0:r.doadora,o=s.lote_fiv;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Identificação"}),e.jsx("p",{className:"font-medium",children:s.identificacao||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Cliente"}),e.jsx("p",{className:"font-medium",children:((l=s.cliente)==null?void 0:l.nome)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Classificação"}),e.jsx("p",{className:"font-medium",children:s.classificacao?e.jsx(A,{variant:"secondary",children:s.classificacao}):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Status"}),e.jsx("p",{className:"font-medium",children:e.jsxs(A,{className:"bg-cyan-100 text-cyan-800",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"CONGELADO"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Data de Congelamento"}),e.jsx("p",{className:"font-medium",children:T(s.data_congelamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Localização"}),e.jsx("p",{className:"font-medium",children:s.localizacao_atual||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tipo"}),e.jsx("p",{className:"font-medium",children:s.tipo_embriao||"-"})]}),e.jsx("div",{className:"col-span-2 border-t pt-4 mt-2",children:e.jsx("p",{className:"text-muted-foreground font-medium mb-2",children:"Origem"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Doadora"}),e.jsxs("p",{className:"font-medium",children:[(n==null?void 0:n.registro)||(n==null?void 0:n.nome)||"-",(n==null?void 0:n.raca)&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",n.raca,")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Touro"}),e.jsxs("p",{className:"font-medium",children:[(a==null?void 0:a.nome)||"-",(a==null?void 0:a.registro)&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",a.registro,")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Raça do Touro"}),e.jsx("p",{className:"font-medium",children:(a==null?void 0:a.raca)||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Data D0 (Lote FIV)"}),e.jsx("p",{className:"font-medium",children:T(o==null?void 0:o.data_abertura)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Data de Aspiração"}),e.jsx("p",{className:"font-medium",children:T(r==null?void 0:r.data_aspiracao)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Hora de Aspiração"}),e.jsx("p",{className:"font-medium",children:(r==null?void 0:r.horario_aspiracao)||"-"})]}),s.observacoes&&e.jsxs("div",{className:"col-span-2 border-t pt-4 mt-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Observações"}),e.jsx("p",{className:"font-medium",children:s.observacoes})]})]})};return Q?e.jsx(me,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(ve,{title:"Embriões Congelados",description:"Estoque geral de embriões congelados",actions:e.jsxs(U,{variant:"outline",onClick:le,disabled:x.length===0,children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(C,{children:e.jsx(v,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-cyan-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Congelados"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalGeral})]})]})})}),e.jsx(C,{children:e.jsxs(v,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Filtrados"}),e.jsx("p",{className:"text-2xl font-bold",children:N.total})]})}),e.jsx(C,{children:e.jsxs(v,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clientes"}),e.jsx("p",{className:"text-2xl font-bold",children:N.porCliente.length})]})}),e.jsx(C,{children:e.jsxs(v,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Classificações"}),e.jsx("p",{className:"text-2xl font-bold",children:N.porClassificacao.length})]})})]}),N.porClassificacao.length>0&&e.jsxs(C,{children:[e.jsx($,{className:"pb-2",children:e.jsx(J,{className:"text-base",children:"Por Classificação"})}),e.jsx(v,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:N.porClassificacao.map(([s,c])=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted rounded-lg",children:[e.jsx(A,{variant:"secondary",children:s}),e.jsx("span",{className:"font-semibold text-sm",children:c})]},s))})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-xs",children:[e.jsx(Se,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Buscar...",value:m,onChange:s=>Z(s.target.value),className:"pl-8"})]}),e.jsxs(L,{value:w,onValueChange:ee,children:[e.jsx(b,{className:"w-[180px]",children:e.jsx(R,{placeholder:"Cliente"})}),e.jsxs(k,{children:[e.jsx(p,{value:"todos",children:"Todos Clientes"}),X.map(s=>e.jsx(p,{value:s.id,children:s.nome},s.id))]})]}),e.jsxs(L,{value:g,onValueChange:se,children:[e.jsx(b,{className:"w-[150px]",children:e.jsx(R,{placeholder:"Raça"})}),e.jsxs(k,{children:[e.jsx(p,{value:"todos",children:"Todas Raças"}),oe.map(s=>e.jsx(p,{value:s,children:s},s))]})]}),e.jsxs(L,{value:D,onValueChange:ae,children:[e.jsx(b,{className:"w-[150px]",children:e.jsx(R,{placeholder:"Classificação"})}),e.jsxs(k,{children:[e.jsx(p,{value:"todos",children:"Todas"}),re.map(s=>e.jsx(p,{value:s,children:s},s))]})]}),e.jsxs(L,{value:S,onValueChange:te,children:[e.jsx(b,{className:"w-[180px]",children:e.jsx(R,{placeholder:"Touro"})}),e.jsxs(k,{children:[e.jsx(p,{value:"todos",children:"Todos Touros"}),ne.map(([s,c])=>e.jsx(p,{value:s,children:c},s))]})]})]}),e.jsxs(C,{children:[e.jsx($,{children:e.jsxs(J,{children:["Embriões Congelados (",x.length,")"]})}),e.jsx(v,{children:x.length===0?e.jsx(we,{title:"Nenhum embrião encontrado",description:m||w!=="todos"||g!=="todos"||D!=="todos"||S!=="todos"?"Tente ajustar os filtros":"Nenhum embrião congelado no estoque"}):e.jsxs(xe,{children:[e.jsx(he,{children:e.jsxs(K,{children:[e.jsx(j,{children:"Identificação"}),e.jsx(j,{children:"Cliente"}),e.jsx(j,{children:"Classificação"}),e.jsx(j,{children:"Doadora"}),e.jsx(j,{children:"Touro"}),e.jsx(j,{children:"Raça"}),e.jsx(j,{children:"Data Cong."}),e.jsx(j,{children:"Localização"}),e.jsx(j,{className:"text-right",children:"Ações"})]})}),e.jsx(je,{children:x.map(s=>{var n,o,l;const c=s.acasalamento,t=(n=c==null?void 0:c.aspiracao)==null?void 0:n.doadora,a=(o=c==null?void 0:c.dose_semen)==null?void 0:o.touro,r=(t==null?void 0:t.raca)||(a==null?void 0:a.raca);return e.jsxs(K,{children:[e.jsx(u,{className:"font-medium font-mono text-sm",children:s.identificacao||"-"}),e.jsx(u,{children:((l=s.cliente)==null?void 0:l.nome)||"-"}),e.jsx(u,{children:s.classificacao?e.jsx(A,{variant:"secondary",children:s.classificacao}):"-"}),e.jsx(u,{children:(t==null?void 0:t.registro)||(t==null?void 0:t.nome)||"-"}),e.jsxs(u,{children:[(a==null?void 0:a.nome)||"-",(a==null?void 0:a.registro)&&e.jsxs("span",{className:"text-muted-foreground text-xs ml-1",children:["(",a.registro,")"]})]}),e.jsx(u,{children:r||"-"}),e.jsx(u,{children:T(s.data_congelamento)}),e.jsx(u,{children:s.localizacao_atual||"-"}),e.jsx(u,{className:"text-right",children:e.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>B(s),children:[e.jsx(Te,{className:"w-4 h-4 mr-1"}),"Detalhar"]})})]},s.id)})})]})})]}),e.jsx(ue,{open:!!I,onOpenChange:s=>!s&&B(null),children:e.jsxs(pe,{className:"max-w-2xl",children:[e.jsxs(fe,{children:[e.jsx(ge,{children:"Detalhes do Embrião"}),e.jsx(Ne,{children:"Informações completas do embrião congelado"})]}),I&&e.jsx(ie,{embriao:I})]})})]})}export{qe as default};
