import{c as _a,a as Na,r as t,s as _,j as e,B as y}from"./index-BPMeM9-O.js";import{C as ba,a as Da,b as ya,d as wa}from"./card-8azKTSNJ.js";import{D as ke,b as Ae,c as Fe,d as Ie,e as Ee}from"./dialog-CLDnxY7R.js";import{A as Pe,a as Oe,b as Re,c as Te,d as Le,e as Ve,f as Be,g as Me}from"./alert-dialog-CLsWNiMN.js";import{B as Ca}from"./badge-CeJDYfYs.js";import{I as x}from"./input-tqcTRdPv.js";import{L as P}from"./label-fluRYl3j.js";import{S as W,a as ee,b as ae,c as se,d as M}from"./select-La4nrp5K.js";import{P as Sa,a as za,b as ka}from"./popover-D1vF_0kq.js";import{C as Aa,a as Fa,b as Ia,c as He,d as Ea,e as Pa}from"./command-DZRkJAgr.js";import{P as Oa}from"./PageHeader-DQ4rM2jO.js";import{u as Ra}from"./use-toast-BGNwDi9e.js";import{f as Ta}from"./dateUtils-eJ5e6apA.js";import{D as La}from"./DatePickerBR-CHtWVvxh.js";import{U as Va}from"./user-BTDnQyTa.js";import{M as Ba}from"./map-pin-B27L4YNJ.js";import{X as Ma}from"./x-BxiwAMrM.js";import{P as qe}from"./plus-Ah0p7ggz.js";import{U as $e}from"./user-plus-NL-39gGx.js";import{T as Ha}from"./trash-2-D4PEDwvS.js";import{S as qa}from"./save-CVRLcPrA.js";import{T as $a}from"./triangle-alert-h0K6D8II.js";import"./index-C5PY5DOm.js";import"./check-Bdb-Yd05.js";import"./search-SyV5imYB.js";import"./chevron-right-BkIAhNYS.js";import"./pt-BR-CyDikW87.js";import"./calendar-CuUQg-xw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=_a("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),H="passagene_aspiracao_rascunho",Ga=24;function ys(){Na();const{toast:u}=Ra(),[re,Ue]=t.useState("nova-sessao"),[w,Ge]=t.useState([]),[Ja,te]=t.useState(!1),[h,O]=t.useState("form"),[oe,ie]=t.useState(!1),[Je,R]=t.useState(!1),[Xe,ne]=t.useState(!1),[ce,Ke]=t.useState(null),[o,C]=t.useState({fazenda_id:"",data_aspiracao:new Date().toISOString().split("T")[0],horario_inicio:"",veterinario_responsavel:"",tecnico_responsavel:""}),[g,T]=t.useState([]),[n,k]=t.useState([]),[L,de]=t.useState([]),[Ye,le]=t.useState(!1),q=t.useRef(0),[Ze,me]=t.useState([]),[Qe,$]=t.useState(!1),[We,pe]=t.useState(!1),[U,xe]=t.useState(""),[ea,G]=t.useState(!1),[aa,J]=t.useState(!1),[F,ue]=t.useState(""),[d,I]=t.useState({registro:"",nome:"",raca:"",racaCustom:""}),sa=["Nelore","Gir","Girolando","Holandesa","Jersey","Senepol","Angus","Brahman"],[E,he]=t.useState([]),[X,ra]=t.useState([]),[fe,ge]=t.useState(!1),[V,ve]=t.useState(!1),[K,Xa]=t.useState(""),[S,ta]=t.useState(""),[z,oa]=t.useState(""),[B,Ka]=t.useState(""),[je,ia]=t.useState(1),Y=15,_e=U.trim(),na=_e.length>=2,Ne=Ze.filter(a=>!g.includes(a.id)),Z=t.useMemo(()=>n.reduce((a,s)=>a+(s.total_oocitos||0),0),[n]),Q=g.length>0&&n.length>0;h==="doadoras"||n.length>0,Math.ceil(X.length/Y),t.useMemo(()=>{const a=(je-1)*Y,s=a+Y;return X.slice(a,s)},[X,je]),t.useEffect(()=>{ma()},[]),t.useEffect(()=>{be()&&R(!0)},[]),t.useEffect(()=>{if(h==="doadoras"||n.length>0){const a=setTimeout(()=>{ca()},1e3);return()=>clearTimeout(a)}},[o,g,n,h]),t.useEffect(()=>{const a=_e;if(!a){me([]),$(!1);return}const s=++q.current;$(!0),_.from("fazendas").select("id, nome").ilike("nome",`%${a}%`).order("nome",{ascending:!0}).limit(50).then(({data:r})=>{s===q.current&&me(r||[])}).finally(()=>{s===q.current&&$(!1)})},[U]),t.useEffect(()=>{o.fazenda_id&&h==="doadoras"&&ye()},[o.fazenda_id,h]);const be=()=>{try{const a=localStorage.getItem(H);if(!a)return null;const s=JSON.parse(a);return(Date.now()-s.timestamp)/(1e3*60*60)>Ga?(localStorage.removeItem(H),null):s}catch{return null}},ca=()=>{const a={formData:o,fazendas_destino_ids:g,doadoras:n,timestamp:Date.now()};localStorage.setItem(H,JSON.stringify(a))},De=()=>{localStorage.removeItem(H)},da=()=>{const a=be();a&&(C(a.formData),T(a.fazendas_destino_ids),k(a.doadoras),O("doadoras")),R(!1)},la=()=>{De(),R(!1)},ma=async()=>{try{te(!0);const{data:a,error:s}=await _.from("fazendas").select("id, nome").order("nome",{ascending:!0});if(s)throw s;Ge(a||[])}catch(a){u({title:"Erro ao carregar fazendas",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{te(!1)}},ye=async()=>{if(o.fazenda_id)try{le(!0);const{data:a,error:s}=await _.from("doadoras").select("*").eq("fazenda_id",o.fazenda_id).order("registro",{ascending:!0});if(s)throw s;const r=n.map(m=>m.doadora_id),l=(a||[]).filter(m=>!r.includes(m.id));de(l)}catch(a){u({title:"Erro ao carregar doadoras",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{le(!1)}},pa=()=>{if(!o.veterinario_responsavel.trim()){u({title:"Veterinário é obrigatório",variant:"destructive"});return}if(!o.tecnico_responsavel.trim()){u({title:"Técnico é obrigatório",variant:"destructive"});return}if(!o.fazenda_id){u({title:"Fazenda é obrigatória",variant:"destructive"});return}if(!o.data_aspiracao){u({title:"Data é obrigatória",variant:"destructive"});return}O("doadoras")},xa=()=>{O("form")},we=t.useCallback(()=>n.length===0?o.horario_inicio||"":n[n.length-1].hora_final||"",[n,o.horario_inicio]),ua=()=>{if(!F){u({title:"Selecione uma doadora",variant:"destructive"});return}const a=L.find(r=>r.id===F);if(!a)return;const s={doadora_id:a.id,registro:a.registro,nome:a.nome||void 0,raca:a.raca||void 0,horario_aspiracao:we(),hora_final:"",atresicos:0,degenerados:0,expandidos:0,desnudos:0,viaveis:0,total_oocitos:0,recomendacao_touro:"",observacoes:""};k(r=>[...r,s]),de(r=>r.filter(l=>l.id!==F)),ue(""),G(!1)},ha=()=>{if(!d.registro.trim()){u({title:"Registro é obrigatório",variant:"destructive"});return}const a=d.raca==="Outra"?d.racaCustom:d.raca,s={doadora_id:`new_${Date.now()}`,registro:d.registro.trim(),nome:d.nome.trim()||void 0,raca:a||void 0,isNew:!0,horario_aspiracao:we(),hora_final:"",atresicos:0,degenerados:0,expandidos:0,desnudos:0,viaveis:0,total_oocitos:0,recomendacao_touro:"",observacoes:""};k(r=>[...r,s]),I({registro:"",nome:"",raca:"",racaCustom:""}),J(!1)},fa=a=>{const s=n[a];k(r=>r.filter((l,m)=>m!==a)),s.isNew||w.length>0&&L.find(l=>l.id===s.doadora_id)||ye()},N=t.useCallback((a,s,r)=>{k(l=>{const m=l.map((v,b)=>{if(b!==a)return v;const f={...v,[s]:r};if(["atresicos","degenerados","expandidos","desnudos","viaveis"].includes(s)){const p=j=>j===s?typeof r=="number"?r:parseInt(String(r))||0:v[j]||0;f.total_oocitos=p("atresicos")+p("degenerados")+p("expandidos")+p("desnudos")+p("viaveis")}return f});return s==="hora_final"&&a<m.length-1&&(m[a+1]={...m[a+1],horario_aspiracao:r}),m})},[]),ga=async()=>{if(Q)try{ie(!0);const a=n.filter(i=>i.isNew),s=new Map;for(const i of a){const{data:p,error:j}=await _.from("doadoras").insert({fazenda_id:o.fazenda_id,registro:i.registro,nome:i.nome||null,raca:i.raca||null}).select().single();if(j)throw j;s.set(i.doadora_id,p.id)}const{data:r,error:l}=await _.from("pacotes_aspiracao").insert({fazenda_id:o.fazenda_id,fazenda_destino_id:g[0],data_aspiracao:o.data_aspiracao,horario_inicio:o.horario_inicio||null,veterinario_responsavel:o.veterinario_responsavel.trim(),tecnico_responsavel:o.tecnico_responsavel.trim(),total_oocitos:Z,status:"FINALIZADO"}).select().single();if(l)throw l;const m=g.map(i=>({pacote_aspiracao_id:r.id,fazenda_destino_id:i})),{error:v}=await _.from("pacotes_aspiracao_fazendas_destino").insert(m);if(v)throw v;const b=n.map(i=>{const p=i.isNew?s.get(i.doadora_id):i.doadora_id;return{pacote_aspiracao_id:r.id,doadora_id:p,fazenda_id:o.fazenda_id,data_aspiracao:o.data_aspiracao,horario_aspiracao:i.horario_aspiracao||null,hora_final:i.hora_final||null,atresicos:i.atresicos||0,degenerados:i.degenerados||0,expandidos:i.expandidos||0,desnudos:i.desnudos||0,viaveis:i.viaveis||0,total_oocitos:i.total_oocitos||0,veterinario_responsavel:o.veterinario_responsavel.trim(),tecnico_responsavel:o.tecnico_responsavel.trim(),recomendacao_touro:i.recomendacao_touro||null,observacoes:i.observacoes||null}}),{error:f}=await _.from("aspiracoes_doadoras").insert(b);if(f)throw f;De(),va(),u({title:"Aspiração finalizada",description:`${n.length} doadora(s) com ${Z} oócitos registrados`})}catch(a){u({title:"Erro ao finalizar aspiração",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{ie(!1)}},va=()=>{C({fazenda_id:"",data_aspiracao:new Date().toISOString().split("T")[0],horario_inicio:"",veterinario_responsavel:"",tecnico_responsavel:""}),T([]),k([]),O("form")},ja=()=>{ne(!1),ce&&(Ue(ce),Ke(null))},Ce=t.useCallback(async()=>{try{ge(!0);const{data:a,error:s}=await _.from("pacotes_aspiracao").select("*").order("data_aspiracao",{ascending:!1}).order("created_at",{ascending:!1}).limit(200);if(s)throw s;if(!a||a.length===0){he([]),ve(!0);return}const r=new Map(w.map(c=>[c.id,c.nome])),l=a.map(c=>c.id),[m,v]=await Promise.all([_.from("aspiracoes_doadoras").select("pacote_aspiracao_id").in("pacote_aspiracao_id",l),_.from("pacotes_aspiracao_fazendas_destino").select("pacote_aspiracao_id, fazenda_destino_id").in("pacote_aspiracao_id",l)]),b=m.data,f=v.data,i=new Map;b==null||b.forEach(c=>{c.pacote_aspiracao_id&&i.set(c.pacote_aspiracao_id,(i.get(c.pacote_aspiracao_id)||0)+1)});const p=new Map;f==null||f.forEach(c=>{const D=p.get(c.pacote_aspiracao_id)||[],A=r.get(c.fazenda_destino_id);A&&!D.includes(A)&&D.push(A),p.set(c.pacote_aspiracao_id,D)});const j=a.map(c=>{let D=p.get(c.id);if(!D||D.length===0)if(c.fazenda_destino_id){const A=r.get(c.fazenda_destino_id);D=A?[A]:[]}else D=[];return{...c,fazenda_nome:r.get(c.fazenda_id),fazendas_destino_nomes:D,quantidade_doadoras:i.get(c.id)||0}});he(j),ve(!0)}catch(a){u({title:"Erro ao carregar dados",description:a instanceof Error?a.message:"Erro desconhecido",variant:"destructive"})}finally{ge(!1)}},[w,u]),Se=t.useCallback(()=>{if(E.length===0)return;let a=[...E];if(S&&z&&(a=a.filter(s=>{const r=s.data_aspiracao.split("T")[0];return r>=S&&r<=z})),K&&(a=a.filter(s=>s.fazenda_id===K)),B.trim()){const s=B.toLowerCase().trim();a=a.filter(r=>{var f,i,p,j;const l=((f=r.fazenda_nome)==null?void 0:f.toLowerCase())||"",m=((i=r.veterinario_responsavel)==null?void 0:i.toLowerCase())||"",v=((p=r.tecnico_responsavel)==null?void 0:p.toLowerCase())||"",b=((j=r.fazendas_destino_nomes)==null?void 0:j.join(" ").toLowerCase())||"";return l.includes(s)||m.includes(s)||v.includes(s)||b.includes(s)})}ra(a),ia(1)},[E,S,z,K,B]);t.useEffect(()=>{E.length>0&&S&&z&&V&&Se()},[E,S,z,B,V,Se]),t.useEffect(()=>{if(re==="historico"&&!V&&!fe&&w.length>0){if(!S||!z){const a=new Date,s=new Date(a);s.setDate(a.getDate()-30),ta(s.toISOString().split("T")[0]),oa(a.toISOString().split("T")[0])}Ce()}},[re,V,fe,w.length,S,z,Ce]);const ze=a=>{var s;return((s=w.find(r=>r.id===a))==null?void 0:s.nome)||""};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Oa,{title:"Aspirações",description:"Gerenciar aspirações foliculares"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("div",{className:"rounded-xl border border-border bg-gradient-to-r from-card via-card to-muted/30 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-6",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-primary/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Va,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Responsáveis"})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Veterinário *"}),e.jsx(x,{placeholder:"Nome do veterinário",value:o.veterinario_responsavel,onChange:a=>C({...o,veterinario_responsavel:a.target.value}),className:"h-9",disabled:h==="doadoras"})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Técnico *"}),e.jsx(x,{placeholder:"Nome do técnico",value:o.tecnico_responsavel,onChange:a=>C({...o,tecnico_responsavel:a.target.value}),className:"h-9",disabled:h==="doadoras"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"w-1 h-6 rounded-full bg-emerald-500/40 self-center"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground self-center",children:[e.jsx(Ba,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Local"})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Fazenda *"}),e.jsxs(W,{value:o.fazenda_id,onValueChange:a=>C({...o,fazenda_id:a}),disabled:h==="doadoras",children:[e.jsx(ee,{className:"h-9",children:e.jsx(ae,{placeholder:"Selecione a fazenda"})}),e.jsx(se,{children:w.map(a=>e.jsx(M,{value:a.id,children:a.nome},a.id))})]})]}),e.jsxs("div",{className:"w-[130px] flex-shrink-0",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Data *"}),e.jsx(La,{value:o.data_aspiracao,onChange:a=>C({...o,data_aspiracao:a||""}),className:"h-9",disabled:h==="doadoras"})]}),e.jsxs("div",{className:"w-[90px] flex-shrink-0",children:[e.jsx("label",{className:"text-[10px] font-medium text-muted-foreground mb-1 block uppercase tracking-wide",children:"Hora"}),e.jsx(x,{type:"time",value:o.horario_inicio,onChange:a=>C({...o,horario_inicio:a.target.value}),className:"h-9",disabled:h==="doadoras"})]})]}),e.jsx("div",{className:"h-10 w-px bg-border hidden lg:block"}),e.jsx("div",{className:"flex items-end gap-3 ml-auto",children:h==="form"?e.jsxs(y,{onClick:pa,disabled:!o.veterinario_responsavel||!o.tecnico_responsavel||!o.fazenda_id||!o.data_aspiracao,className:"h-9 px-6 bg-primary hover:bg-primary-dark shadow-sm",children:[e.jsx(Ua,{className:"w-4 h-4 mr-2"}),"Continuar"]}):e.jsx(y,{variant:"outline",onClick:xa,className:"h-9",children:"Voltar"})})]})}),h==="doadoras"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border border-border bg-gradient-to-r from-primary/5 to-transparent p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-card rounded-lg p-3 border border-border",children:[e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide block mb-0.5",children:"Fazenda Origem"}),e.jsx("span",{className:"font-semibold text-sm text-foreground",children:ze(o.fazenda_id)})]}),e.jsxs("div",{className:"bg-card rounded-lg p-3 border border-border",children:[e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide block mb-0.5",children:"Data"}),e.jsx("span",{className:"font-semibold text-sm text-foreground",children:Ta(o.data_aspiracao)})]}),e.jsxs("div",{className:"bg-card rounded-lg p-3 border border-border",children:[e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide block mb-0.5",children:"Veterinário"}),e.jsx("span",{className:"font-medium text-sm text-foreground truncate block",children:o.veterinario_responsavel})]}),e.jsxs("div",{className:"bg-card rounded-lg p-3 border border-border",children:[e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide block mb-0.5",children:"Técnico"}),e.jsx("span",{className:"font-medium text-sm text-foreground truncate block",children:o.tecnico_responsavel})]})]}),e.jsx("div",{className:"flex items-center justify-center sm:justify-end",children:e.jsxs("div",{className:"bg-primary text-primary-foreground rounded-xl px-5 py-3 text-center min-w-[100px]",children:[e.jsx("span",{className:"text-2xl font-bold block",children:Z}),e.jsx("span",{className:"text-[10px] uppercase tracking-wide opacity-90",children:"oócitos"})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide mr-1",children:"Destino:"}),g.map(a=>e.jsxs(Ca,{variant:"secondary",className:"h-7 pl-3 pr-1.5 gap-1.5 bg-card border border-border hover:border-primary/50 transition-colors",children:[e.jsx("span",{className:"font-medium",children:ze(a)}),e.jsx("button",{type:"button",onClick:()=>T(s=>s.filter(r=>r!==a)),className:"hover:bg-destructive/10 hover:text-destructive rounded-full p-0.5 transition-colors",children:e.jsx(Ma,{className:"w-3 h-3"})})]},a)),e.jsxs(Sa,{open:We,onOpenChange:pe,children:[e.jsx(za,{asChild:!0,children:e.jsxs(y,{variant:"outline",size:"sm",className:`h-7 text-xs border-dashed ${g.length===0?"border-primary text-primary bg-primary/10 hover:bg-primary/20":"border-border hover:border-primary hover:text-primary"}`,children:[e.jsx(qe,{className:"w-3.5 h-3.5 mr-1"}),g.length===0?"Adicionar Destino *":"Adicionar"]})}),e.jsx(ka,{className:"w-[300px] p-0",align:"start",children:e.jsxs(Aa,{shouldFilter:!1,children:[e.jsx(Fa,{placeholder:"Buscar fazenda...",value:U,onValueChange:xe}),e.jsx(Ia,{children:na?Qe?e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Buscando..."}):Ne.length===0?e.jsx(He,{children:"Nenhuma encontrada"}):e.jsx(Ea,{children:Ne.map(a=>e.jsx(Pa,{value:`${a.nome} ${a.id}`,onSelect:()=>{T(s=>[...s,a.id]),xe(""),pe(!1)},children:a.nome},a.id))}):e.jsx(He,{children:"Digite pelo menos 2 letras"})})]})})]})]})})]}),e.jsxs(ba,{children:[e.jsx(Da,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ya,{className:"text-base",children:["Doadoras (",n.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{size:"sm",onClick:()=>G(!0),children:[e.jsx(qe,{className:"w-4 h-4 mr-1"}),"Adicionar"]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>J(!0),children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Nova"]})]})]})}),e.jsxs(wa,{className:"pt-0",children:[n.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'Nenhuma doadora adicionada. Clique em "Adicionar" ou "Nova" para começar.'}):e.jsxs("div",{className:"rounded-lg border border-border overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-[minmax(140px,1fr)_80px_80px_repeat(5,40px)_45px_1fr_1fr_32px] gap-0 bg-muted text-[10px] font-semibold text-muted-foreground uppercase tracking-wide",children:[e.jsx("div",{className:"px-3 py-2",children:"Doadora"}),e.jsx("div",{className:"px-2 py-2 text-center",children:"Início"}),e.jsx("div",{className:"px-2 py-2 text-center",children:"Fim"}),e.jsx("div",{className:"px-1 py-2 text-center",children:"Atr"}),e.jsx("div",{className:"px-1 py-2 text-center",children:"Deg"}),e.jsx("div",{className:"px-1 py-2 text-center",children:"Exp"}),e.jsx("div",{className:"px-1 py-2 text-center",children:"Des"}),e.jsx("div",{className:"px-1 py-2 text-center text-primary",children:"Viáv"}),e.jsx("div",{className:"px-1 py-2 text-center text-primary font-bold",children:"Total"}),e.jsx("div",{className:"px-2 py-2",children:"Touro"}),e.jsx("div",{className:"px-2 py-2",children:"Obs"}),e.jsx("div",{})]}),n.map((a,s)=>e.jsxs("div",{className:"group grid grid-cols-[minmax(140px,1fr)_80px_80px_repeat(5,40px)_45px_1fr_1fr_32px] gap-0 items-center border-t border-border hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",children:[e.jsx("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primary text-[10px] font-bold shrink-0",children:s+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:a.nome||a.registro}),a.raca&&e.jsx("span",{className:"text-[9px] text-muted-foreground bg-muted px-1 rounded shrink-0",children:a.raca}),a.isNew&&e.jsx("span",{className:"text-[9px] text-primary bg-primary/10 px-1 rounded shrink-0",children:"N"})]}),a.nome&&e.jsx("span",{className:"text-[10px] text-muted-foreground block truncate",children:a.registro})]})]}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(x,{type:"time",value:a.horario_aspiracao||"",onChange:r=>N(s,"horario_aspiracao",r.target.value),className:"h-7 text-xs text-center px-1 w-full",disabled:s===0})}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(x,{type:"time",value:a.hora_final||"",onChange:r=>N(s,"hora_final",r.target.value),className:"h-7 text-xs text-center px-1 w-full"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(x,{type:"number",min:"0",value:a.atresicos||"",onChange:r=>N(s,"atresicos",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full",placeholder:"0"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(x,{type:"number",min:"0",value:a.degenerados||"",onChange:r=>N(s,"degenerados",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full",placeholder:"0"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(x,{type:"number",min:"0",value:a.expandidos||"",onChange:r=>N(s,"expandidos",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full",placeholder:"0"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(x,{type:"number",min:"0",value:a.desnudos||"",onChange:r=>N(s,"desnudos",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full",placeholder:"0"})}),e.jsx("div",{className:"px-0.5 py-1",children:e.jsx(x,{type:"number",min:"0",value:a.viaveis||"",onChange:r=>N(s,"viaveis",parseInt(r.target.value)||0),className:"h-7 text-xs text-center px-0 w-full ring-1 ring-primary/20",placeholder:"0"})}),e.jsx("div",{className:"px-1 py-1 text-center",children:e.jsx("span",{className:"text-sm font-bold text-primary",children:a.total_oocitos||0})}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(x,{value:a.recomendacao_touro||"",onChange:r=>N(s,"recomendacao_touro",r.target.value),className:"h-7 text-xs px-2 w-full",placeholder:"Touro"})}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(x,{value:a.observacoes||"",onChange:r=>N(s,"observacoes",r.target.value),className:"h-7 text-xs px-2 w-full",placeholder:"Obs"})}),e.jsx("div",{className:"px-1 py-1 flex justify-center",children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>fa(s),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-destructive hover:bg-destructive/10",children:e.jsx(Ha,{className:"w-3.5 h-3.5"})})})]},a.doadora_id))]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs(y,{onClick:ga,disabled:!Q||oe,className:"bg-primary hover:bg-primary-dark",children:[e.jsx(qa,{className:"w-4 h-4 mr-2"}),oe?"Finalizando...":"Finalizar Aspiração"]})}),!Q&&e.jsx("p",{className:"text-xs text-destructive text-right mt-2",children:g.length===0&&n.length===0?"Adicione fazenda destino e pelo menos uma doadora":g.length===0?"Adicione pelo menos uma fazenda destino":"Adicione pelo menos uma doadora"})]})]})]})]}),e.jsx(Pe,{open:Je,onOpenChange:R,children:e.jsxs(Oe,{children:[e.jsxs(Re,{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx($a,{className:"h-5 w-5 text-primary"}),"Aspiração não finalizada encontrada"]}),e.jsx(Le,{children:"Você tem uma aspiração em andamento que não foi finalizada. Deseja continuar de onde parou?"})]}),e.jsxs(Ve,{children:[e.jsx(Be,{onClick:la,children:"Descartar"}),e.jsx(Me,{onClick:da,children:"Restaurar"})]})]})}),e.jsx(Pe,{open:Xe,onOpenChange:ne,children:e.jsxs(Oe,{children:[e.jsxs(Re,{children:[e.jsx(Te,{children:"Aspiração em andamento"}),e.jsxs(Le,{children:["Você tem ",n.length," doadora(s) adicionada(s) que não foram salvas. Os dados ficarão salvos localmente e você poderá continuar depois."]})]}),e.jsxs(Ve,{children:[e.jsx(Be,{children:"Continuar Editando"}),e.jsx(Me,{onClick:ja,children:"Sair"})]})]})}),e.jsx(ke,{open:ea,onOpenChange:G,children:e.jsxs(Ae,{children:[e.jsxs(Fe,{children:[e.jsx(Ie,{children:"Adicionar Doadora"}),e.jsx(Ee,{children:"Selecione uma doadora da fazenda"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Doadora *"}),e.jsxs(W,{value:F,onValueChange:ue,children:[e.jsx(ee,{children:e.jsx(ae,{placeholder:"Selecione uma doadora"})}),e.jsx(se,{children:Ye?e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Carregando..."}):L.length===0?e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Nenhuma doadora disponível"}):L.map(a=>e.jsxs(M,{value:a.id,children:[a.registro," ",a.nome?`- ${a.nome}`:""]},a.id))})]})]}),e.jsx(y,{onClick:ua,className:"w-full",disabled:!F,children:"Adicionar"})]})]})}),e.jsx(ke,{open:aa,onOpenChange:J,children:e.jsxs(Ae,{children:[e.jsxs(Fe,{children:[e.jsx(Ie,{children:"Cadastrar Nova Doadora"}),e.jsx(Ee,{children:"Preencha os dados da nova doadora"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Registro *"}),e.jsx(x,{value:d.registro,onChange:a=>I({...d,registro:a.target.value}),placeholder:"Número do registro"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Nome"}),e.jsx(x,{value:d.nome,onChange:a=>I({...d,nome:a.target.value}),placeholder:"Nome da doadora (opcional)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Raça"}),e.jsxs(W,{value:d.raca,onValueChange:a=>I({...d,raca:a}),children:[e.jsx(ee,{children:e.jsx(ae,{placeholder:"Selecione a raça"})}),e.jsxs(se,{children:[sa.map(a=>e.jsx(M,{value:a,children:a},a)),e.jsx(M,{value:"Outra",children:"Outra"})]})]})]}),d.raca==="Outra"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Raça Customizada *"}),e.jsx(x,{value:d.racaCustom,onChange:a=>I({...d,racaCustom:a.target.value}),placeholder:"Digite a raça"})]}),e.jsxs(y,{onClick:ha,className:"w-full",disabled:!d.registro,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Criar e Adicionar"]})]})]})})]})}export{ys as default};
